<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุฌุฏุงุฑ - ููุฏูููุฑุงุช ุงูุญุฏูุซุฉ</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Switch to Tajawal for better clarity -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body { font-family: 'Tajawal', sans-serif; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .fade-in-up { animation: fadeInUp 0.8s ease-out forwards; opacity: 0; transform: translateY(20px); }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
        
        /* --- 1. ุฅุถุงูุฉ ุญุฑูุฉ ุงูููุจ (Pop Animation) --- */
        @keyframes heartPop {
            0% { transform: scale(1); }
            50% { transform: scale(1.35); }
            100% { transform: scale(1); }
        }
        .heart-pop {
            animation: heartPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        /* ------------------------------------------ */

        /* --- FIX: Mega Menu Glitch (ุฅุตูุงุญ ุงููุงุฆูุฉ ุงูููุณุฏูุฉ) --- */
        .mega-menu { 
            visibility: hidden;
            opacity: 0;
            transform: translateY(10px);
            /* ุฅุถุงูุฉ ุชุฃุฎูุฑ ุจุณูุท ุนูุฏ ุงูุฅุบูุงู ูููุน ุงูุงุฎุชูุงุก ุงูููุงุฌุฆ */
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transition-delay: 0.15s; 
        }
        
        /* ุชุญุฏูุซ ุงูุฌุณุฑ ุงููููู:
           ุชู ุชูููู ุงูุนุฑุถ (width) ูุฌุนูู ููุฑูุฒุงู (left: 50%) ููููู ุชุญุช ุฒุฑ "ุงูุฃูุณุงู" ููุท 
           ููุง ูุบุทู ุงูุฃุฒุฑุงุฑ ุงููุฌุงูุฑุฉ ูุซู "ุงูุนุฑูุถ" ุฃู "ุงูุฑุฆูุณูุฉ".
        */
        .mega-menu::before {
            content: '';
            position: absolute;
            top: -30px; /* ูุบุทู ุงููุณุงูุฉ ุงูุนูููุฉ ุญุชู ุงูููุฏุฑ */
            left: 50%;
            transform: translateX(-50%); /* ุชูุณูุท ุงูุฌุณุฑ */
            width: 150px; /* ุนุฑุถ ูุญุฏูุฏ ููุงุณุจ ุงูุฒุฑ ููุท */
            height: 35px;
            background: transparent;
            display: block;
            z-index: 60;
        }

        .group:hover .mega-menu { 
            visibility: visible;
            opacity: 1;
            transform: translateY(0);
            transition-delay: 0s; /* ุงูุธููุฑ ููุฑุงู ุจุฏูู ุชุฃุฎูุฑ */
        }
        /* ------------------------------------ */

        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; }
        .gallery-thumb.active { border-color: #d97706; box-shadow: 0 0 0 1px #d97706; }

        /* NEW: Modern Horizontal Scrollbar */
        .custom-scrollbar-modern::-webkit-scrollbar {
            height: 6px; /* ุฃูุญู */
            background-color: transparent;
        }
        .custom-scrollbar-modern::-webkit-scrollbar-track {
            background-color: #f5f5f4; /* stone-100 */
            border-radius: 99px;
            margin-inline: 10px;
        }
        .custom-scrollbar-modern::-webkit-scrollbar-thumb {
            background-color: #d6d3d1; /* stone-300 */
            border-radius: 99px;
            border: 2px solid #f5f5f4; /* Padding effect */
        }
        .custom-scrollbar-modern::-webkit-scrollbar-thumb:hover {
            background-color: #78716c; /* stone-500 */
        }
    </style>
</head>
<!-- ุชู ุฅุถุงูุฉ flex ู min-h-screen ููุง ูุฅุตูุงุญ ูุดููุฉ ุงูุฌููุชุด -->
<body class="bg-white text-stone-900 selection:bg-stone-200 overflow-x-hidden flex flex-col min-h-screen">

    <!-- ๐ SPLASH SCREEN (ุดุงุดุฉ ุงูุฏุฎูู) -->
    <div id="splash-screen" class="fixed inset-0 z-[100] bg-white/80 backdrop-blur-3xl flex flex-col items-center justify-center transition-all duration-700 ease-in-out">
        <div class="relative">
            <!-- Background Glow -->
            <div class="absolute inset-0 bg-stone-200 rounded-full blur-3xl opacity-50 animate-pulse"></div>
            
            <!-- Logo Container -->
            <div id="splash-logo" class="relative z-10 flex flex-col items-center gap-4 transform transition-all duration-700 scale-100">
                <!-- ุณูุชู ุญูู ุงูุดุนุงุฑ ููุง ุฏููุงููููุงู ุฃู ุงุณุชุฎุฏุงู ุงูุงูุชุฑุงุถู -->
                <div class="text-6xl font-black text-stone-900 tracking-tighter flex items-center gap-1 animate-bounce">
                    ุฌุฏุงุฑ<span class="text-stone-400 text-7xl leading-3">.</span>
                </div>
                <p class="text-sm text-stone-500 font-bold tracking-[0.3em] uppercase animate-pulse">Decor & Art</p>
            </div>
        </div>
        
        <!-- Loading Bar -->
        <div class="mt-8 w-48 h-1 bg-stone-100 rounded-full overflow-hidden">
            <div class="h-full bg-stone-900 animate-[loading_2s_ease-in-out_forwards]"></div>
        </div>

        <style>
            @keyframes loading { 0% { width: 0; } 100% { width: 100%; } }
        </style>

        <script>
            // ูุญุงููุฉ ุชุญููู ุงูุดุนุงุฑ ูู ุงููุงุด ููุฑุงู ูุนุฑุถู ูู ุดุงุดุฉ ุงูุชุฑุญูุจ
            try {
                const cachedHero = localStorage.getItem('gedar_hero_cache');
                if (cachedHero) {
                    const settings = JSON.parse(cachedHero);
                    if (settings.logoUrl) {
                        document.getElementById('splash-logo').innerHTML = `
                            <img src="${settings.logoUrl}" class="w-32 md:w-40 h-auto object-contain animate-pulse drop-shadow-sm" alt="Logo">
                        `;
                    }
                }
            } catch(e) {}

            // ุฅุฎูุงุก ุงูุดุงุดุฉ ุจุนุฏ ุซุงููุชูู
            window.addEventListener('load', () => {
                setTimeout(() => {
                    const splash = document.getElementById('splash-screen');
                    const logo = document.getElementById('splash-logo');
                    if(splash) {
                        splash.classList.add('opacity-0', 'pointer-events-none');
                        if(logo) logo.classList.add('scale-150', 'opacity-0'); // Zoom out effect
                        
                        // ุฅุฒุงูุฉ ุงูุนูุตุฑ ูู DOM ุจุนุฏ ุงูุชูุงุก ุงูุญุฑูุฉ ูุชุฎููู ุงูุตูุญุฉ
                        setTimeout(() => splash.remove(), 800);
                    }
                }, 2000); // 2 seconds
            });
        </script>
    </div>
    <!-- ๐ END SPLASH SCREEN -->

    <!-- NEW: Top Promo Banner (Above Header) -->
    <div id="top-promo-banner" class="w-full fixed top-0 left-0 right-0 z-[60] hidden transition-all duration-300 bg-stone-900"></div>

    <!-- Navigation -->
    <!-- UPDATED: Modern Glassmorphism Header -->
    <nav id="navbar" class="fixed top-0 left-0 right-0 z-50 transition-all duration-500 bg-white/80 backdrop-blur-xl border-b border-stone-100/50 supports-[backdrop-filter]:bg-white/60">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center relative">
            
            <!-- Brand Logo (Modern Typography) -->
            <div id="navbar-brand" onclick="setView('home')" class="cursor-pointer flex flex-col items-start leading-none group z-50 transition-all select-none">
                <div class="text-3xl font-black tracking-tighter flex items-center gap-0.5 text-stone-900">
                    ุฌุฏุงุฑ<span class="text-stone-400 text-4xl leading-3 animate-pulse">.</span>
                </div>
                <span class="text-[0.6rem] text-stone-500 font-bold tracking-[0.2em] uppercase mt-1 opacity-0 group-hover:opacity-100 transition-opacity duration-500 -translate-y-2 group-hover:translate-y-0">Decor & Art</span>
            </div>

            <!-- Desktop Navigation (Centered & Animated) -->
            <div class="hidden md:flex absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 items-center gap-1 bg-stone-100/50 p-1.5 rounded-full border border-stone-200/50 backdrop-blur-sm">
                <button onclick="setView('home')" class="px-5 py-2 rounded-full text-xs font-bold text-stone-600 hover:bg-white hover:text-stone-900 hover:shadow-sm transition-all duration-300">ุงูุฑุฆูุณูุฉ</button>
                
                <div class="group h-full flex items-center relative">
                    <button onclick="setView('categories')" class="px-5 py-2 rounded-full text-xs font-bold text-stone-600 hover:bg-white hover:text-stone-900 hover:shadow-sm transition-all duration-300 flex items-center gap-1">
                        ุงูุฃูุณุงู <i data-lucide="chevron-down" size="12" class="group-hover:rotate-180 transition-transform duration-300 opacity-60"></i>
                    </button>
                    
                    <!-- Modern Mega Menu (Redesigned: Premium Look) -->
                    <div class="mega-menu fixed left-1/2 -translate-x-1/2 top-[85px] w-[95vw] max-w-[1200px] bg-white rounded-[2.5rem] shadow-2xl shadow-stone-200/50 border border-stone-100 overflow-hidden invisible opacity-0 translate-y-4 group-hover:visible group-hover:opacity-100 group-hover:translate-y-0 transition-all duration-300 ease-out z-[60]">
                        <div class="flex h-[500px]">
                            <!-- Sidebar Navigation (List) -->
                            <div class="w-[28%] bg-stone-50/80 p-8 flex flex-col border-l border-stone-100 relative">
                                <!-- Header -->
                                <div class="flex items-center gap-3 mb-6 text-stone-400">
                                    <i data-lucide="layout-grid" size="18"></i>
                                    <span class="text-xs font-bold tracking-[0.2em] uppercase">ุงูุชุตูููุงุช</span>
                                </div>
                                
                                <!-- List -->
                                <ul class="space-y-2 flex-1 overflow-y-auto custom-scrollbar pl-2 pr-1" id="mega-menu-categories-list">
                                    <!-- Injected via JS -->
                                </ul>

                                <!-- Bottom Action -->
                                <div class="mt-4 pt-4 border-t border-stone-200">
                                    <button onclick="viewAllProducts()" class="group w-full flex items-center justify-between p-4 rounded-2xl bg-stone-900 text-white hover:bg-stone-800 transition-all shadow-lg hover:shadow-stone-900/20 active:scale-95">
                                        <div class="flex items-center gap-3">
                                            <div class="p-1.5 bg-white/10 rounded-lg"><i data-lucide="package" size="16"></i></div>
                                            <span class="font-bold text-sm">ูู ุงูููุชุฌุงุช</span>
                                        </div>
                                        <i data-lucide="arrow-left" size="16" class="transition-transform group-hover:-translate-x-1"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- Visual Content Area (Grid) -->
                            <div class="w-[72%] p-10 bg-white relative overflow-hidden">
                                <!-- Background Decoration -->
                                <div class="absolute top-0 right-0 w-64 h-64 bg-stone-50 rounded-full blur-3xl -mr-20 -mt-20 pointer-events-none"></div>
                                
                                <div class="flex justify-between items-end mb-8 relative z-10">
                                    <div>
                                        <h3 class="text-3xl font-bold text-stone-900 mb-2 tracking-tight">ุฃูุณุงู ูููุฒุฉ</h3>
                                        <p class="text-stone-500 text-sm">ุงุณุชูุดู ูุฌููุนุงุชูุง ุงููุฎุชุงุฑุฉ ุจุนูุงูุฉ ูุชูุงุณุจ ุฐููู ุงูุฑููุน</p>
                                    </div>
                                    <button onclick="setView('categories')" class="group flex items-center gap-2 px-5 py-2.5 rounded-full bg-stone-50 text-stone-600 font-bold text-xs hover:bg-stone-100 transition-colors">
                                        ุนุฑุถ ุฌููุน ุงูุฃูุณุงู
                                        <div class="w-5 h-5 bg-white rounded-full flex items-center justify-center shadow-sm group-hover:-translate-x-1 transition-transform">
                                            <i data-lucide="arrow-left" size="10"></i>
                                        </div>
                                    </button>
                                </div>

                                <div id="mega-menu-popular-list" class="grid grid-cols-3 gap-6 h-[360px] relative z-10">
                                    <!-- Injected via JS -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <button onclick="setView('offers')" class="px-5 py-2 rounded-full text-xs font-bold text-stone-600 hover:bg-red-50 hover:text-red-600 hover:shadow-sm transition-all duration-300 flex items-center gap-1"><i data-lucide="flame" size="12"></i> ุงูุนุฑูุถ</button>
                <button onclick="setView('shop')" class="px-5 py-2 rounded-full text-xs font-bold text-stone-600 hover:bg-white hover:text-stone-900 hover:shadow-sm transition-all duration-300">ุงููุชุฌุฑ</button>
                <button onclick="setView('track-order')" class="px-5 py-2 rounded-full text-xs font-bold text-stone-600 hover:bg-white hover:text-stone-900 hover:shadow-sm transition-all duration-300">ุชุชุจุน ุทูุจู</button>
                <button onclick="setView('contact')" class="px-5 py-2 rounded-full text-xs font-bold text-stone-600 hover:bg-white hover:text-stone-900 hover:shadow-sm transition-all duration-300">ุชูุงุตู</button>
            </div>

            <!-- Action Icons (Right Side) -->
            <div class="flex items-center gap-3 z-50">
                
                <!-- Search (Expandable) -->
                <div id="top-search-wrapper" class="relative">
                    <div id="top-search-bar" class="flex items-center bg-transparent hover:bg-stone-100 rounded-full h-10 w-10 transition-all duration-300 ease-out overflow-hidden border border-transparent cursor-pointer" onclick="toggleTopSearch(event)">
                        <button class="w-10 h-10 flex items-center justify-center text-stone-600 hover:text-stone-900 shrink-0">
                            <i data-lucide="search" size="20"></i>
                        </button>
                        <input 
                            id="top-search-input" 
                            type="text" 
                            class="w-full h-full bg-transparent border-none outline-none text-sm px-3 text-stone-800 opacity-0 transition-opacity duration-200 placeholder:text-stone-400 font-medium" 
                            placeholder="ุงุจุญุซ..."
                            onkeydown="handleGlobalSearch(event)"
                            onclick="event.stopPropagation()" 
                            autocomplete="off"
                        >
                    </div>
                </div>

                <!-- Favorites -->
                <button onclick="setView('favorites')" class="relative w-10 h-10 flex items-center justify-center rounded-full hover:bg-stone-100 text-stone-600 hover:text-red-500 transition-colors group" title="ุงูููุถูุฉ">
                    <i data-lucide="heart" size="20" class="group-hover:scale-110 transition-transform"></i>
                    <span id="fav-badge" class="absolute top-2 right-2 h-2 w-2 bg-red-500 rounded-full hidden ring-2 ring-white"></span>
                </button>
                
                <!-- Cart -->
                <button onclick="toggleCart(true)" class="relative w-10 h-10 flex items-center justify-center rounded-full hover:bg-stone-100 text-stone-600 hover:text-stone-900 transition-colors group">
                    <i data-lucide="shopping-bag" size="20" class="group-hover:scale-110 transition-transform"></i>
                    <!-- ุชู ุฅุฒุงูุฉ scale-0 ููุธูุฑ ุงูุฑูู ุฏุงุฆูุงู ุฅุฐุง ูุงู ููุงู ููุชุฌุงุช -->
                    <span id="cart-badge" class="absolute -top-1 -right-1 h-5 w-5 bg-red-600 text-white text-[10px] flex items-center justify-center rounded-full hidden font-bold border-2 border-white shadow-sm">0</span>
                </button>

                <!-- User Profile -->
                <div class="relative group/user pl-2" id="user-menu-container">
                    <!-- Injected via JS -->
                </div>
            </div>
        </div>

        <!-- NEW: Mobile Quick Menu (Text Only - Modern Desktop Style) -->
        <!-- UPDATED: ุชุตููู ุนุตุฑู ูุดุจู ุงูููุจููุชุฑ (ุจุฏูู ุฃููููุงุชุ ูุตูุต ููุท ุฏุงุฎู ูุจุณููุงุช) -->
        <div class="md:hidden w-full overflow-x-auto scrollbar-hide py-2.5 bg-white/80 backdrop-blur-xl border-t border-stone-100/50">
            <div class="flex items-center gap-2 px-4 min-w-full w-fit">
                <button onclick="setView('home')" class="px-5 py-2 rounded-full text-[11px] font-bold bg-stone-900 text-white border border-stone-900 whitespace-nowrap shadow-md hover:scale-105 transition-transform">ุงูุฑุฆูุณูุฉ</button>
                <button onclick="setView('categories')" class="px-5 py-2 rounded-full text-[11px] font-bold bg-white text-stone-600 border border-stone-200 whitespace-nowrap hover:bg-white hover:border-stone-300 transition-all shadow-sm">ุงูุฃูุณุงู</button>
                <button onclick="setView('offers')" class="px-5 py-2 rounded-full text-[11px] font-bold bg-red-50 text-red-600 border border-red-100 whitespace-nowrap hover:bg-red-100 transition-all shadow-sm">ุงูุนุฑูุถ</button>
                <button onclick="setView('shop')" class="px-5 py-2 rounded-full text-[11px] font-bold bg-white text-stone-600 border border-stone-200 whitespace-nowrap hover:bg-white hover:border-stone-300 transition-all shadow-sm">ุงููุชุฌุฑ</button>
                <button onclick="setView('track-order')" class="px-5 py-2 rounded-full text-[11px] font-bold bg-white text-stone-600 border border-stone-200 whitespace-nowrap hover:bg-white hover:border-stone-300 transition-all shadow-sm">ุชุชุจุน ุทูุจู</button>
                <button onclick="setView('contact')" class="px-5 py-2 rounded-full text-[11px] font-bold bg-white text-stone-600 border border-stone-200 whitespace-nowrap hover:bg-white hover:border-stone-300 transition-all shadow-sm">ุชูุงุตู</button>
            </div>
        </div>

        <!-- Mobile Menu (Full Screen Overlay) -->
        <div id="mobile-menu" class="absolute top-full left-0 w-full bg-white/95 backdrop-blur-xl shadow-lg hidden flex-col border-t border-stone-100 h-[calc(100vh-80px)] overflow-y-auto pb-20 z-40">
            <div id="mobile-user-section" class="p-6 bg-white mb-2 border-b border-stone-100">
                <!-- Mobile User Info Injected Here -->
            </div>
            
            <div class="p-4 space-y-2">
                <button onclick="setView('home'); toggleMobileMenu()" class="w-full flex items-center justify-between p-4 rounded-2xl hover:bg-white transition-colors font-bold text-stone-700">
                    <span class="flex items-center gap-3"><i data-lucide="home" size="18" class="text-stone-400"></i> ุงูุฑุฆูุณูุฉ</span>
                    <i data-lucide="chevron-left" size="16" class="text-stone-300"></i>
                </button>
                
                <div class="border border-stone-100 rounded-2xl overflow-hidden">
                    <button onclick="document.getElementById('mobile-cats').classList.toggle('hidden')" class="w-full flex items-center justify-between p-4 hover:bg-white transition-colors font-bold text-stone-700 bg-white">
                        <span class="flex items-center gap-3"><i data-lucide="grid" size="18" class="text-stone-400"></i> ุงูุฃูุณุงู</span>
                        <i data-lucide="chevron-down" size="16" class="text-stone-300"></i>
                    </button>
                    <div id="mobile-cats" class="hidden bg-white/50 p-2 space-y-1 border-t border-stone-100"><div id="mobile-cats-list"></div></div>
                </div>

                <button onclick="setView('offers'); toggleMobileMenu()" class="w-full flex items-center justify-between p-4 rounded-2xl bg-red-50 hover:bg-red-100 transition-colors font-bold text-red-600 border border-red-100">
                    <span class="flex items-center gap-3"><i data-lucide="flame" size="18"></i> ุงูุนุฑูุถ ูุงูุฎุตููุงุช</span>
                    <i data-lucide="chevron-left" size="16"></i>
                </button>

                <button onclick="setView('track-order'); toggleMobileMenu()" class="w-full flex items-center justify-between p-4 rounded-2xl hover:bg-white transition-colors font-bold text-stone-700">
                    <span class="flex items-center gap-3"><i data-lucide="package-search" size="18" class="text-blue-500"></i> ุชุชุจุน ุทูุจู</span>
                    <i data-lucide="chevron-left" size="16" class="text-stone-300"></i>
                </button>
                
                <button onclick="setView('contact'); toggleMobileMenu()" class="w-full flex items-center justify-between p-4 rounded-2xl hover:bg-white transition-colors font-bold text-stone-700">
                    <span class="flex items-center gap-3"><i data-lucide="phone" size="18" class="text-stone-400"></i> ุชูุงุตู ูุนูุง</span>
                    <i data-lucide="chevron-left" size="16" class="text-stone-300"></i>
                </button>
            </div>

            <div class="mt-auto p-6 border-t border-stone-100" id="mobile-admin-link">
                <!-- Admin link -->
            </div>
        </div>
    </nav>

    <!-- NEW LOCATION: Header Banner (Below Fixed Nav) -->
    <!-- ุชู ุชูููู ุงููุงูุด ุงูุนููู mt ูุชูููู ุงููุฌูุฉ: ุงูููุจุงูู 85px ูุงูููุจููุชุฑ 74px -->
    <div id="header-banner-container" class="w-full z-30 transition-all duration-300 hidden mt-[85px] md:mt-[74px]"></div>

    <!-- ุชู ุฅุถุงูุฉ flex-grow ููุง ูุฏูุน ุงูู Footer ููุฃุณูู ุฏุงุฆูุงู -->
    <main id="main-content" class="flex-grow"></main>

    <!-- Drawers & Modals -->
    <div id="cart-drawer-backdrop" onclick="toggleCart(false)" class="fixed inset-0 bg-black/40 backdrop-blur-sm z-[65] opacity-0 pointer-events-none transition-opacity duration-300"></div>
    <div id="cart-drawer" class="fixed top-0 left-0 h-full w-full sm:w-[450px] bg-white z-[70] shadow-2xl transform -translate-x-full transition-transform duration-500 cubic-bezier(0.4, 0, 0.2, 1) flex flex-col border-r border-stone-100">
        <!-- Modern Header -->
        <div class="p-6 border-b border-stone-100 flex justify-between items-center bg-white z-10">
            <div>
                <h2 class="text-2xl font-bold text-stone-900 flex items-center gap-2">ุนุฑุจุฉ ุงูุชุณูู</h2>
                <p class="text-xs text-stone-500 mt-1">ุฑุงุฌุน ุทูุจุงุชู ูุจู ุงูุฏูุน</p>
            </div>
            <div class="flex items-center gap-2">
                <button id="clear-cart-btn" onclick="clearCart()" class="w-10 h-10 bg-red-50 hover:bg-red-100 text-red-600 rounded-full flex items-center justify-center transition-colors hidden" title="ุชูุฑูุบ ุงูุณูุฉ">
                    <i data-lucide="trash-2" size="18"></i>
                </button>
                <button onclick="toggleCart(false)" class="w-10 h-10 bg-white hover:bg-stone-100 rounded-full flex items-center justify-center transition-colors text-stone-500 hover:text-stone-900"><i data-lucide="x" size="20"></i></button>
            </div>
        </div>
        
        <!-- 5๏ธโฃ Stepper Placeholder (Cart - Step 1) -->
        <div id="cart-stepper" class="px-6 pt-6 bg-white"></div>

        <!-- Items Container -->
        <div id="cart-items" class="flex-1 overflow-y-auto p-6 space-y-5 bg-white/30 custom-scrollbar"></div>
        
        <!-- Modern Footer -->
        <div id="cart-footer" class="p-6 border-t border-stone-100 bg-white space-y-4 hidden z-10 shadow-[0_-10px_60px_-15px_rgba(0,0,0,0.1)]">
            <div class="space-y-3">
                <div class="flex justify-between items-center text-sm font-medium text-stone-500"><span>ุนุฏุฏ ุงูููุชุฌุงุช</span><span id="cart-count-summary" class="font-bold text-stone-900 bg-stone-100 px-2 py-0.5 rounded text-xs">0</span></div>
                <div class="flex justify-between items-center">
                    <span class="text-lg font-bold text-stone-900">ุงูุฅุฌูุงูู</span>
                    <span id="cart-total" class="text-2xl font-serif font-bold text-stone-900">$0.00</span>
                </div>
                <p class="text-[10px] text-stone-400 text-center bg-white p-2 rounded-lg border border-stone-100"><i data-lucide="info" size="10" class="inline mb-0.5"></i> ุงูุดุญู ูุงูุถุฑุงุฆุจ ุชุญุณุจ ุนูุฏ ุฅุชูุงู ุงูุทูุจ</p>
            </div>
            <button onclick="checkout()" class="w-full bg-stone-900 text-white py-4 rounded-2xl font-bold hover:bg-stone-800 transition-all shadow-lg hover:shadow-xl hover:-translate-y-0.5 flex justify-center items-center gap-3 group text-lg">
                <span>ุฅุชูุงู ุงูุดุฑุงุก</span>
                <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center group-hover:translate-x-1 transition-transform">
                    <i data-lucide="arrow-left" size="18"></i>
                </div>
            </button>
        </div>
    </div>

    <!-- REMOVED OLD FAVORITE DRAWER -->

    <!-- ุชู ุชุนุฏูู z-50 ุฅูู z-[100] ููุธูุฑ ุงูุชูุจูู ููู ูู ุงูููุงูุฐ -->
    <div id="toast" class="fixed bottom-8 left-1/2 -translate-x-1/2 z-[100] transition-all duration-500 translate-y-12 opacity-0 pointer-events-none bg-stone-900 text-white px-6 py-3 rounded shadow-lg text-sm font-medium"></div>

    <!-- Checkout Modal (Redesigned) -->
    <div id="checkout-modal-backdrop" onclick="toggleCheckoutModal(false)" class="fixed inset-0 bg-black/60 backdrop-blur-md z-50 opacity-0 pointer-events-none transition-opacity duration-300"></div>
    
    <div id="checkout-modal" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[95%] max-w-lg bg-white rounded-[2rem] shadow-2xl z-50 opacity-0 pointer-events-none transition-all duration-500 cubic-bezier(0.34, 1.56, 0.64, 1) scale-95 p-0 max-h-[90vh] flex flex-col overflow-hidden border border-stone-100">
        
        <!-- Header (Fixed) -->
        <div class="px-6 py-5 bg-white z-10 flex justify-between items-center border-b border-stone-50 shrink-0">
            <div>
                <h2 class="text-xl font-bold text-stone-900 flex items-center gap-2">ุฅุชูุงู ุงูุทูุจ</h2>
                <p class="text-[10px] text-stone-400 mt-0.5 font-medium">ุฃููู ุจูุงูุงุชู ูุชุฃููุฏ ุงูุญุฌุฒ</p>
            </div>
            <button onclick="toggleCheckoutModal(false)" class="w-9 h-9 bg-white rounded-full flex items-center justify-center text-stone-400 hover:bg-red-50 hover:text-red-500 transition-all duration-300 group shadow-sm">
                <i data-lucide="x" size="18" class="group-hover:rotate-90 transition-transform"></i>
            </button>
        </div>

        <!-- Scrollable Content -->
        <div class="flex-1 overflow-y-auto px-6 py-6 custom-scrollbar bg-[#FAFAFA]">
            
            <!-- 5๏ธโฃ Stepper Placeholder -->
            <div id="checkout-stepper" class="mb-6"></div>

            <form onsubmit="handlePlaceOrder(event)" class="space-y-6">
                
                <!-- Section 1: Customer Info -->
                <div class="space-y-3">
                    <h3 class="text-xs font-bold text-stone-500 uppercase tracking-wider flex items-center gap-2">
                        <span class="w-5 h-5 rounded-full bg-stone-200 text-stone-600 flex items-center justify-center text-[10px]">1</span>
                        ุจูุงูุงุช ุงูุชูุงุตู
                    </h3>
                    
                    <div class="bg-white p-4 rounded-2xl shadow-sm border border-stone-100 space-y-3">
                        <!-- Name -->
                        <div class="relative group">
                            <div class="absolute right-3.5 top-1/2 -translate-y-1/2 text-stone-300 group-focus-within:text-stone-800 transition-colors pointer-events-none">
                                <i data-lucide="user" size="16"></i>
                            </div>
                            <input name="customerName" required class="w-full bg-white border border-stone-100 focus:border-stone-900 focus:bg-white rounded-xl py-3 pr-10 pl-4 text-sm font-bold text-stone-800 placeholder:text-stone-300 placeholder:font-medium transition-all outline-none" placeholder="ุงูุงุณู ุซูุงุซู">
                        </div>

                        <!-- Phone -->
                        <div class="relative group">
                            <div class="absolute right-3.5 top-1/2 -translate-y-1/2 text-stone-300 group-focus-within:text-stone-800 transition-colors pointer-events-none">
                                <i data-lucide="smartphone" size="16"></i>
                            </div>
                            <input name="customerPhone" type="tel" maxlength="11" required class="w-full bg-white border border-stone-100 focus:border-stone-900 focus:bg-white rounded-xl py-3 pr-10 pl-4 text-sm font-bold text-stone-800 placeholder:text-stone-300 placeholder:font-medium transition-all outline-none dir-ltr text-right font-mono" placeholder="01xxxxxxxxx">
                        </div>

                        <!-- Address -->
                        <div class="relative group">
                            <div class="absolute right-3.5 top-3.5 text-stone-300 group-focus-within:text-stone-800 transition-colors pointer-events-none">
                                <i data-lucide="map-pin" size="16"></i>
                            </div>
                            <textarea id="checkout-address" name="customerAddress" oninput="calculateCheckoutTotal()" required rows="2" class="w-full bg-white border border-stone-100 focus:border-stone-900 focus:bg-white rounded-xl py-3 pr-10 pl-4 text-sm font-bold text-stone-800 placeholder:text-stone-300 placeholder:font-medium transition-all outline-none resize-none" placeholder="ุงูุนููุงู ุจุงูุชูุตูู (ุงููุญุงูุธุฉ - ุงููุฏููุฉ - ุงูุดุงุฑุน)"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Section 2: Delivery -->
                <div class="space-y-3">
                    <h3 class="text-xs font-bold text-stone-500 uppercase tracking-wider flex items-center gap-2">
                        <span class="w-5 h-5 rounded-full bg-stone-200 text-stone-600 flex items-center justify-center text-[10px]">2</span>
                        ุฎูุงุฑุงุช ุงูุชูุตูู
                    </h3>
                    
                    <label class="flex items-center justify-between bg-white p-3.5 rounded-2xl border border-stone-100 shadow-sm cursor-pointer hover:border-stone-300 transition-all group select-none">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center group-hover:scale-110 transition-transform">
                                <i data-lucide="truck" size="16"></i>
                            </div>
                            <div>
                                <span class="block text-xs font-bold text-stone-900">ุชูุตูู ููููุฒู</span>
                                <span class="text-[9px] text-stone-400">ุณูุชู ุญุณุงุจ ุงูุชูููุฉ ุชููุงุฆูุงู</span>
                            </div>
                        </div>
                        <div class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="delivery-check" onchange="calculateCheckoutTotal()" class="sr-only peer">
                            <div class="w-9 h-5 bg-stone-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-stone-900"></div>
                        </div>
                    </label>
                </div>

                <!-- Section 3: Payment -->
                <div class="space-y-3">
                    <h3 class="text-xs font-bold text-stone-500 uppercase tracking-wider flex items-center gap-2">
                        <span class="w-5 h-5 rounded-full bg-stone-200 text-stone-600 flex items-center justify-center text-[10px]">3</span>
                        ุทุฑููุฉ ุงูุฏูุน
                    </h3>

                    <div class="grid grid-cols-2 gap-3">
                        <!-- COD -->
                        <label class="relative cursor-pointer group">
                            <input type="radio" name="paymentMethod" value="cod" class="peer sr-only" checked onchange="updatePaymentUI()">
                            <div class="p-3 rounded-2xl bg-white border border-stone-100 peer-checked:border-green-500 peer-checked:bg-green-50/10 transition-all text-center h-full hover:border-stone-300 flex flex-col items-center justify-center gap-2">
                                <div class="w-8 h-8 mx-auto rounded-full bg-white text-stone-400 peer-checked:bg-green-500 peer-checked:text-white transition-colors flex items-center justify-center">
                                    <i data-lucide="banknote" size="16"></i>
                                </div>
                                <span class="block text-[10px] font-bold text-stone-600 peer-checked:text-green-700">ุฏูุน ุนูุฏ ุงูุงุณุชูุงู</span>
                                
                                <div class="absolute top-2 right-2 opacity-0 peer-checked:opacity-100 transition-opacity text-green-500">
                                    <i data-lucide="check-circle-2" size="14" class="fill-green-100"></i>
                                </div>
                            </div>
                        </label>

                        <!-- VF Cash -->
                        <label class="relative cursor-pointer group">
                            <input type="radio" name="paymentMethod" value="vodafone_cash" class="peer sr-only" onchange="updatePaymentUI()">
                            <div class="p-3 rounded-2xl bg-white border border-stone-100 peer-checked:border-red-500 peer-checked:bg-red-50/10 transition-all text-center h-full hover:border-stone-300 flex flex-col items-center justify-center gap-2">
                                <div class="w-8 h-8 mx-auto rounded-full bg-white text-stone-400 peer-checked:bg-red-500 peer-checked:text-white transition-colors flex items-center justify-center">
                                    <i data-lucide="smartphone" size="16"></i>
                                </div>
                                <span class="block text-[10px] font-bold text-stone-600 peer-checked:text-red-700">ุงููุญุงูุธ ุงูุฅููุชุฑูููุฉ</span>
                                
                                <div class="absolute top-2 right-2 opacity-0 peer-checked:opacity-100 transition-opacity text-red-500">
                                    <i data-lucide="check-circle-2" size="14" class="fill-red-100"></i>
                                </div>
                            </div>
                        </label>
                    </div>

                    <!-- Partial Payment Option -->
                    <div id="partial-payment-option" class="hidden mt-2 animate-in fade-in slide-in-from-top-2">
                        <label class="flex items-center gap-3 p-3 bg-orange-50 border border-orange-100 rounded-xl cursor-pointer hover:bg-orange-100 transition-colors">
                            <div class="relative flex items-center">
                                <input type="checkbox" name="isPartial" id="isPartial" class="peer w-4 h-4 accent-orange-600 rounded cursor-pointer" onchange="updatePaymentUI()">
                            </div>
                            <div class="flex-1">
                                <span class="block text-xs font-bold text-orange-800">ุฏูุน ุนุฑุจูู ููุท (ุฌุฏูุฉ ุญุฌุฒ)</span>
                                <p class="text-[9px] text-orange-600/80">ุงุฏูุน 50% ุงูุขู ูุงูุจุงูู ุนูุฏ ุงูุงุณุชูุงู</p>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Order Summary -->
                <div class="bg-white rounded-2xl p-4 border border-stone-200">
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-xs text-stone-500 font-bold">ุฅุฌูุงูู ุงูุทูุจ</span>
                        <span id="checkout-total-display" class="text-xl font-serif font-black text-stone-900">$0.00</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <p id="delivery-note" class="text-[9px] text-blue-600 font-bold bg-blue-50 px-2 py-0.5 rounded hidden"></p>
                        <span id="payment-method-label" class="text-[9px] font-bold px-2 py-0.5 rounded bg-stone-200 text-stone-600">ุฏูุน ุนูุฏ ุงูุงุณุชูุงู</span>
                    </div>
                </div>

                <!-- Footer Actions -->
                <div class="space-y-3 pt-2">
                    <div class="flex items-center gap-2 justify-center text-[9px] text-stone-400 bg-white/50 py-1.5 rounded-lg border border-stone-50">
                        <i data-lucide="shield-check" size="10" class="text-green-500"></i>
                        <span>ุฌููุน ุงูุจูุงูุงุช ูุดูุฑุฉ ูุขููุฉ</span>
                    </div>

                    <button type="submit" class="w-full bg-stone-900 text-white py-3.5 rounded-xl font-bold hover:bg-stone-800 transition-all shadow-lg hover:shadow-xl hover:-translate-y-0.5 flex justify-center items-center gap-2 group text-sm">
                        <span>ุชุฃููุฏ ุงูุทูุจ</span>
                        <div class="bg-white/20 rounded-full p-1 group-hover:translate-x-1 transition-transform">
                            <i data-lucide="arrow-left" size="14"></i>
                        </div>
                    </button>
                </div>

            </form>
        </div>
    </div>

    <!-- Vodafone Cash Modal (NEW) -->
    <div id="vodafone-modal-backdrop" onclick="toggleVodafoneModal(false)" class="fixed inset-0 bg-black/60 backdrop-blur-md z-[55] opacity-0 pointer-events-none transition-opacity duration-300"></div>
    <div id="vodafone-modal" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[90%] max-w-md bg-white rounded-[2rem] shadow-2xl z-[55] opacity-0 pointer-events-none transition-all duration-300 scale-95 p-0 overflow-hidden border border-stone-100">
        
        <!-- Modern Header -->
        <div class="bg-stone-900 p-6 text-white relative overflow-hidden">
            <div class="absolute top-0 right-0 w-32 h-32 bg-white/5 rounded-full -mr-10 -mt-10 blur-2xl"></div>
            <div class="absolute bottom-0 left-0 w-24 h-24 bg-white/5 rounded-full -ml-8 -mb-8 blur-2xl"></div>
            
            <div class="relative z-10 flex flex-col items-center text-center">
                <div class="w-12 h-12 bg-white/10 rounded-2xl flex items-center justify-center backdrop-blur-md mb-3 border border-white/10 shadow-lg">
                    <i data-lucide="smartphone-nfc" size="24" class="text-white"></i>
                </div>
                <h2 class="text-xl font-bold mb-1">ุงูุฏูุน ุงูุฅููุชุฑููู</h2>
                <p class="text-white/70 text-xs font-medium">ุงููุญุงูุธ ุงูุฐููุฉ & ุฅูุณุชุง ุจุงู</p>
            </div>
            <button onclick="toggleVodafoneModal(false)" class="absolute top-4 left-4 text-white/60 hover:text-white bg-white/5 hover:bg-white/20 rounded-full p-2 transition-all"><i data-lucide="x" size="18"></i></button>
        </div>

        <div class="p-5 space-y-5 bg-white max-h-[70vh] overflow-y-auto custom-scrollbar">
            <!-- 5๏ธโฃ Stepper Placeholder (Payment - Step 3) -->
            <div id="vodafone-stepper" class="-mt-2"></div>

            <!-- Amount Display -->
            <div class="text-center">
                <p class="text-[10px] text-stone-400 font-bold uppercase tracking-wider mb-2">ุงููุจูุบ ุงููุทููุจ ุชุญูููู</p>
                <div class="inline-flex items-baseline justify-center gap-1 bg-white border border-stone-200 rounded-2xl px-8 py-3 shadow-sm w-full">
                    <span id="vc-amount" class="text-3xl font-serif font-black text-stone-900 tracking-tight">0.00</span>
                </div>
            </div>

            <!-- Copy Number Section (Primary Action) -->
            <div class="relative group cursor-pointer" onclick="navigator.clipboard.writeText('01064009655'); showToast('ุชู ูุณุฎ ุงูุฑูู ุจูุฌุงุญ')">
                <div class="absolute -inset-0.5 bg-gradient-to-r from-stone-200 to-stone-300 rounded-2xl opacity-50 group-hover:opacity-100 transition duration-500 blur-sm"></div>
                <div class="relative bg-white border border-stone-100 rounded-2xl p-3 flex items-center justify-between shadow-sm hover:shadow-md transition-all">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-xl bg-white flex items-center justify-center text-stone-600 border border-stone-100">
                            <i data-lucide="copy" size="18"></i>
                        </div>
                        <div class="text-right">
                            <p class="text-[9px] text-stone-400 font-bold uppercase mb-0.5">ุฑูู ุงูุชุญููู (ุฌููุน ุงููุญุงูุธ)</p>
                            <p class="text-lg font-mono font-bold text-stone-900 dir-ltr tracking-wide leading-none">01064009655</p>
                            <p class="text-[9px] text-stone-500 font-medium mt-1 dir-ltr tracking-tight">Mostafa M** Mo*** Z*** Eyd</p>
                        </div>
                    </div>
                    <div class="text-[10px] font-bold text-white bg-stone-900 px-3 py-1.5 rounded-lg shadow-sm group-hover:scale-105 transition-transform">
                        ูุณุฎ
                    </div>
                </div>
            </div>

            <!-- Generic Instructions (Tabs Style) -->
            <div class="bg-white border border-stone-200 rounded-2xl overflow-hidden">
                <div class="flex border-b border-stone-100 bg-white/50">
                    <button class="flex-1 py-3 text-xs font-bold text-stone-900 border-b-2 border-stone-900 bg-white">ุนุจุฑ ุงูุชุทุจูู</button>
                    <button class="flex-1 py-3 text-xs font-bold text-stone-400 hover:text-stone-700 transition-colors" onclick="document.getElementById('ussd-codes-section').scrollIntoView({behavior: 'smooth'})">ุงูุฃููุงุฏ ุงููุฎุชุตุฑุฉ</button>
                </div>
                <div class="p-4 bg-white/30">
                    <ul class="space-y-3 relative">
                        <div class="absolute right-[9px] top-2 bottom-2 w-0.5 bg-stone-200"></div>
                        <li class="relative pr-6 flex items-start">
                            <span class="absolute right-0 top-0.5 w-5 h-5 bg-white border-2 border-stone-200 rounded-full flex items-center justify-center text-[9px] font-bold text-stone-500 z-10 shadow-sm">1</span>
                            <p class="text-xs text-stone-600 font-medium pt-0.5">ุงูุชุญ ุชุทุจูู <span class="font-bold text-stone-800">ูุญูุธุชู</span> ุฃู <span class="font-bold text-purple-700">InstaPay</span>.</p>
                        </li>
                        <li class="relative pr-6 flex items-start">
                            <span class="absolute right-0 top-0.5 w-5 h-5 bg-white border-2 border-stone-200 rounded-full flex items-center justify-center text-[9px] font-bold text-stone-500 z-10 shadow-sm">2</span>
                            <p class="text-xs text-stone-600 font-medium pt-0.5">ุงุฎุชุฑ <span class="font-bold text-stone-800">ุชุญููู ูุฃู ูุญูุธุฉ</span> ุฃู ุฑูู ูุงุชู.</p>
                        </li>
                        <li class="relative pr-6 flex items-start">
                            <span class="absolute right-0 top-0.5 w-5 h-5 bg-white border-2 border-stone-200 rounded-full flex items-center justify-center text-[9px] font-bold text-stone-500 z-10 shadow-sm">3</span>
                            <p class="text-xs text-stone-600 font-medium pt-0.5">ุญูู <span class="bg-stone-200 px-1 rounded text-stone-900 dir-ltr inline-block font-bold text-[10px]" id="vc-amount-step">0</span> ููุฑูู ุงูููุถุญ ุจุงูุฃุนูู.</p>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- USSD Codes Section (NEW) -->
            <div id="ussd-codes-section" class="space-y-2">
                <div class="flex items-center gap-2 mb-1 px-1">
                    <i data-lucide="hash" size="14" class="text-stone-400"></i>
                    <span class="text-xs font-bold text-stone-500">ุฃููุงุฏ ุงูุชุญููู ุงูุณุฑูุน (ุจุฏูู ุงูุชุฑูุช)</span>
                </div>
                <div class="grid grid-cols-2 gap-2">
                    <!-- Vodafone -->
                    <div class="bg-red-50/50 border border-red-100 p-2 rounded-xl text-center group hover:border-red-200 transition-colors">
                        <div class="text-[9px] font-bold text-red-600 mb-1">ููุฏุงููู ูุงุด</div>
                        <div class="bg-white border border-red-100 rounded-lg py-1.5 px-1 shadow-sm dir-ltr font-mono text-[9px] font-bold text-stone-700 whitespace-nowrap overflow-x-auto scrollbar-hide">
                            *9*7*ุงูุฑูู*ุงููุจูุบ#
                        </div>
                    </div>
                    <!-- Etisalat -->
                    <div class="bg-green-50/50 border border-green-100 p-2 rounded-xl text-center group hover:border-green-200 transition-colors">
                        <div class="text-[9px] font-bold text-green-600 mb-1">ุงุชุตุงูุงุช ูุงุด</div>
                        <div class="bg-white border border-green-100 rounded-lg py-1.5 px-1 shadow-sm dir-ltr font-mono text-[9px] font-bold text-stone-700">
                            ุงุทูุจ *777#
                        </div>
                    </div>
                    <!-- Orange -->
                    <div class="bg-orange-50/50 border border-orange-100 p-2 rounded-xl text-center group hover:border-orange-200 transition-colors">
                        <div class="text-[9px] font-bold text-orange-600 mb-1">ุฃูุฑุงูุฌ ูุงุด</div>
                        <div class="bg-white border border-orange-100 rounded-lg py-1.5 px-1 shadow-sm dir-ltr font-mono text-[9px] font-bold text-stone-700">
                            ุงุทูุจ *115#
                        </div>
                    </div>
                    <!-- WE -->
                    <div class="bg-purple-50/50 border border-purple-100 p-2 rounded-xl text-center group hover:border-purple-200 transition-colors">
                        <div class="text-[9px] font-bold text-purple-700 mb-1">ูู ุจุงู (WE)</div>
                        <div class="bg-white border border-purple-100 rounded-lg py-1.5 px-1 shadow-sm dir-ltr font-mono text-[9px] font-bold text-stone-700">
                            ุงุทูุจ *322#
                        </div>
                    </div>
                </div>
            </div>

            <!-- Confirmation Action -->
            <input type="hidden" id="vc-order-id-hidden">
            <div class="pt-2 sticky bottom-0 bg-white pb-1">
                <button onclick="confirmVodafonePayment()" class="w-full bg-stone-900 hover:bg-stone-800 text-white py-3.5 rounded-xl font-bold transition-all shadow-lg hover:shadow-xl hover:-translate-y-0.5 flex justify-center items-center gap-2 group text-sm">
                    <span>ุฃุชููุช ุงูุชุญูููุ ูุชุงุจุนุฉ</span>
                    <i data-lucide="arrow-left" size="16" class="group-hover:-translate-x-1 transition-transform"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Vodafone Payment Confirmation Form Modal (NEW) -->
    <div id="vc-confirm-modal-backdrop" onclick="toggleVcConfirmModal(false)" class="fixed inset-0 bg-black/60 backdrop-blur-md z-[60] opacity-0 pointer-events-none transition-opacity duration-300"></div>
    <div id="vc-confirm-modal" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[90%] max-w-md bg-white rounded-3xl shadow-2xl z-[60] opacity-0 pointer-events-none transition-all duration-300 scale-95 p-6 md:p-8">
        <div class="flex justify-between items-center mb-6 border-b border-stone-100 pb-4">
            <h2 class="text-xl font-bold text-stone-900 flex items-center gap-2"><i data-lucide="file-check" class="text-[#E60000]"></i> ุชุฃููุฏ ุจูุงูุงุช ุงูุฏูุน</h2>
            <button onclick="toggleVcConfirmModal(false)" class="text-stone-400 hover:text-red-500 transition-colors p-1 bg-white rounded-full"><i data-lucide="x"></i></button>
        </div>
        
        <!-- 5๏ธโฃ Stepper Placeholder (Payment Confirm - Step 3) -->
        <div id="vc-confirm-stepper" class="mb-6"></div>

        <!-- ุชู ุฅุถุงูุฉ id="vc-confirm-form" ู oninput="validateVcForm()" -->
        <form id="vc-confirm-form" onsubmit="handleVcConfirmSubmit(event)" oninput="validateVcForm()" onchange="validateVcForm()" class="space-y-4">
            <input type="hidden" id="vc-confirm-order-id">
            
            <div class="bg-blue-50 p-3 rounded-xl border border-blue-100 text-xs text-blue-800 mb-2 flex gap-2 items-start">
                <i data-lucide="info" size="14" class="mt-0.5 shrink-0"></i>
                <p>ุณุงุนุฏูุง ูู ุชุฃููุฏ ุทูุจู ุจุณุฑุนุฉ ูู ุฎูุงู ุฅุฑูุงู ุจูุงูุงุช ุงูุชุญููู ุงูุตุญูุญุฉ.</p>
            </div>

            <!-- ุญูู ุฑูุน ุงูุตูุฑุฉ ุงูุฌุฏูุฏ (Client-side Compression) -->
            <div class="bg-white p-3 rounded-xl border border-stone-200 border-dashed hover:bg-stone-100 transition-colors relative group">
                <label class="block text-xs font-bold text-stone-600 mb-2 uppercase tracking-wider flex items-center gap-2">
                    <i data-lucide="image" size="14"></i> ุตูุฑุฉ ุงูุชุญููู (ุณูุฑูู ุดูุช) <span class="text-red-500">*</span>
                </label>
                <input type="file" name="receiptImage" accept="image/*" required class="w-full text-sm text-stone-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-bold file:bg-stone-900 file:text-white hover:file:bg-stone-800 cursor-pointer">
                <p class="text-[10px] text-stone-400 mt-2">ูุฑุฌู ุฑูุน ุตูุฑุฉ ูุงุถุญุฉ ูุฑุณุงูุฉ ุชุฃููุฏ ุงูุชุญููู (ุณูุชู ุถุบุทูุง ุชููุงุฆูุงู ูุชูููู ุงุณุชููุงู ุงูุจูุงูุงุช).</p>
                
                <!-- ุนูุงูุฉ ุตุญ ุชุธูุฑ ุนูุฏ ุฑูุน ุงูุตูุฑุฉ -->
                <div id="img-check-indicator" class="absolute top-3 left-3 text-green-500 hidden animate-bounce">
                    <i data-lucide="check-circle" size="20"></i>
                </div>
            </div>

            <div>
                <label class="block text-xs font-bold text-stone-500 mb-1.5 uppercase tracking-wider">ุงูุงุณู ุจุงููุงูู (ุตุงุญุจ ุงููุญูุธุฉ) <span class="text-red-500">*</span></label>
                <div class="relative">
                    <input name="senderName" required class="w-full border border-stone-200 p-3 pl-10 rounded-xl focus:ring-2 focus:ring-stone-900 outline-none bg-white focus:bg-white transition-colors text-sm font-bold text-stone-800">
                    <i data-lucide="user" class="absolute left-3 top-3.5 text-stone-400" size="16"></i>
                </div>
            </div>

            <div>
                <label class="block text-xs font-bold text-stone-500 mb-1.5 uppercase tracking-wider">ุฑูู ุงูููุจุงูู ุงููุญูู ููู <span class="text-red-500">*</span></label>
                <div class="relative">
                    <input name="senderPhone" type="tel" maxlength="11" required class="w-full border border-stone-200 p-3 pl-10 rounded-xl focus:ring-2 focus:ring-stone-900 outline-none bg-white focus:bg-white transition-colors text-sm font-bold text-stone-800 dir-ltr text-right" placeholder="01xxxxxxxxx">
                    <i data-lucide="smartphone" class="absolute left-3 top-3.5 text-stone-400" size="16"></i>
                </div>
                <p class="text-[10px] text-stone-400 mt-1 mr-1">ูุฌุจ ุฃู ูููู 11 ุฑูู (010, 011, 012, 015)</p>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-xs font-bold text-stone-500 mb-1.5 uppercase tracking-wider">ุงููุจูุบ ุงููุฏููุน <span class="text-red-500">*</span></label>
                    <div class="relative">
                        <input name="amountPaid" type="number" step="0.01" required class="w-full border border-stone-200 p-3 pl-8 rounded-xl focus:ring-2 focus:ring-stone-900 outline-none bg-white focus:bg-white transition-colors text-sm font-bold text-stone-800">
                        <span class="absolute left-3 top-3.5 text-stone-400 text-xs font-bold">$</span>
                    </div>
                </div>
                <div>
                    <label class="block text-xs font-bold text-stone-500 mb-1.5 uppercase tracking-wider">ุฑูู ุงูุนูููุฉ (ุงุฎุชูุงุฑู)</label>
                    <input name="transactionId" class="w-full border border-stone-200 p-3 rounded-xl focus:ring-2 focus:ring-stone-900 outline-none bg-white focus:bg-white transition-colors text-sm font-bold text-stone-800" placeholder="Transaction ID">
                </div>
            </div>

            <!-- ุชู ุชุนุฏูู ุงูุฒุฑ: ุฅุถุงูุฉ id="vc-submit-btn" ู disabled ู ุชูุณูู ุจุงูุช -->
            <button type="submit" id="vc-submit-btn" disabled class="w-full bg-stone-400 text-white/80 py-4 rounded-xl font-bold cursor-not-allowed transition-all shadow-none mt-4 flex justify-center items-center gap-2">
                <span>ุชุฃููุฏ ูุฅุฑุณุงู ูููุฑุงุฌุนุฉ</span>
                <i data-lucide="check" size="18"></i>
            </button>
            <p id="vc-form-hint" class="text-center text-[10px] text-red-500 font-bold animate-pulse">ูุฑุฌู ุฑูุน ุงูุตูุฑุฉ ูููุก ุงูุจูุงูุงุช ูุชูุนูู ุงูุฒุฑ</p>
        </form>
    </div>

    <!-- ๐ Add Real Work Modal (New Modal instead of Browser Prompt) -->
    <div id="add-work-modal-backdrop" onclick="toggleAddWorkModal(false)" class="fixed inset-0 bg-black/60 backdrop-blur-md z-[65] opacity-0 pointer-events-none transition-opacity duration-300"></div>
    <div id="add-work-modal" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[90%] max-w-md bg-white rounded-3xl shadow-2xl z-[65] opacity-0 pointer-events-none transition-all duration-300 scale-95 p-6">
        <div class="flex justify-between items-center mb-4 border-b border-stone-100 pb-3">
            <h3 class="text-xl font-bold text-stone-900 flex items-center gap-2"><i data-lucide="image-plus" class="text-blue-600"></i> ุฅุถุงูุฉ ูููุนุฑุถ</h3>
            <button onclick="toggleAddWorkModal(false)" class="text-stone-400 hover:text-stone-900 bg-stone-100 rounded-full p-1"><i data-lucide="x" size="18"></i></button>
        </div>
        <form onsubmit="handleSubmitRealWork(event)">
            <div class="space-y-4">
                <div>
                    <label class="block text-xs font-bold text-stone-500 mb-1.5 uppercase tracking-wider">ุงูุฑุงุจุท (ุตูุฑุฉ ุฃู ููุฏูู ููุชููุจ)</label>
                    <input name="workUrl" required class="w-full border border-stone-200 rounded-xl p-3 text-sm focus:ring-2 focus:ring-stone-900 outline-none bg-white focus:bg-white transition-all dir-ltr text-left placeholder:text-right" placeholder="https://...">
                    <p class="text-[10px] text-stone-400 mt-1">ููุจู ุฑูุงุจุท ุงูุตูุฑ ุงููุจุงุดุฑุฉ ุฃู ุฑูุงุจุท ููุฏูููุงุช YouTube</p>
                </div>
                <button type="submit" class="w-full bg-stone-900 text-white py-3 rounded-xl font-bold hover:bg-stone-800 transition-all shadow-lg flex items-center justify-center gap-2">
                    <i data-lucide="plus-circle" size="18"></i> ุฅุถุงูุฉ
                </button>
            </div>
        </form>
    </div>

    <!-- Edit Order Modal (NEW) -->
    <div id="edit-order-modal-backdrop" onclick="toggleEditOrderModal(false)" class="fixed inset-0 bg-black/60 backdrop-blur-md z-[60] opacity-0 pointer-events-none transition-opacity duration-300"></div>
    <div id="edit-order-modal" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[90%] max-w-lg bg-white rounded-3xl shadow-2xl z-[60] opacity-0 pointer-events-none transition-all duration-300 scale-95 p-6 md:p-8">
        <div class="flex justify-between items-center mb-6 border-b border-stone-100 pb-4">
            <h2 class="text-2xl font-bold text-stone-900 flex items-center gap-2"><i data-lucide="pen-line" class="text-blue-600"></i> ุชุนุฏูู ุงูุทูุจ</h2>
            <button onclick="toggleEditOrderModal(false)" class="text-stone-400 hover:text-red-500 transition-colors p-1 bg-white rounded-full"><i data-lucide="x"></i></button>
        </div>
        
        <form onsubmit="handleUpdateOrder(event)" id="edit-order-form" class="space-y-5">
            <input type="hidden" name="orderId">
            <div class="space-y-4">
                <div>
                    <label class="block text-xs font-bold text-stone-500 mb-1.5 uppercase tracking-wider">ุงุณู ุงูุนููู</label>
                    <input name="customerName" required class="w-full border border-stone-200 p-3 rounded-xl focus:ring-2 focus:ring-stone-900 outline-none bg-white focus:bg-white transition-colors">
                </div>
                <div>
                    <label class="block text-xs font-bold text-stone-500 mb-1.5 uppercase tracking-wider">ุฑูู ุงููุงุชู</label>
                    <input name="customerPhone" required class="w-full border border-stone-200 p-3 rounded-xl focus:ring-2 focus:ring-stone-900 outline-none bg-white focus:bg-white transition-colors">
                </div>
                <div>
                    <label class="block text-xs font-bold text-stone-500 mb-1.5 uppercase tracking-wider">ุงูุนููุงู</label>
                    <textarea name="customerAddress" required rows="2" class="w-full border border-stone-200 p-3 rounded-xl focus:ring-2 focus:ring-stone-900 outline-none bg-white focus:bg-white transition-colors"></textarea>
                </div>
                <div class="bg-blue-50 p-4 rounded-xl border border-blue-100">
                     <label class="block text-xs font-bold text-blue-800 mb-1.5 uppercase tracking-wider">ุงูุฅุฌูุงูู (ุชุนุฏูู ูุฏูู)</label>
                     <div class="relative">
                        <input name="totalAmount" type="number" step="0.01" required class="w-full border border-blue-200 p-3 pl-8 rounded-xl focus:ring-2 focus:ring-blue-600 outline-none bg-white font-bold text-stone-900">
                        <span class="absolute left-3 top-3.5 text-stone-400 text-xs font-bold">$</span>
                     </div>
                     <p class="text-[10px] text-blue-600 mt-2">ุชูุจูู: ุชุบููุฑ ูุฐุง ุงูุฑูู ูุง ูุคุซุฑ ุนูู ุฃุณุนุงุฑ ุงูููุชุฌุงุช ุงููุฑุฏูุฉุ ุจู ูุบูุฑ ุฅุฌูุงูู ุงููุงุชูุฑุฉ ููุท.</p>
                </div>
            </div>
            
            <button type="submit" class="w-full bg-stone-900 text-white py-3.5 rounded-xl font-bold hover:bg-stone-800 transition-all shadow-lg flex justify-center items-center gap-2">
                <i data-lucide="save"></i> <span>ุญูุธ ุงูุชุนุฏููุงุช</span>
            </button>
        </form>
    </div>
    <!-- Order Success Modal (UPDATED) -->
    <div id="success-modal-backdrop" onclick="toggleSuccessModal(false)" class="fixed inset-0 bg-black/60 backdrop-blur-md z-[60] opacity-0 pointer-events-none transition-opacity duration-300"></div>
    <div id="success-modal" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[90%] max-w-md bg-white rounded-3xl shadow-2xl z-[60] opacity-0 pointer-events-none transition-all duration-300 scale-95 p-8 text-center">
        
        <!-- 5๏ธโฃ Stepper Placeholder (Success - Step 4) -->
        <div id="success-stepper" class="mb-8"></div>

        <div class="w-20 h-20 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-6 shadow-sm animate-bounce">
            <i data-lucide="check" size="40"></i>
        </div>
        <!-- Added IDs here -->
        <h2 id="success-title" class="text-2xl font-bold text-stone-900 mb-2">ุชู ุงุณุชูุงู ุทูุจู ุจูุฌุงุญ!</h2>
        <div id="success-desc" class="text-stone-500 text-sm mb-6">ุดูุฑุงู ูุซูุชู ุจูุง. ูุฑุฌู ุงูุงุญุชูุงุธ ุจุฑูู ุงูุทูุจ ูุชุชุจุน ุญุงูุฉ ุงูุดุญูุฉ.</div>
        
        <div class="bg-white p-4 rounded-xl border border-stone-200 mb-6 relative group cursor-pointer hover:bg-stone-100 transition-colors" onclick="copyOrderId()">
            <p class="text-xs text-stone-400 font-bold uppercase tracking-wider mb-1">ุฑูู ุงูุทูุจ (ุงุถุบุท ูููุณุฎ)</p>
            <p id="success-order-id" class="text-xl font-mono font-bold text-stone-800 tracking-wider select-all">Loading...</p>
            <div class="absolute left-4 top-1/2 -translate-y-1/2 text-stone-400 group-hover:text-stone-900 transition-colors">
                <i data-lucide="copy" size="20"></i>
            </div>
        </div>

        <button onclick="toggleSuccessModal(false); setView('track-order')" class="w-full bg-stone-900 text-white py-3.5 rounded-xl font-bold hover:bg-stone-800 transition-all shadow-lg hover:shadow-xl mb-3 flex items-center justify-center gap-2">
            <i data-lucide="package-search" size="18"></i> ุชุชุจุน ุญุงูุฉ ุงูุทูุจ ุงูุขู
        </button>
        <button onclick="toggleSuccessModal(false)" class="w-full text-stone-500 font-bold py-2 hover:text-stone-900">
            ูุชุงุจุนุฉ ุงูุชุณูู
        </button>
    </div>

    <!-- Request Modification Modal (NEW Feature) -->
    <div id="mod-modal-backdrop" onclick="toggleModModal(false)" class="fixed inset-0 bg-black/60 backdrop-blur-md z-[60] opacity-0 pointer-events-none transition-opacity duration-300"></div>
    <div id="mod-modal" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[90%] max-w-md bg-white rounded-3xl shadow-2xl z-[60] opacity-0 pointer-events-none transition-all duration-300 scale-95 p-6">
        <div class="flex justify-between items-center mb-4 border-b border-stone-100 pb-3">
            <h3 class="text-xl font-bold text-stone-900 flex items-center gap-2"><i data-lucide="edit-3" class="text-orange-500"></i> ุทูุจ ุชุนุฏูู</h3>
            <button onclick="toggleModModal(false)"><i data-lucide="x" class="text-stone-400 hover:text-stone-900"></i></button>
        </div>
        <form onsubmit="handleSubmitModRequest(event)">
            <input type="hidden" name="orderId" id="mod-order-id">
            <div class="bg-blue-50 p-3 rounded-xl border border-blue-100 mb-4 text-xs text-blue-700 leading-relaxed">
                <i data-lucide="info" size="14" class="inline mb-0.5"></i> ูุฑุฌู ูุชุงุจุฉ ุงูุชุนุฏููุงุช ุงููุทููุจุฉ ุจูุถูุญ (ูุซูุงู: ุชุบููุฑ ุงูุนููุงูุ ุชุบููุฑ ุฑูู ุงููุงุชูุ ุฅูุบุงุก ููุชุฌ). ุณูููู ูุฑูููุง ุจูุฑุงุฌุนุฉ ุงูุทูุจ ูุชูููุฐู ุฅู ุฃููู.
            </div>
            <textarea name="message" required rows="4" class="w-full border border-stone-200 rounded-xl p-3 text-sm focus:ring-2 focus:ring-stone-900 outline-none mb-4 bg-white focus:bg-white transition-all placeholder:text-stone-400" placeholder="ุงูุชุจ ุชูุงุตูู ุงูุชุนุฏูู ููุง..."></textarea>
            <button type="submit" class="w-full bg-stone-900 text-white py-3 rounded-xl font-bold hover:bg-stone-800 transition-all shadow-lg">ุฅุฑุณุงู ุงูุทูุจ ููุฅุฏุงุฑุฉ</button>
        </form>
    </div>

    <!-- NEW: Custom WhatsApp Message Modal -->
    <div id="wa-modal-backdrop" onclick="toggleWaModal(false)" class="fixed inset-0 bg-black/60 backdrop-blur-md z-[70] opacity-0 pointer-events-none transition-opacity duration-300"></div>
    <div id="wa-modal" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[90%] max-w-md bg-white rounded-3xl shadow-2xl z-[70] opacity-0 pointer-events-none transition-all duration-300 scale-95 p-6">
        <div class="flex justify-between items-center mb-4 border-b border-stone-100 pb-3">
            <h3 class="text-xl font-bold text-stone-900 flex items-center gap-2"><i data-lucide="message-circle" class="text-[#25D366]"></i> ูุฑุงุณูุฉ ุงูุนููู</h3>
            <button onclick="toggleWaModal(false)"><i data-lucide="x" class="text-stone-400 hover:text-stone-900"></i></button>
        </div>
        <div class="space-y-4">
            <input type="hidden" id="wa-target-phone">
            
            <div class="flex gap-2 mb-2 overflow-x-auto pb-2 scrollbar-hide">
                <button onclick="setWaTemplate('confirm')" class="text-[10px] bg-green-50 text-green-700 px-3 py-1.5 rounded-full border border-green-200 hover:bg-green-100 whitespace-nowrap transition-colors">ูุงูุจ ุชุฃููุฏ</button>
                <button onclick="setWaTemplate('shipping')" class="text-[10px] bg-blue-50 text-blue-700 px-3 py-1.5 rounded-full border border-blue-200 hover:bg-blue-100 whitespace-nowrap transition-colors">ูุงูุจ ุดุญู</button>
                <button onclick="setWaTemplate('address')" class="text-[10px] bg-orange-50 text-orange-700 px-3 py-1.5 rounded-full border border-orange-200 hover:bg-orange-100 whitespace-nowrap transition-colors">ุชุฃููุฏ ุนููุงู</button>
                <button onclick="setWaTemplate('empty')" class="text-[10px] bg-white text-stone-700 px-3 py-1.5 rounded-full border border-stone-200 hover:bg-stone-100 whitespace-nowrap transition-colors">ูุงุฑุบ</button>
            </div>

            <div>
                <label class="block text-xs font-bold text-stone-500 mb-1.5">ูุต ุงูุฑุณุงูุฉ (ูุงุจู ููุชุนุฏูู)</label>
                <textarea id="wa-message-input" rows="8" class="w-full border border-stone-200 rounded-xl p-3 text-sm focus:ring-2 focus:ring-[#25D366] outline-none bg-white focus:bg-white transition-all placeholder:text-stone-400 font-medium text-stone-700 leading-relaxed"></textarea>
            </div>
            <button onclick="sendCustomWhatsApp()" class="w-full bg-[#25D366] text-white py-3.5 rounded-xl font-bold hover:bg-[#1da851] transition-all shadow-lg flex justify-center gap-2 items-center group">
                <span>ูุชุญ ูู ูุงุชุณุงุจ</span>
                <i data-lucide="send" size="18" class="group-hover:translate-x-1 transition-transform"></i>
            </button>
        </div>
    </div>

    <!-- Modern Light Footer -->
    <footer class="bg-white text-stone-600 py-16 mt-auto border-t border-stone-200 font-light relative overflow-hidden">
        <!-- Background Elements (Light Theme) -->
        <div class="absolute top-0 right-0 w-96 h-96 bg-stone-200/40 rounded-full blur-3xl -mr-40 -mt-40 pointer-events-none"></div>
        <div class="absolute bottom-0 left-0 w-64 h-64 bg-stone-200/40 rounded-full blur-3xl -ml-20 -mb-20 pointer-events-none"></div>

        <div class="container mx-auto px-6 relative z-10">
            
            <!-- ุฒุฑ ุงูุงูุชูุงู ููุฃุนูู (ุฌุฏูุฏ) -->
            <div class="flex justify-end mb-8">
                <button onclick="window.scrollTo({ top: 0, behavior: 'smooth' })" class="group flex items-center gap-2 bg-white border border-stone-200 hover:border-stone-900 text-stone-500 hover:text-stone-900 px-5 py-2.5 rounded-full transition-all duration-300 shadow-sm hover:shadow-md">
                    <span class="text-xs font-bold">ุงูุฅูุชูุงู ููุฃุนูู</span>
                    <div class="bg-stone-100 group-hover:bg-stone-900 group-hover:text-white rounded-full p-1 transition-colors">
                        <i data-lucide="arrow-up" size="14" class="group-hover:-translate-y-0.5 transition-transform"></i>
                    </div>
                </button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12 lg:gap-8 mb-16 border-b border-stone-200 pb-12">
                <!-- Brand Info -->
                <div class="space-y-6">
                    <!-- ุชู ุฅุถุงูุฉ id="footer-brand" ููุง -->
                    <div id="footer-brand">
                        <div class="text-3xl font-bold text-stone-900 tracking-tighter flex items-center gap-1">ุฌุฏุงุฑ<span class="text-stone-400 text-5xl leading-3">.</span></div>
                    </div>
                    <!-- ุชู ุชูุจูุฑ ุงูุฎุท ููุง ูู text-sm ุฅูู text-base -->
                    <p class="text-base leading-relaxed max-w-xs text-stone-500">
                        ูุญูู ูุณุงุญุชู ุงูุนุงุฏูุฉ ุฅูู ุชุญูุฉ ูููุฉ. ูุฌูุชู ุงูุฃููู ูุฃุญุฏุซ ุตูุญุงุช ุงูุฏูููุฑ ูุชุฌุงููุฏ ุงูุญูุงุฆุท ูู ูุตุฑ ุจุฌูุฏุฉ ูุง ุชุถุงูู.
                    </p>
                    <div class="flex gap-3">
                        <a href="https://www.facebook.com/gedar.fayoum" target="_blank" class="w-10 h-10 rounded-full bg-white flex items-center justify-center hover:bg-[#1877F2] hover:text-white transition-all duration-300 group shadow-sm border border-stone-200 hover:border-[#1877F2] text-stone-500">
                            <i data-lucide="facebook" size="18" class="group-hover:scale-110 transition-transform"></i>
                        </a>
                        <a href="https://www.instagram.com/gedar_fayoum" target="_blank" class="w-10 h-10 rounded-full bg-white flex items-center justify-center hover:bg-[#E4405F] hover:text-white transition-all duration-300 group shadow-sm border border-stone-200 hover:border-[#E4405F] text-stone-500">
                            <i data-lucide="instagram" size="18" class="group-hover:scale-110 transition-transform"></i>
                        </a>
                        <a href="https://wa.me/201014175070" target="_blank" class="w-10 h-10 rounded-full bg-white flex items-center justify-center hover:bg-[#25D366] hover:text-white transition-all duration-300 group shadow-sm border border-stone-200 hover:border-[#25D366] text-stone-500">
                            <i data-lucide="message-circle" size="18" class="group-hover:scale-110 transition-transform"></i>
                        </a>
                    </div>
                </div>

                <!-- Quick Links -->
                <div>
                    <h4 class="text-stone-900 font-bold text-lg mb-6 relative w-fit after:content-[''] after:absolute after:-bottom-2 after:right-0 after:w-1/2 after:h-0.5 after:bg-stone-300">ุงูุชุณูู</h4>
                    <!-- ุชู ุชูุจูุฑ ุงูุฎุท ููุง ูู text-sm ุฅูู text-base -->
                    <ul class="space-y-4 text-base">
                        <li><button onclick="setView('shop')" class="hover:text-stone-900 transition-colors flex items-center gap-2 group w-full text-right"><i data-lucide="chevron-left" size="14" class="opacity-0 group-hover:opacity-100 transition-all -translate-x-2 group-hover:translate-x-0 text-stone-400"></i> ูู ุงูููุชุฌุงุช</button></li>
                        <li><button onclick="filterCategory('ุจุฏูู ุงูุฎุดุจ'); setView('shop')" class="hover:text-stone-900 transition-colors flex items-center gap-2 group w-full text-right"><i data-lucide="chevron-left" size="14" class="opacity-0 group-hover:opacity-100 transition-all -translate-x-2 group-hover:translate-x-0 text-stone-400"></i> ุจุฏูู ุงูุฎุดุจ</button></li>
                        <li><button onclick="filterCategory('ุจุฏูู ุงูุฑุฎุงู'); setView('shop')" class="hover:text-stone-900 transition-colors flex items-center gap-2 group w-full text-right"><i data-lucide="chevron-left" size="14" class="opacity-0 group-hover:opacity-100 transition-all -translate-x-2 group-hover:translate-x-0 text-stone-400"></i> ุจุฏูู ุงูุฑุฎุงู</button></li>
                        <li><button onclick="setView('offers')" class="hover:text-stone-900 transition-colors flex items-center gap-2 group w-full text-right"><i data-lucide="chevron-left" size="14" class="opacity-0 group-hover:opacity-100 transition-all -translate-x-2 group-hover:translate-x-0 text-stone-400"></i> ุงูุนุฑูุถ ูุงูุฎุตููุงุช</button></li>
                    </ul>
                </div>

                <!-- Customer Support -->
                <div>
                    <h4 class="text-stone-900 font-bold text-lg mb-6 relative w-fit after:content-[''] after:absolute after:-bottom-2 after:right-0 after:w-1/2 after:h-0.5 after:bg-stone-300">ุฎุฏูุฉ ุงูุนููุงุก</h4>
                    <!-- ุชู ุชูุจูุฑ ุงูุฎุท ููุง ูู text-sm ุฅูู text-base -->
                    <ul class="space-y-4 text-base">
                        <li><button onclick="setView('track-order')" class="hover:text-stone-900 transition-colors flex items-center gap-2 text-orange-600 font-bold group w-full text-right"><i data-lucide="package-search" size="16" class="group-hover:scale-110 transition-transform"></i> ุชุชุจุน ุทูุจู</button></li>
                        <li><button onclick="setView('contact')" class="hover:text-stone-900 transition-colors w-full text-right">ุงุชุตู ุจูุง</button></li>
                        <li><button onclick="setView('faq')" class="hover:text-stone-900 transition-colors w-full text-right">ุงูุฃุณุฆูุฉ ุงูุดุงุฆุนุฉ</button></li>
                        <li><button onclick="setView('return-policy')" class="hover:text-stone-900 transition-colors w-full text-right">ุณูุงุณุฉ ุงูุงุณุชุฑุฌุงุน</button></li>
                    </ul>
                </div>

                <!-- Contact Details -->
                <div>
                    <h4 class="text-stone-900 font-bold text-lg mb-6 relative w-fit after:content-[''] after:absolute after:-bottom-2 after:right-0 after:w-1/2 after:h-0.5 after:bg-stone-300">ูุนูููุงุช ุงูุชูุงุตู</h4>
                    <!-- ุชู ุชูุจูุฑ ุงูุฎุท ููุง ูู text-sm ุฅูู text-base -->
                    <ul class="space-y-6 text-base">
                        <li class="flex items-start gap-4 group">
                            <div class="w-10 h-10 rounded-xl bg-white flex items-center justify-center shrink-0 group-hover:bg-stone-100 transition-colors text-stone-500 group-hover:text-stone-900 border border-stone-200 shadow-sm">
                                <i data-lucide="map-pin" size="18"></i>
                            </div>
                            <span class="mt-1 leading-relaxed">ุงููููู - ููุงูุฉ ุดุงุฑุน ุงููุณุชุดูู ุงูุนุงู ุฅุชุฌุงู ูุฏูุฑูุฉ ุงูุฃูู<br/><span class="text-stone-400 text-sm">ุจุฌูุงุฑ ุงููุบุณูุฉ ุงูุงูุฑูููู ูุงูุงู ูุทุนู ุงุจู ุตูุงุญ</span></span>
                        </li>
                        <li class="flex items-center gap-4 group">
                            <div class="w-10 h-10 rounded-xl bg-white flex items-center justify-center shrink-0 group-hover:bg-stone-100 transition-colors text-stone-500 group-hover:text-stone-900 border border-stone-200 shadow-sm">
                                <i data-lucide="phone" size="18"></i>
                            </div>
                            <div class="flex flex-col">
                                <a href="tel:+201014175070" class="dir-ltr font-mono text-xl text-stone-900 font-bold tracking-wide hover:text-blue-600 transition-colors" title="ุงุชุตุงู ูุงุชูู">01014175070</a>
                                <a href="https://wa.me/201014175070" target="_blank" class="text-sm font-bold text-green-600 hover:text-green-700 flex items-center gap-1 transition-colors">
                                    <i data-lucide="message-circle" size="14"></i> ุชูุงุตู ุนุจุฑ ูุงุชุณุงุจ
                                </a>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Bottom Bar -->
            <div class="border-t border-stone-200 pt-8">
                <!-- ุชู ุชูุจูุฑ ุงูุฎุท ููุง ูู text-xs ุฅูู text-sm -->
                <div class="flex flex-col md:flex-row justify-between items-center gap-6 text-sm text-stone-500 mb-6">
                    <p>&copy; 2024 ูุชุฌุฑ ุฌุฏุงุฑ ููุฏูููุฑ. ุฌููุน ุงูุญููู ูุญููุธุฉ.</p>
                    
                    <!-- Payment Methods Logos -->
                    <div class="grayscale hover:grayscale-0 transition-all duration-500 opacity-80 hover:opacity-100">
                        <img src="https://raw.githubusercontent.com/gedarfayoum-eng/website/refs/heads/main/Images/banner/payment.webp" class="h-16 md:h-24 w-auto object-contain" alt="ุทุฑู ุงูุฏูุน ุงููุชุงุญุฉ">
                    </div>
                </div>

                <!-- Developer Info (NEW) -->
                <!-- ุชู ุชูุจูุฑ ุงูุฎุท ููุง ูู text-[10px] ุฅูู text-sm -->
                <div class="flex justify-center items-center gap-2 text-sm text-stone-400 border-t border-stone-100 pt-4">
                    <span>ูุนูููุงุช ุงููุทูุฑ:</span>
                    <a href="https://badre.site" target="_blank" class="flex items-center gap-1.5 font-bold hover:text-stone-800 transition-colors group dir-ltr bg-white px-3 py-1 rounded-full border border-stone-100 hover:border-stone-300 hover:shadow-sm">
                        <i data-lucide="globe" size="14" class="text-stone-400 group-hover:text-blue-600 transition-colors"></i>
                        <span>Badr i. Smida</span>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- REMOVED: Bottom Banner Container was here -->

    <!-- New Lightbox Modal (White Theme) -->
    <div id="lightbox-modal" class="fixed inset-0 z-[100] bg-white/95 hidden flex items-center justify-center opacity-0 transition-opacity duration-300 backdrop-blur-sm">
        <!-- Close Button -->
        <button onclick="closeLightbox()" class="absolute top-6 right-6 text-stone-400 hover:text-stone-900 z-50 p-2 transition-transform hover:rotate-90 bg-stone-100 hover:bg-stone-200 rounded-full backdrop-blur-md border border-stone-200 shadow-sm">
            <i data-lucide="x" size="24"></i>
        </button>
        
        <!-- Navigation Buttons -->
        <!-- Next (Left in RTL) -->
        <button onclick="changeLightboxImage(1)" class="absolute left-4 md:left-8 top-1/2 -translate-y-1/2 text-stone-400 hover:text-stone-900 z-50 p-3 bg-white hover:bg-stone-50 rounded-full backdrop-blur-md transition-all border border-stone-200 shadow-lg hover:scale-110 group">
            <i data-lucide="chevron-left" size="32" class="group-hover:-translate-x-1 transition-transform"></i>
        </button>
        
        <!-- Prev (Right in RTL) -->
        <button onclick="changeLightboxImage(-1)" class="absolute right-4 md:right-8 top-1/2 -translate-y-1/2 text-stone-400 hover:text-stone-900 z-50 p-3 bg-white hover:bg-stone-50 rounded-full backdrop-blur-md transition-all border border-stone-200 shadow-lg hover:scale-110 group">
            <i data-lucide="chevron-right" size="32" class="group-hover:translate-x-1 transition-transform"></i>
        </button>

        <!-- Main Content Container -->
        <div class="relative w-full h-full flex items-center justify-center p-4 md:p-12" onclick="if(event.target === this) closeLightbox()">
            
            <!-- Image Element -->
            <img id="lightbox-img" src="" class="max-h-full max-w-full object-contain rounded-2xl shadow-2xl transition-all duration-300 select-none transform scale-95 opacity-0 border border-stone-100">
            
            <!-- Video Element (New) -->
            <div id="lightbox-video-container" class="hidden w-full max-w-4xl aspect-video rounded-2xl overflow-hidden shadow-2xl border border-stone-200 bg-black">
                <iframe id="lightbox-video" class="w-full h-full" src="" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
            </div>

            <!-- Counter -->
            <div class="absolute bottom-6 left-1/2 -translate-x-1/2 text-stone-600 font-mono text-sm bg-white/90 px-4 py-1.5 rounded-full backdrop-blur-md border border-stone-200 font-bold tracking-widest shadow-sm">
                <span id="lightbox-counter">1 / 1</span>
            </div>
        </div>
    </div>

    <!-- Firebase & Main Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        // ุฅุถุงูุฉ runTransaction ููุง
        import { getFirestore, collection, doc, getDoc, setDoc, addDoc, onSnapshot, updateDoc, deleteDoc, arrayUnion, serverTimestamp, runTransaction } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // ==========================================
        // ุฅุนุฏุงุฏุงุช ุงูุฅุดุนุงุฑุงุช (ูุงู ุฌุฏุงู)
        // ==========================================
        // ุถุน ุฑุงุจุท Google Apps Script Web App ููุง ุจูู ุนูุงูุงุช ุงูุชูุตูุต
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxeZJyOp0X4_CUWeoB_Bhkt75CCH-dEu0QKjkSOJsb-7MvNgYx8tgFKdCvVT64tp8frzg/exec"; 
        
        // --- ๐ ุฅุนุฏุงุฏุงุช ุจูุช ูุงุชุณุงุจ (CallMeBot) ---
        // 1. ุงุญูุธ ุงูุฑูู "CallMeBot" ูู ุฌูุงุช ุงุชุตุงูู: +34 644 56 52 23
        // 2. ุฃุฑุณู ูู ุฑุณุงูุฉ: "I allow callmebot to send me messages"
        // 3. ุณูุตูู ุงูู API Keyุ ุถุนู ุจุงูุฃุณูู:
        const BOT_PHONE = "201069913150"; // ุชู ุงูุชุญุฏูุซ ุจูุงุกู ุนูู ุจูุงูุงุชู
        const BOT_API_KEY = "4918216"; // ุชู ุงูุชุญุฏูุซ ุจูุงุกู ุนูู ุจูุงูุงุชู
        
        // Admin Configuration
        const ADMIN_EMAIL = 'gedar.fayoum@gmail.com';
        
        // Delivery Configuration
        const DELIVERY_AREAS = [
            "ุงูุนุจูุฏู", "ุงูุฅุตูุงุญ ุงูุฒุฑุงุนู", "ุงููุณูุฉ", "ุฑูุนุช ุนุฒูู", 
            "ุงููููุฑู", "ุงููุณุชุดูู ุงูุนุงู", "ุฏูุฉ", "ูููู ูุตุฑ"
        ];
        const FIXED_DELIVERY_FEE = 70;

        // Global State
        let db, auth, appId, user;
        let CATEGORIES = [];
        let PRODUCTS = [];
        let ALL_REVIEWS = []; 
        let ALL_ORDERS = []; // NEW: Store orders
        let REAL_WORKS = []; // ๐ Global variable for Real Work images
        let realWorkLimit = 4; // ๐ ูุชุบูุฑ ูุชุชุจุน ุนุฏุฏ ุงูุตูุฑ ุงููุนุฑูุถุฉ ุญุงููุงู
        let cart = [];
        let favorites = [];
        let isDataLoaded = false; // NEW: To handle direct link loading state
        
        // Lightbox State
        let currentLightboxIndex = 0;

        // ๐ Helper: Extract YouTube ID
        window.getYouTubeID = (url) => {
            if (!url) return null;
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        };

        // --- NEW: Lightbox Functions (Updated for Video) ---
        window.openLightbox = (index) => {
            if (!REAL_WORKS || REAL_WORKS.length === 0) return;
            
            const modal = document.getElementById('lightbox-modal');
            
            currentLightboxIndex = index;
            
            // Show modal first
            modal.classList.remove('hidden');
            // Small delay to allow CSS transition for opacity
            requestAnimationFrame(() => {
                modal.classList.remove('opacity-0');
            });

            // Update content
            updateLightboxContent();
            
            // Add Keyboard Listener
            document.addEventListener('keydown', handleLightboxKeys);
            // Disable Body Scroll
            document.body.style.overflow = 'hidden';
        };

        window.closeLightbox = () => {
            const modal = document.getElementById('lightbox-modal');
            modal.classList.add('opacity-0');
            
            // Stop Video Playback immediately by clearing src
            const iframe = document.getElementById('lightbox-video');
            if(iframe) iframe.src = '';

            setTimeout(() => {
                modal.classList.add('hidden');
                // Reset Image
                const img = document.getElementById('lightbox-img');
                if(img) {
                    img.style.transform = 'scale(0.95)';
                    img.style.opacity = '0';
                }
            }, 300);

            document.removeEventListener('keydown', handleLightboxKeys);
            document.body.style.overflow = '';
        };

        window.changeLightboxImage = (dir) => {
            // dir: 1 (Next), -1 (Prev)
            currentLightboxIndex += dir;
            
            // Loop functionality
            if (currentLightboxIndex >= REAL_WORKS.length) currentLightboxIndex = 0;
            if (currentLightboxIndex < 0) currentLightboxIndex = REAL_WORKS.length - 1;
            
            updateLightboxContent();
        };

        function updateLightboxContent() {
            const url = REAL_WORKS[currentLightboxIndex];
            const ytId = getYouTubeID(url);
            
            const imgEl = document.getElementById('lightbox-img');
            const vidContainer = document.getElementById('lightbox-video-container');
            const iframe = document.getElementById('lightbox-video');
            const counter = document.getElementById('lightbox-counter');
            
            // Update counter
            if(counter) counter.innerText = `${currentLightboxIndex + 1} / ${REAL_WORKS.length}`;

            // Reset States
            imgEl.style.opacity = '0';
            imgEl.style.transform = 'scale(0.98)';
            
            // Logic to switch between Video and Image
            if (ytId) {
                // It's a Video
                imgEl.classList.add('hidden');
                vidContainer.classList.remove('hidden');
                
                // Set AutoPlay for smooth experience
                iframe.src = `https://www.youtube.com/embed/${ytId}?autoplay=1&rel=0`;
            } else {
                // It's an Image
                vidContainer.classList.add('hidden');
                iframe.src = ''; // Stop any playing video
                imgEl.classList.remove('hidden');
                
                setTimeout(() => {
                    imgEl.src = url;
                    // Fade in on load
                    imgEl.onload = () => {
                        imgEl.style.opacity = '1';
                        imgEl.style.transform = 'scale(1)';
                    };
                }, 50);
            }
        }

        function handleLightboxKeys(e) {
            if (e.key === 'Escape') closeLightbox();
            if (e.key === 'ArrowLeft') changeLightboxImage(1); // Left Arrow = Next (in RTL visuals)
            if (e.key === 'ArrowRight') changeLightboxImage(-1); // Right Arrow = Prev (in RTL visuals)
        }
        // ------------------------------

        // Tracking Data Loading
        let initialCatsLoaded = false;
        let initialProdsLoaded = false;

        // NEW: Load Data from Cache (Speed Booster)
        function loadCachedData() {
            try {
                // 1. Load Categories
                const cachedCats = localStorage.getItem('gedar_categories_cache');
                if (cachedCats) {
                    const parsed = JSON.parse(cachedCats);
                    if (Array.isArray(parsed) && parsed.length > 0) {
                        CATEGORIES = parsed;
                        initialCatsLoaded = true;
                    }
                }

                // 2. Load Products
                const cachedProds = localStorage.getItem('gedar_products_cache');
                if (cachedProds) {
                    const parsed = JSON.parse(cachedProds);
                    if (Array.isArray(parsed) && parsed.length > 0) {
                        PRODUCTS = parsed;
                        initialProdsLoaded = true;
                        isDataLoaded = true;
                    }
                }

                // 3. Render Immediately if we have data
                if (initialCatsLoaded || initialProdsLoaded) {
                    // Update Mega Menu immediately with what we have
                    if (CATEGORIES.length > 0) updateMegaMenu();
                    
                    // Render current view
                    renderView();
                    
                    console.log("๐ Loaded from cache instantly");
                }
            } catch (e) {
                console.error("Cache Load Error:", e);
            }
        }

        // NEW: Global interval for countdowns
        let countdownInterval = null;
        let bannerScrollTimers = {}; // ูุชุบูุฑ ูุชุฎุฒูู ูุคูุชุงุช ุงูุญุฑูุฉ ุงูุชููุงุฆูุฉ
        let lastPlacedOrder = null; // โ ุชู ุฅุถุงูุฉ ูุฐุง ุงููุชุบูุฑ ูููุน ุงูุฃุฎุทุงุก
        
        // NEW: ูุชุบูุฑ ูุชุชุจุน ูู ุชู ูุชุญ ุงูุณูุฉ ุชููุงุฆูุงู ุฃู ูุง
        let hasAutoOpenedCart = false;

        // NEW: Lock flags to prevent double submission (ุชุญุณููุงุช ูุงุฒูุฉ)
        let isOrderSubmitting = false;
        let isPaymentSubmitting = false;

        // ุฎุฑูุทุฉ ุญุงูุงุช ุงูุทูุจ ูููุตูุต ุงูุนุฑุจูุฉ (ููุฅุดุนุงุฑุงุช)
        const STATUS_ARABIC_MAP = {
            'new': 'ุชู ุงุณุชูุงู ุงูุทูุจ',
            'pending_payment': 'ุจุงูุชุธุงุฑ ุงูุฏูุน',
            'payment_review': 'ุฌุงุฑู ูุฑุงุฌุนุฉ ุงูุฏูุน',
            'confirmed': 'ุชู ุชุฃููุฏ ุงูุทูุจ ูุงูุฏูุน',
            'processing': 'ุฌุงุฑู ุชุฌููุฒ ุงูุทูุจ',
            'shipped': 'ุชู ุดุญู ุงูุทูุจ',
            'delivered': 'ุชู ุชูุตูู ุงูุทูุจ ุจูุฌุงุญ',
            'cancelled': 'ุชู ุฅูุบุงุก ุงูุทูุจ',
            'expired': 'ููุชููุฉ ุงูุตูุงุญูุฉ (ูู ูุชู ุงูุฏูุน)' // 3๏ธโฃ New Status
        };

        // NEW: Hero Settings State (Initialized Empty)
        let HERO_SETTINGS = {
            mainImage: "",
            secondaryImage: "",
            priceLabel: "",
            priceValue: "",
            discountLabel: "",
            discountValue: "",
            logoUrl: "",
            logoSize: "100",
            // Image Configuration
            imageBaseUrl: "",
            imageDefaultExt: ".webp",
            // Header Banner Settings (Separate Mobile/Desktop)
            footerBannerUrl: "",
            footerBannerUrlMobile: "", // ๐ Added Mobile URL
            fbHeightDesktop: "300", fbHeightMobile: "150",
            fbWidthDesktop: "90", fbWidthMobile: "95",
            fbRadiusDesktop: "2rem", fbRadiusMobile: "1rem",
            showFooterBanner: false,
            // Category Banner Settings (Separate Mobile/Desktop)
            categoryBannerUrl: "",
            catBanHeightDesktop: "250", catBanHeightMobile: "120",
            catBanWidthDesktop: "90", catBanWidthMobile: "95",
            catBanRadiusDesktop: "1.5rem", catBanRadiusMobile: "0.8rem",
            showCategoryBanner: false,
            // Other Banners
            bestSellerBannerUrl: "",
            bestSellerBannerHeight: "200",
            bestSellerBannerWidth: "100",
            showBestSellerBanner: false,
            featuredBannerUrl: "",
            featuredBannerHeight: "200",
            featuredBannerWidth: "100",
            showFeaturedBanner: false,
            // --- NEW: Payment Banner Settings ---
            paymentBannerUrl: "",
            showPaymentBanner: false,
            // ุฅุถุงูุฉ ุฅุนุฏุงุฏุงุช ุงูุทูู ูุงูุนุฑุถ (ุงูุงูุชุฑุงุถู ุฃูุจุฑ ููููุงู: 60px)
            paymentBannerHeight: "60",
            paymentBannerWidth: "auto",
            // ------------------------------------
            showHeroMobile: true,
            showHeroDesktop: true,
            showCategoryBar: true // NEW: Default to true
        };
        let currentView = 'home';
        let currentAdminTab = 'dashboard';
        let currentOrderTab = 'active'; 
        let currentProductId = null;
        let currentEditProduct = null;
        let currentEditCategoryName = null; // NEW: Track category being edited
        let shopState = { search: '', categories: [], priceMin: 0, priceMax: 10000, sort: 'featured' };
        
        // NEW: Admin Order Filter State
        let adminOrderFilter = 'all'; // all, pending, vodafone, today

        let detailsQuantity = 1;
        let activeImageIndex = 0;
        let currentSelectedColor = null; // ูุชุบูุฑ ุฌุฏูุฏ ูุชุฎุฒูู ุงูููู ุงููุฎุชุงุฑ

        // --- NEW: Helper to check if discount is valid ---
        function isDiscountActive(p) {
            if (!p.discount || p.discount <= 0) return false;
            // If no expiry is set, discount is always active (permanent)
            if (!p.discountExpiry) return true;
            // Check if current time is before expiry
            return p.discountExpiry > Date.now();
        }

        // --- Init ---
        async function init() {
            lucide.createIcons();
            
            // ๐ Try to load from cache immediately before Firebase connects
            loadCachedData();

            const firebaseConfig = {
                apiKey: "AIzaSyAQoLRMCHjOW_jWHtuYppSLxzaYhPZUj40",
                authDomain: "gedarwebsitenew.firebaseapp.com",
                projectId: "gedarwebsitenew",
                storageBucket: "gedarwebsitenew.firebasestorage.app",
                messagingSenderId: "164355005674",
                appId: "1:164355005674:web:ce33a2b8694c2e9507cb93",
                measurementId: "G-8FPJKYQT4X"
            };
            const app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

            onAuthStateChanged(auth, (u) => {
                // Security Check: Enforce Owner Only for Google Sign-In
                // If user is signed in (not anon) AND email doesn't match admin, force logout.
                if (u && !u.isAnonymous && u.email !== ADMIN_EMAIL) {
                    signOut(auth).then(() => {
                        showToast("ุนุฐุฑุงูุ ูุฐุง ุงูุญุณุงุจ ุบูุฑ ูุตุฑุญ ูู ุจุงูุฏุฎูู. ุงูุฏุฎูู ูููุงูู ููุท.");
                    });
                    return;
                }

                user = u;
                updateUserUI();
                
                if (user) {
                    setupDataListeners();
                } else {
                    signInAnonymously(auth).catch(err => console.error("Anon Auth Error:", err));
                }
            });

            const savedFavs = localStorage.getItem('aura_favorites');
            if (savedFavs) try { favorites = JSON.parse(savedFavs); updateFavoritesUI(); } catch(e) {}

            // NEW: Load Cart from LocalStorage
            const savedCart = localStorage.getItem('gedar_cart');
            if (savedCart) try { cart = JSON.parse(savedCart); updateCartUI(); } catch(e) {}

            // NEW: Listen for URL changes (Back/Forward buttons)
            window.addEventListener('hashchange', handleRouting);
            
            // NEW: Handle initial URL on page load
            handleRouting();
            
            window.addEventListener('scroll', () => {
                const nav = document.getElementById('navbar');
                // ุชู ุชุนุฏูู ููุทู ุงูู Scroll ูุฅุฒุงูุฉ ุงูู padding ุงูุฒุงุฆุฏ ูุฃููุง ุซุจุชูุงู ูู ุงูู HTML
                if (window.scrollY > 20) {
                    nav.classList.add('shadow-md');
                } else {
                    nav.classList.remove('shadow-md');
                }
            });

            // Click outside to close search
            document.addEventListener('click', (e) => {
                const wrapper = document.getElementById('top-search-wrapper');
                if (wrapper && !wrapper.contains(e.target)) {
                    closeTopSearch();
                }
            });
        }

        function setupDataListeners() {
            const catDoc = doc(db, 'artifacts', appId, 'public', 'data', 'metadata', 'store');
            onSnapshot(catDoc, (snap) => {
                if (snap.exists()) {
                    let cats = snap.data().categories || [];
                    // UPDATE: ุชุตููุฉ ุงูุจูุงูุงุช ูุฅุฒุงูุฉ ุฃู ูุณู ูุงุณุฏ ุฃู undefined
                    CATEGORIES = cats
                        .map(c => typeof c === 'string' ? { name: c, image: 'https://images.unsplash.com/photo-1555041469-a586c61ea9bc?w=500' } : c)
                        .filter(c => c && c.name && c.name !== 'undefined' && c.name.trim() !== '');
                    
                    // โ NEW: Save to Cache
                    localStorage.setItem('gedar_categories_cache', JSON.stringify(CATEGORIES));
                } else {
                    // Create empty metadata doc if not exists, but don't seed dummy data
                    setDoc(catDoc, { categories: [] });
                    CATEGORIES = [];
                }
                
                // Mark Categories as Loaded
                initialCatsLoaded = true;

                updateMegaMenu();
                if (currentView === 'shop' || currentView === 'categories' || currentView === 'admin') renderView();
            });

            const prodCol = collection(db, 'artifacts', appId, 'public', 'data', 'products');
            onSnapshot(prodCol, (snap) => {
                // Completely removed default seeding logic
                // Now purely relies on what's in Firestore
                PRODUCTS = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                isDataLoaded = true; // Data is ready
                
                // โ NEW: Save to Cache
                localStorage.setItem('gedar_products_cache', JSON.stringify(PRODUCTS));
                
                // Mark Products as Loaded
                initialProdsLoaded = true;

                // Refresh view if we were waiting for data (e.g. direct product link)
                if (currentView === 'product-details' || currentView === 'home' || currentView === 'shop') renderView();
            });

            const reviewsCol = collection(db, 'artifacts', appId, 'public', 'data', 'reviews');
            onSnapshot(reviewsCol, (snap) => {
                ALL_REVIEWS = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                if (currentView === 'product-details' || currentView === 'admin') renderView();
            });

            // NEW: Hero Settings Listener
            const heroDoc = doc(db, 'artifacts', appId, 'public', 'data', 'metadata', 'hero');
            onSnapshot(heroDoc, (snap) => {
                if (snap.exists()) {
                    HERO_SETTINGS = snap.data();
                    // NEW: Cache settings for instant load next time
                    localStorage.setItem('gedar_hero_cache', JSON.stringify(HERO_SETTINGS));
                }
                // Update Branding Immediately
                updateGlobalBranding();
                
                // If on home or admin, re-render to show changes
                if (currentView === 'home' || currentView === 'admin') renderView();
            });

            // ๐ NEW: Real Work Images Listener
            const realWorkDoc = doc(db, 'artifacts', appId, 'public', 'data', 'metadata', 'realwork');
            onSnapshot(realWorkDoc, (snap) => {
                if (snap.exists()) {
                    REAL_WORKS = snap.data().images || [];
                } else {
                    // Default images if empty (Increased to show load more functionality)
                    REAL_WORKS = [
                        "https://images.unsplash.com/photo-1620626012053-93f268326996?w=600&q=80",
                        "https://images.unsplash.com/photo-1616486338812-3dadae4b4f9d?w=600&q=80",
                        "https://images.unsplash.com/photo-1616137466211-f939a420be84?w=600&q=80",
                        "https://images.unsplash.com/photo-1618221195710-dd6b41faaea6?w=600&q=80",
                        "https://images.unsplash.com/photo-1600210492486-724fe5c67fb0?w=600&q=80",
                        "https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?w=600&q=80",
                        "https://images.unsplash.com/photo-1600566753376-12c8ab7fb75b?w=600&q=80",
                        "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?w=600&q=80"
                    ];
                }
                if (currentView === 'home') renderView();
            });

            // NEW: Orders Listener for Admin Only
            if (user && user.email === ADMIN_EMAIL) {
                const ordersCol = collection(db, 'artifacts', appId, 'public', 'data', 'orders');
                onSnapshot(ordersCol, (snap) => {
                    ALL_ORDERS = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                    
                    // ุชุนุฏูู ููุทู ุงููุฑุฒ ููุชุนุงูู ูุน serverTimestamp
                    ALL_ORDERS.sort((a, b) => {
                        // ุฏุงูุฉ ูุณุงุนุฏุฉ ูุงุณุชุฎุฑุงุฌ ุงูููุช ุจุงููููู ุซุงููุฉ
                        const getTime = (t) => {
                            if (!t) return Date.now(); // ููุทูุจุงุช ุงูุฌุฏูุฏุฉ ุงูุชู ูู ูุตู ุชูููุชูุง ุจุนุฏ (Pending)
                            return t.toMillis ? t.toMillis() : (t || 0); // ุฅุฐุง ูุงู Timestamp ุฃู ุฑูู ูุฏูู
                        };
                        return getTime(b.createdAt) - getTime(a.createdAt);
                    });

                    // 3๏ธโฃ Auto Cleanup Trigger (ุชุดุบูู ุงูุชูุธูู ุงูุฐูู ุนูุฏ ุชุญููู ุงูุจูุงูุงุช)
                    autoCleanupOrders(ALL_ORDERS);

                    // ุชุญุฏูุซ ุงูุนุฑุถ ุฅุฐุง ููุง ูู ุตูุญุฉ ุงูุทูุจุงุช ุฃู ูู ููุญุฉ ุงูุชุญูู ุจุชุจููุจ ุงูุทูุจุงุช
                    if (currentView === 'orders' || (currentView === 'admin' && currentAdminTab === 'orders')) renderView();
                });
            }
        }

        // --- 3๏ธโฃ NEW: Auto Cleanup Function (ุงูุชูุธูู ุงูุฐูู) ---
        async function autoCleanupOrders(orders) {
            const now = Date.now();
            const EXPIRATION_LIMIT = 48 * 60 * 60 * 1000; // 48 ุณุงุนุฉ ุจุงููููู ุซุงููุฉ

            // ููุชุฑุฉ ุงูุทูุจุงุช ุงูุชู ุชุญุชุงุฌ ุชูุธูู
            const expiredOrders = orders.filter(o => {
                // ูุชุญูู ููุท ูู ุงูุทูุจุงุช ุงูุชู ูู ุงูุชุธุงุฑ ุงูุฏูุน (Pending)
                const isPending = o.status === 'pending_payment';
                if (!isPending) return false;

                // ุญุณุงุจ ููุช ุงูุทูุจ (ุชุตุญูุญ ุงูุฌููุชุด)
                let orderTime = now; // ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ: "ุงูุขู" (ูููุน ุงูุญุฐู ุจุงูุฎุทุฃ)

                if (o.createdAt) {
                    if (typeof o.createdAt.toMillis === 'function') {
                        orderTime = o.createdAt.toMillis();
                    } else if (typeof o.createdAt === 'number') {
                        orderTime = o.createdAt;
                    } else {
                        const parsed = new Date(o.createdAt).getTime();
                        if (!isNaN(parsed) && parsed > 0) orderTime = parsed;
                    }
                }
                
                // ุงูุดุฑุท: ูุฑ ุฃูุซุฑ ูู 48 ุณุงุนุฉ
                // ุฅุฐุง ูุงู orderTime = now (ูู ุญุงูุฉ ุงูุฎุทุฃ)ุ ุงููุชูุฌุฉ ุณุชููู 0 ููู ููุณุช ุฃูุจุฑ ูู 48 ุณุงุนุฉุ ูุฐุง ุงูุทูุจ ุจุฃูุงู
                return (now - orderTime) > EXPIRATION_LIMIT;
            });

            if (expiredOrders.length === 0) return; // ูุง ููุฌุฏ ุดูุก ููุชูุธูู

            // ุชูููุฐ ุงูุชุญุฏูุซุงุช (Batch updates logic handling one by one here for simplicity)
            const updates = expiredOrders.map(o => {
                return updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', o.id), {
                    status: 'expired',
                    // ุชูุซูู ุงูุนูููุฉ ูู ุงูุณุฌู ุงูุฒููู
                    statusHistory: arrayUnion({
                        status: 'expired',
                        timestamp: Date.now(),
                        note: 'ูุธุงู ุงูุชูุธูู ุงูุฐูู: ุชู ุฅูุบุงุก ุงูุทูุจ ุชููุงุฆูุงู ูุนุฏู ุฅุฑุณุงู ุฅุซุจุงุช ุงูุฏูุน ุฎูุงู 48 ุณุงุนุฉ'
                    })
                });
            });

            try {
                await Promise.all(updates);
                // ุฅุธูุงุฑ ุงูุชูุจูู ููุท ุฅุฐุง ุชู ุญุฐู ุทูุจุงุช ุจุงููุนู
                if(expiredOrders.length > 0) {
                    showToast(`๐งน ุงูุชูุธูู ุงูุฐูู: ุชู ุชุญููู ${expiredOrders.length} ุทูุจ ูุฏูู ุฅูู ููุชูู ุงูุตูุงุญูุฉ`);
                }
            } catch (err) {
                console.error("Auto Cleanup Error:", err);
            }
        }
        // -----------------------------------------------------

        function updateUserUI() {
            const container = document.getElementById('user-menu-container');
            const mobileSection = document.getElementById('mobile-user-section');
            const mobileAdminLink = document.getElementById('mobile-admin-link');
            const isAnon = user ? user.isAnonymous : true;
            const isAdmin = user && user.email === ADMIN_EMAIL;

            if (isAnon) {
                // ุชู ุฅุฒุงูุฉ hidden sm:block ูุชุธูุฑ ุงูุฃููููุฉ ุฏุงุฆูุงู
                container.innerHTML = `<button onclick="setView('login')" class="p-2 hover:bg-stone-100 rounded-full transition-colors" title="ุชุณุฌูู ุงูุฏุฎูู"><i data-lucide="user"></i></button>`;
                mobileSection.innerHTML = `<button onclick="setView('login'); toggleMobileMenu()" class="w-full text-center py-2 bg-stone-900 text-white rounded-xl">ุชุณุฌูู ุงูุฏุฎูู</button>`;
                if(mobileAdminLink) mobileAdminLink.innerHTML = '';
            } else {
                const avatar = user.photoURL || '';
                const name = user.displayName || 'ูุณุชุฎุฏู';
                const email = user.email || '';

                // Modern User Dropdown Design
                // --- 3. ุชุญุฏูุซ ูุงุฆูุฉ ุงููุณุชุฎุฏู ูุชููู ุงูุณูุงุจูุฉ (invisible/visible ุจุฏูุงู ูู hidden/block) ---
                container.innerHTML = `
                    <button class="flex items-center gap-2 p-1 pl-2 hover:bg-stone-100 rounded-full flex border border-transparent hover:border-stone-200 transition-all group-hover/user:bg-white group-hover/user:shadow-sm">
                        ${avatar ? `<img src="${avatar}" class="w-8 h-8 rounded-full object-cover ring-2 ring-white shadow-sm">` : `<div class="w-8 h-8 rounded-full bg-stone-200 flex items-center justify-center text-stone-600"><i data-lucide="user" size="16"></i></div>`}
                        <i data-lucide="chevron-down" size="14" class="text-stone-400 group-hover/user:text-stone-800 transition-colors hidden sm:block"></i>
                    </button>
                    
                    <div class="absolute top-full left-0 mt-3 w-72 bg-white/95 backdrop-blur-xl shadow-[0_10px_40px_-10px_rgba(0,0,0,0.15)] rounded-2xl border border-stone-100 overflow-hidden invisible opacity-0 translate-y-2 group-hover/user:visible group-hover/user:opacity-100 group-hover/user:translate-y-0 z-50 p-2 transform origin-top-left transition-all duration-300 ease-out">
                        
                        <!-- Profile Header -->
                        <div class="p-4 mb-2 bg-white/80 rounded-xl flex items-center gap-4 border border-stone-100">
                             ${avatar ? `<img src="${avatar}" class="w-12 h-12 rounded-full object-cover ring-4 ring-white shadow-sm">` : `<div class="w-12 h-12 rounded-full bg-white flex items-center justify-center shadow-sm text-stone-400"><i data-lucide="user" size="24"></i></div>`}
                            <div class="overflow-hidden">
                                <p class="font-bold text-stone-900 text-sm truncate">${name}</p>
                                <p class="text-[11px] text-stone-500 truncate font-medium">${email}</p>
                                ${isAdmin ? `<span class="inline-block mt-1 px-2 py-0.5 bg-blue-100 text-blue-700 text-[10px] font-bold rounded-full">ุงููุฏูุฑ</span>` : `<span class="inline-block mt-1 px-2 py-0.5 bg-green-100 text-green-700 text-[10px] font-bold rounded-full">ุนููู</span>`}
                            </div>
                        </div>

                        <!-- Menu Items -->
                        <div class="space-y-1">
                            ${isAdmin ? `
                            <button onclick="setView('admin')" class="w-full text-right px-3 py-2.5 hover:bg-white rounded-xl text-sm font-bold text-stone-700 flex items-center justify-between group transition-colors">
                                <span class="flex items-center gap-3"><div class="p-1.5 rounded-lg bg-blue-50 text-blue-600 group-hover:bg-blue-600 group-hover:text-white transition-colors"><i data-lucide="layout-dashboard" size="16"></i></div> ููุญุฉ ุงูุชุญูู</span>
                            </button>
                            ` : ''}
                            
                            <!-- ุชู ุชุญุฏูุซ ุงูุฑุงุจุท ููุง ูููุฌู ูุชุจููุจ ุงูุทูุจุงุช ุฏุงุฎู ุงูููุญุฉ -->
                            <button onclick="${isAdmin ? "setAdminView('orders')" : "showToast('ูุฑูุจุงู...')"}" class="w-full text-right px-3 py-2.5 hover:bg-white rounded-xl text-sm font-bold text-stone-700 flex items-center justify-between group transition-colors">
                                <span class="flex items-center gap-3"><div class="p-1.5 rounded-lg bg-orange-50 text-orange-600 group-hover:bg-orange-600 group-hover:text-white transition-colors"><i data-lucide="package" size="16"></i></div> ุทูุจุงุช ุงูุนููุงุก</span>
                                ${isAdmin ? `<span class="bg-red-500 text-white text-[10px] px-1.5 py-0.5 rounded-full" id="orders-badge" ${ALL_ORDERS.length===0?'style="display:none"':''}>${ALL_ORDERS.filter(o=>!o.isArchived).length}</span>` : ''}
                            </button>
                            
                            <div class="h-px bg-stone-100 my-2 mx-2"></div>
                            
                            <button onclick="handleLogout()" class="w-full text-right px-3 py-2.5 hover:bg-red-50 text-stone-600 hover:text-red-600 rounded-xl text-sm font-bold flex items-center justify-between group transition-colors">
                                <span class="flex items-center gap-3"><div class="p-1.5 rounded-lg bg-stone-100 text-stone-500 group-hover:bg-red-100 group-hover:text-red-600 transition-colors"><i data-lucide="log-out" size="16"></i></div> ุชุณุฌูู ุงูุฎุฑูุฌ</span>
                            </button>
                        </div>
                    </div>
                `;
                
                // Mobile Section (Simpler version)
                mobileSection.innerHTML = `
                    <div class="flex items-center gap-3 mb-6 bg-white p-4 rounded-2xl border border-stone-100 shadow-sm">
                        ${avatar ? `<img src="${avatar}" class="w-12 h-12 rounded-full border-2 border-white shadow-md">` : `<div class="w-12 h-12 bg-stone-200 rounded-full flex items-center justify-center"><i data-lucide="user"></i></div>`}
                        <div class="overflow-hidden">
                            <p class="font-bold text-lg text-stone-900">${name}</p>
                            <p class="text-xs text-stone-500 truncate">${email}</p>
                        </div>
                    </div>
                    <button onclick="handleLogout(); toggleMobileMenu()" class="w-full flex items-center justify-center gap-2 py-3 bg-red-50 text-red-600 font-bold rounded-xl hover:bg-red-100 transition-colors">
                        <i data-lucide="log-out" size="18"></i> ุชุณุฌูู ุงูุฎุฑูุฌ
                    </button>
                `;

                if(isAdmin && mobileAdminLink) {
                    mobileAdminLink.innerHTML = `<button onclick="setView('admin'); toggleMobileMenu()" class="flex items-center gap-2 text-sm text-stone-600"><i data-lucide="settings" size="18"></i> ุงูุฅุฏุงุฑุฉ</button>`;
                } else if (mobileAdminLink) {
                    mobileAdminLink.innerHTML = '';
                }
            }
            lucide.createIcons();
        }

        // --- Exposed Logic ---
        
        // NEW: Routing Handler (Updated for Deep Linking)
        function handleRouting() {
            const hash = window.location.hash; 
            
            // If no hash or just #/, default to home
            if (!hash || hash === '#/' || hash === '#') {
                if(currentView !== 'home') {
                    setView('home');
                }
                return;
            }

            const path = hash.replace(/^#\//, ''); // remove #/
            const parts = path.split('/'); // split by /
            
            const route = parts[0];
            
            if (route === 'product' && parts[1]) {
                // Route: #/product/{id}
                currentProductId = parts[1];
                currentView = 'product-details';
            } else if (route === 'admin') {
                // Route: #/admin or #/admin/orders
                currentView = 'admin';
                if(parts[1]) currentAdminTab = parts[1];
                else currentAdminTab = 'dashboard';
            } else if (route) {
                // Generic Routes: #/shop, #/about, #/return-policy etc.
                currentView = route;
            } else {
                currentView = 'home';
            }
            
            // Clean up admin edit states if leaving admin
            if (currentView !== 'admin') {
                currentEditProduct = null;
                currentEditCategoryName = null;
            }

            renderView();
            window.scrollTo(0, 0);
        }

        window.setView = (view, param) => {
            // Clear any running countdowns when switching views
            if (countdownInterval) clearInterval(countdownInterval);

            currentView = view;
            
            // ๐ ุฅุนุงุฏุฉ ุชุนููู ุญุฏ ุนุฑุถ ุงูุตูุฑ ุนูุฏ ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ
            if (view === 'home') {
                realWorkLimit = 4;
            }
            
            if(view !== 'admin' && view !== 'orders') currentEditProduct = null;
            if(view === 'admin' && !currentAdminTab) currentAdminTab = 'dashboard';
            
            // UPDATE: URL Hash Logic (Smart URL Update)
            let targetHash = '/';
            
            if (view === 'home') {
                targetHash = '/';
            } else if (view === 'offers') {
                targetHash = '/offers';
            } else if (view === 'faq') { // NEW ROUTE
                targetHash = '/faq';
            } else if (view === 'product-details' && param) {
                targetHash = '/product/' + param;
                currentProductId = param; // Ensure ID is set
            } else if (view === 'admin') {
                targetHash = '/admin/' + (param || currentAdminTab || 'dashboard');
                if(param) currentAdminTab = param;
            } else {
                targetHash = '/' + view;
            }
            
            // NEW: Update URL Hash without triggering reload
            if (window.location.hash !== '#' + targetHash) {
                history.pushState(null, null, '#' + targetHash);
            }

            renderView();
            window.scrollTo(0, 0);
        };

        // ุฏุงูุฉ ุฌุฏูุฏุฉ ููุชููู ุจูู ุชุจููุจุงุช ููุญุฉ ุงูุชุญูู
        window.setAdminView = (tab) => {
            setView('admin', tab);
        };

        // NEW: Set Admin Order Filter
        window.setAdminOrderFilter = (filter) => {
            adminOrderFilter = filter;
            renderView();
        };

        // --- FIX: ุฏุงูุฉ ุงูุชุจุฏูู ุจูู ุงูุฌุงุฑูุฉ ูุงูุฃุฑุดูู (ูุงูุช ููููุฏุฉ) ---
        window.setOrderTab = (tab) => {
            currentOrderTab = tab;
            // ุฅุนุงุฏุฉ ุชุนููู ููุชุฑ ุงูุจุญุซ ุนูุฏ ุชุบููุฑ ุงูุชุจููุจ
            adminOrderFilter = 'all'; 
            renderView();
        };
        // -----------------------------------------------------------

        // --- NEW: ุฏุงูุฉ ุงูุจุญุซ ุงูููุฑู ูู ุงูุทูุจุงุช ---
        window.filterOrdersList = (query) => {
            const cards = document.querySelectorAll('.order-card-item');
            const q = query.toLowerCase().trim();
            
            cards.forEach(card => {
                const searchData = card.dataset.search.toLowerCase();
                if (searchData.includes(q)) {
                    card.classList.remove('hidden');
                } else {
                    card.classList.add('hidden');
                }
            });
        };
        // ---------------------------------------

        window.viewProduct = (id) => {
            currentProductId = id; // Ensure ID is set immediately
            detailsQuantity = 1;
            activeImageIndex = 0;
            currentSelectedColor = null; // ุชุตููุฑ ุงูููู ุนูุฏ ูุชุญ ููุชุฌ ุฌุฏูุฏ
            
            // --- NEW: Save to History ---
            // Get existing history
            let historyList = JSON.parse(localStorage.getItem('gedar_history') || '[]');
            // Remove current id if it exists (to move it to top)
            historyList = historyList.filter(hId => hId !== id);
            // Add to front
            historyList.unshift(id);
            // Limit to 10 items
            if(historyList.length > 10) historyList.pop();
            // Save back
            localStorage.setItem('gedar_history', JSON.stringify(historyList));
            // ---------------------------

            // Use setView to handle URL update properly
            setView('product-details', id);
        };

        window.scrollSlider = (dir) => {
            const s = document.getElementById('related-slider');
            if(s) s.scrollBy({ left: dir === 'right' ? 220 : -220, behavior: 'smooth' });
        };

        // NEW: Generic Banner Scroll Function (Updated for RTL Robustness)
        window.scrollBanner = (id, direction) => {
            const slider = document.getElementById(id);
            if (!slider) return;
            
            const width = slider.clientWidth;
            // direction: -1 (Left Arrow/Next in RTL), 1 (Right Arrow/Prev in RTL)
            slider.scrollBy({ left: direction * width, behavior: 'smooth' });
        };

        // NEW: Auto Scroll Logic
        window.startBannerAutoScroll = (id) => {
            const el = document.getElementById(id);
            if (!el) return;
            
            // Clear existing timer to prevent duplicates
            if (bannerScrollTimers[id]) clearInterval(bannerScrollTimers[id]);

            bannerScrollTimers[id] = setInterval(() => {
                const element = document.getElementById(id);
                if (!element) {
                    clearInterval(bannerScrollTimers[id]);
                    return;
                }

                // Logic for infinite scrolling effect
                const maxScroll = element.scrollWidth - element.clientWidth;
                // In RTL, scrollLeft is typically negative or 0 at start. 
                // We use Math.abs to handle browser differences in RTL scroll behavior.
                const currentScroll = Math.abs(element.scrollLeft);
                
                // If we reached the end (with small tolerance), go back to start
                if (currentScroll >= maxScroll - 10) {
                    element.scrollTo({ left: 0, behavior: 'smooth' });
                } else {
                    // Move Next (Negative left in RTL)
                    element.scrollBy({ left: -element.clientWidth, behavior: 'smooth' });
                }
            }, 4000); // 4 seconds interval
        };

        window.stopBannerAutoScroll = (id) => {
            if (bannerScrollTimers[id]) {
                clearInterval(bannerScrollTimers[id]);
                delete bannerScrollTimers[id];
            }
        };
        
        window.scrollFeatured = (dir) => {
            const s = document.getElementById('featured-slider');
            if(s) s.scrollBy({ left: dir === 'right' ? 260 : -260, behavior: 'smooth' });
        };

        // NEW: Function to start countdown timers
        function startCountdown() {
            if (countdownInterval) clearInterval(countdownInterval);
            
            const update = () => {
                const timers = document.querySelectorAll('.discount-timer');
                if (timers.length === 0) return;

                const now = Date.now();
                timers.forEach(el => {
                    const expiry = parseInt(el.dataset.expiry);
                    const diff = expiry - now;

                    if (diff <= 0) {
                        el.innerHTML = '<span class="text-stone-400 font-bold text-xs">ุงูุชูู ุงูุนุฑุถ</span>';
                        return;
                    }

                    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((diff % (1000 * 60)) / 1000);

                    el.innerHTML = `
                        <div class="flex items-center gap-2 text-xs font-bold text-red-600 dir-ltr bg-red-50 px-2 py-1 rounded-lg border border-red-100">
                            <span class="w-5 text-center">${seconds}</span>:
                            <span class="w-5 text-center">${minutes}</span>:
                            <span class="w-5 text-center">${hours}</span>:
                            <span class="w-6 text-center">${days}ู</span>
                        </div>
                    `;
                });
            };

            update(); // Run immediately
            countdownInterval = setInterval(update, 1000);
        }

        // --- NEW: Generic Scroll Function for Product Details Sliders ---
        window.scrollSection = (id, dir) => {
            const el = document.getElementById(id);
            if(el) {
                // In RTL, scrolling negative 'left' moves to the visual left (next items)
                const scrollAmount = 300;
                el.scrollBy({ left: dir === 'next' ? -scrollAmount : scrollAmount, behavior: 'smooth' });
            }
        };

        // --- NEW: Toggle About Section ---
        window.toggleAbout = (id) => {
            const container = document.getElementById(`about-container-${id}`);
            const fade = document.getElementById(`about-fade-${id}`);
            const btn = document.getElementById(`about-btn-${id}`);
            
            if (container.classList.contains('max-h-[100px]')) {
                // Expand
                container.classList.remove('max-h-[100px]');
                if(fade) fade.classList.add('hidden');
                btn.innerHTML = `<i data-lucide="chevron-up" size="16"></i> ุนุฑุถ ุฃูู`;
            } else {
                // Collapse
                container.classList.add('max-h-[100px]');
                if(fade) fade.classList.remove('hidden');
                btn.innerHTML = `<i data-lucide="chevron-down" size="16"></i> ุดุงูุฏ ุงููุฒูุฏ`;
            }
            lucide.createIcons();
        };

        // --- NEW: Share Product Logic ---
        window.shareProduct = async (id) => {
            const product = PRODUCTS.find(p => p.id === id);
            if (!product) return;
            
            // ุชูููู ุงูุฑุงุจุท ุงููุจุงุดุฑ
            // ูุณุชุฎุฏู window.location.origin ู window.location.pathname ูุถูุงู ุฃู ุงูุฑุงุจุท ูุนูู ุจุบุถ ุงููุธุฑ ุนู ุงูุฏูููู
            const url = `${window.location.origin}${window.location.pathname}#/product/${id}`;
            
            // ุงุณุชุฎุฏุงู ูุงุฌูุฉ ุงููุดุงุฑูุฉ ุงูุฃุตููุฉ ูููุชุตูุญ (ููููุงุชู)
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: product.name,
                        text: `ุดุงูุฏ ูุฐุง ุงูููุชุฌ ุงููููุฒ ูู ุฌุฏุงุฑ: ${product.name}`,
                        url: url
                    });
                } catch (err) {
                    console.log('Sharing failed or cancelled', err);
                }
            } else {
                // ุงููุณุฎ ููุญุงูุธุฉ ูุจุฏูู (ูุฃุฌูุฒุฉ ุงูููุจููุชุฑ ุฃู ุงููุชุตูุญุงุช ุงููุฏููุฉ)
                navigator.clipboard.writeText(url).then(() => {
                    showToast("ุชู ูุณุฎ ุฑุงุจุท ุงูููุชุฌ ููุญุงูุธุฉ");
                }).catch(() => {
                    showToast("ูุดู ูุณุฎ ุงูุฑุงุจุท");
                });
            }
        };

        window.showToast = (msg) => {
            const t = document.getElementById('toast');
            if (!t) return;
            t.innerText = msg;
            t.classList.remove('translate-y-12', 'opacity-0');
            setTimeout(() => t.classList.add('translate-y-12', 'opacity-0'), 3000);
        };

        // --- NEW: Shop & Filter Logic (ุฅุตูุงุญ ูุดููุฉ ุงูุชุตููุฉ) ---
        
        window.filterCategory = (catName) => {
            // ุชูุนูู ุงููุณู ุงููุฎุชุงุฑ ูุชุตููุฑ ุงูุจุญุซ
            shopState.categories = [catName];
            shopState.search = ''; 
            // ุงูุงูุชูุงู ูุตูุญุฉ ุงููุชุฌุฑ
            setView('shop');
        };

        window.viewAllProducts = () => {
            // ุฅุนุงุฏุฉ ุถุจุท ุงูููุงุชุฑ ูุนุฑุถ ุงููู
            shopState = { search: '', categories: [], priceMin: 0, priceMax: 1000, sort: 'featured' };
            setView('shop');
        };

        window.updateShopFilters = (type, value) => {
            if (type === 'search') {
                shopState.search = value.toLowerCase();
            } else if (type === 'category') {
                // ุฅุถุงูุฉ ุฃู ุฅุฒุงูุฉ ุงููุณู ูู ูุตูููุฉ ุงูุชุตููุฉ
                if (shopState.categories.includes(value)) {
                    shopState.categories = shopState.categories.filter(c => c !== value);
                } else {
                    shopState.categories.push(value);
                }
            } else if (type === 'priceMax') {
                shopState.priceMax = Number(value);
            } else if (type === 'priceMin') {
                shopState.priceMin = Number(value);
            } else if (type === 'sort') {
                shopState.sort = value;
            }
            
            // ุชุทุจูู ุงูููุชุฑ ูุชุญุฏูุซ ุงููุงุฌูุฉ
            if (currentView === 'shop') {
                applyShopFilters();
                
                // NEW: ุฅุนุงุฏุฉ ุฑุณู ูุงุฆูุฉ ุงูุฃูุณุงู ูุชุญุฏูุซ ุญุงูุฉ ุงูุชุญุฏูุฏ (Checkboxes)
                if (type === 'category') {
                    const list = document.getElementById('shop-categories-list');
                    if (list) list.innerHTML = generateCategoryFilterHTML();
                }
            }
        };

        // NEW: Helper function to generate category filter HTML
        function generateCategoryFilterHTML() {
            return CATEGORIES.map(cat => {
                const isSelected = shopState.categories.includes(cat.name);
                return `
                <label class="cursor-pointer group flex items-center justify-between p-2.5 rounded-xl transition-all duration-200 border ${isSelected ? 'bg-stone-900 border-stone-900 text-white shadow-md' : 'bg-white border-transparent hover:bg-white text-stone-600'}">
                    <div class="flex items-center gap-3">
                        <div class="relative flex items-center justify-center w-5 h-5">
                            <input type="checkbox" class="peer appearance-none w-5 h-5 border-2 rounded-md transition-all duration-200 cursor-pointer ${isSelected ? 'border-white/40 bg-white/20' : 'border-stone-300 bg-white group-hover:border-stone-400'}" value="${cat.name}" onchange="updateShopFilters('category',this.value)" ${isSelected ? 'checked' : ''}>
                            <i data-lucide="check" size="12" class="absolute text-white pointer-events-none transition-all duration-200 ${isSelected ? 'opacity-100 scale-100' : 'opacity-0 scale-50'}"></i>
                        </div>
                        <span class="font-bold text-sm select-none">${cat.name}</span>
                    </div>
                </label>`;
            }).join('');
        }

        window.resetFilters = () => {
            viewAllProducts();
        };

        // --- NEW: Missing Cart & UI Functions (ุฅุถุงูุฉ ุฏูุงู ุงูุณูุฉ ูุงูููุถูุฉ ุงูููููุฏุฉ) ---

        window.addToCart = (id, selectedColor = null) => {
            const p = PRODUCTS.find(x => x.id === id);
            if (!p) return;
            
            // Calculate effective price based on active discount
            const active = isDiscountActive(p);
            const finalPrice = active ? (p.price * (1 - p.discount / 100)) : p.price;

            // ุงูุจุญุซ ุนู ุงูููุชุฌ ูู ุงูุณูุฉ (ูุทุงุจู ุงูุขูุฏู ูุงูููู)
            const existing = cart.find(x => x.id === id && x.selectedColor === selectedColor);
            
            if (existing) {
                existing.quantity++;
                // Update price in cart to match current offer status (optional but good practice)
                existing.price = finalPrice; 
            } else {
                // Store with effective price and selected color
                cart.push({ ...p, price: finalPrice, quantity: 1, selectedColor: selectedColor });
            }
            
            saveCart();
            updateCartUI();
            
            // ุชุนุฏูู: ูุชุญ ุงูุณูุฉ ุชููุงุฆูุงู ููุท ูู ุงููุฑุฉ ุงูุฃููู
            if (!hasAutoOpenedCart) {
                toggleCart(true);
                hasAutoOpenedCart = true;
            }
            
            showToast("ุชูุช ุงูุฅุถุงูุฉ ููุณูุฉ");
        };

        // --- 5๏ธโฃ NEW: Stepper HTML Generator Helper ---
        window.getStepperHTML = (currentStep) => {
            const steps = [
                { num: 1, label: 'ุงูุณูุฉ' },
                { num: 2, label: 'ุงูุจูุงูุงุช' },
                { num: 3, label: 'ุงูุฏูุน' },
                { num: 4, label: 'ุชุฃููุฏ' }
            ];
            
            let html = '<div class="flex items-center justify-between w-full dir-rtl relative">';
            
            // Background Line
            html += '<div class="absolute top-3 right-0 left-0 h-0.5 bg-stone-100 -z-0"></div>';
            
            // Progress Line (Width based on step) - RTL adjustment
            const progress = ((currentStep - 1) / (steps.length - 1)) * 100;
            html += `<div class="absolute top-3 right-0 h-0.5 bg-stone-900 -z-0 transition-all duration-500" style="width: ${progress}%"></div>`;

            html += steps.map(s => {
                const isActive = s.num <= currentStep;
                const isCurrent = s.num === currentStep;
                
                return `
                <div class="flex flex-col items-center gap-1.5 relative z-10 bg-white px-2">
                    <div class="w-6 h-6 rounded-full flex items-center justify-center text-[10px] font-bold border-2 transition-all duration-300 ${isActive ? 'bg-stone-900 text-white border-stone-900' : 'bg-white text-stone-300 border-stone-200'} ${isCurrent ? 'ring-2 ring-stone-100 ring-offset-2' : ''}">
                        ${isActive && !isCurrent ? '<i data-lucide="check" size="10"></i>' : s.num}
                    </div>
                    <span class="text-[9px] font-bold ${isActive ? 'text-stone-900' : 'text-stone-300'} transition-colors">${s.label}</span>
                </div>
                `;
            }).join('');
            
            html += '</div>';
            return html;
        };
        // ---------------------------------------------

        window.toggleCart = (show) => {
            const backdrop = document.getElementById('cart-drawer-backdrop');
            const drawer = document.getElementById('cart-drawer');
            if (show) {
                backdrop.classList.remove('opacity-0', 'pointer-events-none');
                drawer.classList.remove('-translate-x-full');
                
                // Inject Stepper (Step 1)
                const stepper = document.getElementById('cart-stepper');
                if(stepper) {
                    stepper.innerHTML = getStepperHTML(1);
                    lucide.createIcons();
                }

            } else {
                backdrop.classList.add('opacity-0', 'pointer-events-none');
                drawer.classList.add('-translate-x-full');
            }
            lucide.createIcons();
        };

        window.saveCart = () => localStorage.setItem('gedar_cart', JSON.stringify(cart));

        window.removeFromCartByIndex = (index) => {
            cart.splice(index, 1);
            saveCart();
            updateCartUI();
        };

        // NEW: Clear Cart Function
        window.clearCart = () => {
            if(cart.length === 0) return;
            if(!confirm("ูู ุฃูุช ูุชุฃูุฏ ูู ุชูุฑูุบ ุงูุณูุฉ ุจุงููุงููุ")) return;
            cart = [];
            saveCart();
            updateCartUI();
            showToast("ุชู ุชูุฑูุบ ุงูุณูุฉ");
        };

        window.updateQuantityByIndex = (index, change) => {
            const item = cart[index];
            if(item) {
                item.quantity += change;
                if(item.quantity < 1) item.quantity = 1;
                saveCart();
                updateCartUI();
            }
        };

        // Old function kept for backward compatibility if needed, but UI now uses index
        window.removeFromCart = (id) => {
            cart = cart.filter(x => x.id !== id);
            saveCart();
            updateCartUI();
        };

        window.updateQuantity = (id, change) => {
             // Fallback implementation using ID (might affect multiple variants)
             // Better to use updateQuantityByIndex
            const item = cart.find(x => x.id === id);
            if(item) {
                item.quantity += change;
                if(item.quantity < 1) item.quantity = 1;
                saveCart();
                updateCartUI();
            }
        };

        // --- UPDATED: ุชุญุณูู ุฏุงูุฉ ุงูููุถูุฉ (ุชุญุฏูุซ ููุฑู + ุญุฑูุฉ) ---
        window.toggleFavorite = (id) => {
            const index = favorites.indexOf(id);
            const isAdding = index === -1;

            if (isAdding) {
                favorites.push(id);
            } else {
                favorites.splice(index, 1);
            }
            
            localStorage.setItem('aura_favorites', JSON.stringify(favorites));
            updateFavoritesUI(); // ุชุญุฏูุซ ุงูุนุฏุงุฏ ุงูุนููู ููุท
            
            // --- ุงูุชุญุฏูุซ ุงูููุฑู ููุฃุฒุฑุงุฑ ุฏูู ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ ---
            // ูุจุญุซ ุนู ูู ุฃุฒุฑุงุฑ ุงูููุถูุฉ ุงูุชู ุชุญูู ููุงุณ ูุฐุง ุงูููุชุฌ
            const btns = document.querySelectorAll(`.fav-btn-${id}`);
            
            btns.forEach(btn => {
                if (isAdding) {
                    // ุชูุนูู ุงูููุจ
                    btn.classList.remove('text-stone-400', 'border-stone-100');
                    btn.classList.add('text-red-500', 'border-red-100');
                    
                    // ุฅุถุงูุฉ ุญุฑูุฉ ุงูุชูุจูุฑ
                    btn.classList.add('heart-pop');
                    setTimeout(() => btn.classList.remove('heart-pop'), 450); // ุฅุฒุงูุฉ ุงูููุงุณ ุจุนุฏ ุงูุชูุงุก ุงูุญุฑูุฉ

                    // ููุก ุงูุฃููููุฉ ุจุงูููู
                    const icon = btn.querySelector('svg');
                    if (icon) icon.classList.add('fill-current');
                } else {
                    // ุฅูุบุงุก ุชูุนูู ุงูููุจ
                    btn.classList.add('text-stone-400', 'border-stone-100');
                    btn.classList.remove('text-red-500', 'border-red-100');
                    
                    const icon = btn.querySelector('svg');
                    if (icon) icon.classList.remove('fill-current');
                }
            });

            // ููุท ุฅุฐุง ููุง ุฏุงุฎู ุตูุญุฉ "ุงูููุถูุฉ" ูููู ุจุฅุนุงุฏุฉ ุงูุฑุณู ูุฅุฎูุงุก ุงูุนูุตุฑ ุงููุญุฐูู
            if (currentView === 'favorites' && !isAdding) {
                renderFavoritesPage(document.getElementById('main-content'));
                lucide.createIcons();
            }
            
            showToast(isAdding ? "ุชูุช ุงูุฅุถุงูุฉ ููููุถูุฉ โค๏ธ" : "ุชู ุงูุญุฐู ูู ุงูููุถูุฉ ๐");
        };
        // -----------------------------------------------------
        
        // ุฏูุงู ูุณุงุนุฏุฉ ูุตูุญุฉ ุชูุงุตูู ุงูููุชุฌ
        window.setActiveImage = (idx) => {
            activeImageIndex = idx;
            const mainImg = document.getElementById('main-product-image');
            const thumbs = document.querySelectorAll('.gallery-thumb');
            const p = PRODUCTS.find(x => x.id === currentProductId);
            const images = (p && p.images && p.images.length) ? p.images : (p ? [p.image] : []);
            
            if(mainImg && images[idx]) mainImg.src = images[idx];
            
            thumbs.forEach((t, i) => {
                if(i === idx) t.classList.add('active');
                else t.classList.remove('active');
            });
        };

        window.changeDetailsQuantity = (d) => {
            detailsQuantity += d;
            if(detailsQuantity < 1) detailsQuantity = 1;
            const el = document.getElementById('details-qty');
            if(el) el.innerText = detailsQuantity;
        };

        window.addToCartFromDetails = (id) => {
            const p = PRODUCTS.find(x => x.id === id);
            if (!p) return;

            // ุงูุชุญูู ููุง ุฅุฐุง ูุงู ุงูููุชุฌ ูุญุชูู ุนูู ุฃููุงู ููู ูุชู ุงุฎุชูุงุฑ ููู
            if (p.variants && p.variants.length > 0 && !currentSelectedColor) {
                showToast("ูุฑุฌู ุงุฎุชูุงุฑ ุงูููู ุฃููุงู");
                // Scroll to variants section
                const variantsSec = document.getElementById('variants-section');
                if(variantsSec) variantsSec.scrollIntoView({ behavior: 'smooth', block: 'center' });
                return;
            }

            // Calculate effective price based on active discount
            const active = isDiscountActive(p);
            const finalPrice = active ? (p.price * (1 - p.discount / 100)) : p.price;

            const existing = cart.find(x => x.id === id && x.selectedColor === currentSelectedColor);
            if (existing) {
                existing.quantity += detailsQuantity;
                existing.price = finalPrice;
            } else {
                cart.push({ ...p, price: finalPrice, quantity: detailsQuantity, selectedColor: currentSelectedColor });
            }
            
            saveCart();
            updateCartUI();
            showToast("ุชูุช ุงูุฅุถุงูุฉ ููุณูุฉ");
        };

        window.toggleMobileMenu = () => {
             const m = document.getElementById('mobile-menu');
             if(m) {
                 m.classList.toggle('hidden');
                 m.classList.toggle('flex');
             }
        };

        // --- Checkout Logic ---
        
        window.checkout = () => {
            if (cart.length === 0) return showToast("ุงูุณูุฉ ูุงุฑุบุฉ");
            
            // Reset fields
            document.getElementById('delivery-check').checked = false;
            document.getElementById('checkout-address').value = ''; 
            
            // Reset Payment to Default (COD)
            const radios = document.getElementsByName('paymentMethod');
            if(radios.length > 0) radios[0].checked = true;
            if(window.updatePaymentUI) window.updatePaymentUI();

            // Initial Calculation
            calculateCheckoutTotal();
            
            // Close cart drawer & Open modal
            toggleCart(false);
            toggleCheckoutModal(true);
        };
        
        // NEW: Update UI based on selection
        window.updatePaymentUI = () => {
            const el = document.querySelector('input[name="paymentMethod"]:checked');
            const method = el ? el.value : 'cod';
            const label = document.getElementById('payment-method-label');
            const partialOption = document.getElementById('partial-payment-option');
            const isPartialCheck = document.getElementById('isPartial');
            
            if (!label) return;

            if (method === 'vodafone_cash') {
                partialOption.classList.remove('hidden');
                
                if (isPartialCheck && isPartialCheck.checked) {
                    label.innerText = 'ุนุฑุจูู (ููุฏู)';
                    label.className = 'inline-block bg-orange-100 text-orange-700 text-[10px] px-2 py-0.5 rounded font-bold';
                } else {
                    label.innerText = 'ุงููุญุงูุธ ุงูุฅููุชุฑูููุฉ';
                    label.className = 'inline-block bg-red-100 text-red-700 text-[10px] px-2 py-0.5 rounded font-bold';
                }
            } else {
                partialOption.classList.add('hidden');
                if(isPartialCheck) isPartialCheck.checked = false; // Reset checkbox
                
                label.innerText = 'ุฏูุน ุนูุฏ ุงูุงุณุชูุงู';
                label.className = 'inline-block bg-green-100 text-green-700 text-[10px] px-2 py-0.5 rounded font-bold';
            }
        };

        window.calculateCheckoutTotal = () => {
            const isDelivery = document.getElementById('delivery-check').checked;
            const address = document.getElementById('checkout-address').value.trim();
            const totalDisplay = document.getElementById('checkout-total-display');
            const noteDisplay = document.getElementById('delivery-note');
            
            let cartTotal = cart.reduce((s, i) => s + (i.price * i.quantity), 0);
            let finalTotal = cartTotal;
            let note = "";
            let showNote = false;

            if (isDelivery) {
                // Check if address contains any of the predefined areas
                const isFixedArea = DELIVERY_AREAS.some(area => address.includes(area));
                
                if (isFixedArea) {
                    finalTotal += FIXED_DELIVERY_FEE;
                    note = `+ ${FIXED_DELIVERY_FEE} ุฌ.ู ูุตุงุฑูู ุชูุตูู`;
                    showNote = true;
                } else {
                    // Delivery requested but area not matched yet or unknown
                    note = "ุญุณุงุจ ุงูุชูุตูู ูุน ุงูููุฏูุจ ุนูุฏ ุงูุงุณุชูุงู";
                    showNote = true;
                }
            } else {
                note = "ุจุฏูู ุชูุตูู (ุงุณุชูุงู ูู ุงููุฑุน)";
                showNote = false;
            }

            totalDisplay.innerText = `$${finalTotal.toFixed(2)}`;
            noteDisplay.innerText = note;
            if(showNote) noteDisplay.classList.remove('hidden');
            else noteDisplay.classList.add('hidden');
        };

        window.toggleCheckoutModal = (show) => {
            const backdrop = document.getElementById('checkout-modal-backdrop');
            const modal = document.getElementById('checkout-modal');
            
            if (show) {
                backdrop.classList.remove('opacity-0', 'pointer-events-none');
                modal.classList.remove('opacity-0', 'pointer-events-none', 'scale-95');
                modal.classList.add('scale-100');

                // Inject Stepper (Step 2)
                const stepper = document.getElementById('checkout-stepper');
                if(stepper) {
                    stepper.innerHTML = getStepperHTML(2);
                    lucide.createIcons();
                }

            } else {
                backdrop.classList.add('opacity-0', 'pointer-events-none');
                modal.classList.add('opacity-0', 'pointer-events-none', 'scale-95');
                modal.classList.remove('scale-100');
            }
            lucide.createIcons();
        };

        // --- ๐ FIXED: Track Order Search Handler ---
        window.handleTrackOrderSearch = async (e) => {
            e.preventDefault();
            const orderId = e.target.orderId.value.trim();
            const resultContainer = document.getElementById('tracking-result');
            
            if (!orderId) return;

            // Show Loading
            resultContainer.innerHTML = '<div class="text-center py-8"><div class="inline-block w-8 h-8 border-4 border-stone-200 border-t-stone-900 rounded-full animate-spin"></div><p class="mt-2 text-stone-500 text-sm">ุฌุงุฑู ุงูุจุญุซ...</p></div>';

            try {
                // Fetch Order
                const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'orders', orderId);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    const order = { id: docSnap.id, ...docSnap.data() };
                    
                    // Render Result
                    renderTrackingTimeline(resultContainer, order);
                } else {
                    // Not Found
                    resultContainer.innerHTML = `
                        <div class="text-center py-12 bg-red-50 rounded-3xl border border-red-100 fade-in-up">
                            <div class="w-16 h-16 bg-red-100 text-red-500 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i data-lucide="search-x" size="32"></i>
                            </div>
                            <h3 class="font-bold text-red-900 text-lg mb-2">ุนุฐุฑุงูุ ูู ูุฌุฏ ูุฐุง ุงูุทูุจ</h3>
                            <p class="text-red-700/80 text-sm">ูุฑุฌู ุงูุชุฃูุฏ ูู ุฑูู ุงูุทูุจ ูุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู.</p>
                        </div>
                    `;
                    lucide.createIcons();
                }
            } catch (error) {
                console.error("Tracking Error:", error);
                showToast("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุจุญุซ");
                resultContainer.innerHTML = '';
            }
        };
        // ---------------------------------------------

        // NEW: Success Modal Logic (Enhanced for VF Cash)
        window.toggleSuccessModal = (show, orderId, isVodafoneCash = false) => {
            const backdrop = document.getElementById('success-modal-backdrop');
            const modal = document.getElementById('success-modal');
            const idDisplay = document.getElementById('success-order-id');
            const titleEl = document.getElementById('success-title');
            const descEl = document.getElementById('success-desc');
            
            if (show) {
                if(orderId) idDisplay.innerText = orderId;
                
                // Inject Stepper (Step 4 - Final)
                const stepper = document.getElementById('success-stepper');
                if(stepper) {
                    stepper.innerHTML = getStepperHTML(4);
                    lucide.createIcons();
                }

                // Custom Message Logic
                if (isVodafoneCash) {
                    titleEl.innerText = "ุชู ุงุณุชูุงู ุทูุจู ูุงููุฑุงุฌุนุฉ ุฌุงุฑูุฉ";
                    descEl.innerHTML = `
                        <div class="space-y-3 mt-4 mb-2">
                            <div class="bg-blue-50 text-blue-800 p-3 rounded-xl text-xs md:text-sm font-bold border border-blue-100 flex items-center justify-center gap-2 shadow-sm">
                                <span class="animate-pulse">โณ</span> ุฌุงุฑู ูุฑุงุฌุนุฉ ุงูุชุญููู ุฎูุงู 30 ุฏูููุฉ
                            </div>
                            <div class="text-stone-500 text-xs font-medium flex items-center justify-center gap-1">
                                ๐ฒ ุณูุชู ุงูุชูุงุตู ูุนู ููุฑ ุชุฃููุฏ ุนูููุฉ ุงูุฏูุน
                            </div>
                        </div>
                    `;
                } else {
                    // Default Message
                    titleEl.innerText = "ุชู ุงุณุชูุงู ุทูุจู ุจูุฌุงุญ!";
                    descEl.innerHTML = "ุดูุฑุงู ูุซูุชู ุจูุง. ูุฑุฌู ุงูุงุญุชูุงุธ ุจุฑูู ุงูุทูุจ ูุชุชุจุน ุญุงูุฉ ุงูุดุญูุฉ.";
                }

                backdrop.classList.remove('opacity-0', 'pointer-events-none');
                modal.classList.remove('opacity-0', 'pointer-events-none', 'scale-95');
                modal.classList.add('scale-100');
            } else {
                backdrop.classList.add('opacity-0', 'pointer-events-none');
                modal.classList.add('opacity-0', 'pointer-events-none', 'scale-95');
                modal.classList.remove('scale-100');
            }
            lucide.createIcons();
        };

        window.copyOrderId = () => {
            const id = document.getElementById('success-order-id').innerText;
            navigator.clipboard.writeText(id);
            showToast("ุชู ูุณุฎ ุฑูู ุงูุทูุจ");
        };

        window.handlePlaceOrder = async (e) => {
            e.preventDefault();
            
            // Lock Check: ููุน ุงูุชูุฑุงุฑ
            if (isOrderSubmitting) return;
            if (cart.length === 0) return;

            // 1. Get Button & Save Original State
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalBtnContent = submitBtn.innerHTML;

            const name = e.target.customerName.value.trim();
            const phone = e.target.customerPhone.value.trim();
            const address = e.target.customerAddress.value.trim();
            
            // --- VALIDATION START ---
            if (!name || !phone || !address) {
                return showToast("ูุฑุฌู ููุก ุฌููุน ุงูุญููู ุงููุทููุจุฉ (ุงูุงุณูุ ุงููุงุชูุ ุงูุนููุงู)");
            }

            // Phone Validation Regex (Egypt Mobile Numbers)
            const phoneRegex = /^01[0125][0-9]{8}$/;
            if (!phoneRegex.test(phone)) {
                showToast("ุฑูู ุงููุงุชู ุบูุฑ ุตุญูุญ. ูุฌุจ ุฃู ูุชููู ูู 11 ุฑูู ููุจุฏุฃ ุจู 010, 011, 012, ุฃู 015");
                return;
            }
            // --- VALIDATION END ---

            // 2. Set Loading State & Lock
            isOrderSubmitting = true;
            submitBtn.disabled = true;
            submitBtn.innerHTML = `<div class="flex items-center justify-center gap-2"><div class="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"></div><span>ุฌุงุฑู ุฅุตุฏุงุฑ ุงููุงุชูุฑุฉ...</span></div>`;
            submitBtn.classList.add('opacity-60', 'cursor-not-allowed');

            // Get Payment Method
            const paymentMethod = e.target.paymentMethod ? e.target.paymentMethod.value : 'cod';
            
            // 4๏ธโฃ Get Partial Payment Status
            const isPartial = document.getElementById('isPartial').checked && paymentMethod === 'vodafone_cash';

            // Recalculate logic securely
            const isDelivery = document.getElementById('delivery-check').checked;
            let cartTotal = cart.reduce((s, i) => s + (i.price * i.quantity), 0);
            let deliveryFee = 0;
            let deliveryStatus = "no_delivery"; 

            if (isDelivery) {
                const isFixedArea = DELIVERY_AREAS.some(area => address.includes(area));
                if (isFixedArea) {
                    deliveryFee = FIXED_DELIVERY_FEE;
                    deliveryStatus = "fixed";
                } else {
                    deliveryStatus = "courier";
                }
            }

            const totalAmount = cartTotal + deliveryFee;
            const initialStatus = paymentMethod === 'vodafone_cash' ? 'pending_payment' : 'new';

            const orderData = {
                customer: {
                    name: name,
                    phone: phone,
                    address: address
                },
                items: cart,
                subtotal: cartTotal,
                delivery: {
                    requested: isDelivery,
                    fee: deliveryFee,
                    status: deliveryStatus, 
                    areasMatch: deliveryStatus === 'fixed'
                },
                totalAmount: totalAmount,
                paymentMethod: paymentMethod,
                isPartialPayment: isPartial, // 4๏ธโฃ Save Partial Flag
                status: initialStatus,
                createdAt: serverTimestamp(), // NOTE: In local obj we use Date.now() for immediate PDF
                userId: user && !user.isAnonymous ? user.uid : 'guest',
                statusHistory: [{
                    status: initialStatus,
                    timestamp: Date.now(),
                    note: isPartial ? 'ุชู ุฅูุดุงุก ุงูุทูุจ (ุจูุธุงู ุงูุนุฑุจูู)' : 'ุชู ุฅูุดุงุก ุงูุทูุจ ุจูุฌุงุญ'
                }]
            };

            // 1๏ธโฃ1๏ธโฃ Create a local snapshot with proper Date for immediate PDF generation
            // Because serverTimestamp() is not readable immediately in client-side object without fetch
            lastPlacedOrder = { 
                ...orderData, 
                id: "PENDING-ID", // Will update after success
                createdAt: Date.now() 
            };

            try {
                // --- 8๏ธโฃ SMART ORDER NUMBERING (ุงูุชุฑููู ุงูุฐูู) ---
                // ูุณุชุฎุฏู Transaction ูุถูุงู ุนุฏู ุชูุฑุงุฑ ุงูุฑูู ุญุชู ูู ุทูุจ ุดุฎุตูู ูู ููุณ ุงููุญุธุฉ
                
                const finalOrderId = await runTransaction(db, async (transaction) => {
                    // ... existing transaction code ...
                    const counterRef = doc(db, 'artifacts', appId, 'public', 'data', 'metadata', 'orderCounter');
                    const counterDoc = await transaction.get(counterRef);
                    let currentSeq = 0;
                    if (counterDoc.exists()) currentSeq = counterDoc.data().seq || 0;
                    const nextSeq = currentSeq + 1;
                    const year = new Date().getFullYear();
                    const formattedId = `GD-${year}-${String(nextSeq).padStart(5, '0')}`;
                    const newOrderRef = doc(db, 'artifacts', appId, 'public', 'data', 'orders', formattedId);
                    transaction.set(newOrderRef, orderData);
                    transaction.set(counterRef, { seq: nextSeq }, { merge: true });
                    return formattedId;
                });
                
                // 1๏ธโฃ1๏ธโฃ Update the global order object with the real ID
                lastPlacedOrder.id = finalOrderId;

                // --- ๐ ุชู ุชุนุทูู ุงูุฅุฑุณุงู ุงููุจุงุดุฑ ูููุน ุงูุชูุฑุงุฑ ูุงูุงุนุชูุงุฏ ุนูู Google Script ---
                /*
                if (BOT_API_KEY && BOT_PHONE) {
                    const msg = encodeURIComponent(
                        `๐ฆ *ุทูุจ ุฌุฏูุฏ ูู ุงููููุน!*\n` +
                        `-------------------\n` +
                        `#๏ธโฃ ุฑูู ุงูุทูุจ: *${finalOrderId}*\n` +
                        `๐ค ุงูุนููู: ${name}\n` +
                        `๐ฑ ุงููุงุชู: ${phone}\n` +
                        `๐ฐ ุงูุฅุฌูุงูู: *${totalAmount} ุฌ.ู*\n` +
                        `๐ณ ุงูุฏูุน: ${paymentMethod === 'vodafone_cash' ? 'ููุฏุงููู ูุงุด' : 'ุนูุฏ ุงูุงุณุชูุงู'}\n` +
                        `-------------------\n` +
                        `๐ ุงูุนููุงู: ${address}`
                    );
                    
                    fetch(`https://api.callmebot.com/whatsapp.php?phone=${BOT_PHONE}&text=${msg}&apikey=${BOT_API_KEY}`, { mode: 'no-cors' })
                        .catch(err => console.error("Bot Notification Failed:", err));
                }
                */
                // ---------------------------------------

                // ... existing notification code ...
                if (GOOGLE_SCRIPT_URL) {
                    const itemsSummary = cart.map(i => `${i.name} (${i.quantity})`).join(' + ');
                    // โ ุฅุถุงูุฉ 1: ุชูุถูุญ ุงูุนุฑุจูู ุจุฌุงูุจ ุงูููุชุฌุงุช
                    const finalItems = isPartial ? itemsSummary + " (ูุธุงู ุนุฑุจูู 50%)" : itemsSummary;
                    const timestamp = new Date().toLocaleString('ar-EG');
                    
                    fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors', 
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            type: 'new_order',
                            orderId: finalOrderId, 
                            date: timestamp,
                            customerName: name,
                            customerPhone: phone,
                            address: address,
                            totalAmount: totalAmount,
                            // โ ุฅุถุงูุฉ 2: ุฅุฑุณุงู ุงูููุฏ ุงูุฎุงู (vodafone_cash) ุนุดุงู ุงูุณูุฑูุจุช ููููู
                            paymentMethod: paymentMethod, 
                            items: finalItems,
                            backup_source: "Gedar_Web_V1"
                        })
                    }).catch(err => console.log("Backup Error:", err));
                }

                cart = [];
                saveCart(); 
                updateCartUI(); 
                toggleCheckoutModal(false);
                e.target.reset();
                
                // 3. Reset Button State (Success) & Unlock
                isOrderSubmitting = false;
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalBtnContent;
                submitBtn.classList.remove('opacity-60', 'cursor-not-allowed');
                
                // BRANCHING LOGIC based on Payment Method
                if (paymentMethod === 'vodafone_cash') {
                    handleVodafoneCashFlow(finalOrderId, totalAmount, isPartial); // Pass isPartial
                } else {
                    toggleSuccessModal(true, finalOrderId, false); 
                }
                
            } catch (error) {
                // ... error handling ...
                console.error("Order Error:", error);
                showToast("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฅุฑุณุงู ุงูุทูุจุ ูุฑุฌู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู.");
                isOrderSubmitting = false;
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalBtnContent;
                submitBtn.classList.remove('opacity-60', 'cursor-not-allowed');
            }
        };

        // NEW: Vodafone Cash Flow Implementation
        window.handleVodafoneCashFlow = (orderId, amount, isPartial = false) => {
            // Populate Data
            
            // 4๏ธโฃ Update Labels for Partial Payment
            if (isPartial) {
                // ุญุณุงุจ 50% ูู ุงููุจูุบ
                const minPartial = Math.ceil(amount * 0.5); // ุชูุฑูุจ ููุฃุนูู ูุฃูุฑุจ ุฑูู ุตุญูุญ
                
                document.getElementById('vc-amount').innerHTML = `
                    <div class="flex flex-col items-center gap-1">
                        <span class="text-3xl font-serif font-black text-stone-900">${minPartial.toFixed(2)} ุฌ.ู</span>
                        <span class="text-xs font-bold text-red-600 bg-red-50 px-2 py-1 rounded">ูุทููุจ ุฏูุน 50% ูุญุฏ ุฃุฏูู ููุนุฑุจูู</span>
                    </div>`;
                document.getElementById('vc-amount-step').innerText = minPartial + ' ุฌ.ู';
                
                // ุชุฎุฒูู ุงูุญุฏ ุงูุฃุฏูู ูู ูุชุบูุฑ ุนุงู ููุชุญูู ููู ูุงุญูุงู
                window.requiredMinPayment = minPartial;
            } else {
                document.getElementById('vc-amount').innerText = amount.toFixed(2) + ' ุฌ.ู';
                document.getElementById('vc-amount-step').innerText = amount.toFixed(2) + ' ุฌ.ู';
                window.requiredMinPayment = 0; // ูุง ููุฌุฏ ุญุฏ ุฃุฏูู ุฎุงุต (ุงููุจูุบ ุจุงููุงูู ูุทููุจ ููู ุงูุชุญูู ููู ุฃูู ุตุฑุงูุฉ ููุง)
            }
            
            document.getElementById('vc-order-id-hidden').value = orderId;
            
            // Show Modal
            toggleVodafoneModal(true);
        };

        window.toggleVodafoneModal = (show) => {
            const backdrop = document.getElementById('vodafone-modal-backdrop');
            const modal = document.getElementById('vodafone-modal');
            if (show) {
                backdrop.classList.remove('opacity-0', 'pointer-events-none');
                modal.classList.remove('opacity-0', 'pointer-events-none', 'scale-95');
                modal.classList.add('scale-100');

                // Inject Stepper (Step 3 - Payment)
                const stepper = document.getElementById('vodafone-stepper');
                if(stepper) {
                    stepper.innerHTML = getStepperHTML(3);
                    lucide.createIcons();
                }

            } else {
                backdrop.classList.add('opacity-0', 'pointer-events-none');
                modal.classList.add('opacity-0', 'pointer-events-none', 'scale-95');
                modal.classList.remove('scale-100');
            }
            lucide.createIcons();
        };

        // Transition from Instruction Modal to Form Modal
        window.confirmVodafonePayment = () => {
            const orderId = document.getElementById('vc-order-id-hidden').value;
            // Get amount from display text (e.g., "1250.00 ุฌ.ู") and parse it
            const amountText = document.getElementById('vc-amount').innerText;
            const amountVal = parseFloat(amountText);

            toggleVodafoneModal(false);
            
            // Open Confirmation Form & Prefill Data
            document.getElementById('vc-confirm-order-id').value = orderId;
            
            // Prefill amount if input exists
            const amountInput = document.querySelector('#vc-confirm-modal input[name="amountPaid"]');
            if(amountInput) amountInput.value = amountVal;

            toggleVcConfirmModal(true);
        };

        // Toggle Confirmation Modal
        window.toggleVcConfirmModal = (show) => {
            const backdrop = document.getElementById('vc-confirm-modal-backdrop');
            const modal = document.getElementById('vc-confirm-modal');
            if (show) {
                backdrop.classList.remove('opacity-0', 'pointer-events-none');
                modal.classList.remove('opacity-0', 'pointer-events-none', 'scale-95');
                modal.classList.add('scale-100');
                
                // Inject Stepper (Step 3 - Payment Confirm)
                const stepper = document.getElementById('vc-confirm-stepper');
                if(stepper) {
                    stepper.innerHTML = getStepperHTML(3);
                    lucide.createIcons();
                }

                // --- NEW: Restore Draft Data (ุงุณุชุนุงุฏุฉ ุงููุณูุฏุฉ) ---
                loadVcDraft();
                // ---------------------------------------------

                // ุฅุนุงุฏุฉ ุงูุชุญูู ุนูุฏ ุงููุชุญ ูุชุญุฏูุซ ุญุงูุฉ ุงูุฒุฑ
                setTimeout(validateVcForm, 100);
            } else {
                backdrop.classList.add('opacity-0', 'pointer-events-none');
                modal.classList.add('opacity-0', 'pointer-events-none', 'scale-95');
                modal.classList.remove('scale-100');
            }
            lucide.createIcons();
        };

        // --- NEW: Save Draft Function (ุญูุธ ุชููุงุฆู) ---
        window.saveVcDraft = () => {
            const form = document.getElementById('vc-confirm-form');
            if(!form) return;
            
            const currentOrderId = document.getElementById('vc-confirm-order-id').value;
            
            const draft = {
                senderName: form.senderName.value,
                senderPhone: form.senderPhone.value,
                amountPaid: form.amountPaid.value,
                transactionId: form.transactionId.value,
                orderId: currentOrderId, // ุฑุจุท ุงููุณูุฏุฉ ุจุฑูู ุงูุทูุจ
                timestamp: Date.now()
            };
            
            localStorage.setItem('gedar_vc_draft', JSON.stringify(draft));
        };

        // --- NEW: Load Draft Function (ุงุณุชุนุงุฏุฉ ุงููุณูุฏุฉ) ---
        window.loadVcDraft = () => {
            const draftStr = localStorage.getItem('gedar_vc_draft');
            if (!draftStr) return;
            
            try {
                const draft = JSON.parse(draftStr);
                const currentOrderId = document.getElementById('vc-confirm-order-id').value;
                
                // ูุชุฃูุฏ ุฃู ุงููุณูุฏุฉ ุชุฎุต ููุณ ุงูุทูุจ ุงูุญุงูู (ุฃู ูุณูุฏุฉ ุนุงูุฉ ุญุฏูุซุฉ)
                // ุฅุฐุง ูุงู ุฑูู ุงูุทูุจ ูุทุงุจูุงูุ ูุณุชุนูุฏ ุงูุจูุงูุงุช
                if (draft.orderId && draft.orderId === currentOrderId) {
                    const form = document.getElementById('vc-confirm-form');
                    if(!form) return;

                    if(draft.senderName) form.senderName.value = draft.senderName;
                    if(draft.senderPhone) form.senderPhone.value = draft.senderPhone;
                    if(draft.amountPaid) form.amountPaid.value = draft.amountPaid;
                    if(draft.transactionId) form.transactionId.value = draft.transactionId;
                    
                    // ุชูุจูู ุจุณูุท (ุงุฎุชูุงุฑู)
                    // console.log("Draft restored");
                }
            } catch(e) { console.error("Error loading draft", e); }
        };

        // --- UPDATED: ุงูุชุญูู ูู ุตุญุฉ ูููุฐุฌ ุงูุฏูุน ูุญูุธ ุงููุณูุฏุฉ ---
        window.validateVcForm = () => {
            const form = document.getElementById('vc-confirm-form');
            const btn = document.getElementById('vc-submit-btn');
            const hint = document.getElementById('vc-form-hint');
            const imgIndicator = document.getElementById('img-check-indicator');
            
            if(!form || !btn) return;

            // --- NEW: Save Draft on every validation check (Input) ---
            saveVcDraft();
            // -----------------------------------------------------

            // 1. ุงูุชุญูู ูู ุงูุตูุฑุฉ
            const hasImage = form.receiptImage.files.length > 0;
            if(imgIndicator) {
                if(hasImage) imgIndicator.classList.remove('hidden');
                else imgIndicator.classList.add('hidden');
            }

            // 2. ุงูุชุญูู ูู ุจุงูู ุงูุญููู
            const name = form.senderName.value.trim();
            const phone = form.senderPhone.value.trim();
            const amountVal = parseFloat(form.amountPaid.value);
            
            // ุชุญูู ุจุณูุท ูู ุทูู ุฑูู ุงููุงุชู (ุฃูุซุฑ ูู 10 ุฃุฑูุงู)
            const isPhoneValid = phone.length >= 11;

            // 3. ุงูุชุญูู ูู ูููุฉ ุงูุนุฑุจูู (50%) - (NEW LOGIC)
            let isAmountValid = true;
            let amountErrorMsg = '';
            
            // ุงูุชุญูู ูู ุงููุชุบูุฑ ุงูุนุงู ุงูุฐู ุชู ุชุนูููู ูู handleVodafoneCashFlow
            if (window.requiredMinPayment && window.requiredMinPayment > 0) {
                if (isNaN(amountVal) || amountVal < window.requiredMinPayment) {
                    isAmountValid = false;
                    amountErrorMsg = `ุนููุงูุ ุฃูู ูุจูุบ ููุนุฑุจูู ูู ${window.requiredMinPayment} ุฌ.ู (50% ูู ุงููููุฉ)`;
                }
            } else {
                // ูู ุญุงูุฉ ุงูุฏูุน ุงููุงููุ ููุท ูุชุฃูุฏ ุฃูู ุฑูู ุตุญูุญ ููุฌุจ
                if (isNaN(amountVal) || amountVal <= 0) isAmountValid = false;
            }

            // 4. ุชูุนูู/ุชุนุทูู ุงูุฒุฑ
            if (hasImage && name && isPhoneValid && isAmountValid) {
                btn.disabled = false;
                // ุฅุฒุงูุฉ ุณุชุงูู ุงูุชุนุทูู
                btn.classList.remove('bg-stone-400', 'text-white/80', 'cursor-not-allowed', 'shadow-none');
                // ุฅุถุงูุฉ ุณุชุงูู ุงูุชูุนูู
                btn.classList.add('bg-stone-900', 'text-white', 'hover:bg-stone-800', 'shadow-lg');
                
                // ุฅุฎูุงุก ุงูุชูููุญ
                if(hint) hint.classList.add('hidden');
            } else {
                btn.disabled = true;
                // ุงุณุชุนุงุฏุฉ ุณุชุงูู ุงูุชุนุทูู
                btn.classList.add('bg-stone-400', 'text-white/80', 'cursor-not-allowed', 'shadow-none');
                btn.classList.remove('bg-stone-900', 'text-white', 'hover:bg-stone-800', 'shadow-lg');
                
                // ุฅุธูุงุฑ ุงูุชูููุญ ุงูููุงุณุจ
                if(hint) {
                    hint.classList.remove('hidden');
                    if (!isAmountValid && amountErrorMsg) {
                        // ุฅุธูุงุฑ ุฑุณุงูุฉ ุฎุทุฃ ุงููุจูุบ ุจุงูููู ุงูุฃุญูุฑ
                        hint.innerText = amountErrorMsg;
                        hint.classList.remove('text-red-500', 'text-stone-400');
                        hint.classList.add('text-red-600', 'font-black');
                    } else {
                        // ุงูุฑุณุงูุฉ ุงูุงูุชุฑุงุถูุฉ
                        hint.innerText = 'ูุฑุฌู ุฑูุน ุงูุตูุฑุฉ ูููุก ุงูุจูุงูุงุช ูุชูุนูู ุงูุฒุฑ';
                        hint.classList.remove('text-red-600', 'font-black');
                        hint.classList.add('text-red-500');
                    }
                }
            }
        };

        // NEW: Image Compression Helper (Client-Side)
        // This avoids using paid cloud storage by compressing images to small strings
        const compressImage = (file) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (event) => {
                    const img = new Image();
                    img.src = event.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        // Resize Logic (Max 800px width/height) to ensure small size
                        const MAX_WIDTH = 800;
                        const MAX_HEIGHT = 800;
                        let width = img.width;
                        let height = img.height;

                        if (width > height) {
                            if (width > MAX_WIDTH) {
                                height *= MAX_WIDTH / width;
                                width = MAX_WIDTH;
                            }
                        } else {
                            if (height > MAX_HEIGHT) {
                                width *= MAX_HEIGHT / height;
                                height = MAX_HEIGHT;
                            }
                        }

                        canvas.width = width;
                        canvas.height = height;
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        // Compress to JPEG with 60% quality
                        // This usually results in < 100KB string which fits easily in Firestore
                        const dataUrl = canvas.toDataURL('image/jpeg', 0.6);
                        resolve(dataUrl);
                    };
                    img.onerror = (err) => reject(err);
                };
                reader.onerror = (err) => reject(err);
            });
        };

        // Handle Submission of Payment Details
        window.handleVcConfirmSubmit = async (e) => {
            e.preventDefault();
            
            // Lock Check: ููุน ุงูุชูุฑุงุฑ
            if (isPaymentSubmitting) return;

            // 1. Get Button & Save State
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalBtnContent = submitBtn.innerHTML;

            const orderId = document.getElementById('vc-confirm-order-id').value;
            const senderName = e.target.senderName.value.trim();
            const senderPhone = e.target.senderPhone.value.trim();
            const amountPaid = e.target.amountPaid.value; 
            const transactionId = e.target.transactionId.value.trim(); 
            
            // Get Image File
            const receiptFile = e.target.receiptImage.files[0];

            // --- 3๏ธโฃ DUPLICATE DETECTION (Smart Check) ---
            try {
                const lastSub = JSON.parse(localStorage.getItem('gedar_last_vc_submit') || '{}');
                if (lastSub.phone === senderPhone && 
                    lastSub.amount === amountPaid && 
                    (Date.now() - lastSub.timestamp) < 5 * 60 * 1000) {
                    
                    showToast("โ๏ธ ุชู ุฅุฑุณุงู ูุฐุง ุงูุฅูุตุงู ุจุงููุนู! ูุฑุฌู ุงูุงูุชุธุงุฑ ูููุฑุงุฌุนุฉ.");
                    return; 
                }
            } catch(err) { console.log("Duplicate check error", err); }
            // ---------------------------------------------

            // --- VALIDATION START (ุงูุชุญูู ุงูุฐูู) ---
            if (!senderName || !senderPhone || !amountPaid) {
                return showToast("โ๏ธ ูุฑุฌู ุงุณุชููุงู ุฌููุน ุงูุจูุงูุงุช ุงููุทููุจุฉ");
            }
            
            if (!receiptFile) {
                return showToast("โ๏ธ ูุฑุฌู ุฅุฑูุงู ุตูุฑุฉ ุงูุชุญููู (ุณูุฑูู ุดูุช)");
            }

            // Phone Validation Regex (Egypt Mobile Numbers)
            const phoneRegex = /^01[0125][0-9]{8}$/;
            if (!phoneRegex.test(senderPhone)) {
                // ๐ด ุฑุณุงูุฉ ุงูุฎุทุฃ ุงูุฐููุฉ 1: ุฑูู ุบูุท
                showToast("โ ุฑูู ุงููุงุชู ุบูุฑ ุตุญูุญ. ุชุฃูุฏ ุฃูู 11 ุฑูู ููุจุฏุฃ ุจู 01");
                return;
            }
            // --- VALIDATION END ---

            // 2. Set Loading State & Lock
            isPaymentSubmitting = true;
            submitBtn.disabled = true;
            submitBtn.innerHTML = `<div class="flex items-center justify-center gap-2"><div class="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"></div><span>ุฌุงุฑู ุงููุนุงูุฌุฉ...</span></div>`;
            submitBtn.classList.add('opacity-60', 'cursor-not-allowed');

            try {
                // Compress Image
                const base64Image = await compressImage(receiptFile);
                const amountPaidFloat = parseFloat(amountPaid);

                // Update Firestore Order Document
                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', orderId), {
                    paymentDetails: {
                        method: 'vodafone_cash',
                        senderName: senderName,
                        senderPhone: senderPhone,
                        amountPaid: amountPaidFloat,
                        transactionId: transactionId || 'N/A',
                        screenshotBase64: base64Image, // Store image directly as text
                        submittedAt: Date.now()
                    },
                    // Update Status to "Review" so admin knows payment is claimed
                    status: 'payment_review' 
                });

                // --- ๐ ุฅุฑุณุงู ุฅุดุนุงุฑ ุจูุงูุงุช ุงูุฏูุน ูุฌูุฌู ุณูุฑูุจุช ---
                if (GOOGLE_SCRIPT_URL) {
                    fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            type: 'payment_confirmation', // ุฏู ุงููู ุจูููุฒ ุงูุฑุณุงูุฉ ุฏู
                            orderId: orderId,
                            senderName: senderName,
                            senderPhone: senderPhone,
                            amountPaid: amountPaid,
                            transactionId: transactionId
                        })
                    }).catch(err => console.log("Payment Notification Error:", err));
                }
                // --------------------------------------------------

                // --- SAVE SUBMISSION TO LOCAL STORAGE ---
                localStorage.setItem('gedar_last_vc_submit', JSON.stringify({
                    phone: senderPhone,
                    amount: amountPaid,
                    timestamp: Date.now()
                }));
                
                // --- Clear Draft on Success ---
                localStorage.removeItem('gedar_vc_draft');

                toggleVcConfirmModal(false);
                
                // Show Final Success Modal
                toggleSuccessModal(true, orderId, true);
                
                showToast("โ ุชู ุฅุฑุณุงู ุงูุจูุงูุงุช ุจูุฌุงุญ");
                
                // 3. Reset Button (Success) & Unlock
                isPaymentSubmitting = false;
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalBtnContent;
                submitBtn.classList.remove('opacity-60', 'cursor-not-allowed');

            } catch (err) {
                console.error("Payment Confirm Error:", err);
                
                // ๐ด ุชุญููู ุงูุฃุฎุทุงุก ุงูุฐูู (Smart Error Analysis)
                let errorMsg = "ุญุฏุซ ุฎุทุฃ ุบูุฑ ูุชููุนุ ุญุงูู ูุฑุฉ ุฃุฎุฑู.";
                const errString = err.toString().toLowerCase();
                const errCode = err.code; // Firebase error code

                // 1. Image Too Large (ุตูุฑุฉ ูุจูุฑุฉ)
                // ุนุงุฏุฉู ุงูุฎุทุฃ ูููู invalid-argument ุฅุฐุง ุชุฌุงูุฒ ุญุฌู ุงููุณุชูุฏ 1 ููุฌุง
                if (errString.includes('exceeds') || errString.includes('too large') || errCode === 'invalid-argument') {
                    errorMsg = "๐ธ ุงูุตูุฑุฉ ูุจูุฑุฉ ุฌุฏุงู! ูุฑุฌู ุงุฎุชูุงุฑ ุตูุฑุฉ ุฃุตุบุฑ ุฃู ุงูุชูุงุท ููุทุฉ ุดุงุดุฉ ุฌุฏูุฏุฉ.";
                } 
                // 2. Weak Connection (ุงุชุตุงู ุถุนูู)
                else if (errString.includes('network') || errString.includes('offline') || errCode === 'unavailable') {
                    errorMsg = "๐ก ุงูุงุชุตุงู ุถุนูู! ูุฑุฌู ุงูุชุญูู ูู ุงูุฅูุชุฑูุช ูุงููุญุงููุฉ ูุฌุฏุฏุงู.";
                }
                // 3. Permission Error (ูุดููุฉ ุตูุงุญูุงุช)
                else if (errCode === 'permission-denied') {
                    errorMsg = "๐ ุญุฏุซ ุฎุทุฃ ูู ุงูุตูุงุญูุงุช. ูุฑุฌู ุชุญุฏูุซ ุงูุตูุญุฉ.";
                }

                showToast(errorMsg);
                
                // 4. Reset Button (Error) & Unlock
                isPaymentSubmitting = false;
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalBtnContent;
                submitBtn.classList.remove('opacity-60', 'cursor-not-allowed');
            }
        };

        window.handleAddCategory = async (e) => {
            e.preventDefault();
            if (!user || user.email !== ADMIN_EMAIL) return showToast("ุบูุฑ ูุตุฑุญ: ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ููุณุคูู");
            const name = e.target.catName.value.trim();
            const image = e.target.catImg.value.trim();
            
            // Check logic: If editing, update. If adding, check duplicate.
            if (currentEditCategoryName) {
                // --- UPDATE MODE ---
                try {
                    const newCats = CATEGORIES.map(c => 
                        c.name === currentEditCategoryName ? { name: name, image: image } : c
                    );
                    await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'metadata', 'store'), { categories: newCats }, { merge: true });
                    showToast(`ุชู ุชุนุฏูู ูุณู "${name}" ุจูุฌุงุญ`);
                    currentEditCategoryName = null; // Reset
                    e.target.reset();
                    renderView(); // Refresh UI to reset button text
                } catch(err) { console.error(err); showToast("ุญุฏุซ ุฎุทุฃ ูู ุงูุชุนุฏูู"); }
            } else {
                // --- ADD MODE ---
                if (name && !CATEGORIES.some(c => c.name === name)) {
                    try {
                        const newCat = { 
                            name: name, 
                            image: image || "https://images.unsplash.com/photo-1555041469-a586c61ea9bc?w=500" 
                        };
                        await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'metadata', 'store'), { categories: arrayUnion(newCat) });
                        showToast(`ุชู ุฅุถุงูุฉ ูุณู "${name}" ุจูุฌุงุญ`);
                        e.target.reset();
                    } catch(err) { console.error(err); showToast("ุญุฏุซ ุฎุทุฃ"); }
                } else {
                    showToast("ุงุณู ุบูุฑ ุตุงูุญ ุฃู ููุฌูุฏ ูุณุจูุงู");
                }
            }
        };

        // NEW: ุฏูุงู ูุณุงุนุฏุฉ ูุชุนุฏูู ุงูุฃูุณุงู (ูุงูุช ููููุฏุฉ)
        window.prepareEditCategory = (name) => {
            currentEditCategoryName = name;
            // ุงูุชุฃูุฏ ูู ุฃููุง ูู ุชุจููุจ ุงูุฃูุณุงู
            setAdminView('categories');
            showToast(`ุฌุงุฑู ุชุนุฏูู ูุณู: ${name}`);
            window.scrollTo(0, 0); // ุงูุตุนูุฏ ููุฃุนูู ูููุตูู ูููููุฐุฌ
        };

        window.cancelEditCategory = () => {
            currentEditCategoryName = null;
            renderView();
        };

        // --- NEW: Delete Category ---
        window.handleDeleteCategory = async (catName) => {
            if (!confirm(`ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุณู "${catName}"ุ`)) return;
            if (!user || user.email !== ADMIN_EMAIL) return showToast("ุบูุฑ ูุตุฑุญ");

            try {
                // Filter out the category to delete
                const newCats = CATEGORIES.filter(c => c.name !== catName);
                // Save the new array (overwrite)
                await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'metadata', 'store'), { categories: newCats }, { merge: true });
                showToast("ุชู ุญุฐู ุงููุณู");
            } catch(err) { console.error(err); showToast("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุญุฐู"); }
        };

        // NEW: Handle Save Hero Settings
        window.handleSaveHeroSettings = async (e) => {
            e.preventDefault();
            if (!user || user.email !== ADMIN_EMAIL) return showToast("ุบูุฑ ูุตุฑุญ");

            const mainImg = e.target.heroMain.value.trim();
            const secImg = e.target.heroSec.value.trim();
            const priceLbl = e.target.heroPriceLabel.value.trim();
            const priceVal = e.target.heroPriceValue.value.trim();
            const discLbl = e.target.heroDiscLabel.value.trim();
            const discVal = e.target.heroDiscValue.value.trim();
            
            // Logo Fields
            const logoUrl = e.target.siteLogo.value.trim();
            const logoSize = e.target.logoSize.value.trim();

            // Image Config Fields (NEW)
            const imgBaseUrl = e.target.imgBaseUrl.value.trim();
            const imgDefaultExt = e.target.imgExt.value.trim();

            // Header Banner Fields
            const fbUrl = e.target.fbUrl.value.trim();
            const fbHeight = e.target.fbHeight.value.trim();
            const fbWidth = e.target.fbWidth.value.trim();
            const fbShow = e.target.fbShow.checked;

            // Category Banner Fields
            const catBanUrl = e.target.catBanUrl.value.trim();
            const catBanHeight = e.target.catBanHeight.value.trim();
            const catBanWidth = e.target.catBanWidth.value.trim();
            const catBanShow = e.target.catBanShow.checked;

            // NEW: Best Seller Banner Fields
            const bsBanUrl = e.target.bsBanUrl.value.trim();
            const bsBanHeight = e.target.bsBanHeight.value.trim();
            const bsBanWidth = e.target.bsBanWidth.value.trim();
            const bsBanShow = e.target.bsBanShow.checked;

            // NEW: Featured Banner Fields
            const ftBanUrl = e.target.ftBanUrl.value.trim();
            const ftBanHeight = e.target.ftBanHeight.value.trim();
            const ftBanWidth = e.target.ftBanWidth.value.trim();
            const ftBanShow = e.target.ftBanShow.checked;

            // Hero Visibility Fields
            const heroMobile = e.target.heroShowMobile.checked;
            const heroDesktop = e.target.heroShowDesktop.checked;

            try {
                await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'metadata', 'hero'), {
                    mainImage: mainImg,
                    secondaryImage: secImg,
                    priceLabel: priceLbl,
                    priceValue: priceVal,
                    discountLabel: discLbl,
                    discountValue: discVal,
                    logoUrl: logoUrl,
                    logoSize: logoSize,
                    // Save Image Config (NEW)
                    imageBaseUrl: imgBaseUrl,
                    imageDefaultExt: imgDefaultExt,
                    // Save Header Banner
                    footerBannerUrl: fbUrl,
                    footerBannerHeight: fbHeight,
                    footerBannerWidth: fbWidth,
                    showFooterBanner: fbShow,
                    // Save Category Banner
                    categoryBannerUrl: catBanUrl,
                    categoryBannerHeight: catBanHeight,
                    categoryBannerWidth: catBanWidth,
                    showCategoryBanner: catBanShow,
                    // Save Best Seller Banner
                    bestSellerBannerUrl: bsBanUrl,
                    bestSellerBannerHeight: bsBanHeight,
                    bestSellerBannerWidth: bsBanWidth,
                    showBestSellerBanner: bsBanShow,
                    // Save Featured Banner
                    featuredBannerUrl: ftBanUrl,
                    featuredBannerHeight: ftBanHeight,
                    featuredBannerWidth: ftBanWidth,
                    showFeaturedBanner: ftBanShow,
                    // Save Hero Visibility
                    showHeroMobile: heroMobile,
                    showHeroDesktop: heroDesktop
                }, { merge: true });
                showToast("ุชู ุชุญุฏูุซ ุฅุนุฏุงุฏุงุช ุงููููุน ูุงููุงุฌูุฉ ุจูุฌุงุญ");
            } catch(err) {
                console.error(err);
                showToast("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุญูุธ");
            }
        };

        // NEW: Function to update global branding (Navbar, Footer, & Bottom Banner)
        function updateGlobalBranding() {
            const navBrand = document.getElementById('navbar-brand');
            const footerBrand = document.getElementById('footer-brand');
            const bannerContainer = document.getElementById('header-banner-container'); // Updated ID
            
            // --- NEW: Top Promo Banner Logic (Split Mobile/Desktop Images) ---
            const topBanner = document.getElementById('top-promo-banner');
            const nav = document.getElementById('navbar');
            
            // ุชูุธูู ุงูุฃููุงุท ุงููุฏููุฉ
            if (topBanner) {
                topBanner.style = ''; // Reset inline styles
                topBanner.className = 'fixed top-0 inset-x-0 z-[60] hidden flex justify-center items-start bg-stone-900 transition-all duration-300';
            }
            if (nav) nav.style.top = '';
            if (bannerContainer) bannerContainer.style.marginTop = '';
            document.body.style.paddingTop = '';

            // ุฅุฒุงูุฉ ุงูุณุชุงูู ุงูุฏููุงูููู ุงููุฏูู
            const oldStyle = document.getElementById('dynamic-top-banner-style');
            if (oldStyle) oldStyle.remove();

            if (HERO_SETTINGS.showFeaturedBanner && (HERO_SETTINGS.featuredBannerUrl || HERO_SETTINGS.featuredBannerUrlMobile)) {
                
                // 1. ุงุณุชุฎุฑุงุฌ ุงูููู
                const imgDesk = HERO_SETTINGS.featuredBannerUrl;
                const imgMob = HERO_SETTINGS.featuredBannerUrlMobile || imgDesk; // Fallback to desktop if empty

                const hDesk = parseInt(HERO_SETTINGS.featuredBannerHeightDesktop) || 60; 
                const hMob = parseInt(HERO_SETTINGS.featuredBannerHeightMobile) || 40;
                
                const wDesk = HERO_SETTINGS.featuredBannerWidthDesktop || '100';
                const wMob = HERO_SETTINGS.featuredBannerWidthMobile || '100';

                // 2. ุจูุงุก HTML ููุตูุฑุชูู (ููุจุงูู ูููุจููุชุฑ)
                if (topBanner) {
                    topBanner.classList.remove('hidden');
                    
                    // ุงุณุชุฎุฏุงู classes ููุชุญูู ูู ุงูุธููุฑ ูุงูุงุฎุชูุงุก ุจูุงุกู ุนูู ุงูุดุงุดุฉ
                    // md:hidden ููููุจุงูู
                    // hidden md:block ููููุจููุชุฑ
                    topBanner.innerHTML = `
                        <!-- Mobile Image -->
                        <img src="${imgMob}" 
                             class="block md:hidden object-cover" 
                             style="height: ${hMob}px; width: ${wMob}%; max-width: none;" 
                             alt="Mobile Offer">
                        
                        <!-- Desktop Image -->
                        <img src="${imgDesk}" 
                             class="hidden md:block object-cover" 
                             style="height: ${hDesk}px; width: ${wDesk}%; max-width: none;" 
                             alt="Desktop Offer">
                    `;
                }

                // 3. ุญูู CSS ููุชุญูู ูู ุฅุฒุงุญุฉ ุงููููุน (Navbar & Body)
                const css = `
                    <style id="dynamic-top-banner-style">
                        /* Mobile Spacing */
                        #navbar { top: ${hMob}px; }
                        body { padding-top: ${hMob}px; }
                        #header-banner-container { margin-top: calc(85px + ${hMob}px) !important; }

                        /* Desktop Spacing */
                        @media (min-width: 768px) {
                            #navbar { top: ${hDesk}px; }
                            body { padding-top: ${hDesk}px; }
                            #header-banner-container { margin-top: calc(74px + ${hDesk}px) !important; }
                        }
                    </style>
                `;
                document.head.insertAdjacentHTML('beforeend', css);

            } else {
                // Hide Banner
                if (topBanner) {
                    topBanner.classList.add('hidden');
                    topBanner.innerHTML = '';
                }
            }
            // ---------------------------------------------------------

            const logoUrl = HERO_SETTINGS.logoUrl;
            const size = HERO_SETTINGS.logoSize || 100;

            if (navBrand) {
                if (logoUrl) {
                    navBrand.innerHTML = `<img src="${logoUrl}" style="width: ${size}px; height: auto; max-width: none;" class="object-contain" alt="Logo">`;
                } else {
                    navBrand.innerHTML = `
                        <div class="text-2xl font-bold tracking-tight flex items-center gap-1">ุฌุฏุงุฑ<span class="text-stone-400 text-4xl leading-3">.</span></div>
                        <span class="text-[0.65rem] text-stone-500 font-medium mt-1 tracking-wide">ููุฏูููุฑุงุช ุงูุญุฏูุซุฉ</span>
                    `;
                }
            }

            if (footerBrand) {
                if (logoUrl) {
                    footerBrand.innerHTML = `<img src="${logoUrl}" style="width: ${parseInt(size) * 1.2}px; height: auto;" class="object-contain" alt="Logo">`;
                } else {
                    footerBrand.innerHTML = `<div class="text-3xl font-bold text-stone-900 tracking-tighter flex items-center gap-1">ุฌุฏุงุฑ<span class="text-stone-400 text-5xl leading-3">.</span></div>`;
                }
            }

            // Update Header Banner (Slider Logic with Responsive Styles)
            if (bannerContainer) {
                if (HERO_SETTINGS.showFooterBanner && (HERO_SETTINGS.footerBannerUrl || HERO_SETTINGS.footerBannerUrlMobile)) {
                    // ุชุนุฏูู: ุฅุธูุงุฑ ุงูุจุงูุฑ ููุท ุฅุฐุง ููุง ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
                    if (currentView === 'home') {
                        bannerContainer.classList.remove('hidden');
                    } else {
                        bannerContainer.classList.add('hidden');
                    }
                    
                    // 1. Prepare URLs
                    const deskUrls = (HERO_SETTINGS.footerBannerUrl || '').split(/\r?\n/).filter(u => u.trim());
                    // Fallback to desktop if mobile is empty
                    const rawMobUrls = (HERO_SETTINGS.footerBannerUrlMobile || '').split(/\r?\n/).filter(u => u.trim());
                    const mobUrls = rawMobUrls.length > 0 ? rawMobUrls : deskUrls;

                    // Infinite Loop Logic (Triple)
                    const displayDesk = deskUrls.length > 1 ? [...deskUrls, ...deskUrls, ...deskUrls] : deskUrls;
                    const displayMob = mobUrls.length > 1 ? [...mobUrls, ...mobUrls, ...mobUrls] : mobUrls;

                    // IDs
                    const sliderDeskId = 'header-slider-desktop';
                    const sliderMobId = 'header-slider-mobile';
                    
                    // Settings
                    const hDesk = HERO_SETTINGS.fbHeightDesktop || 300;
                    const hMob = HERO_SETTINGS.fbHeightMobile || 150;
                    const wDesk = HERO_SETTINGS.fbWidthDesktop || 90;
                    const wMob = HERO_SETTINGS.fbWidthMobile || 95;
                    const rDesk = HERO_SETTINGS.fbRadiusDesktop || '2rem';
                    const rMob = HERO_SETTINGS.fbRadiusMobile || '1rem';

                    // Inject CSS
                    const styleId = 'header-banner-style';
                    let styleEl = document.getElementById(styleId);
                    if(!styleEl) {
                        styleEl = document.createElement('style');
                        styleEl.id = styleId;
                        document.head.appendChild(styleEl);
                    }
                    
                    styleEl.innerHTML = `
                        .header-banner-slide-desk { 
                            height: ${hDesk}px; width: ${wDesk}%; min-width: ${wDesk}%; margin: 0 15px; border-radius: ${rDesk};
                            opacity: 1; transform: scale(0.98); transition: transform 0.5s ease;
                        }
                        .header-banner-slide-desk:hover { transform: scale(1); }

                        .header-banner-slide-mob { 
                            height: ${hMob}px; width: ${wMob}%; min-width: ${wMob}%; margin: 0 6px; border-radius: ${rMob};
                            opacity: 1; transform: scale(0.96); transition: transform 0.5s ease;
                        }
                        .header-banner-slide-mob:hover { transform: scale(1); }
                    `;

                    // Generate HTML
                    // We render TWO containers: one for mobile (md:hidden), one for desktop (hidden md:block)
                    
                    bannerContainer.innerHTML = `
                    <div class="w-full py-4 bg-white">
                        
                        <!-- Mobile Slider (md:hidden) -->
                        <div class="md:hidden relative group" onmouseenter="stopBannerAutoScroll('${sliderMobId}')" onmouseleave="startBannerAutoScroll('${sliderMobId}')">
                            <div id="${sliderMobId}" class="flex overflow-x-auto snap-x snap-mandatory scrollbar-hide scroll-smooth h-full items-center">
                                ${displayMob.map((url, idx) => `
                                    <div id="mob-slide-${idx}" class="header-banner-slide-mob flex-shrink-0 relative overflow-hidden shadow-sm border border-stone-200/50 bg-white">
                                        <img src="${url.trim()}" class="w-full h-full object-fill" alt="Banner">
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <!-- Desktop Slider (hidden md:block) -->
                        <div class="hidden md:block relative group" onmouseenter="stopBannerAutoScroll('${sliderDeskId}')" onmouseleave="startBannerAutoScroll('${sliderDeskId}')">
                            <div id="${sliderDeskId}" class="flex overflow-x-auto snap-x snap-mandatory scrollbar-hide scroll-smooth h-full items-center justify-center">
                                ${displayDesk.map((url, idx) => `
                                    <div id="desk-slide-${idx}" class="header-banner-slide-desk flex-shrink-0 relative overflow-hidden shadow-sm border border-stone-200/50 bg-white">
                                        <img src="${url.trim()}" class="w-full h-full object-cover" alt="Banner">
                                    </div>
                                `).join('')}
                            </div>
                            <!-- Nav Buttons (Desktop Only) -->
                            ${deskUrls.length > 1 ? `
                            <button onclick="scrollBanner('${sliderDeskId}', -1)" class="absolute top-1/2 left-10 -translate-y-1/2 w-12 h-12 bg-white/80 backdrop-blur-md rounded-full flex items-center justify-center text-stone-800 shadow-lg hover:scale-110 transition-all opacity-0 group-hover:opacity-100 z-20"><i data-lucide="chevron-left"></i></button>
                            <button onclick="scrollBanner('${sliderDeskId}', 1)" class="absolute top-1/2 right-10 -translate-y-1/2 w-12 h-12 bg-white/80 backdrop-blur-md rounded-full flex items-center justify-center text-stone-800 shadow-lg hover:scale-110 transition-all opacity-0 group-hover:opacity-100 z-20"><i data-lucide="chevron-right"></i></button>
                            ` : ''}
                        </div>

                    </div>`;
                    
                    // Init Scroll
                    setTimeout(() => {
                        if(mobUrls.length > 1) startBannerAutoScroll(sliderMobId);
                        if(deskUrls.length > 1) startBannerAutoScroll(sliderDeskId);
                    }, 500);

                    lucide.createIcons();
                } else {
                    bannerContainer.classList.add('hidden');
                    bannerContainer.innerHTML = '';
                }
            }
        }

        // --- NEW: Handle Save Hero Settings (Updated for Split Settings) ---
        window.handleSaveHeroSettings = async (e) => {
            e.preventDefault();
            if (!user || user.email !== ADMIN_EMAIL) return showToast("ุบูุฑ ูุตุฑุญ");

            // Helpers
            const getVal = (name) => e.target[name] ? e.target[name].value.trim() : '';
            const getCheck = (name) => e.target[name] ? e.target[name].checked : false;

            try {
                await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'metadata', 'hero'), {
                    // Standard Fields
                    mainImage: getVal('heroMain'),
                    secondaryImage: getVal('heroSec'),
                    priceLabel: getVal('heroPriceLabel'),
                    priceValue: getVal('heroPriceValue'),
                    discountLabel: getVal('heroDiscLabel'),
                    discountValue: getVal('heroDiscValue'),
                    logoUrl: getVal('siteLogo'),
                    logoSize: getVal('logoSize'),
                    imageBaseUrl: getVal('imgBaseUrl'),
                    imageDefaultExt: getVal('imgExt'),
                    
                    // Header Banner (Split Settings)
                    footerBannerUrl: getVal('fbUrl'),
                    footerBannerUrlMobile: getVal('fbUrlMob'), // ๐ Save Mobile URL
                    showFooterBanner: getCheck('fbShow'),
                    fbHeightDesktop: getVal('fbHeightDesk'), fbHeightMobile: getVal('fbHeightMob'),
                    fbWidthDesktop: getVal('fbWidthDesk'), fbWidthMobile: getVal('fbWidthMob'),
                    fbRadiusDesktop: getVal('fbRadiusDesk'), fbRadiusMobile: getVal('fbRadiusMob'),

                    // Category Banner (Split Settings)
                    categoryBannerUrl: getVal('catBanUrl'),
                    showCategoryBanner: getCheck('catBanShow'),
                    catBanHeightDesktop: getVal('catBanHeightDesk'), catBanHeightMobile: getVal('catBanHeightMob'),
                    catBanWidthDesktop: getVal('catBanWidthDesk'), catBanWidthMobile: getVal('catBanWidthMob'),
                    catBanRadiusDesktop: getVal('catBanRadiusDesk'), catBanRadiusMobile: getVal('catBanRadiusMob'),

                    // Other Banners (Simple)
                    bestSellerBannerUrl: getVal('bsBanUrl'),
                    bestSellerBannerHeight: getVal('bsBanHeight'),
                    bestSellerBannerWidth: getVal('bsBanWidth'),
                    showBestSellerBanner: getCheck('bsBanShow'),
                    
                    // Featured Banner (UPDATED: Split Mobile/Desktop Images & Sizes)
                    featuredBannerUrl: getVal('ftBanUrl'),       // Desktop URL
                    featuredBannerUrlMobile: getVal('ftBanUrlMob'), // Mobile URL (NEW)
                    
                    featuredBannerHeightDesktop: getVal('ftBanHeightDesk'), 
                    featuredBannerHeightMobile: getVal('ftBanHeightMob'), 
                    featuredBannerWidthDesktop: getVal('ftBanWidthDesk'), 
                    featuredBannerWidthMobile: getVal('ftBanWidthMob'),
                    
                    // Keep generics just in case
                    featuredBannerHeight: getVal('ftBanHeightDesk'), 
                    featuredBannerWidth: getVal('ftBanWidthDesk'),
                    showFeaturedBanner: getCheck('ftBanShow'),
                    
                    // --- NEW: Payment Banner ---
                    paymentBannerUrl: getVal('payBanUrl'),
                    showPaymentBanner: getCheck('payBanShow'),
                    paymentBannerHeight: getVal('payBanHeight'),
                    paymentBannerWidth: getVal('payBanWidth'),
                    // --------------------------

                    showHeroMobile: getCheck('heroShowMobile'),
                    showHeroDesktop: getCheck('heroShowDesktop'),
                    showCategoryBar: getCheck('catBarShow') 
                }, { merge: true });
                showToast("ุชู ุชุญุฏูุซ ุฅุนุฏุงุฏุงุช ุงููููุน ูุงููุงุฌูุฉ ุจูุฌุงุญ");
            } catch(err) {
                console.error(err);
                showToast("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุญูุธ");
            }
        };

        window.cancelEdit = () => {
            currentEditProduct = null;
            renderView();
        };

        // NEW: ุฏูุงู ุชุนุฏูู ูุญุฐู ุงูููุชุฌุงุช
        window.handleEditProduct = (id) => {
            const p = PRODUCTS.find(x => x.id === id);
            if (!p) return;
            currentEditProduct = p;
            // ุงูุงูุชูุงู ูุชุจููุจ ุงูููุชุฌุงุช ูู ููุญุฉ ุงูุชุญูู ูุชุนุจุฆุฉ ุงููููุฐุฌ
            setAdminView('products');
            showToast(`ุฌุงุฑู ุชุนุฏูู: ${p.name}`);
        };

        window.handleDeleteProduct = async (id) => {
            if (!confirm("ูู ุฃูุช ูุชุฃูุฏ ุชูุงูุงู ูู ุญุฐู ูุฐุง ุงูููุชุฌุ ูุง ูููู ุงูุชุฑุงุฌุน ุนู ูุฐุง ุงูุฅุฌุฑุงุก.")) return;
            if (!user || user.email !== ADMIN_EMAIL) return showToast("ุบูุฑ ูุตุฑุญ");

            try {
                await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', id));
                showToast("ุชู ุญุฐู ุงูููุชุฌ ุจูุฌุงุญ");
                // ุฅุฐุง ูุงู ุงูููุชุฌ ุงููุญุฐูู ูู ููุฏ ุงูุชุนุฏูู ุญุงููุงูุ ูู ุจุฅูุบุงุก ุงูุชุนุฏูู
                if (currentEditProduct && currentEditProduct.id === id) {
                    currentEditProduct = null;
                }
            } catch (error) {
                console.error("Error deleting product:", error);
                showToast("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุญุฐู");
            }
        };

        window.handleSaveProduct = async (e) => {
            e.preventDefault();
            if (!user || user.email !== ADMIN_EMAIL) return showToast("ุบูุฑ ูุตุฑุญ: ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ููุณุคูู");
            
            const nameVal = e.target.prodName.value;
            const brandVal = e.target.prodBrand ? e.target.prodBrand.value : "";
            const materialVal = e.target.prodMaterial ? e.target.prodMaterial.value : "";
            const priceVal = parseFloat(e.target.prodPrice.value);
            const discountVal = parseFloat(e.target.prodDiscount.value) || 0;
            const expiryVal = e.target.prodExpiry.value ? new Date(e.target.prodExpiry.value).getTime() : null;
            
            // NEW: Get Featured Value
            const isFeaturedVal = e.target.prodFeatured ? e.target.prodFeatured.checked : false;
            
            // NEW: Get In Stock Value
            const inStockVal = e.target.prodInStock ? e.target.prodInStock.checked : true;

            const catVal = e.target.prodCat.value;
            
            // --- NEW: Smart Image URL Generation ---
            let imgInput = e.target.prodImg.value.trim();
            let imgVal = imgInput;
            
            // ุฅุฐุง ูุงู ุงููุฏุฎู ููุณ ุฑุงุจุทุงู ูุงููุงู (ูุง ูุจุฏุฃ ุจู http) ูููุฌุฏ ุฅุนุฏุงุฏุงุช ูููุงุนุฏุฉ
            if (imgInput && !imgInput.match(/^https?:\/\//) && HERO_SETTINGS.imageBaseUrl) {
                // ุงูุชุฃูุฏ ูู ูุฌูุฏ / ูู ููุงูุฉ ุงูุฑุงุจุท ุงูุฃุณุงุณู
                const baseUrl = HERO_SETTINGS.imageBaseUrl.endsWith('/') 
                    ? HERO_SETTINGS.imageBaseUrl 
                    : HERO_SETTINGS.imageBaseUrl + '/';
                
                // ุงูุชุฃูุฏ ูู ุงูุงูุชุฏุงุฏ
                const ext = HERO_SETTINGS.imageDefaultExt || '.webp';
                const hasExt = imgInput.includes('.');
                
                imgVal = baseUrl + imgInput + (hasExt ? '' : ext);
            }
            // ----------------------------------------

            const descVal = e.target.prodDesc ? e.target.prodDesc.value : "";
            const featuresVal = e.target.prodFeatures ? e.target.prodFeatures.value.split('\n').filter(l => l.trim()) : [];
            const imagesVal = e.target.prodImages ? e.target.prodImages.value.split('\n').filter(l => l.trim()) : [];
            
            // Parse Variants (Colors)
            const variantsLines = e.target.prodVariants ? e.target.prodVariants.value.split('\n').filter(l => l.trim()) : [];
            const variants = variantsLines.map(line => {
                const parts = line.split(':'); 
                if (parts.length < 2) return null;
                const color = parts[0].trim();
                const image = parts.slice(1).join(':').trim(); 
                return { color, image };
            }).filter(item => item !== null);

            // Parse Specifications
            const specsLines = e.target.prodSpecs ? e.target.prodSpecs.value.split('\n').filter(l => l.trim()) : [];
            const specifications = specsLines.map(line => {
                const parts = line.split(':'); 
                if (parts.length < 2) return null;
                const label = parts[0].trim();
                const value = parts.slice(1).join(':').trim(); 
                return { label, value };
            }).filter(item => item !== null);

            // --- NEW: Parse Services ---
            const servicesLines = e.target.prodServices ? e.target.prodServices.value.split('\n').filter(l => l.trim()) : [];
            const services = servicesLines.map(line => {
                const parts = line.split(':');
                if (parts.length < 2) return null;
                const icon = parts[0].trim();
                const text = parts.slice(1).join(':').trim();
                return { icon, text };
            }).filter(item => item !== null);

            const finalImages = [imgVal, ...imagesVal];

            const productData = {
                name: nameVal,
                brand: brandVal,
                material: materialVal,
                price: priceVal,
                discount: discountVal,
                discountExpiry: expiryVal,
                isFeatured: isFeaturedVal, // Save Featured Status
                inStock: inStockVal,       // Save Stock Status
                category: catVal,
                image: imgVal,
                images: finalImages,
                description: descVal,
                features: featuresVal,
                variants: variants, // Add Variants
                specifications: specifications,
                services: services, // Add services
                rating: 5,
                details: "ุชูุงุตูู ุงูููุชุฌ..."
            };

            try {
                if (currentEditProduct) {
                    await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', currentEditProduct.id), productData);
                    showToast("ุชู ุชุนุฏูู ุงูููุชุฌ ุจูุฌุงุญ");
                    currentEditProduct = null;
                } else {
                    await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'products'), productData);
                    showToast("ุชู ุฅุถุงูุฉ ุงูููุชุฌ ุจูุฌุงุญ");
                }
                e.target.reset();
                if (currentView === 'admin') renderView();
            } catch(err) { console.error(err); showToast("ุญุฏุซ ุฎุทุฃ"); }
        };

        window.handleSubmitReview = async (e) => {
            e.preventDefault();
            const name = e.target.reviewerName.value.trim();
            const comment = e.target.reviewerComment.value.trim();
            const rating = parseInt(e.target.reviewerRating.value);

            if (!name || !comment) return showToast("ูุฑุฌู ููุก ุฌููุน ุงูุญููู");

            try {
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'reviews'), {
                    productId: currentProductId,
                    userName: name,
                    comment: comment,
                    rating: rating,
                    status: 'pending',
                    createdAt: Date.now()
                });
                showToast("ุชู ุฅุฑุณุงู ุชุนูููู ูููุฑุงุฌุนุฉุ ุณูุธูุฑ ุจุนุฏ ุงูููุงููุฉ");
                e.target.reset();
            } catch (err) {
                console.error(err);
                showToast("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุฅุฑุณุงู");
            }
        };

        window.handleReviewAction = async (id, action) => {
            if (!user || user.email !== ADMIN_EMAIL) return showToast("ุบูุฑ ูุตุฑุญ");
            try {
                if (action === 'approve') {
                    // Check if verified checkbox is checked
                    const isVerified = document.getElementById(`verify-check-${id}`)?.checked || false;
                    
                    await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'reviews', id), { 
                        status: 'approved',
                        verified: isVerified 
                    });
                    showToast("ุชูุช ุงูููุงููุฉ ุนูู ุงูุชุนููู");
                } else {
                    await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'reviews', id));
                    showToast("ุชู ุฑูุถ ุงูุชุนููู ูุญุฐูู");
                }
            } catch (err) {
                console.error(err);
                showToast("ุญุฏุซ ุฎุทุฃ");
            }
        };

        // --- ๐ FIXED: Modification Request Logic (ุฅุตูุงุญ ุทูุจ ุงูุชุนุฏูู) ---
        window.toggleModModal = (show) => {
            const backdrop = document.getElementById('mod-modal-backdrop');
            const modal = document.getElementById('mod-modal');
            if (show) {
                backdrop.classList.remove('opacity-0', 'pointer-events-none');
                modal.classList.remove('opacity-0', 'pointer-events-none', 'scale-95');
                modal.classList.add('scale-100');
            } else {
                backdrop.classList.add('opacity-0', 'pointer-events-none');
                modal.classList.add('opacity-0', 'pointer-events-none', 'scale-95');
                modal.classList.remove('scale-100');
            }
        };

        window.openModRequestModal = (orderId) => {
            document.getElementById('mod-order-id').value = orderId;
            toggleModModal(true);
        };

        window.handleSubmitModRequest = async (e) => {
            e.preventDefault();
            const orderId = e.target.orderId.value;
            const message = e.target.message.value.trim();

            if (!message) return showToast("ูุฑุฌู ูุชุงุจุฉ ุชูุงุตูู ุงูุชุนุฏูู");

            try {
                const btn = e.target.querySelector('button');
                const originalText = btn.innerText;
                btn.disabled = true;
                btn.innerText = "ุฌุงุฑู ุงูุฅุฑุณุงู...";

                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', orderId), {
                    modificationRequest: {
                        message: message,
                        status: 'pending',
                        createdAt: Date.now()
                    },
                    // ุฅุถุงูุฉ ููุณุฌู ุงูุฒููู
                    statusHistory: arrayUnion({
                        status: 'modification_requested',
                        timestamp: Date.now(),
                        note: `ุทูุจ ุงูุนููู ุชุนุฏูู: ${message}`
                    })
                });

                showToast("ุชู ุฅุฑุณุงู ุทูุจ ุงูุชุนุฏูู ููุฅุฏุงุฑุฉ ุจูุฌุงุญ");
                toggleModModal(false);
                e.target.reset();
                btn.disabled = false;
                btn.innerText = originalText;
                
                // ุชุญุฏูุซ ุงููุงุฌูุฉ ููุฑุงู ุฅุฐุง ููุง ูู ุตูุญุฉ ุงูุชุชุจุน
                const resultContainer = document.getElementById('tracking-result');
                if (resultContainer && resultContainer.innerHTML !== "") {
                    // ุฅุนุงุฏุฉ ุฌูุจ ุงูุทูุจ ูุชุญุฏูุซ ุงูุญุงูุฉ ุงูุธุงูุฑุฉ
                    const docSnap = await getDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', orderId));
                    if(docSnap.exists()){
                         const order = { id: docSnap.id, ...docSnap.data() };
                         renderTrackingTimeline(resultContainer, order);
                    }
                }

            } catch (err) {
                console.error(err);
                showToast("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุฅุฑุณุงู");
                e.target.querySelector('button').disabled = false;
                e.target.querySelector('button').innerText = "ุฅุฑุณุงู ุงูุทูุจ ููุฅุฏุงุฑุฉ";
            }
        };
        // -----------------------------------------------------------

        // --- 1๏ธโฃ2๏ธโฃ FIXED: Admin Edit Order Logic (ุฅุตูุงุญ ุชุนุฏูู ุงูุทูุจ) ---
        
        window.toggleEditOrderModal = (show) => {
            const backdrop = document.getElementById('edit-order-modal-backdrop');
            const modal = document.getElementById('edit-order-modal');
            if (show) {
                backdrop.classList.remove('opacity-0', 'pointer-events-none');
                modal.classList.remove('opacity-0', 'pointer-events-none', 'scale-95');
                modal.classList.add('scale-100');
            } else {
                backdrop.classList.add('opacity-0', 'pointer-events-none');
                modal.classList.add('opacity-0', 'pointer-events-none', 'scale-95');
                modal.classList.remove('scale-100');
            }
        };

        window.openEditOrderModal = (id) => {
            if (!user || user.email !== ADMIN_EMAIL) return showToast("ุบูุฑ ูุตุฑุญ");
            
            const order = ALL_ORDERS.find(o => o.id === id);
            if (!order) return showToast("ุงูุทูุจ ุบูุฑ ููุฌูุฏ");

            const form = document.getElementById('edit-order-form');
            form.orderId.value = order.id;
            form.customerName.value = order.customer.name;
            form.customerPhone.value = order.customer.phone;
            form.customerAddress.value = order.customer.address;
            form.totalAmount.value = order.totalAmount;

            toggleEditOrderModal(true);
        };

        window.handleUpdateOrder = async (e) => {
            e.preventDefault();
            if (!user || user.email !== ADMIN_EMAIL) return showToast("ุบูุฑ ูุตุฑุญ");

            const id = e.target.orderId.value;
            const name = e.target.customerName.value.trim();
            const phone = e.target.customerPhone.value.trim();
            const address = e.target.customerAddress.value.trim();
            const total = parseFloat(e.target.totalAmount.value);

            if (!name || !phone || !address || isNaN(total)) {
                return showToast("ูุฑุฌู ุงูุชุฃูุฏ ูู ุตุญุฉ ุงูุจูุงูุงุช");
            }

            try {
                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', id), {
                    'customer.name': name,
                    'customer.phone': phone,
                    'customer.address': address,
                    'totalAmount': total,
                    statusHistory: arrayUnion({
                        status: 'edited',
                        timestamp: Date.now(),
                        note: 'ุชู ุชุนุฏูู ุจูุงูุงุช ุงูุทูุจ ูุฏููุงู ุจูุงุณุทุฉ ุงููุฏูุฑ'
                    })
                });
                showToast("โ ุชู ุชุญุฏูุซ ุจูุงูุงุช ุงูุทูุจ ุจูุฌุงุญ");
                toggleEditOrderModal(false);
            } catch(err) {
                console.error(err);
                showToast("โ ูุดู ุชุญุฏูุซ ุงูุทูุจ");
            }
        };
        // -----------------------------------------------------------

        // NEW: Handle Order Actions
        window.handleOrderAction = async (id, action) => {
            if (!user || user.email !== ADMIN_EMAIL) return showToast("ุบูุฑ ูุตุฑุญ");
            
            try {
                if (action === 'delete') {
                    if(!confirm("โ๏ธ ุชุญุฐูุฑ: ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงูุทูุจ ููุงุฆูุงูุ ูุง ูููู ุงูุชุฑุงุฌุน.")) return;
                    await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', id));
                    showToast("ุชู ุญุฐู ุงูุทูุจ ููุงุฆูุงู");
                } else if (action === 'archive') {
                    if(!confirm("ูู ุชุฑูุฏ ููู ูุฐุง ุงูุทูุจ ุฅูู ุงูุฃุฑุดููุ")) return;
                    
                    await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', id), {
                        isArchived: true,
                        // ุฅุถุงูุฉ ุณุฌู ููุนูููุฉ
                        statusHistory: arrayUnion({
                            status: 'archived',
                            timestamp: Date.now(),
                            note: 'ุชู ููู ุงูุทูุจ ููุฃุฑุดูู ูุฏููุงู'
                        })
                    });
                    showToast("ุชู ููู ุงูุทูุจ ุฅูู ุงูุฃุฑุดูู ๐๏ธ");
                    
                } else if (action === 'restore') {
                    if(!confirm("ูู ุชุฑูุฏ ุงุณุชุนุงุฏุฉ ูุฐุง ุงูุทูุจ ูููุงุฆูุฉ ุงูุฌุงุฑูุฉุ")) return;

                    await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', id), {
                        isArchived: false,
                        // ุฅุถุงูุฉ ุณุฌู ููุนูููุฉ
                        statusHistory: arrayUnion({
                            status: 'restored',
                            timestamp: Date.now(),
                            note: 'ุชู ุงุณุชุนุงุฏุฉ ุงูุทูุจ ูู ุงูุฃุฑุดูู'
                        })
                    });
                    showToast("ุชู ุงุณุชุนุงุฏุฉ ุงูุทูุจ ูููุงุฆูุฉ ุงูุฑุฆูุณูุฉ โฉ๏ธ");
                }
            } catch(err) {
                console.error(err);
                showToast("ุญุฏุซ ุฎุทุฃ ูู ุชุญุฏูุซ ุงูุทูุจ");
            }
        };

        // NEW: Handle Modification Decision (Admin)
        window.handleModDecision = async (id, decision) => {
            if (!user || user.email !== ADMIN_EMAIL) return showToast("ุบูุฑ ูุตุฑุญ");
            
            try {
                // decision: 'approved' or 'rejected'
                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', id), {
                    'modificationRequest.status': decision,
                    'modificationRequest.adminRespondedAt': Date.now()
                });
                
                if (decision === 'approved') {
                    showToast("ุชูุช ุงูููุงููุฉ ุนูู ุทูุจ ุงูุชุนุฏูู (ูุฑุฌู ุชูููุฐ ุงูุชุนุฏูู ูุฏููุงู ุฅุฐุง ูุฒู ุงูุฃูุฑ)");
                    // Optional: Open edit modal automatically if approved to let admin make changes
                    // openEditOrderModal(id); 
                } else {
                    showToast("ุชู ุฑูุถ ุทูุจ ุงูุชุนุฏูู");
                }
            } catch(err) {
                console.error(err);
                showToast("ุญุฏุซ ุฎุทุฃ");
            }
        };

        // NEW: Handle Order Status Change (Admin)
        window.handleOrderStatusChange = async (id, newStatus) => {
            if (!user || user.email !== ADMIN_EMAIL) return showToast("ุบูุฑ ูุตุฑุญ");
            
            try {
                // ุงูุญุตูู ุนูู ุงููุต ุงูุนุฑุจู ููุญุงูุฉ
                const statusLabel = STATUS_ARABIC_MAP[newStatus] || newStatus;

                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', id), {
                    status: newStatus,
                    // --- NEW: ุฅุถุงูุฉ ููุณุฌู ุงูุฒููู ---
                    statusHistory: arrayUnion({
                        status: newStatus,
                        timestamp: Date.now(),
                        note: `ุชู ุชุบููุฑ ุงูุญุงูุฉ ุฅูู: ${statusLabel}`
                    })
                    // -----------------------------
                });
                showToast("ุชู ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจ ุจูุฌุงุญ");

                // --- NEW: ุฅุฑุณุงู ุฅุดุนุงุฑ ููุนููู ---
                const order = ALL_ORDERS.find(o => o.id === id);
                if (order) {
                    // Update local object immediately to reflect in UI without refresh if needed
                    if (!order.statusHistory) order.statusHistory = [];
                    order.statusHistory.push({
                        status: newStatus,
                        timestamp: Date.now(),
                        note: `ุชู ุชุบููุฑ ุงูุญุงูุฉ ุฅูู: ${statusLabel}`
                    });
                    
                    notifyOrderStatus(order, newStatus);
                }
                // -----------------------------

            } catch(err) {
                console.error(err);
                showToast("ูุดู ุชุญุฏูุซ ุงูุญุงูุฉ");
            }
        };

        // --- NEW: ุฏุงูุฉ ุฅุถุงูุฉ ููุงุญุธุฉ ุฏุงุฎููุฉ ---
        window.addInternalNote = async (id) => {
            if (!user || user.email !== ADMIN_EMAIL) return showToast("ุบูุฑ ูุตุฑุญ");
            
            const input = document.getElementById(`note-input-${id}`);
            const text = input.value.trim();
            
            if (!text) return;

            try {
                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', id), {
                    internalNotes: arrayUnion({
                        text: text,
                        timestamp: Date.now(),
                        admin: user.displayName || 'Admin'
                    })
                });
                showToast("ุชู ุญูุธ ุงูููุงุญุธุฉ ุงูุฏุงุฎููุฉ");
                input.value = ''; // ุชูุฑูุบ ุงูุญูู
            } catch(err) {
                console.error(err);
                showToast("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุญูุธ ุงูููุงุญุธุฉ");
            }
        };

        // --- 9๏ธโฃ CSV EXPORT FUNCTION ---
        window.exportOrdersToCSV = (range) => {
            if (!user || user.email !== ADMIN_EMAIL) return showToast("ุบูุฑ ูุตุฑุญ");
            
            let filteredOrders = ALL_ORDERS;
            const now = new Date();
            
            // Filter Logic
            if (range === 'today') {
                filteredOrders = filteredOrders.filter(o => {
                    const d = o.createdAt.toDate ? o.createdAt.toDate() : new Date(o.createdAt);
                    return d.toDateString() === now.toDateString();
                });
            } else if (range === 'week') {
                const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                filteredOrders = filteredOrders.filter(o => {
                    const d = o.createdAt.toDate ? o.createdAt.toDate() : new Date(o.createdAt);
                    return d >= weekAgo;
                });
            } else if (range === 'month') {
                const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                filteredOrders = filteredOrders.filter(o => {
                    const d = o.createdAt.toDate ? o.createdAt.toDate() : new Date(o.createdAt);
                    return d >= monthAgo;
                });
            }

            if (filteredOrders.length === 0) return showToast("ูุง ุชูุฌุฏ ุทูุจุงุช ูู ูุฐู ุงููุชุฑุฉ ูุชุตุฏูุฑูุง");

            // CSV Header
            let csvContent = "\uFEFF"; // BOM for Excel Arabic support
            // ุชู ุฅุถุงูุฉ ุฃุนูุฏุฉ ุจูุงูุงุช ุงูุฏูุน ูู ุงูููุงูุฉ
            csvContent += "ุฑูู ุงูุทูุจ,ุงุณู ุงูุนููู,ุฑูู ุงููุงุชู,ุงูุนููุงู,ุฅุฌูุงูู ุงููุจูุบ,ุทุฑููุฉ ุงูุฏูุน,ุญุงูุฉ ุงูุทูุจ,ุชุงุฑูุฎ ุงูุทูุจ,ุงุณู ุงููุญูู (ุงูุฏูุน),ุฑูู ุงููุญูุธุฉ,ุงููุจูุบ ุงููุฏููุน,ุฑูู ุงูุนูููุฉ\n";

            // CSV Rows
            filteredOrders.forEach(o => {
                const d = o.createdAt.toDate ? o.createdAt.toDate() : new Date(o.createdAt);
                const dateStr = d.toLocaleDateString('ar-EG') + " " + d.toLocaleTimeString('ar-EG');
                
                // Escape commas in address/name to prevent column shift
                const cleanName = `"${(o.customer.name || '').replace(/"/g, '""')}"`;
                const cleanAddress = `"${(o.customer.address || '').replace(/"/g, '""')}"`;
                const paymentAr = o.paymentMethod === 'vodafone_cash' ? 'ููุฏุงููู ูุงุด' : 'ุนูุฏ ุงูุงุณุชูุงู';
                const statusAr = STATUS_ARABIC_MAP[o.status] || o.status;

                // ุงุณุชุฎุฑุงุฌ ุจูุงูุงุช ุงูุฏูุน ุฅุฐุง ูุฌุฏุช
                let paySenderName = "-", paySenderPhone = "-", payAmount = "-", payTransId = "-";
                
                if (o.paymentMethod === 'vodafone_cash' && o.paymentDetails) {
                    paySenderName = `"${(o.paymentDetails.senderName || '').replace(/"/g, '""')}"`;
                    // ุฅุถุงูุฉ ุนูุงูุฉ ุงูุชุจุงุณ ููุฑุฏุฉ ูููุน ุฅูุณูู ูู ุญุฐู ุงูุตูุฑ ูู ุจุฏุงูุฉ ุงูุฑูู
                    paySenderPhone = `'${o.paymentDetails.senderPhone || ''}`; 
                    payAmount = o.paymentDetails.amountPaid || '0';
                    payTransId = `"${(o.paymentDetails.transactionId || '').replace(/"/g, '""')}"`;
                }

                csvContent += `${o.id},${cleanName},'${o.customer.phone},${cleanAddress},${o.totalAmount},${paymentAr},${statusAr},${dateStr},${paySenderName},${paySenderPhone},${payAmount},${payTransId}\n`;
            });

            // Trigger Download
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", `orders_export_${range}_${now.toISOString().slice(0,10)}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast(`ุชู ุชุตุฏูุฑ ${filteredOrders.length} ุทูุจ ุจูุฌุงุญ`);
        };

        // NEW: Handle Payment Review Decision (Vodafone Cash) - UPDATED FOR AUTO WHATSAPP
        window.handlePaymentDecision = async (id, decision) => {
            if (!user || user.email !== ADMIN_EMAIL) return showToast("ุบูุฑ ูุตุฑุญ");
            
            // ุฌูุจ ุจูุงูุงุช ุงูุทูุจ ุฃููุงู ูุงุณุชุฎุฏุงู ุงุณู ูุฑูู ุงูุนููู
            const order = ALL_ORDERS.find(o => o.id === id);
            if (!order) return showToast("ุจูุงูุงุช ุงูุทูุจ ุบูุฑ ููุฌูุฏุฉ");

            try {
                let updateData = {};
                let msg = "";
                let whatsappMsg = ""; // ุงูุฑุณุงูุฉ ุงูููุณูุฉ
                
                if (decision === 'approve') {
                    // ูุจูู ุงูุฏูุน: ุชุญููู ุงูุญุงูุฉ ุฅูู ูุคูุฏ (ูุฏููุน)
                    updateData = {
                        status: 'confirmed', 
                        'paymentDetails.verified': true,
                        'paymentDetails.verifiedAt': Date.now(),
                        'paymentDetails.adminNote': 'ุชู ุชุฃููุฏ ูุตูู ุงููุจูุบ',
                        // --- NEW: ุฅุถุงูุฉ ููุณุฌู ุงูุฒููู ---
                        statusHistory: arrayUnion({
                            status: 'confirmed',
                            timestamp: Date.now(),
                            note: 'ุชู ุชุฃููุฏ ุงุณุชูุงู ุงูุฏูุน ุจูุฌุงุญ'
                        })
                        // -----------------------------
                    };
                    msg = "ุชู ุชุฃููุฏ ุงูุฏูุน ุจูุฌุงุญ ูุชุญููู ุงูุทูุจ ุฅูู (ูุคูุฏ)";

                    // === ุฑุณุงูุฉ ุงููุจูู ุงูููุณูุฉ ===
                    whatsappMsg = `ูุฑุญุจูุง ุฃ/ ${order.customer.name}\n\n` +
                        `ูุณุนุฏูุง ุฅุจูุงุบู ุจุฃูู ุชู ุชุฃููุฏ ุงุณุชูุงู ูููุฉ ุทูุจู ุจูุฌุงุญ.\n` +
                        `ุฑูู ุงูุทูุจ: *${order.id}*\n` +
                        `ุงููุจูุบ ุงููุณุชูู: *${order.paymentDetails.amountPaid} ุฌ.ู*\n` +
                        `ุฌุงุฑู ุญุงูููุง ุชุฌููุฒ ุทูุจู ุฏุงุฎู ุงููุฎุงุฒูุ ูุณูุชู ุดุญูู ูู ุฃูุฑุจ ููุช ูููู.\n\n` +
                        `ุณููุงููู ุจุชูุงุตูู ุงูุดุญู ููุฑ ุฎุฑูุฌ ุงูุทูุจ.\n` +
                        `ุดูุฑูุง ูุซูุชู ูู ุฌุฏุงุฑ ููุฏูููุฑ ๐ค`;

                } else {
                    // ุฑูุถ ุงูุฏูุน: ุทูุจ ุณุจุจ ุงูุฑูุถ
                    const reason = prompt("ูุฑุฌู ูุชุงุจุฉ ุณุจุจ ุงูุฑูุถ (ุณูุธูุฑ ููุนููู):", "ุงููุจูุบ ูู ูุตู ุงููุญูุธุฉ / ุงูุจูุงูุงุช ุบูุฑ ูุทุงุจูุฉ");
                    if (reason === null) return; // ุฃูุบู ุงููุฏูุฑ ุงูุนูููุฉ

                    updateData = {
                        status: 'payment_pending',
                        'paymentDetails.verified': false,
                        'paymentDetails.rejectedAt': Date.now(),
                        'paymentDetails.adminNote': reason, // ุญูุธ ุงูุณุจุจ ุงููุฏุฎู
                        // --- NEW: ุฅุถุงูุฉ ููุณุฌู ุงูุฒููู ---
                        statusHistory: arrayUnion({
                            status: 'payment_pending',
                            timestamp: Date.now(),
                            note: `ุฑูุถ ุนูููุฉ ุงูุฏูุน: ${reason}`
                        })
                        // -----------------------------
                    };
                    msg = "ุชู ุฑูุถ ุงูุฏูุน ูุชุณุฌูู ุงูุณุจุจ ููุนููู";

                    // === ุฑุณุงูุฉ ุงูุฑูุถ ุงูููุณูุฉ ===
                    const trackLink = `${window.location.origin}${window.location.pathname}#/track-order`;
                    whatsappMsg = `ูุฑุญุจุงู ${order.customer.name} ๐\n` +
                        `ุชุญุฏูุซ ุจุฎุตูุต ุทูุจู ุฑูู *#${order.id}*\n\n` +
                        `ุนุฐุฑุงูุ ูู ูุชููู ูู ุชุฃููุฏ ุนูููุฉ ุงูุฏูุน โ\n` +
                        `โ๏ธ ุงูุณุจุจ: *${reason}*\n\n` +
                        `ูุฑุฌู ูุฑุงุฌุนุฉ ุงูุจูุงูุงุช ูุฅุนุงุฏุฉ ุงููุญุงููุฉ ุนุจุฑ ุฑุงุจุท ุงูุชุชุจุน:\n${trackLink}`;
                }

                // ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช
                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', id), updateData);
                showToast(msg);

                // === ูุชุญ ูุงุชุณุงุจ ุชููุงุฆูุงู ===
                const phone = "20" + order.customer.phone.replace(/^0+/, ""); // ุชูุณูู ุงูุฑูู ุงููุตุฑู
                const url = `https://wa.me/${phone}?text=${encodeURIComponent(whatsappMsg)}`;
                
                // ูุชุญ ูู ูุงูุฐุฉ ุฌุฏูุฏุฉ (ูุฏ ูุญุชุงุฌ ุงููุชุตูุญ ูุณูุงุญูุฉ Pop-ups ูุฃูู ูุฑุฉ)
                const win = window.open(url, '_blank');
                if (win) {
                    win.focus();
                } else {
                    showToast("ูุฑุฌู ุงูุณูุงุญ ุจุงูููุงูุฐ ุงูููุจุซูุฉ ููุชุญ ูุงุชุณุงุจ ุชููุงุฆูุงู");
                    // Fallback link click
                    window.location.href = url;
                }

            } catch(err) {
                console.error(err);
                showToast("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชุญุฏูุซ ุญุงูุฉ ุงูุฏูุน");
            }
        };

        // โ ุชู ุญุฐู ุฏุงูุฉ handlePlaceOrder ุงูููุฑุฑุฉ ูู ููุง ุจุงููุงูู ูุญู ูุดููุฉ ุงุฒุฏูุงุฌ ุงูุทูุจ

        function renderTrackingTimeline(container, order) {
            const steps = [
                { id: 'new', label: 'ุชู ุงูุทูุจ', icon: 'shopping-bag', desc: 'ุชู ุงุณุชูุงู ุทูุจู ุจูุฌุงุญ ููู ููุฏ ุงููุฑุงุฌุนุฉ.' },
                { id: 'pending_payment', label: 'ุจุงูุชุธุงุฑ ุงูุฏูุน', icon: 'credit-card', desc: 'ูุฑุฌู ุฅุชูุงู ุนูููุฉ ุงูุฏูุน ูุชุฃููุฏ ุงูุทูุจ.' },
                { id: 'payment_review', label: 'ูุฑุงุฌุนุฉ ุงูุฏูุน', icon: 'file-search', desc: 'ุฌุงุฑู ูุฑุงุฌุนุฉ ุจูุงูุงุช ุงูุฏูุน ุงูุชู ุฃุฑุณูุชูุง ูุชุฃููุฏ ุงูุทูุจ.' },
                { id: 'confirmed', label: 'ุชู ุงูุชุฃููุฏ', icon: 'check-circle', desc: 'ุชู ุชุฃููุฏ ุทูุจู ูุงูุฏูุน ุจูุฌุงุญ.' },
                { id: 'processing', label: 'ุฌุงุฑู ุงูุชุฌููุฒ', icon: 'package', desc: 'ูููู ูุฑูููุง ุจุชุฌููุฒ ูุชุบููู ุทูุจู ุญุงููุงู.' },
                { id: 'shipped', label: 'ุชู ุงูุดุญู', icon: 'truck', desc: 'ุงูุดุญูุฉ ุฎุฑุฌุช ูุน ููุฏูุจ ุงูุชูุตูู ูู ุทุฑูููุง ุฅููู.' },
                { id: 'delivered', label: 'ุชู ุงูุชูุตูู', icon: 'home', desc: 'ุชู ุชุณููู ุงูุทูุจ ุจูุฌุงุญ. ูุชููู ุฃู ููุงู ุฅุนุฌุงุจู!' }
            ];

            const currentStatus = order.status || 'new';
            const currentIndex = steps.findIndex(s => s.id === currentStatus);
            const currentStepInfo = (currentIndex !== -1) ? steps[currentIndex] : steps[0];
            const isDelivered = currentStatus === 'delivered';
            const progressPercent = Math.min(100, Math.max(0, (currentIndex / (steps.length - 1)) * 100));

            // ... (Payment Rejection HTML & Mod Req HTML code same as before) ...
            // ููุงุฎุชุตุงุฑ ุณุฃุถุน ุงูุฃููุงุฏ ุงููุชุบูุฑุฉ ููุงุ ููููู ุงูุญูุงุธ ุนูู ุงูุฃููุงุฏ ุงููุฏููุฉ ููุฃูุณุงู ุงูุฃุฎุฑู
            
            let paymentRejectionHTML = '';
            if (order.paymentDetails && order.paymentDetails.verified === false && order.status === 'payment_pending') {
                const rejectionReason = order.paymentDetails.adminNote || "ูุฑุฌู ูุฑุงุฌุนุฉ ุงูุจูุงูุงุช.";
                const waNumber = "201014175070";
                const waText = encodeURIComponent(`ูุฑุญุจุงูุ ูุฏู ุงุณุชูุณุงุฑ ุจุฎุตูุต ุฑูุถ ุงูุฏูุน ููุทูุจ ุฑูู #${order.id}`);
                paymentRejectionHTML = `
                <div class="bg-red-50 border-2 border-red-100 rounded-2xl p-6 mb-8 flex flex-col md:flex-row gap-5 items-start animate-in fade-in slide-in-from-top-4 shadow-sm">
                    <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center shrink-0 text-red-600">
                        <i data-lucide="x-octagon" size="24"></i>
                    </div>
                    <div class="flex-1 w-full">
                        <h3 class="font-bold text-lg text-red-800 mb-1">ุนุฐุฑุงูุ ุชู ุฑูุถ ุนูููุฉ ุงูุฏูุน</h3>
                        <p class="text-red-700 font-medium text-sm mb-3">ุงูุณุจุจ: "<span class="font-bold">${rejectionReason}</span>"</p>
                        <div class="flex flex-wrap gap-3">
                            <button onclick="handleVodafoneCashFlow('${order.id}', ${order.totalAmount})" class="flex-1 bg-red-600 hover:bg-red-700 text-white px-5 py-2.5 rounded-xl text-sm font-bold shadow-sm transition-colors flex items-center justify-center gap-2"><i data-lucide="refresh-cw" size="16"></i> ุฅุนุงุฏุฉ ุฅุฑุณุงู ุงูุจูุงูุงุช</button>
                            <a href="https://wa.me/${waNumber}?text=${waText}" target="_blank" class="flex-1 bg-white border border-green-500 text-green-600 hover:bg-green-50 px-5 py-2.5 rounded-xl text-sm font-bold shadow-sm transition-colors flex items-center justify-center gap-2"><i data-lucide="message-circle" size="16"></i> ุญู ุงููุฒุงุน (ูุงุชุณุงุจ)</a>
                        </div>
                    </div>
                </div>`;
            }

            let modReqHTML = '';
            if (order.modificationRequest && order.modificationRequest.status === 'pending') {
                modReqHTML = `<div class="bg-orange-50 border border-orange-200 rounded-xl p-4 mb-6 flex items-start gap-3"><i data-lucide="clock" class="text-orange-500 mt-1 shrink-0"></i><div><h4 class="font-bold text-orange-700 text-sm">ุทูุจ ุงูุชุนุฏูู ููุฏ ุงููุฑุงุฌุนุฉ</h4><p class="text-orange-600 text-xs mt-1">ุทูุจุช: "${order.modificationRequest.message}"</p></div></div>`;
            } else if (currentStatus !== 'delivered' && currentStatus !== 'shipped' && !order.modificationRequest) {
                modReqHTML = `<div class="mb-6 text-center"><button onclick="openModRequestModal('${order.id}')" class="text-sm font-bold text-stone-500 hover:text-stone-900 underline decoration-stone-300 underline-offset-4 flex items-center justify-center gap-2 mx-auto transition-colors"><i data-lucide="edit-3" size="14"></i> ูู ุชุฑูุฏ ุทูุจ ุชุนุฏูู ุนูู ูุฐุง ุงูุทูุจุ</button></div>`;
            }

            container.innerHTML = `
                <!-- 1. Hero Status Card -->
                <div class="bg-white rounded-3xl p-6 md:p-8 shadow-xl shadow-stone-200/40 mb-8 border border-white relative overflow-hidden group fade-in-up">
                    <div class="absolute top-0 right-0 w-64 h-64 bg-white rounded-full -mr-20 -mt-20 blur-3xl transition-colors duration-500 group-hover:bg-stone-100"></div>
                    <div class="absolute bottom-0 left-0 w-40 h-40 ${isDelivered ? 'bg-green-50' : 'bg-blue-50'} rounded-full -ml-10 -mb-10 blur-3xl opacity-60"></div>
                    <div class="relative z-10 flex flex-col md:flex-row justify-between items-start md:items-center gap-6">
                        <div>
                            <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-bold bg-stone-100 text-stone-600 mb-4 border border-stone-200">
                                <span class="w-1.5 h-1.5 rounded-full ${isDelivered ? 'bg-green-500' : 'bg-blue-500 animate-pulse'}"></span>
                                ุฑูู ุงูุทูุจ #${order.id}
                            </div>
                            <h2 class="text-3xl md:text-4xl font-bold text-stone-900 mb-2 tracking-tight">${currentStepInfo.label}</h2>
                            <p class="text-stone-500 text-sm md:text-base max-w-md leading-relaxed">${currentStepInfo.desc}</p>
                        </div>
                        <div class="w-20 h-20 md:w-24 md:h-24 ${isDelivered ? 'bg-green-100 text-green-600' : 'bg-stone-900 text-white'} rounded-3xl flex items-center justify-center shadow-lg transform rotate-3 transition-transform hover:rotate-6">
                            <i data-lucide="${currentStepInfo.icon}" size="40"></i>
                        </div>
                    </div>
                </div>

                ${paymentRejectionHTML}
                ${modReqHTML}

                <div class="space-y-8 fade-in-up" style="animation-delay: 0.1s;">
                    
                    <!-- 2. Horizontal Timeline (Full Width) -->
                    <div class="bg-white rounded-3xl p-6 md:p-8 shadow-sm border border-stone-100 overflow-hidden">
                        <div class="overflow-x-auto pb-4 custom-scrollbar">
                            <div class="min-w-[700px] relative px-4 py-6">
                                <div class="absolute top-1/2 right-0 left-0 h-1 bg-stone-100 -translate-y-1/2 rounded-full z-0 mx-8"></div>
                                <div class="absolute top-1/2 right-0 h-1 bg-stone-900 -translate-y-1/2 rounded-full z-0 mx-8 transition-all duration-1000 ease-out" style="width: ${progressPercent}%"></div>
                                <div class="flex justify-between items-center relative z-10 w-full">
                                    ${steps.map((step, idx) => {
                                        const isCompleted = idx <= currentIndex;
                                        const isCurrent = idx === currentIndex;
                                        return `<div class="flex flex-col items-center gap-4 relative group cursor-default text-center w-32">
                                            <div class="w-12 h-12 rounded-full border-[3px] flex items-center justify-center transition-all duration-500 z-10 ${isCompleted ? 'bg-stone-900 border-stone-900 text-white shadow-lg scale-110' : 'bg-white border-stone-200 text-stone-300'} ${isCurrent ? 'ring-4 ring-stone-100' : ''}"><i data-lucide="${step.icon}" size="${isCurrent ? 20 : 18}"></i></div>
                                            <div class="flex flex-col items-center"><h4 class="font-bold text-sm ${isCompleted ? 'text-stone-900' : 'text-stone-400'} mb-1 transition-colors">${step.label}</h4>${isCurrent ? `<span class="text-[10px] bg-blue-50 text-blue-600 px-2 py-0.5 rounded-full font-bold animate-pulse">ุงูุญุงููุฉ</span>` : ''}</div>
                                        </div>`;
                                    }).join('')}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 3. NEW: Detailed Order Timeline Log (Sijil Zamani) -->
                    <div class="bg-white rounded-3xl p-6 md:p-8 shadow-sm border border-stone-100 relative overflow-hidden">
                        <h3 class="font-bold text-lg mb-8 flex items-center gap-2 text-stone-900">
                            <div class="p-2 bg-white rounded-lg"><i data-lucide="history" class="text-stone-900" size="20"></i></div>
                            ุณุฌู ุงููุดุงุทุงุช (Timeline)
                        </h3>
                        
                        <div class="relative border-r-2 border-stone-100 mr-3 space-y-8 pb-2">
                            ${(order.statusHistory && order.statusHistory.length > 0) ? order.statusHistory.sort((a,b) => b.timestamp - a.timestamp).map((log, idx) => {
                                const dateObj = new Date(log.timestamp);
                                const dateStr = dateObj.toLocaleDateString('ar-EG');
                                const timeStr = dateObj.toLocaleTimeString('ar-EG', {hour: '2-digit', minute:'2-digit'});
                                const isFirst = idx === 0;
                                
                                return `
                                <div class="relative pr-8 animate-in fade-in slide-in-from-right-4" style="animation-delay: ${idx * 0.1}s">
                                    <!-- Dot -->
                                    <div class="absolute -right-[9px] top-1.5 w-4 h-4 rounded-full border-2 border-white ${isFirst ? 'bg-green-500 ring-4 ring-green-100 shadow-md' : 'bg-stone-300'}"></div>
                                    
                                    <div class="bg-white p-4 rounded-2xl border border-stone-100 ${isFirst ? 'bg-green-50/50 border-green-100' : ''}">
                                        <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-1 mb-2">
                                            <h4 class="font-bold text-stone-900 text-sm ${isFirst ? 'text-green-800' : ''}">${STATUS_ARABIC_MAP[log.status] || log.status}</h4>
                                            <span class="text-[10px] text-stone-400 dir-ltr font-mono bg-white px-2 py-0.5 rounded border border-stone-100">${dateStr} | ${timeStr}</span>
                                        </div>
                                        <p class="text-xs text-stone-600 leading-relaxed font-medium">${log.note || 'ูุง ุชูุฌุฏ ููุงุญุธุงุช ุฅุถุงููุฉ'}</p>
                                    </div>
                                </div>
                                `;
                            }).join('') : `
                                <div class="relative pr-8">
                                    <div class="absolute -right-[9px] top-1.5 w-4 h-4 rounded-full bg-stone-300 border-2 border-white"></div>
                                    <h4 class="font-bold text-stone-900 text-sm">ุจุฏุงูุฉ ุงูุณุฌู</h4>
                                    <p class="text-xs text-stone-500 mt-1">ุณุฌู ุงููุดุงุทุงุช ูุชุงุญ ููุทูุจุงุช ุงูุฌุฏูุฏุฉ ููุท.</p>
                                </div>
                            `}
                        </div>
                    </div>

                    <!-- 4. Invoice Summary -->
                    <div class="bg-white rounded-3xl shadow-xl shadow-stone-200/50 border border-stone-100 overflow-hidden transform transition-all hover:-translate-y-1 duration-300">
                        <div class="p-6 bg-stone-900 text-white relative overflow-hidden">
                            <div class="absolute top-0 right-0 w-32 h-32 bg-white/5 rounded-full -mr-10 -mt-10 blur-2xl"></div>
                            <div class="absolute bottom-0 left-0 w-24 h-24 bg-white/5 rounded-full -ml-8 -mb-8 blur-2xl"></div>
                            <div class="relative z-10 flex justify-between items-center">
                                <div>
                                    <h3 class="font-bold text-lg flex items-center gap-2"><i data-lucide="receipt" size="18" class="text-stone-400"></i> ููุฎุต ุงููุงุชูุฑุฉ</h3>
                                    <p class="text-stone-400 text-xs mt-1 font-mono tracking-wider opacity-80">ORDER #${order.id}</p>
                                </div>
                                <div class="w-10 h-10 rounded-full bg-white/10 backdrop-blur-md flex items-center justify-center border border-white/10"><i data-lucide="shopping-bag" size="20" class="text-white"></i></div>
                            </div>
                        </div>
                        <div class="grid md:grid-cols-2">
                            <div class="p-6 bg-white md:border-l md:border-stone-100 max-h-[350px] overflow-y-auto custom-scrollbar space-y-4">
                                ${order.items.map(item => `
                                    <div class="flex items-center gap-4 group">
                                        <div class="w-14 h-14 bg-white rounded-xl border border-stone-100 overflow-hidden flex-shrink-0 relative">
                                            <img src="${item.selectedColor && item.variants ? (item.variants.find(v=>v.color===item.selectedColor)?.image || item.image) : item.image}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500">
                                            <span class="absolute bottom-0 right-0 bg-stone-900 text-white text-[9px] w-5 h-5 flex items-center justify-center rounded-tl-lg font-bold">${item.quantity}</span>
                                        </div>
                                        <div class="flex-1 min-w-0">
                                            <h4 class="font-bold text-stone-900 text-sm truncate mb-0.5">${item.name}</h4>
                                            <p class="text-xs text-stone-500 font-medium">ุณุนุฑ ุงููุทุนุฉ: $${item.price}</p>
                                            ${item.selectedColor ? `<p class="text-[10px] text-stone-400 mt-0.5 bg-white inline-block px-1.5 rounded border border-stone-100">ุงูููู: ${item.selectedColor}</p>` : ''}
                                        </div>
                                        <div class="text-right"><p class="font-serif font-bold text-stone-900 text-sm">$${(item.price * item.quantity).toFixed(2)}</p></div>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="flex flex-col">
                                <div class="p-6 bg-white space-y-3 flex-1">
                                    <div class="flex justify-between items-center text-xs font-bold text-stone-500"><span>ุงููุฌููุน ุงููุฑุนู</span><span class="font-serif text-stone-700">$${order.items.reduce((s, i) => s + (i.price * i.quantity), 0).toFixed(2)}</span></div>
                                    ${order.delivery && order.delivery.requested ? `<div class="flex justify-between items-center text-xs font-bold text-stone-500"><span>ุงูุดุญู</span><span class="font-serif text-stone-700">${order.delivery.fee > 0 ? '$' + order.delivery.fee.toFixed(2) : 'ุญุณุจ ุงูููุทูุฉ'}</span></div>` : ''}
                                    <div class="flex justify-between items-center pt-3 border-t border-stone-200 mt-2"><span class="text-base font-bold text-stone-900">ุงูุฅุฌูุงูู ุงูููู</span><span class="text-xl font-serif font-black text-stone-900">$${Number(order.totalAmount).toFixed(2)}</span></div>
                                </div>
                                <div class="p-5 bg-white/50 border-t border-stone-100 text-xs">
                                    <div class="flex flex-wrap items-center justify-between gap-3 mb-4">
                                        <div class="flex items-center gap-2"><div class="w-8 h-8 rounded-full bg-white border border-stone-200 flex items-center justify-center text-stone-600 shadow-sm"><i data-lucide="user" size="14"></i></div><div><p class="text-[10px] text-stone-400 font-bold mb-0.5">ุงูุนููู</p><p class="font-bold text-stone-900 text-sm">${order.customer.name}</p></div></div>
                                        <div class="flex items-center gap-2"><div class="text-right"><p class="text-[10px] text-stone-400 font-bold mb-0.5">ุงููุงุชู</p><p class="font-mono text-stone-700 font-bold dir-ltr bg-white px-2 py-0.5 rounded border border-stone-100">${order.customer.phone}</p></div><div class="w-8 h-8 rounded-full bg-white border border-stone-200 flex items-center justify-center text-stone-600 shadow-sm"><i data-lucide="phone" size="14"></i></div></div>
                                    </div>
                                    <div class="bg-white p-3 rounded-xl border border-stone-200 shadow-sm flex gap-3 items-start"><i data-lucide="map-pin" size="16" class="text-orange-500 shrink-0 mt-0.5"></i><div><p class="text-[10px] text-stone-400 font-bold mb-1">ุนููุงู ุงูุชูุตูู</p><p class="text-stone-700 leading-relaxed font-medium">${order.customer.address}</p></div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            lucide.createIcons();
        }

        window.loginWithGoogle = async () => {
            const provider = new GoogleAuthProvider();
            try {
                const result = await signInWithPopup(auth, provider);
                // Extra check immediately after popup
                if (result.user.email !== ADMIN_EMAIL) {
                    await signOut(auth);
                    showToast("ุนุฐุฑุงูุ ุงูุฏุฎูู ููุชุตุฑ ุนูู ุญุณุงุจ ุงููุงูู ููุท: " + ADMIN_EMAIL);
                    return;
                }
                showToast("ูุฑุญุจุงู ุจู ูุง ูุฏูุฑ ุงููุชุฌุฑ");
                setView('home');
            } catch (error) {
                console.error(error);
                showToast("ูุดู ุชุณุฌูู ุงูุฏุฎูู");
            }
        };

        window.handleLogout = async () => {
            try {
                await signOut(auth);
                showToast("ุชู ุชุณุฌูู ุงูุฎุฑูุฌ");
                setView('home');
            } catch (error) { console.error(error); }
        };

        // --- Search Logic ---
        let isSearchOpen = false;

        window.toggleTopSearch = (e) => {
            e.stopPropagation();
            const bar = document.getElementById('top-search-bar');
            const input = document.getElementById('top-search-input');
            
            if (!isSearchOpen) {
                // Open (Modern Expansion)
                bar.classList.remove('bg-transparent', 'border-transparent', 'w-10');
                bar.classList.add('bg-white', 'border-stone-200', 'w-48', 'md:w-64', 'shadow-sm'); // Solid background on open
                input.classList.remove('opacity-0');
                input.focus();
                isSearchOpen = true;
            } else {
                if(input.value.trim() !== "") {
                     updateShopFilters('search', input.value.trim());
                     setView('shop');
                } else {
                    closeTopSearch(); 
                }
            }
        };

        window.closeTopSearch = () => {
            if(!isSearchOpen) return;
            const bar = document.getElementById('top-search-bar');
            const input = document.getElementById('top-search-input');
            
            bar.classList.remove('bg-white', 'border-stone-200', 'w-48', 'md:w-64', 'shadow-sm');
            bar.classList.add('bg-transparent', 'border-transparent', 'w-10');
            input.classList.add('opacity-0');
            input.blur();
            isSearchOpen = false;
        };

        window.handleGlobalSearch = (e) => {
            if(e.key === 'Enter') {
                const val = e.target.value.trim();
                if(val) {
                     updateShopFilters('search', val);
                     setView('shop');
                     closeTopSearch(); // Optional: close after search
                }
            }
        };

        // NEW: Filter Drawer Logic
        window.toggleFilterDrawer = (show) => {
            const sidebar = document.getElementById('shop-sidebar');
            const overlay = document.getElementById('filter-sidebar-overlay');
            if (show) {
                sidebar.classList.remove('translate-x-full');
                overlay.classList.remove('hidden');
                document.body.style.overflow = 'hidden'; // Prevent background scrolling
            } else {
                sidebar.classList.add('translate-x-full');
                overlay.classList.add('hidden');
                document.body.style.overflow = '';
            }
        };

        // --- Internal Helpers ---

        function updateCartUI() {
            const container = document.getElementById('cart-items');
            const footer = document.getElementById('cart-footer');
            const badge = document.getElementById('cart-badge');
            const totalEl = document.getElementById('cart-total');
            const countSummary = document.getElementById('cart-count-summary');
            const clearBtn = document.getElementById('clear-cart-btn'); // NEW: Get Clear Button
            
            const count = cart.reduce((s, i) => s + i.quantity, 0);
            badge.innerText = count;
            badge.classList.toggle('hidden', count === 0);
            
            // NEW: Toggle Clear Button Visibility
            if(clearBtn) {
                if(count > 0) clearBtn.classList.remove('hidden');
                else clearBtn.classList.add('hidden');
            }
            
            const total = cart.reduce((s, i) => s + (i.price * i.quantity), 0);
            totalEl.innerText = `$${total.toFixed(2)}`;
            if(countSummary) countSummary.innerText = count;

            if (cart.length === 0) {
                container.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full text-center space-y-6 animate-in fade-in zoom-in duration-300">
                    <div class="w-32 h-32 bg-white rounded-full flex items-center justify-center mb-4 relative">
                        <div class="absolute inset-0 border-2 border-dashed border-stone-200 rounded-full animate-[spin_10s_linear_infinite]"></div>
                        <i data-lucide="shopping-bag" size="48" class="text-stone-300"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-xl text-stone-900 mb-2">ุณูุฉ ุงูุชุณูู ูุงุฑุบุฉ</h3>
                        <p class="text-stone-500 text-sm max-w-[200px] mx-auto">ูุจุฏู ุฃูู ูู ุชุถู ุฃู ููุชุฌุงุช ุจุนุฏ. ุชุตูุญ ุงููุชุฌุฑ ูุงูุชุดู ุฎูุงุฑุงุชูุง ุงููููุฒุฉ.</p>
                    </div>
                    <button onclick="toggleCart(false)" class="bg-stone-900 text-white px-8 py-3 rounded-xl font-bold hover:bg-stone-800 transition-all shadow-lg hover:-translate-y-0.5">
                        ุงุจุฏุฃ ุงูุชุณูู
                    </button>
                </div>`;
                footer.classList.add('hidden');
            } else {
                footer.classList.remove('hidden');
                // ูุณุชุฎุฏู map ูุน index ูุฃููุง ูุญุชุงุฌ ุงูู index ููุญุฐู ูุงูุชุนุฏูู ุงูุฏููู
                container.innerHTML = cart.map((item, index) => {
                    // ุชุญุฏูุฏ ุงูุตูุฑุฉ ุจูุงุกู ุนูู ุงูููู ุงููุฎุชุงุฑ
                    let displayImage = item.image;
                    if (item.selectedColor && item.variants) {
                        const variant = item.variants.find(v => v.color === item.selectedColor);
                        if (variant && variant.image) displayImage = variant.image;
                    }

                    return `
                    <div class="group flex gap-4 p-4 bg-white border border-stone-100 rounded-2xl hover:border-stone-300 hover:shadow-[0_4px_20px_-5px_rgba(0,0,0,0.05)] transition-all duration-300 relative overflow-hidden">
                        <!-- Image -->
                        <div class="h-24 w-24 flex-shrink-0 bg-white rounded-xl overflow-hidden border border-stone-100 relative">
                            <img src="${displayImage}" class="h-full w-full object-cover group-hover:scale-110 transition-transform duration-700">
                        </div>
                        
                        <!-- Content -->
                        <div class="flex-1 flex flex-col justify-between py-0.5">
                            <div>
                                <div class="flex justify-between items-start gap-2">
                                    <h3 class="font-bold text-stone-900 text-sm leading-snug line-clamp-2 hover:text-blue-600 transition-colors cursor-pointer" onclick="viewProduct('${item.id}'); toggleCart(false)">${item.name}</h3>
                                    <button onclick="removeFromCartByIndex(${index})" class="text-stone-300 hover:text-red-500 transition-colors p-1 -mt-1 -ml-1 rounded-full hover:bg-red-50"><i data-lucide="x" size="16"></i></button>
                                </div>
                                <p class="text-[10px] text-stone-400 mt-1 font-bold tracking-wider uppercase">${item.category}</p>
                                ${item.selectedColor ? `<p class="text-[10px] text-stone-500 mt-1 bg-white inline-block px-1.5 py-0.5 rounded border border-stone-100">ุงูููู: ${item.selectedColor}</p>` : ''}
                            </div>
                            
                            <!-- Controls -->
                            <div class="flex justify-between items-end mt-3">
                                <p class="text-base font-serif font-bold text-stone-900">$${item.price}</p>
                                
                                <div class="flex items-center gap-3 bg-white rounded-lg p-1 border border-stone-100">
                                    <button onclick="updateQuantityByIndex(${index}, -1)" class="w-7 h-7 flex items-center justify-center bg-white rounded-md shadow-sm hover:bg-stone-200 text-stone-600 transition-colors disabled:opacity-50 hover:text-stone-900"><i data-lucide="minus" size="14"></i></button>
                                    <span class="w-6 text-center text-sm font-bold text-stone-800 select-none">${item.quantity}</span>
                                    <button onclick="updateQuantityByIndex(${index}, 1)" class="w-7 h-7 flex items-center justify-center bg-white rounded-md shadow-sm hover:bg-stone-200 text-stone-600 transition-colors hover:text-stone-900"><i data-lucide="plus" size="14"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>`;
                }).join('');
            }
            lucide.createIcons();
        }

        function updateFavoritesUI() {
            // Simplified: Only update badge
            const badge = document.getElementById('fav-badge');
            if(badge) badge.classList.toggle('hidden', favorites.length === 0);
        }

        function updateMegaMenu() {
            const list = document.getElementById('mega-menu-categories-list');
            const popularList = document.getElementById('mega-menu-popular-list');
            const mobList = document.getElementById('mobile-cats-list');
            
            // 1. Update Sidebar List (Modern Hover Effect)
            if (list) {
                // Take first 6 categories for sidebar
                const visibleCats = CATEGORIES.slice(0, 6);
                
                list.innerHTML = visibleCats.map((cat) => {
                    const safeName = cat.name.replace(/'/g, "\\'");
                    return `
                    <li>
                        <button onclick="filterCategory('${safeName}')" class="group/item w-full flex items-center gap-4 p-3 rounded-2xl hover:bg-white hover:shadow-[0_4px_20px_-5px_rgba(0,0,0,0.05)] transition-all duration-300 border border-transparent hover:border-stone-100 text-right">
                            <div class="w-12 h-12 rounded-xl bg-white border border-stone-200 p-0.5 overflow-hidden flex-shrink-0 shadow-sm group-hover/item:scale-105 transition-transform">
                                <img src="${cat.image}" class="w-full h-full object-cover rounded-lg" onerror="this.style.display='none'">
                            </div>
                            <div class="flex-1">
                                <span class="block font-bold text-stone-700 text-sm group-hover/item:text-stone-900 transition-colors truncate">${cat.name}</span>
                                <span class="text-[10px] text-stone-400 group-hover/item:text-blue-500 transition-colors font-medium">ุชุตูุญ ุงููุฌููุนุฉ</span>
                            </div>
                            <i data-lucide="chevron-left" size="16" class="text-stone-300 opacity-0 -translate-x-2 group-hover/item:opacity-100 group-hover/item:translate-x-0 transition-all"></i>
                        </button>
                    </li>
                    `;
                }).join('');
            }

            // 2. Update Popular Grid (Visual Cards - Clean & Modern)
            if (popularList) {
                // Take 3 main categories for the large grid
                const popularCats = CATEGORIES.slice(0, 3); 
                
                if (popularCats.length === 0) {
                    popularList.innerHTML = `<div class="col-span-3 flex flex-col items-center justify-center text-stone-400 h-full bg-stone-50/50 rounded-3xl border-2 border-dashed border-stone-200"><i data-lucide="folder-open" size="40" class="mb-3 opacity-50"></i><p class="text-sm font-bold">ูุง ุชูุฌุฏ ุฃูุณุงู ููุนุฑุถ</p></div>`;
                } else {
                    popularList.innerHTML = popularCats.map((cat, index) => `
                        <div onclick="filterCategory('${cat.name.replace(/'/g, "\\'")}')" class="group relative h-full rounded-[2rem] overflow-hidden cursor-pointer shadow-sm hover:shadow-2xl hover:shadow-stone-200/50 transition-all duration-500 border border-stone-100 bg-stone-100">
                            <img src="${cat.image}" class="absolute inset-0 w-full h-full object-cover transition-transform duration-1000 group-hover:scale-110" loading="lazy">
                            
                            <!-- Premium Gradient Overlay -->
                            <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent opacity-60 group-hover:opacity-50 transition-opacity duration-500"></div>
                            
                            <!-- Floating Content -->
                            <div class="absolute bottom-0 left-0 w-full p-6 translate-y-2 group-hover:translate-y-0 transition-transform duration-500">
                                <div class="bg-white/10 backdrop-blur-md border border-white/20 p-4 rounded-2xl overflow-hidden relative group-hover:bg-white/20 transition-colors">
                                    <!-- Decorative Shape -->
                                    <div class="absolute top-0 right-0 w-12 h-12 bg-white/10 rounded-bl-full -mr-4 -mt-4 blur-sm"></div>
                                    
                                    <h4 class="text-white font-bold text-xl mb-1 relative z-10">${cat.name}</h4>
                                    
                                    <div class="flex items-center gap-2 text-white/90 text-xs font-bold opacity-0 group-hover:opacity-100 transition-all duration-500 delay-75 transform translate-y-2 group-hover:translate-y-0">
                                        <span>ุงูุชุดู ุงููุฒูุฏ</span>
                                        <div class="bg-white text-stone-900 rounded-full p-0.5"><i data-lucide="arrow-left" size="10"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('');
                }
            }
            
            // 3. Update Mobile List (No Change)
            if (mobList) {
                // ... existing mobile code ...
                mobList.innerHTML = CATEGORIES.map(cat => `
                    <button onclick="filterCategory('${cat.name.replace(/'/g, "\\'")}')" class="w-full py-3 text-center text-sm text-stone-600 hover:bg-white flex items-center justify-center gap-3 border-b border-stone-50 last:border-none">
                        <img src="${cat.image}" class="w-8 h-8 rounded-lg object-cover border border-stone-200 shadow-sm">
                        ${cat.name}
                    </button>
                `).join('');
            }
            lucide.createIcons();
        }

        function applyShopFilters() {
            const grid = document.getElementById('shop-products-grid');
            const empty = document.getElementById('shop-empty-state');
            const count = document.getElementById('results-count');
            
            if (!grid) return;

            let filtered = PRODUCTS.filter(p => {
                const s = shopState.search;
                const matchesSearch = p.name.toLowerCase().includes(s) || (p.description && p.description.toLowerCase().includes(s));
                const matchesCat = shopState.categories.length === 0 || shopState.categories.includes(p.category);
                const matchesPrice = p.price >= shopState.priceMin && p.price <= shopState.priceMax;
                return matchesSearch && matchesCat && matchesPrice;
            });

            if (shopState.sort === 'price-low') filtered.sort((a, b) => a.price - b.price);
            else if (shopState.sort === 'price-high') filtered.sort((a, b) => b.price - a.price);
            else if (shopState.sort === 'newest') filtered.reverse();

            if (count) count.innerText = `ุงููุชุงุฆุฌ: ${filtered.length}`;
            
            if (filtered.length === 0) {
                grid.innerHTML = '';
                if(empty) empty.classList.remove('hidden');
            } else {
                if(empty) empty.classList.add('hidden');
                grid.innerHTML = filtered.map(p => createProductCard(p)).join('');
            }
            lucide.createIcons();
        }

        // --- Render Views ---
        function renderView() {
            const main = document.getElementById('main-content');
            main.innerHTML = '';
            
            // NEW: ุงูุชุญูู ูู ุธููุฑ ุงูุจุงูุฑ ุงูุนููู ุญุณุจ ุงูุตูุญุฉ
            const banner = document.getElementById('header-banner-container');
            if (banner) {
                if (currentView === 'home' && HERO_SETTINGS.showFooterBanner && HERO_SETTINGS.footerBannerUrl) {
                    banner.classList.remove('hidden');
                } else {
                    banner.classList.add('hidden');
                }
            }
            
            if (currentView === 'home') {
                renderHero(main); 
                renderCategoryBar(main); 
                renderFeatured(main);
                renderCategorySections(main); 
                renderRealWorkSection(main); // ๐ ุชูุช ุฅุถุงูุฉ ูุณู ุฃุนูุงููุง ูู ุฃุฑุถ ุงููุงูุน
                renderReviewsSection(main); // 1๏ธโฃ Add Reviews to Home
            } else if (currentView === 'shop') {
                renderShop(main);
            } else if (currentView === 'offers') { 
                renderOffers(main);
            } else if (currentView === 'categories') {
                renderCategoriesView(main);
            } else if (currentView === 'about') {
                renderAbout(main);
            } else if (currentView === 'contact') {
                renderContact(main);
            } else if (currentView === 'return-policy') {
                renderReturnPolicy(main);
            } else if (currentView === 'faq') { 
                renderFAQ(main);
            } else if (currentView === 'product-details') {
                renderProductDetails(main);
            } else if (currentView === 'admin') {
                renderAdmin(main);
            } else if (currentView === 'orders') {
                renderOrders(main);
            } else if (currentView === 'login') {
                renderLogin(main);
            } else if (currentView === 'track-order') {
                renderTrackOrder(main);
            } else if (currentView === 'favorites') {
                renderFavoritesPage(main);
            }
            lucide.createIcons();
        }

        // --- NEW: Render Reviews Section (Customer Trust) ---
        function renderReviewsSection(c) {
            // ุชุตููุฉ ุงููุฑุงุฌุนุงุช ุงููุนุชูุฏุฉ ูุงูุชู ููุง ุชูููู ุนุงูู (4 ุฃู 5 ูุฌูู)
            // ุฒูุงุฏุฉ ุงูุนุฏุฏ ููุนุฑุถ ูู ุงูุณูุงูุฏุฑ
            const validReviews = ALL_REVIEWS.filter(r => r.status === 'approved' && r.rating >= 4).slice(0, 15);
            
            if (validReviews.length === 0) return;

            c.innerHTML += `
            <div class="py-16 bg-white border-t border-stone-100 relative group/reviews">
                <div class="container mx-auto px-6">
                    <div class="flex justify-between items-end mb-10 fade-in-up">
                        <div>
                            <span class="inline-block p-2 rounded-xl bg-yellow-50 text-yellow-600 mb-3 border border-yellow-100 shadow-sm"><i data-lucide="message-square-heart" size="24"></i></span>
                            <h3 class="text-3xl font-bold text-stone-900 mb-2">ุขุฑุงุก ุนููุงุฆูุง</h3>
                            <p class="text-stone-500">ูุนุชุฒ ุจุซูุฉ ุนููุงุฆูุง ูุชุฌุงุฑุจูู ุงููููุฒุฉ ูุน ุฌุฏุงุฑ ููุฏูููุฑ</p>
                        </div>
                        
                        <!-- Navigation Buttons -->
                        <div class="flex gap-2">
                            <!-- ุฒุฑ ุงูุชุงูู (ูุณุงุฑ ูู ุงูุนุฑุจูุฉ) -->
                            <button onclick="document.getElementById('reviews-slider').scrollBy({ left: -320, behavior: 'smooth' })" class="w-10 h-10 border border-stone-200 rounded-full hover:bg-stone-900 hover:text-white hover:border-stone-900 transition-all flex items-center justify-center text-stone-600 shadow-sm"><i data-lucide="arrow-left" size="20"></i></button>
                            <!-- ุฒุฑ ุงูุณุงุจู (ูููู ูู ุงูุนุฑุจูุฉ) -->
                            <button onclick="document.getElementById('reviews-slider').scrollBy({ left: 320, behavior: 'smooth' })" class="w-10 h-10 border border-stone-200 rounded-full hover:bg-stone-900 hover:text-white hover:border-stone-900 transition-all flex items-center justify-center text-stone-600 shadow-sm"><i data-lucide="arrow-right" size="20"></i></button>
                        </div>
                    </div>

                    <!-- Slider Container (Horizontal Scroll) -->
                    <div id="reviews-slider" class="flex gap-5 overflow-x-auto scrollbar-hide snap-x scroll-smooth pb-6 px-1" onmouseenter="stopAutoScroll('reviews-slider')" onmouseleave="startAutoScroll('reviews-slider')">
                        ${validReviews.map((r, i) => `
                            <!-- Fixed Width Card -->
                            <div class="min-w-[300px] md:min-w-[360px] snap-start bg-white p-6 rounded-3xl border border-stone-100 shadow-sm hover:shadow-lg hover:-translate-y-1 transition-all duration-300 relative flex flex-col h-full group/card">
                                <div class="absolute top-6 left-6 text-stone-200 group-hover/card:text-yellow-100 transition-colors">
                                    <i data-lucide="quote" size="40"></i>
                                </div>
                                <div class="flex items-center gap-1 text-yellow-400 mb-4 relative z-10">
                                    ${Array(r.rating).fill('<i data-lucide="star" class="w-4 h-4 fill-current"></i>').join('')}
                                </div>
                                <p class="text-stone-700 text-sm leading-relaxed mb-6 relative z-10 font-medium flex-1 line-clamp-4">"${r.comment}"</p>
                                <div class="flex items-center gap-3 border-t border-stone-50 pt-4 relative z-10 mt-auto">
                                    <div class="w-12 h-12 rounded-full bg-stone-100 flex items-center justify-center text-stone-500 font-bold text-lg border-2 border-white shadow-sm">${r.userName.charAt(0)}</div>
                                    <div>
                                        <p class="text-sm font-bold text-stone-900">${r.userName}</p>
                                        <p class="text-[10px] text-stone-400 dir-ltr text-right">${new Date(r.createdAt).toLocaleDateString('ar-EG')}</p>
                                    </div>
                                    ${r.verified ? `<div class="mr-auto text-blue-500 bg-blue-50 px-2 py-1 rounded-full text-[10px] font-bold flex items-center gap-1" title="ุดุฑุงุก ุชู ุงูุชุญูู ููู"><i data-lucide="badge-check" size="14"></i> ุดุฑุงุก ูุคูุฏ</div>` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>`;
            
            // ุชุดุบูู ุงูุญุฑูุฉ ุงูุชููุงุฆูุฉ ููุณูุงูุฏุฑ ุจุนุฏ ุซุงููุฉ
            setTimeout(() => startAutoScroll('reviews-slider'), 1000);
        }

        // --- NEW: Render Real Work Section (ุฃุนูุงููุง ูู ุฃุฑุถ ุงููุงูุน) ---
        function renderRealWorkSection(c) {
            // ุงูุชุญูู ูู ุตูุงุญูุฉ ุงููุฏูุฑ
            const isAdmin = user && user.email === ADMIN_EMAIL;
            
            // ุชุญุฏูุฏ ุงูุตูุฑ ุงูุชู ุณูุชู ุนุฑุถูุง ุจูุงุกู ุนูู Limit
            const visibleWorks = REAL_WORKS.slice(0, realWorkLimit);
            const hasMore = REAL_WORKS.length > realWorkLimit;

            c.innerHTML += `
            <div class="py-20 bg-white border-t border-stone-200 relative overflow-hidden">
                <!-- Decoration Background -->
                <div class="absolute top-0 left-0 w-96 h-96 bg-stone-100 rounded-full blur-3xl -ml-20 -mt-20 pointer-events-none"></div>
                <div class="absolute bottom-0 right-0 w-64 h-64 bg-stone-100 rounded-full blur-3xl -mr-10 -mb-10 pointer-events-none"></div>
                
                <div class="container mx-auto px-6 relative z-10">
                    <div class="flex flex-col md:flex-row justify-between items-end mb-12 fade-in-up">
                        <div class="text-center md:text-right w-full md:w-auto">
                            <span class="inline-block p-3 rounded-2xl bg-stone-50 text-stone-800 mb-4 shadow-sm border border-stone-100"><i data-lucide="camera" size="28"></i></span>
                            <h3 class="text-3xl md:text-4xl font-black text-stone-900 mb-3 tracking-tight">ุฃุนูุงููุง ูู ุฃุฑุถ ุงููุงูุน</h3>
                            <p class="text-stone-500 font-medium text-lg max-w-xl">ููุณุงุช ูููุฉ ููุฐูุงูุง ูุนููุงุฆูุง ุจูู ุฏูุฉ ูุงุญุชุฑุงููุฉ.</p>
                        </div>
                        
                        <!-- ๐ Admin Add Button (Opens Custom Modal) -->
                        ${isAdmin ? `
                        <button onclick="toggleAddWorkModal(true)" class="mt-4 md:mt-0 flex items-center gap-2 bg-stone-900 text-white px-6 py-3 rounded-xl font-bold hover:bg-stone-800 transition-all shadow-lg hover:-translate-y-1">
                            <i data-lucide="image-plus" size="18"></i> ุฅุถุงูุฉ ุตูุฑุฉ/ููุฏูู
                        </button>
                        ` : ''}
                    </div>
                    
                    <!-- ุชู ุฅุถุงูุฉ id ููุดุจูุฉ ููุณูู ุงูุฅุถุงูุฉ ุฅูููุง -->
                    <div id="real-work-grid" class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6">
                        ${visibleWorks.map((itemUrl, i) => {
                            // Check if YouTube
                            const ytId = getYouTubeID(itemUrl);
                            const isVideo = !!ytId;
                            // Thumbnail: YouTube HQ or Original Image
                            const displayImg = isVideo ? `https://img.youtube.com/vi/${ytId}/hqdefault.jpg` : itemUrl;

                            return `
                            <div onclick="openLightbox(${i})" class="group relative aspect-[3/4] rounded-3xl overflow-hidden cursor-pointer shadow-md hover:shadow-2xl hover:shadow-stone-900/20 transition-all duration-500 fade-in-up border border-stone-100 bg-stone-50" style="animation-delay: ${i * 0.1}s">
                                <img src="${displayImg}" class="w-full h-full object-cover transition-transform duration-1000 group-hover:scale-110" loading="lazy" alt="ุชูููุฐ ูุงูุนู">
                                
                                <!-- Gradient Overlay -->
                                <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent opacity-60 group-hover:opacity-40 transition-opacity duration-500"></div>
                                
                                <!-- Play Icon / Zoom Icon -->
                                <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                                    ${isVideo 
                                        ? `<div class="w-14 h-14 bg-white/90 backdrop-blur-sm rounded-full flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform"><i data-lucide="play" class="ml-1 fill-stone-900 text-stone-900" size="24"></i></div>`
                                        : `<div class="absolute bottom-4 right-4 translate-y-4 opacity-0 group-hover:translate-y-0 group-hover:opacity-100 transition-all duration-500 delay-100">
                                            <div class="w-10 h-10 bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center text-white border border-white/30 shadow-lg">
                                                <i data-lucide="zoom-in" size="18"></i>
                                            </div>
                                           </div>`
                                    }
                                </div>

                                ${isAdmin ? `
                                <button onclick="event.stopPropagation(); handleDeleteRealWorkImage(${i})" class="absolute top-3 left-3 w-8 h-8 bg-red-500 text-white rounded-full flex items-center justify-center shadow-lg hover:bg-red-600 transition-all z-20">
                                    <i data-lucide="trash-2" size="14"></i>
                                </button>
                                ` : ''}
                            </div>
                        `;}).join('')}
                    </div>
                    
                    <!-- ๐ ุฒุฑ ุนุฑุถ ุงููุฒูุฏ -->
                    <div id="load-more-container" class="mt-10 text-center ${!hasMore ? 'hidden' : ''}">
                        <button onclick="loadMoreRealWorks()" class="bg-white border-2 border-stone-200 text-stone-600 hover:bg-stone-900 hover:text-white hover:border-stone-900 px-8 py-3 rounded-full font-bold transition-all shadow-sm flex items-center gap-2 mx-auto group">
                            <span>ุนุฑุถ ุตูุฑ ุฃูุซุฑ</span>
                            <i data-lucide="chevron-down" size="18" class="group-hover:translate-y-1 transition-transform"></i>
                        </button>
                    </div>
                    
                    <div class="mt-14 flex flex-wrap justify-center gap-4 fade-in-up" style="animation-delay: 0.3s;">
                        <a href="https://www.facebook.com/gedar.fayoum" target="_blank" class="inline-flex items-center gap-3 text-stone-900 font-bold hover:text-white hover:bg-[#1877F2] transition-all bg-white px-6 py-4 rounded-full shadow-lg hover:shadow-xl border border-stone-100 group transform hover:-translate-y-1">
                            <i data-lucide="facebook" size="20" class="group-hover:text-white transition-colors text-[#1877F2]"></i>
                            <span>ุดุงูุฏ ุงููุฒูุฏ ุนูู ููุณุจูู</span>
                        </a>
                        
                        <a href="https://www.instagram.com/gedar_fayoum" target="_blank" class="inline-flex items-center gap-3 text-stone-900 font-bold hover:text-white hover:bg-[#E4405F] transition-all bg-white px-6 py-4 rounded-full shadow-lg hover:shadow-xl border border-stone-100 group transform hover:-translate-y-1">
                            <i data-lucide="instagram" size="20" class="group-hover:text-white transition-colors text-[#E4405F]"></i>
                            <span>ุดุงูุฏ ุงููุฒูุฏ ุนูู ุงูุณุชุฌุฑุงู</span>
                        </a>
                    </div>

                    <!-- ๐ ุฒุฑ ุงูุงุณุชุดุงุฑุฉ (Call to Action) -->
                    <div class="mt-10 text-center fade-in-up" style="animation-delay: 0.4s;">
                        <p class="text-xs font-bold text-stone-400 mb-3 uppercase tracking-wider">ูู ูุฏูู ููุฑุฉ ูุดุฑูุนุ</p>
                        <a href="https://wa.me/201014175070?text=${encodeURIComponent('ูุฑุญุจุงูุ ุฃุนุฌุจุชูู ุฃุนูุงููู ูุฃุฑุบุจ ูู ุทูุจ ุงุณุชุดุงุฑุฉ ุจุฎุตูุต ุฏูููุฑ ููุฒูู')}" target="_blank" class="inline-flex items-center gap-3 bg-stone-900 hover:bg-stone-800 text-white px-10 py-4 rounded-full font-bold shadow-xl hover:shadow-2xl hover:-translate-y-1 transition-all group border border-stone-700/20 relative overflow-hidden">
                            <!-- ููุนุฉ ุฎูููุฉ -->
                            <div class="absolute inset-0 bg-white/10 translate-y-full group-hover:translate-y-0 transition-transform duration-300"></div>
                            
                            <span class="bg-white/20 p-1.5 rounded-full group-hover:bg-white/30 transition-colors relative z-10"><i data-lucide="sparkles" size="18"></i></span>
                            <span class="relative z-10">ุงุทูุจ ุงุณุชุดุงุฑุชู ุงูุขู</span>
                        </a>
                    </div>

                </div>
            </div>`;
            lucide.createIcons();
        }

        // ๐ ุฏุงูุฉ ุชุญููู ุงููุฒูุฏ ูู ุงูุตูุฑ (ูุญุฏุซุฉ ูุฏุนู ุงูููุฏูู)
        window.loadMoreRealWorks = () => {
            const start = realWorkLimit;
            const end = start + 4;
            const newItems = REAL_WORKS.slice(start, end);
            const isAdmin = user && user.email === ADMIN_EMAIL;
            
            if(newItems.length === 0) return;
            
            realWorkLimit += newItems.length;
            
            const html = newItems.map((itemUrl, i) => {
                const absoluteIndex = start + i;
                const ytId = getYouTubeID(itemUrl);
                const isVideo = !!ytId;
                const displayImg = isVideo ? `https://img.youtube.com/vi/${ytId}/hqdefault.jpg` : itemUrl;

                return `
                <div onclick="openLightbox(${absoluteIndex})" class="group relative aspect-[3/4] rounded-3xl overflow-hidden cursor-pointer shadow-md hover:shadow-2xl hover:shadow-stone-900/20 transition-all duration-500 fade-in-up border border-stone-200 bg-stone-100">
                    <img src="${displayImg}" class="w-full h-full object-cover transition-transform duration-1000 group-hover:scale-110" loading="lazy" alt="ุชูููุฐ ูุงูุนู">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent opacity-60 group-hover:opacity-40 transition-opacity duration-500"></div>
                    
                    <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                        ${isVideo 
                            ? `<div class="w-14 h-14 bg-white/90 backdrop-blur-sm rounded-full flex items-center justify-center shadow-lg"><i data-lucide="play" class="ml-1 fill-stone-900 text-stone-900" size="24"></i></div>`
                            : `<div class="absolute bottom-4 right-4 translate-y-4 opacity-0 group-hover:translate-y-0 group-hover:opacity-100 transition-all duration-500 delay-100">
                                <div class="w-10 h-10 bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center text-white border border-white/30 shadow-lg">
                                    <i data-lucide="zoom-in" size="18"></i>
                                </div>
                               </div>`
                        }
                    </div>

                    ${isAdmin ? `
                    <button onclick="event.stopPropagation(); handleDeleteRealWorkImage(${absoluteIndex})" class="absolute top-3 left-3 w-8 h-8 bg-red-500 text-white rounded-full flex items-center justify-center shadow-lg hover:bg-red-600 transition-all z-20">
                        <i data-lucide="trash-2" size="14"></i>
                    </button>
                    ` : ''}
                </div>`;
            }).join('');
            
            // ุฅุถุงูุฉ ุงูุนูุงุตุฑ ุงูุฌุฏูุฏุฉ ููุดุจูุฉ
            document.getElementById('real-work-grid').insertAdjacentHTML('beforeend', html);
            lucide.createIcons();
            
            // ุฅุฎูุงุก ุงูุฒุฑ ุฅุฐุง ุงูุชูุช ุงูุตูุฑ
            if (realWorkLimit >= REAL_WORKS.length) {
                document.getElementById('load-more-container').style.display = 'none';
            }
        };

        // ๐ ุฅุฏุงุฑุฉ ูุงูุฐุฉ ุฅุถุงูุฉ ุงูุฃุนูุงู
        window.toggleAddWorkModal = (show) => {
            const backdrop = document.getElementById('add-work-modal-backdrop');
            const modal = document.getElementById('add-work-modal');
            
            if (show) {
                backdrop.classList.remove('opacity-0', 'pointer-events-none');
                modal.classList.remove('opacity-0', 'pointer-events-none', 'scale-95');
                modal.classList.add('scale-100');
            } else {
                backdrop.classList.add('opacity-0', 'pointer-events-none');
                modal.classList.add('opacity-0', 'pointer-events-none', 'scale-95');
                modal.classList.remove('scale-100');
            }
            lucide.createIcons();
        };

        // ๐ ุชูุฏูู ุฑุงุจุท ุฌุฏูุฏ (ุตูุฑุฉ ุฃู ููุฏูู)
        window.handleSubmitRealWork = async (e) => {
            e.preventDefault();
            if (!user || user.email !== ADMIN_EMAIL) return showToast("ุบูุฑ ูุตุฑุญ");
            
            const url = e.target.workUrl.value.trim();
            if (!url) return;
            
            try {
                // ุฅุถุงูุฉ ุงูุตูุฑุฉ ูู ุจุฏุงูุฉ ุงููุตูููุฉ
                const newImages = [url, ...REAL_WORKS];
                await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'metadata', 'realwork'), { images: newImages });
                
                showToast("โ ุชูุช ุงูุฅุถุงูุฉ ุจูุฌุงุญ");
                toggleAddWorkModal(false);
                e.target.reset();
            } catch(e) {
                console.error(e);
                showToast("โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุญูุธ");
            }
        };

        // Old handle function kept for compatibility but updated to use modal if called without args (optional)
        // We replaced the call in HTML to toggleAddWorkModal, so this is just cleaning up.
        window.handleAddRealWorkImage = () => toggleAddWorkModal(true);

        window.handleDeleteRealWorkImage = async (index) => {
            if (!user || user.email !== ADMIN_EMAIL) return showToast("ุบูุฑ ูุตุฑุญ");
            if (!confirm("ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐู ุงูุตูุฑุฉ ูู ุงููุนุฑุถุ")) return;
            
            try {
                const newImages = [...REAL_WORKS];
                newImages.splice(index, 1);
                await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'metadata', 'realwork'), { images: newImages });
                showToast("๐๏ธ ุชู ุญุฐู ุงูุตูุฑุฉ");
            } catch(e) {
                console.error(e);
                showToast("โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุญุฐู");
            }
        };

        // NEW: Render Offers Page
        function renderOffers(c) {
            const now = Date.now();
            let timedOffers = PRODUCTS.filter(p => p.discount > 0 && p.discountExpiry && p.discountExpiry > now);
            let untimedOffers = PRODUCTS.filter(p => p.discount > 0 && !p.discountExpiry);
            
            // Sort timed offers by expiry (soonest first)
            timedOffers.sort((a, b) => a.discountExpiry - b.discountExpiry);
            
            const allOffers = [...timedOffers, ...untimedOffers];

            c.innerHTML = `
            <!-- ุชู ุชุนุฏูู pt-28 ุฅูู pt-40 ูููุงุชู ูููุน ุงุฎุชูุงุก ุงููุญุชูู ุชุญุช ุงูููุฏุฑ -->
            <!-- UPDATED: Increased desktop padding from md:pt-24 to md:pt-44 -->
            <div class="pt-40 md:pt-44 pb-20 min-h-screen bg-red-50/30">
                <div class="container mx-auto px-2 md:px-6">
                    <div class="text-center mb-8 fade-in-up">
                        <span class="inline-block p-2 rounded-2xl bg-red-100 text-red-600 mb-2 shadow-sm border border-red-200 animate-pulse"><i data-lucide="timer" size="24"></i></span>
                        <h1 class="text-2xl md:text-4xl font-bold text-stone-900 mb-2">ุงูุนุฑูุถ ุงูุฎุงุทูุฉ</h1>
                        <p class="text-stone-500 text-xs md:text-lg">ุงุบุชูู ุงููุฑุตุฉ! ุฎุตููุงุช ุญุตุฑูุฉ ููุชุฑุฉ ูุญุฏูุฏุฉ.</p>
                    </div>

                    ${allOffers.length === 0 ? `
                        <div class="text-center py-20 bg-white rounded-3xl shadow-sm border border-stone-100 max-w-2xl mx-auto fade-in-up">
                            <div class="w-24 h-24 bg-stone-100 text-stone-300 rounded-full flex items-center justify-center mx-auto mb-6">
                                <i data-lucide="tag" size="40"></i>
                            </div>
                            <h3 class="text-xl font-bold text-stone-900 mb-2">ูุง ุชูุฌุฏ ุนุฑูุถ ูุดุทุฉ ุญุงููุงู</h3>
                            <p class="text-stone-500 mb-8">ุชุงุจุนูุง ูุฑูุจุงู ููุญุตูู ุนูู ุฃููู ุงูุฎุตููุงุช.</p>
                            <button onclick="setView('shop')" class="bg-stone-900 text-white px-8 py-3.5 rounded-xl font-bold hover:bg-stone-800 transition-all">ุชุตูุญ ูู ุงูููุชุฌุงุช</button>
                        </div>
                    ` : `
                        <!-- Updated Grid: 3 columns on mobile with very small gap -->
                        <div class="grid grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-1.5 md:gap-4 fade-in-up" style="animation-delay: 0.1s;">
                            ${allOffers.map(p => {
                                // ุงุณุชุฎุฏุงู ุจุทุงูุฉ ุงูููุชุฌ ุงููุญุณูุฉ (ุงูููุฌูุฏุฉ ุจุงูุฃุณูู) ุฃู ุจูุงุก ุจุทุงูุฉ ูุฎุตุตุฉ ููุนุฑูุถ ููุง
                                const finalPrice = (p.price * (1 - p.discount / 100)).toFixed(0); // ุฅุฒุงูุฉ ุงููุณูุฑ ููููุจุงูู
                                return `
                                <div class="group bg-white rounded-xl border border-red-100 overflow-hidden hover:shadow-lg hover:border-red-200 transition-all h-full flex flex-col relative" onclick="viewProduct('${p.id}')">
                                    
                                    <!-- Discount Badge (Compact) -->
                                    <div class="absolute top-1 right-1 z-10">
                                        <div class="bg-red-600 text-white text-[8px] md:text-[10px] font-bold px-1.5 py-0.5 rounded shadow-sm">
                                            -${p.discount}%
                                        </div>
                                    </div>

                                    <!-- Image -->
                                    <div class="relative aspect-[4/5] overflow-hidden bg-stone-100">
                                        <img src="${p.image}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700">
                                        
                                        <!-- Countdown Overlay (Mobile Optimized) -->
                                        ${p.discountExpiry ? `
                                        <div class="absolute bottom-0 left-0 w-full bg-white/95 backdrop-blur-sm p-0.5 border-t border-red-100 flex flex-col items-center justify-center">
                                            <div class="discount-timer scale-75 origin-center" data-expiry="${p.discountExpiry}"></div>
                                        </div>` : ''}
                                    </div>

                                    <div class="p-2 flex-1 flex flex-col gap-1">
                                        <h3 class="font-bold text-stone-900 text-[10px] md:text-sm leading-tight line-clamp-2 h-7 md:h-auto group-hover:text-red-600 transition-colors">${p.name}</h3>
                                        
                                        <div class="mt-auto pt-1">
                                            <div class="flex flex-col md:flex-row md:items-center md:gap-1.5 mb-1.5">
                                                <span class="text-sm md:text-xl font-serif text-red-600 font-bold leading-none">${finalPrice}<span class="text-[8px] mr-0.5">ุฌ.ู</span></span>
                                                <span class="text-[9px] md:text-xs text-stone-400 line-through decoration-red-200">${Math.floor(p.price)}</span>
                                            </div>
                                            
                                            <button onclick="event.stopPropagation(); addToCart('${p.id}')" class="w-full bg-red-600 hover:bg-red-700 text-white py-1.5 md:py-2.5 rounded-lg font-bold shadow-sm transition-colors flex items-center justify-center gap-1 text-[9px] md:text-xs">
                                                <i data-lucide="shopping-bag" size="12"></i> <span class="hidden md:inline">ุฅูุญู ุงูุนุฑุถ</span><span class="md:hidden">ุฃุถู</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>`;
                            }).join('')}
                        </div>
                    `}
                </div>
            </div>`;
            
            startCountdown();
            lucide.createIcons();
        }

        // NEW: Render Favorites Page (Full Screen)
        function renderFavoritesPage(c) {
            const favItems = PRODUCTS.filter(p => favorites.includes(p.id));

            c.innerHTML = `
            <!-- ุชู ุชุนุฏูู pt-32 ุฅูู pt-28 -->
            <div class="pt-28 md:pt-24 pb-20 min-h-screen bg-white">
                <div class="container mx-auto px-6">
                    <div class="text-center mb-12 fade-in-up">
                        <div class="w-16 h-16 bg-red-50 text-red-500 rounded-full flex items-center justify-center mx-auto mb-4 shadow-sm border border-red-100">
                            <i data-lucide="heart" size="32" class="fill-current"></i>
                        </div>
                        <h1 class="text-3xl md:text-4xl font-bold text-stone-900 mb-3">ูุงุฆูุฉ ุงูุฃูููุงุช</h1>
                        <p class="text-stone-500 font-medium">ุงูููุชุฌุงุช ุงูุชู ุญูุธุชูุง ููุฑุฌูุน ุฅูููุง ูุงุญูุงู (${favItems.length})</p>
                    </div>

                    ${favItems.length === 0 ? `
                        <div class="max-w-md mx-auto text-center py-16 bg-white rounded-3xl shadow-sm border border-stone-100 fade-in-up" style="animation-delay: 0.1s;">
                            <div class="w-24 h-24 bg-white text-stone-300 rounded-full flex items-center justify-center mx-auto mb-6">
                                <i data-lucide="heart-off" size="40"></i>
                            </div>
                            <h3 class="text-xl font-bold text-stone-900 mb-2">ุงููุงุฆูุฉ ูุงุฑุบุฉ ุญุงููุงู</h3>
                            <p class="text-stone-500 mb-8 px-6 leading-relaxed">ูู ุชูู ุจุฅุถุงูุฉ ุฃู ููุชุฌุงุช ุฅูู ุงูููุถูุฉ ุจุนุฏ. ุชุตูุญ ุงููุชุฌุฑ ูุงุถุบุท ุนูู ุฃููููุฉ ุงูููุจ ูุญูุธ ูุง ูุนุฌุจู.</p>
                            <button onclick="viewAllProducts()" class="bg-stone-900 text-white px-8 py-3.5 rounded-xl font-bold hover:bg-stone-800 transition-all shadow-lg hover:shadow-xl hover:-translate-y-0.5 flex items-center gap-2 mx-auto">
                                <span>ุชุตูุญ ุงูููุชุฌุงุช</span>
                                <i data-lucide="arrow-left" size="18"></i>
                            </button>
                        </div>
                    ` : `
                        <!-- Updated Grid: 3 columns on mobile -->
                        <div class="grid grid-cols-3 sm:grid-cols-3 lg:grid-cols-3 xl:grid-cols-4 gap-2 md:gap-6 fade-in-up" style="animation-delay: 0.1s;">
                            ${favItems.map(p => createProductCard(p)).join('')}
                        </div>
                        
                        <div class="mt-16 text-center fade-in-up" style="animation-delay: 0.2s;">
                            <button onclick="viewAllProducts()" class="inline-flex items-center gap-2 text-stone-500 font-bold hover:text-stone-900 transition-colors">
                                <i data-lucide="arrow-right" size="18"></i>
                                <span>ูุชุงุจุนุฉ ุงูุชุณูู</span>
                            </button>
                        </div>
                    `}
                </div>
            </div>`;
        }

        // NEW: Track Order Page
        function renderTrackOrder(c) {
            c.innerHTML = `
            <!-- ุชู ุชุญุฏูุซ ุงูุชุตููู ุจุงููุงูู ููููู ุนุตุฑูุงู -->
            <div class="min-h-screen bg-stone-50/50 pt-40 md:pt-32 pb-20 relative overflow-hidden">
                <!-- Background Decoration -->
                <div class="absolute top-0 left-1/2 -translate-x-1/2 w-full h-[500px] bg-gradient-to-b from-blue-50/50 to-transparent pointer-events-none -z-10"></div>
                <div class="absolute top-20 right-0 w-64 h-64 bg-orange-100/40 rounded-full blur-3xl -z-10"></div>
                <div class="absolute bottom-0 left-0 w-96 h-96 bg-blue-100/40 rounded-full blur-3xl -z-10"></div>

                <div class="container mx-auto px-4 md:px-6 relative z-10">
                    
                    <!-- Modern Header Section -->
                    <div class="max-w-3xl mx-auto text-center mb-10 fade-in-up">
                        <div class="inline-flex items-center justify-center p-3 mb-6 bg-white rounded-2xl shadow-lg shadow-blue-100/50 border border-blue-50">
                            <div class="bg-blue-600 text-white p-2.5 rounded-xl">
                                <i data-lucide="package-search" size="28"></i>
                            </div>
                        </div>
                        <h1 class="text-3xl md:text-5xl font-black text-stone-900 mb-4 tracking-tight">ุชุชุจุน ุฑุญูุฉ ุทูุจู</h1>
                        <p class="text-stone-500 text-sm md:text-lg max-w-lg mx-auto leading-relaxed font-medium">ุฃุฏุฎู ุฑูู ุงูุดุญูุฉ ุฃู ุฑูู ุงูุทูุจ ูู ุงูุฃุณูู ููุนุฑูุฉ ุญุงูุฉ ุงูุชูุตูู ูููุนุฏ ุงููุตูู ุงููุชููุน.</p>
                    </div>

                    <!-- Search Box Card -->
                    <div class="max-w-2xl mx-auto fade-in-up" style="animation-delay: 0.1s;">
                        <div class="bg-white p-2 md:p-3 rounded-[2rem] shadow-xl shadow-stone-200/40 border border-stone-100 relative group transition-all hover:shadow-2xl hover:shadow-blue-200/20 focus-within:shadow-2xl focus-within:shadow-blue-200/20 focus-within:border-blue-200">
                            <form onsubmit="handleTrackOrderSearch(event)" class="relative flex items-center">
                                <div class="absolute right-4 text-stone-400 group-focus-within:text-blue-600 transition-colors">
                                    <i data-lucide="hash" size="20"></i>
                                </div>
                                <input 
                                    name="orderId" 
                                    required 
                                    class="w-full h-14 md:h-16 pr-12 pl-16 bg-transparent border-none outline-none text-lg md:text-xl font-bold text-stone-800 placeholder:text-stone-300 placeholder:font-medium tracking-wide text-center md:text-right transition-all font-mono" 
                                    placeholder="ุฑูู ุงูุทูุจ"
                                    autocomplete="off"
                                >
                                <button type="submit" class="absolute left-2 top-1/2 -translate-y-1/2 h-10 md:h-12 px-6 md:px-8 bg-stone-900 hover:bg-blue-600 text-white rounded-full flex items-center gap-2 transition-all shadow-md hover:shadow-lg active:scale-95 group/btn">
                                    <span class="hidden md:inline font-bold text-sm">ุจุญุซ</span>
                                    <i data-lucide="search" size="18" class="group-hover/btn:scale-110 transition-transform"></i>
                                </button>
                            </form>
                        </div>
                        
                        <!-- Helper Text -->
                        <div class="mt-6 flex flex-wrap justify-center gap-4 text-xs md:text-sm font-medium text-stone-500 fade-in-up" style="animation-delay: 0.2s;">
                            <span class="flex items-center gap-1.5 bg-white px-3 py-1.5 rounded-full shadow-sm border border-stone-100"><i data-lucide="clock" size="14" class="text-orange-500"></i> ุชุญุฏูุซ ูุญุธู</span>
                            <span class="flex items-center gap-1.5 bg-white px-3 py-1.5 rounded-full shadow-sm border border-stone-100"><i data-lucide="shield-check" size="14" class="text-green-500"></i> ุจูุงูุงุช ูุดูุฑุฉ</span>
                            <span class="flex items-center gap-1.5 bg-white px-3 py-1.5 rounded-full shadow-sm border border-stone-100"><i data-lucide="bell" size="14" class="text-blue-500"></i> ุฅุดุนุงุฑุงุช ูุงุชุณุงุจ</span>
                        </div>
                    </div>
                    
                    <!-- Results Container -->
                    <div id="tracking-result" class="max-w-4xl mx-auto mt-12 transition-all"></div>
                    
                    <!-- Support Section -->
                    <div class="mt-20 text-center border-t border-stone-200/60 pt-10 max-w-xl mx-auto fade-in-up" style="animation-delay: 0.3s;">
                        <p class="text-stone-400 text-xs font-bold uppercase tracking-widest mb-3">ูู ุชูุงุฌู ูุดููุฉุ</p>
                        <h3 class="text-stone-800 font-bold mb-4">ูุฑูู ุงูุฏุนู ุฌุงูุฒ ููุณุงุนุฏุชู</h3>
                        <a href="https://wa.me/201014175070" target="_blank" class="inline-flex items-center gap-2 text-stone-600 hover:text-green-600 font-bold bg-white px-6 py-3 rounded-xl border border-stone-200 hover:border-green-200 hover:shadow-md transition-all">
                            <i data-lucide="message-circle" size="18"></i>
                            <span>ุชูุงุตู ูุน ุฎุฏูุฉ ุงูุนููุงุก</span>
                        </a>
                    </div>
                </div>
            </div>`;
        }

        function renderHero(c) {
            // ุชู ุฅุฒุงูุฉ ูุณู ุงูููุฑู (ุฌุฏุฑุงู ุชูุจุถ) ููุงุฆูุงู
        }

        function renderFeatured(c) {
            // --- NEW: Calculate Spacing Dynamically ---
            // ุจูุง ุฃู ุงูููุฑู ูุญุฐููุ ูุนุชุจุฑู false ุฏุงุฆูุงู ูุถูุงู ุญุณุงุจ ุงููุณุงูุงุช ุจุดูู ุตุญูุญ
            const showHeroMob = false; 
            const showHeroDesk = false;
            const showCatBar = HERO_SETTINGS.showCategoryBar !== false;
            const showHeaderBanner = HERO_SETTINGS.showFooterBanner && HERO_SETTINGS.footerBannerUrl;

            // Default Padding (Standard spacing when elements exist above)
            let ptMobile = 'pt-12';
            let ptDesktop = 'md:pt-12';

            // Mobile: If Hero & CatBar are hidden
            if (!showHeroMob && !showCatBar) {
                // If Header Banner exists, it pushes content down, so we need small padding.
                // If NO Banner, we need to clear the fixed Navbar (approx pt-28).
                ptMobile = showHeaderBanner ? 'pt-4' : 'pt-28';
            }

            // Desktop: If Hero & CatBar are hidden
            if (!showHeroDesk && !showCatBar) {
                ptDesktop = showHeaderBanner ? 'md:pt-4' : 'md:pt-32';
            }
            // --------------------------------------------------

            // 1. Render Best Sellers (Existing Logic)
            c.innerHTML += `
            <!-- UPDATED: Dynamic Padding based on visibility -->
            <div class="${ptMobile} ${ptDesktop} pb-2 container mx-auto px-6 border-t border-stone-100">
                <div class="flex justify-between items-end mb-6">
                    <div>
                        <span class="text-xs font-bold text-green-600 tracking-wider uppercase mb-1 block">ุฎูุงุฑุงุช ุงูุนููุงุก</span>
                        <h3 class="text-2xl md:text-3xl font-bold text-stone-900">ุงูุฃูุซุฑ ูุจูุนุงู</h3>
                    </div>
                    <!-- REMOVED BUTTONS FROM HERE -->
                </div>
                
                <!-- WRAPPER for Relative Positioning of Arrows -->
                <div class="relative group/slider">
                    <!-- Right Arrow (Scroll Right / Prev) -->
                    <button onclick="document.getElementById('featured-slider').scrollBy({ left: 300, behavior: 'smooth' })" class="absolute top-1/2 -right-4 lg:-right-6 -translate-y-1/2 z-20 w-12 h-12 bg-white/80 backdrop-blur-md border border-stone-200 rounded-full flex items-center justify-center text-stone-800 shadow-lg hover:bg-stone-900 hover:text-white hover:scale-110 transition-all duration-300 opacity-0 group-hover/slider:opacity-100 translate-x-4 group-hover/slider:translate-x-0 hidden md:flex">
                        <i data-lucide="chevron-right" size="24"></i>
                    </button>

                    <!-- Slider Container -->
                    <div id="featured-slider" class="flex overflow-x-auto scrollbar-hide snap-x pb-8 pt-4 -mx-3 px-3 scroll-smooth">
                        ${PRODUCTS.slice(0, 8).map(p => {
                            return `
                            <!-- UPDATED: Width is 1/4 on desktop (4 items), 1/3 on tablet, 1/2 on mobile -->
                            <div class="w-1/2 md:w-1/3 lg:w-1/4 flex-shrink-0 snap-start px-3 group cursor-pointer">
                                ${createProductCard(p)}
                            </div>
                            `;
                        }).join('')}
                    </div>

                    <!-- Left Arrow (Scroll Left / Next) -->
                    <button onclick="document.getElementById('featured-slider').scrollBy({ left: -300, behavior: 'smooth' })" class="absolute top-1/2 -left-4 lg:-left-6 -translate-y-1/2 z-20 w-12 h-12 bg-white/80 backdrop-blur-md border border-stone-200 rounded-full flex items-center justify-center text-stone-800 shadow-lg hover:bg-stone-900 hover:text-white hover:scale-110 transition-all duration-300 opacity-0 group-hover/slider:opacity-100 -translate-x-4 group-hover/slider:translate-x-0 hidden md:flex">
                        <i data-lucide="chevron-left" size="24"></i>
                    </button>
                </div>
            </div>`;

            // NEW: Render Best Seller Banner (If Enabled)
            if (HERO_SETTINGS.showBestSellerBanner && HERO_SETTINGS.bestSellerBannerUrl) {
                 c.innerHTML += `
                    <div class="container mx-auto px-6 mb-4 fade-in-up">
                        <div class="w-full flex justify-center overflow-hidden rounded-2xl shadow-sm border border-stone-100">
                            <!-- ุชุนุฏูู ููุง: ุงุณุชุฎุฏุงู object-fill -->
                            <img src="${HERO_SETTINGS.bestSellerBannerUrl}" 
                                 class="object-fill md:object-cover"
                                 style="height: ${HERO_SETTINGS.bestSellerBannerHeight || 200}px; width: ${HERO_SETTINGS.bestSellerBannerWidth || 100}%;" 
                                 alt="Best Seller Promo Banner">
                        </div>
                    </div>`;
            }

            // 2. Render Featured Products (Existing Logic)
            const featuredProducts = PRODUCTS.filter(p => p.isFeatured);
            
            if (featuredProducts.length > 0) {
                c.innerHTML += `
                <!-- UPDATED: Reduced padding to pt-4 pb-12 -->
                <div class="pt-4 pb-12 bg-yellow-50/50 border-t border-stone-100">
                    <div class="container mx-auto px-6">
                        <div class="flex justify-between items-end mb-6">
                            <div>
                                <span class="text-xs font-bold text-yellow-600 tracking-wider uppercase mb-1 block">ุงุฎุชูุงุฑุงุชูุง ูู</span>
                                <h3 class="text-2xl md:text-3xl font-bold text-stone-900 flex items-center gap-2"><i data-lucide="star" class="text-yellow-500 fill-yellow-500" size="24"></i> ููุชุฌุงุช ูููุฒุฉ</h3>
                            </div>
                            <!-- REMOVED BUTTONS FROM HERE -->
                        </div>
                        
                        <!-- WRAPPER for Relative Positioning of Arrows -->
                        <div class="relative group/slider">
                            <!-- Right Arrow -->
                            <button onclick="document.getElementById('special-slider').scrollBy({ left: 300, behavior: 'smooth' })" class="absolute top-1/2 -right-4 lg:-right-6 -translate-y-1/2 z-20 w-12 h-12 bg-white/80 backdrop-blur-md border border-stone-200 rounded-full flex items-center justify-center text-stone-800 shadow-lg hover:bg-stone-900 hover:text-white hover:scale-110 transition-all duration-300 opacity-0 group-hover/slider:opacity-100 translate-x-4 group-hover/slider:translate-x-0 hidden md:flex">
                                <i data-lucide="chevron-right" size="24"></i>
                            </button>

                            <!-- Slider Container -->
                            <div id="special-slider" class="flex overflow-x-auto scrollbar-hide snap-x pb-8 pt-4 -mx-3 px-3 scroll-smooth">
                                ${featuredProducts.map(p => {
                                    return `
                                    <!-- UPDATED: Width is 1/4 on desktop (4 items), 1/3 on tablet, 1/2 on mobile -->
                                    <div class="w-1/2 md:w-1/3 lg:w-1/4 flex-shrink-0 snap-start px-3 group cursor-pointer">
                                        ${createProductCard(p)}
                                    </div>
                                    `;
                                }).join('')}
                            </div>

                            <!-- Left Arrow -->
                            <button onclick="document.getElementById('special-slider').scrollBy({ left: -300, behavior: 'smooth' })" class="absolute top-1/2 -left-4 lg:-left-6 -translate-y-1/2 z-20 w-12 h-12 bg-white/80 backdrop-blur-md border border-stone-200 rounded-full flex items-center justify-center text-stone-800 shadow-lg hover:bg-stone-900 hover:text-white hover:scale-110 transition-all duration-300 opacity-0 group-hover/slider:opacity-100 -translate-x-4 group-hover/slider:translate-x-0 hidden md:flex">
                                <i data-lucide="chevron-left" size="24"></i>
                            </button>
                        </div>
                    </div>
                </div>`;

                // REMOVED: Old Featured Banner Location Logic
            }
        }

        // NEW: Render Category Sections (Full Grid 5 cols)
        function renderCategorySections(c) {
            // 1. Filter valid categories (only those containing products)
            const activeCategories = CATEGORIES.filter(cat => PRODUCTS.some(p => p.category === cat.name));

            if (activeCategories.length === 0) return;

            let visibleHTML = '';
            let hiddenHTML = '';

            // Loop through valid categories
            activeCategories.forEach((cat, index) => {
                // Get products for this category
                let catProducts = PRODUCTS.filter(p => p.category === cat.name);
                
                // Randomize products
                catProducts = catProducts.sort(() => 0.5 - Math.random());

                // Logic for "Show More" items within the category (Products inside section)
                const initialLimit = 25;
                const visibleProducts = catProducts.slice(0, initialLimit);
                const hiddenProducts = catProducts.slice(initialLimit);
                const hasHidden = hiddenProducts.length > 0;
                const hiddenContainerId = `more-products-${index}`;
                const btnId = `btn-more-${index}`;

                const sectionHTML = `
                <!-- Category Section -->
                <div class="py-4 border-t border-stone-100 bg-white">
                    <div class="container mx-auto px-6">
                        <!-- Category Header -->
                        <div class="flex items-center gap-4 mb-6 mt-4">
                            <div class="w-12 h-12 rounded-xl bg-white border border-stone-200 overflow-hidden shrink-0">
                                <img src="${cat.image}" class="w-full h-full object-cover">
                            </div>
                            <div>
                                <h3 class="text-2xl font-bold text-stone-900">${cat.name}</h3>
                            </div>
                            <button onclick="filterCategory('${cat.name}'); setView('shop')" class="mr-auto text-xs font-bold text-blue-600 hover:text-blue-700 flex items-center gap-1 transition-colors bg-blue-50 px-3 py-1.5 rounded-lg hover:bg-blue-100">
                                ุนุฑุถ ุงููู <i data-lucide="arrow-left" size="14"></i>
                            </button>
                        </div>

                        <!-- Products Grid: Updated to 3 columns on mobile -->
                        <div class="grid grid-cols-3 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-2 md:gap-6">
                            ${visibleProducts.map(p => createProductCard(p)).join('')}
                        </div>

                        <!-- Hidden Products Container (Inside Section) -->
                        ${hasHidden ? `
                        <div id="${hiddenContainerId}" class="grid grid-cols-3 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-2 md:gap-6 mt-6 hidden fade-in-up">
                            ${hiddenProducts.map(p => createProductCard(p)).join('')}
                        </div>
                        
                        <div class="mt-6 text-center">
                            <button id="${btnId}" onclick="document.getElementById('${hiddenContainerId}').classList.remove('hidden'); this.style.display='none';" class="inline-flex items-center gap-2 text-stone-500 hover:text-stone-900 text-sm font-bold transition-all hover:bg-white px-4 py-2 rounded-lg">
                                <span>ุนุฑุถ ุงููุฒูุฏ ูู ${cat.name}</span>
                                <i data-lucide="chevron-down" size="16"></i>
                            </button>
                        </div>
                        ` : ''}
                    </div>
                </div>
                `;

                // Split into visible (first 3) and hidden (rest)
                if (index < 3) {
                    visibleHTML += sectionHTML;
                } else {
                    hiddenHTML += sectionHTML;
                }
            });

            // Append Visible Sections
            c.innerHTML += visibleHTML;

            // Append Hidden Sections Button & Container if there are more
            if (hiddenHTML) {
                c.innerHTML += `
                <div id="hidden-categories-wrapper" class="hidden fade-in-up">
                    ${hiddenHTML}
                </div>
                
                <div id="show-more-cats-btn-container" class="py-8 text-center bg-white/30 border-t border-stone-100 mt-4">
                    <button onclick="document.getElementById('hidden-categories-wrapper').classList.remove('hidden'); document.getElementById('show-more-cats-btn-container').style.display='none';" class="group bg-white border-2 border-stone-200 text-stone-600 px-8 py-3.5 rounded-full font-bold hover:bg-stone-900 hover:text-white hover:border-stone-900 transition-all shadow-sm hover:shadow-lg flex items-center gap-3 mx-auto text-sm">
                        <span>ุนุฑุถ ุงููุฒูุฏ ูู ุงูุฃูุณุงู</span>
                        <div class="w-6 h-6 rounded-full bg-stone-100 text-stone-500 flex items-center justify-center group-hover:bg-white/20 group-hover:text-white transition-colors">
                            <i data-lucide="chevron-down" size="16"></i>
                        </div>
                    </button>
                </div>
                `;
            }

            lucide.createIcons();
        }

        function renderShop(c) {
            const catsHTML = generateCategoryFilterHTML();
            let adminBlock = '';
            if (user && user.email === ADMIN_EMAIL) {
               // ...
            }

            // ุชู ุชุนุฏูู pt-28 ุฅูู pt-40 ูููุงุชู ูููุน ุงุฎุชูุงุก ุงููุญุชูู ุชุญุช ุงูููุฏุฑ
            c.innerHTML = `<div class="bg-[#FAFAFA] min-h-screen pt-40 md:pt-24 pb-20">
                <div class="container mx-auto px-4 md:px-6">
                    
                    <!-- Mobile Search & Filter Toolbar -->
                    <!-- ุชู ุถุจุท top ููููู ููุงุณุจุงู (ุญูุงูู 105px ุงูุขู) -->
                    <div class="lg:hidden mb-4 space-y-3 sticky top-[105px] z-30 bg-[#FAFAFA]/95 backdrop-blur-sm py-2 -mx-4 px-4 shadow-sm border-b border-stone-200/50">
                         <div class="relative group">
                            <input class="w-full bg-white border border-stone-200 p-3 pl-10 rounded-xl shadow-sm text-sm focus:ring-2 focus:ring-stone-900 outline-none transition-colors" 
                                   oninput="updateShopFilters('search',this.value)" 
                                   value="${shopState.search}" 
                                   placeholder="ุนู ูุงุฐุง ุชุจุญุซุ">
                            <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 text-stone-400" size="18"></i>
                         </div>
                         <div class="flex gap-2">
                             <button onclick="toggleFilterDrawer(true)" class="flex-1 bg-white border border-stone-200 p-3 rounded-xl flex items-center justify-center gap-2 font-bold text-stone-700 text-xs shadow-sm active:bg-white transition-colors">
                                <i data-lucide="sliders-horizontal" size="16"></i> ุชุตููุฉ ุงููุชุงุฆุฌ
                             </button>
                             <!-- Sort (Mobile) -->
                             <div class="relative flex-1">
                                <select onchange="updateShopFilters('sort',this.value)" class="w-full h-full appearance-none bg-white border border-stone-200 p-3 pl-8 pr-4 rounded-xl text-xs font-bold text-stone-700 shadow-sm focus:outline-none">
                                    <option value="featured" ${shopState.sort === 'featured' ? 'selected' : ''}>ุงููููุฒ</option>
                                    <option value="price-low" ${shopState.sort === 'price-low' ? 'selected' : ''}>ุฃูู ุณุนุฑ</option>
                                    <option value="price-high" ${shopState.sort === 'price-high' ? 'selected' : ''}>ุฃุนูู ุณุนุฑ</option>
                                    <option value="newest" ${shopState.sort === 'newest' ? 'selected' : ''}>ุงูุฃุญุฏุซ</option>
                                </select>
                                <i data-lucide="chevron-down" size="14" class="absolute left-3 top-1/2 -translate-y-1/2 text-stone-400 pointer-events-none"></i>
                             </div>
                         </div>
                    </div>

                    <div class="flex flex-col lg:flex-row gap-8 items-start">
                        
                        <!-- Sidebar Filters (Drawer on Mobile, Sidebar on Desktop) -->
                        <div id="filter-sidebar-overlay" onclick="toggleFilterDrawer(false)" class="fixed inset-0 bg-black/60 z-[60] hidden lg:hidden backdrop-blur-sm transition-opacity fade-in"></div>
                        
                        <aside id="shop-sidebar" class="
                            fixed inset-y-0 right-0 z-[70] w-[85%] max-w-[320px] bg-white shadow-2xl transform translate-x-full transition-transform duration-300 ease-out overflow-y-auto
                            lg:translate-x-0 lg:static lg:z-auto lg:w-1/4 lg:shadow-none lg:bg-transparent lg:overflow-visible lg:block lg:sticky lg:top-28
                        ">
                            <!-- Mobile Drawer Header -->
                            <div class="lg:hidden p-5 border-b border-stone-100 flex justify-between items-center bg-white sticky top-0 z-10">
                                <h3 class="font-bold text-lg text-stone-900">ุชุตููุฉ ุงููุชุงุฆุฌ</h3>
                                <button onclick="toggleFilterDrawer(false)" class="w-8 h-8 bg-white rounded-full flex items-center justify-center text-stone-500 hover:text-red-500 hover:bg-red-50 transition-colors"><i data-lucide="x" size="18"></i></button>
                            </div>

                            <div class="p-5 lg:p-0 space-y-6">
                                ${adminBlock}
                                
                                <!-- Desktop Search Box (Hidden on Mobile) -->
                                <div class="hidden lg:block bg-white p-1 rounded-2xl shadow-sm border border-stone-100">
                                    <div class="relative group">
                                        <input class="w-full bg-white border-transparent p-4 pl-12 rounded-xl text-sm font-medium focus:bg-white focus:ring-2 focus:ring-stone-900 focus:outline-none transition-all placeholder:text-stone-400 text-stone-900" oninput="updateShopFilters('search',this.value)" value="${shopState.search}" placeholder="ุนู ูุงุฐุง ุชุจุญุซุ">
                                        <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 text-stone-400 group-focus-within:text-stone-900 transition-colors" size="20"></i>
                                    </div>
                                </div>

                                <!-- Filter Container -->
                                <div class="bg-white rounded-3xl shadow-sm border border-stone-100 overflow-hidden">
                                    <div class="p-6 border-b border-stone-50 flex justify-between items-center bg-white">
                                        <h3 class="font-bold text-lg text-stone-900 flex items-center gap-2"><i data-lucide="sliders-horizontal" size="18"></i> ุงูููุงุชุฑ</h3>
                                        ${shopState.categories.length > 0 || shopState.priceMax < 10000 ? `<button onclick="resetFilters(); toggleFilterDrawer(false)" class="text-xs font-bold text-red-500 hover:bg-red-50 px-2 py-1 rounded-lg transition-colors">ูุณุญ ุงููู</button>` : ''}
                                    </div>
                                    
                                    <div class="p-6 space-y-8">
                                        <!-- Categories (Added ID) -->
                                        <div>
                                            <h4 class="font-bold text-sm text-stone-400 uppercase tracking-wider mb-4">ุงูุชุตูููุงุช</h4>
                                            <div id="shop-categories-list" class="space-y-1 max-h-[300px] overflow-y-auto custom-scrollbar pr-1">
                                                ${catsHTML}
                                            </div>
                                        </div>

                                        <!-- Price Range (Updated to Min/Max Inputs) -->
                                        <div>
                                            <h4 class="font-bold text-sm text-stone-400 uppercase tracking-wider mb-4">ูุทุงู ุงูุณุนุฑ</h4>
                                            <div class="flex items-center gap-3">
                                                <div class="relative w-full group">
                                                    <label class="text-[10px] font-bold text-stone-400 absolute -top-2 right-2 bg-white px-1">ูู</label>
                                                    <input type="number" min="0" class="w-full bg-white border border-stone-200 p-3 rounded-xl text-sm font-bold text-stone-700 focus:outline-none focus:ring-2 focus:ring-stone-900 focus:bg-white transition-all text-center dir-ltr" placeholder="0" value="${shopState.priceMin}" oninput="updateShopFilters('priceMin', this.value)">
                                                    <span class="absolute top-1/2 left-3 -translate-y-1/2 text-stone-400 text-xs font-serif">$</span>
                                                </div>
                                                
                                                <span class="text-stone-300 font-bold text-lg">-</span>
                                                
                                                <div class="relative w-full group">
                                                    <label class="text-[10px] font-bold text-stone-400 absolute -top-2 right-2 bg-white px-1">ุฅูู</label>
                                                    <input type="number" min="0" class="w-full bg-white border border-stone-200 p-3 rounded-xl text-sm font-bold text-stone-700 focus:outline-none focus:ring-2 focus:ring-stone-900 focus:bg-white transition-all text-center dir-ltr" placeholder="1000" value="${shopState.priceMax}" oninput="updateShopFilters('priceMax', this.value)">
                                                    <span class="absolute top-1/2 left-3 -translate-y-1/2 text-stone-400 text-xs font-serif">$</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Mobile Apply Button -->
                                <div class="lg:hidden sticky bottom-0 bg-white p-4 border-t border-stone-100 -mx-5 -mb-5 mt-4">
                                    <button onclick="toggleFilterDrawer(false)" class="w-full bg-stone-900 text-white py-3.5 rounded-xl font-bold shadow-lg hover:bg-stone-800 transition-all active:scale-95">
                                        ุชู ุงูุงูุชูุงุก
                                    </button>
                                </div>
                            </div>
                        </aside>

                        <!-- Products Grid Area -->
                        <div class="w-full lg:w-3/4">
                            <!-- Top Bar (Visible only on Desktop) -->
                            <div class="hidden lg:flex flex-col sm:flex-row justify-between items-center mb-6 gap-4 bg-white p-4 rounded-2xl border border-stone-100 shadow-sm fade-in-up" style="animation-delay: 0.1s;">
                                <div class="flex items-center gap-2">
                                    <div class="p-2 bg-white rounded-lg text-stone-500"><i data-lucide="layout-grid" size="18"></i></div>
                                    <p id="results-count" class="text-stone-600 font-bold text-sm"></p>
                                </div>
                                
                                <div class="flex items-center gap-3 w-full sm:w-auto">
                                    <span class="text-xs font-bold text-stone-400 whitespace-nowrap">ุชุฑุชูุจ ุญุณุจ:</span>
                                    <div class="relative w-full sm:w-48">
                                        <select onchange="updateShopFilters('sort',this.value)" class="w-full appearance-none border border-stone-200 bg-white p-2.5 pl-8 pr-4 rounded-xl text-sm font-bold text-stone-700 focus:outline-none focus:ring-2 focus:ring-stone-900 focus:bg-white cursor-pointer transition-colors">
                                            <option value="featured" ${shopState.sort === 'featured' ? 'selected' : ''}>ุงููููุฒ (ุงูุงูุชุฑุงุถู)</option>
                                            <option value="price-low" ${shopState.sort === 'price-low' ? 'selected' : ''}>ุงูุณุนุฑ: ุงูุฃูู ุฃููุงู</option>
                                            <option value="price-high" ${shopState.sort === 'price-high' ? 'selected' : ''}>ุงูุณุนุฑ: ุงูุฃุนูู ุฃููุงู</option>
                                            <option value="newest" ${shopState.sort === 'newest' ? 'selected' : ''}>ุงูุฃุญุฏุซ ุฅุถุงูุฉ</option>
                                        </select>
                                        <i data-lucide="chevron-down" size="16" class="absolute left-3 top-1/2 -translate-y-1/2 text-stone-400 pointer-events-none"></i>
                                    </div>
                                </div>
                            </div>

                            <!-- Products Grid (UPDATED to 3 Columns on Mobile) -->
                            <div id="shop-products-grid" class="grid grid-cols-3 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-4 gap-2 md:gap-6"></div>
                            
                            <!-- Empty State -->
                            <div id="shop-empty-state" class="hidden flex flex-col items-center justify-center py-24 bg-white rounded-3xl border border-stone-100 shadow-sm text-center">
                                <div class="w-20 h-20 bg-white rounded-full flex items-center justify-center mb-6 animate-pulse">
                                    <i data-lucide="search-x" class="text-stone-300" size="32"></i>
                                </div>
                                <h3 class="text-xl font-bold text-stone-900 mb-2">ุนุฐุฑุงูุ ูู ูุฌุฏ ูุชุงุฆุฌ</h3>
                                <p class="text-stone-500 text-sm max-w-xs mx-auto mb-8">ุญุงูู ุงูุจุญุซ ุจูููุงุช ูุฎุชููุฉ ุฃู ูู ุจุฅุฒุงูุฉ ุจุนุถ ุงูููุงุชุฑ.</p>
                                <button onclick="resetFilters()" class="bg-stone-900 text-white px-8 py-3 rounded-xl font-bold hover:bg-stone-800 transition-all shadow-lg hover:shadow-xl hover:-translate-y-0.5 flex items-center gap-2">
                                    <i data-lucide="refresh-cw" size="16"></i> ุฅุนุงุฏุฉ ุชุนููู ุงูููุงุชุฑ
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>`;
            applyShopFilters();
        }

        // NEW: Render Category Bar (Stories Style)
        function renderCategoryBar(c) {
            // ุงูุชุญูู ูู ุญุงูุฉ ุธููุฑ ุงูุจุงูุฑ ุงูุฅุนูุงูู (ุชุญุช ุงูููุฏุฑ)
            const showHeaderBanner = HERO_SETTINGS.showFooterBanner && HERO_SETTINGS.footerBannerUrl;

            // ุจูุง ุฃู ุงูููุฑู ูุญุฐููุ ูุนุชุจุฑู false ุฏุงุฆูุงู ูุถูุงู ุนุฏู ุงุฎุชูุงุก ูุฐุง ุงูุดุฑูุท ุชุญุช ุงูููุฏุฑ
            const showHeroMob = false;
            const showHeroDesk = false;
            
            // --- ุญุณุงุจ ุงููุณุงูุฉ ููููุจุงูู ---
            let mobilePt = 'pt-28'; // ุงูุงูุชุฑุงุถู: ูุณุงูุฉ ูุจูุฑุฉ ูุชุนููุถ ุงูููุฏุฑ ุงูุซุงุจุช
            
            if (showHeroMob) {
                // ุฅุฐุง ูุงู ุงูุจุงูุฑ ุงูุฑุฆูุณู (Hero) ุธุงูุฑุงู
                mobilePt = 'pt-4'; 
            } else if (showHeaderBanner) {
                mobilePt = 'pt-2';
            } else {
                mobilePt = 'pt-28';
            }

            // --- ุญุณุงุจ ุงููุณุงูุฉ ููููุจููุชุฑ ---
            let desktopPt = 'md:pt-32'; 

            if (showHeroDesk) {
                desktopPt = 'md:pt-8'; 
            } else if (showHeaderBanner) {
                desktopPt = 'md:pt-4'; 
            } else {
                desktopPt = 'md:pt-32'; 
            }

            // NEW: Check visibility setting for Category Bar (Circles)
            if (HERO_SETTINGS.showCategoryBar !== false) {
                // UPDATED: Modern Large Box Design with Scrollbar
                c.innerHTML += `
                <div class="${mobilePt} ${desktopPt} pb-6 container mx-auto px-6 fade-in-up group/cat" style="animation-delay: 0.3s;">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-2">
                            <h3 class="font-bold text-stone-900 text-base md:text-xl tracking-tight">ุชุตูุญ ุงูุฃูุณุงู</h3>
                        </div>
                        <button onclick="setView('categories')" class="text-xs font-bold text-stone-400 hover:text-stone-900 transition-colors flex items-center gap-1 group/btn">
                            ุนุฑุถ ุงููู <i data-lucide="arrow-left" size="14" class="group-hover/btn:-translate-x-1 transition-transform"></i>
                        </button>
                    </div>
                    
                    <div class="relative" onmouseenter="stopAutoScroll('category-scroll-container')" onmouseleave="startAutoScroll('category-scroll-container')">
                        
                        <!-- Container with Visible Scrollbar -->
                        <!-- REMOVED: 'All' Button -->
                        <!-- UPDATED: Added 'custom-scrollbar-modern' class -->
                        <div id="category-scroll-container" class="flex gap-4 overflow-x-auto snap-x pb-4 px-1 scroll-smooth custom-scrollbar-modern">
                            
                            ${CATEGORIES.map(cat => `
                                <div onclick="filterCategory('${cat.name.replace(/'/g, "\\'")}')" class="flex flex-col items-center gap-2 min-w-[100px] cursor-pointer group snap-start">
                                    <!-- Image Container: 100x100, No Border, Simple Rounded -->
                                    <div class="w-[100px] h-[100px] rounded-xl overflow-hidden bg-stone-100 shadow-sm group-hover:shadow-md group-hover:-translate-y-1 transition-all duration-300 relative">
                                        <img src="${cat.image}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700" loading="lazy" onerror="this.src='https://via.placeholder.com/150?text=${cat.name}'">
                                        <!-- Subtle Dark Gradient at bottom for depth -->
                                        <div class="absolute inset-0 bg-gradient-to-t from-black/20 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
                                    </div>
                                    <span class="text-xs font-bold text-stone-600 group-hover:text-stone-900 transition-colors text-center truncate w-full px-1">${cat.name}</span>
                                </div>
                            `).join('')}
                        </div>

                    </div>
                </div>`;
                
                setTimeout(() => startAutoScroll('category-scroll-container'), 1000);
            }

            // NEW: Render Category Banner (Infinite Gallery Style)
            if (HERO_SETTINGS.showCategoryBanner && HERO_SETTINGS.categoryBannerUrl) {
                // ... existing banner code ...
                const rawUrls = HERO_SETTINGS.categoryBannerUrl.split(/\r?\n/).filter(url => url.trim() !== '');
                
                let displayUrls = [];
                if (rawUrls.length > 0) {
                    if (rawUrls.length === 1) {
                        displayUrls = rawUrls; 
                    } else {
                        displayUrls = [...rawUrls, ...rawUrls, ...rawUrls];
                    }
                }

                const sliderId = 'category-banner-slider';
                
                // Settings
                const hDesk = HERO_SETTINGS.catBanHeightDesktop || HERO_SETTINGS.categoryBannerHeight || 250;
                const hMob = HERO_SETTINGS.catBanHeightMobile || 120;
                const wDesk = HERO_SETTINGS.catBanWidthDesktop || HERO_SETTINGS.categoryBannerWidth || 50; 
                const wMob = HERO_SETTINGS.catBanWidthMobile || 85;
                const rDesk = HERO_SETTINGS.catBanRadiusDesktop || HERO_SETTINGS.categoryBannerRadius || '1.5rem';
                const rMob = HERO_SETTINGS.catBanRadiusMobile || '0.8rem';

                // Dynamic CSS
                const styleId = 'cat-banner-style';
                let styleEl = document.getElementById(styleId);
                if(!styleEl) {
                    styleEl = document.createElement('style');
                    styleEl.id = styleId;
                    document.head.appendChild(styleEl);
                }
                
                styleEl.innerHTML = `
                    #cat-banner-wrapper { 
                        width: 100%; 
                        padding: 10px 0;
                    }
                    .cat-banner-slide { 
                        height: ${hMob}px; 
                        width: ${wMob}%; 
                        min-width: ${wMob}%;
                        margin: 0 6px; 
                        border-radius: ${rMob};
                        scroll-snap-align: center;
                        transition: transform 0.5s ease;
                        opacity: 1;
                        transform: scale(0.95);
                    }
                    .cat-banner-slide:hover { transform: scale(1); }
                    
                    @media (min-width: 768px) {
                        #cat-banner-wrapper { padding: 20px 0; }
                        .cat-banner-slide { 
                            height: ${hDesk}px; 
                            width: ${wDesk}%; 
                            min-width: ${wDesk}%;
                            margin: 0 15px;
                            border-radius: ${rDesk};
                            opacity: 1;
                            transform: scale(0.95);
                        }
                        .cat-banner-slide:hover { transform: scale(1); }
                    }
                    
                    #${sliderId} {
                        padding-inline: 0; 
                        scrollbar-width: none; 
                        -ms-overflow-style: none;
                    }
                    #${sliderId}::-webkit-scrollbar { 
                        display: none; 
                    }
                `;

                if (displayUrls.length > 0) {
                    // --- FIX: Smart Margin Logic (ุชู ุฅุตูุงุญ ููุทู ุงููุณุงูุงุช) ---
                    // ูุญุณุจ ุงููุณุงูุฉ ููููุจุงูู ูููููุจููุชุฑ ุจุดูู ูููุตู
                    
                    // 1. ุญุณุงุจ ุงูููุจุงูู
                    let mtMobile = 'mt-4';
                    // ูุถูู ูุณุงูุฉ ูุจูุฑุฉ ููุท ุฅุฐุง ุงุฎุชูู ุงูููุฑู ูุงุฎุชูุช ุงูุฏูุงุฆุฑ ูุงุฎุชูู ุงูุจุงูุฑ ุงูุนููู
                    if (HERO_SETTINGS.showCategoryBar === false && !showHeroMob && !showHeaderBanner) {
                        mtMobile = 'mt-28';
                    }

                    // 2. ุญุณุงุจ ุงูููุจููุชุฑ
                    let mtDesktop = 'md:mt-4';
                    // ูุถูู ูุณุงูุฉ ูุจูุฑุฉ ููุท ุฅุฐุง ุงุฎุชูู ุงูููุฑู ูุงุฎุชูุช ุงูุฏูุงุฆุฑ ูุงุฎุชูู ุงูุจุงูุฑ ุงูุนููู
                    if (HERO_SETTINGS.showCategoryBar === false && !showHeroDesk && !showHeaderBanner) {
                        mtDesktop = 'md:mt-32';
                    }
                    
                    c.innerHTML += `
                    <div class="container mx-auto px-0 ${mtMobile} ${mtDesktop} fade-in-up" style="animation-delay: 0.4s;">
                        <div class="w-full flex justify-center" onmouseenter="stopBannerAutoScroll('${sliderId}')" onmouseleave="startBannerAutoScroll('${sliderId}')">
                            <div id="cat-banner-wrapper" class="relative group bg-transparent transition-all duration-300">
                                <div id="${sliderId}" class="flex overflow-x-auto snap-x snap-mandatory scrollbar-hide scroll-smooth h-full items-center">
                                    ${displayUrls.map((url, idx) => `
                                        <div id="cat-slide-${idx}" class="cat-banner-slide flex-shrink-0 relative overflow-hidden shadow-md border border-stone-100 bg-white group/slide">
                                            <img src="${url.trim()}" class="w-full h-full object-fill md:object-cover transition-transform duration-700 group-hover/slide:scale-105" alt="Category Banner">
                                        </div>
                                    `).join('')}
                                </div>
                                ${rawUrls.length > 1 ? `
                                <button onclick="scrollBanner('${sliderId}', -1)" class="absolute top-1/2 left-4 md:left-10 -translate-y-1/2 w-10 h-10 md:w-12 md:h-12 bg-white/80 backdrop-blur-md rounded-full flex items-center justify-center text-stone-800 shadow-xl hover:bg-stone-900 hover:text-white hover:scale-110 transition-all opacity-0 group-hover:opacity-100 z-20 border border-stone-200">
                                    <i data-lucide="chevron-left" size="24"></i>
                                </button>
                                <button onclick="scrollBanner('${sliderId}', 1)" class="absolute top-1/2 right-4 md:right-10 -translate-y-1/2 w-10 h-10 md:w-12 md:h-12 bg-white/80 backdrop-blur-md rounded-full flex items-center justify-center text-stone-800 shadow-xl hover:bg-stone-900 hover:text-white hover:scale-110 transition-all opacity-0 group-hover:opacity-100 z-20 border border-stone-200">
                                    <i data-lucide="chevron-right" size="24"></i>
                                </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>`;
                    
                    if (rawUrls.length > 1) {
                        setTimeout(() => {
                            const slider = document.getElementById(sliderId);
                            const startIndex = rawUrls.length; 
                            const targetSlide = document.getElementById(`cat-slide-${startIndex}`);
                            if (targetSlide && slider) {
                                targetSlide.scrollIntoView({ behavior: 'auto', block: 'nearest', inline: 'center' });
                                startBannerAutoScroll(sliderId);
                            }
                        }, 500); 
                    }
                }
            }
        }

        // NEW: Auto Scroll Logic Helpers
        let scrollTimers = {};

        window.startAutoScroll = (id) => {
            const el = document.getElementById(id);
            if (!el) return;
            
            // Clear existing to avoid duplicates
            if (scrollTimers[id]) clearInterval(scrollTimers[id]);

            scrollTimers[id] = setInterval(() => {
                const element = document.getElementById(id);
                // Safety check if element removed from DOM
                if (!element) {
                    clearInterval(scrollTimers[id]);
                    return;
                }

                // RTL Logic: 
                // In RTL, scrollLeft starts at 0 (Right side) and goes negative as we scroll Left.
                // We need to scroll LEFT (negative value) to see next items.
                
                const maxScroll = element.scrollWidth - element.clientWidth;
                
                // If content fits, no need to scroll
                if (maxScroll <= 0) return;

                const currentScroll = Math.abs(element.scrollLeft);
                
                // Check if we reached the end (Left side) with small tolerance
                if (currentScroll >= maxScroll - 10) {
                    // Reset to Start (Right side)
                    element.scrollTo({ left: 0, behavior: 'smooth' });
                } else {
                    // Scroll Left (Forward in RTL)
                    element.scrollBy({ left: -200, behavior: 'smooth' });
                }
            }, 3000); // Move every 3 seconds
        };

        window.stopAutoScroll = (id) => {
            if (scrollTimers[id]) {
                clearInterval(scrollTimers[id]);
                delete scrollTimers[id];
            }
        };

        function renderCategoriesView(c) {
            const html = CATEGORIES.map((cat, index) => {
                // Escape single quotes for the onclick handler
                const safeName = cat.name.replace(/'/g, "\\'");
                return `
                <div onclick="filterCategory('${safeName}')" class="group cursor-pointer flex flex-col gap-2 fade-in-up" style="animation-delay: ${index * 0.05}s">
                    <div class="relative aspect-square rounded-2xl md:rounded-[2rem] overflow-hidden bg-stone-100 shadow-sm border border-stone-100 group-hover:shadow-xl group-hover:-translate-y-1 transition-all duration-500">
                        <img src="${cat.image}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-1000 ease-out" loading="lazy" onerror="this.src='https://via.placeholder.com/300?text=Category'">
                        
                        <!-- Modern Overlay on Hover -->
                        <div class="absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors duration-500"></div>
                    </div>
                    
                    <div class="text-center px-1">
                        <h3 class="font-bold text-stone-900 text-[10px] md:text-sm group-hover:text-stone-600 transition-colors truncate">${cat.name}</h3>
                    </div>
                </div>`;
            }).join('') || `<div class="col-span-full text-center py-20 text-stone-400 bg-white rounded-xl border border-dashed border-stone-200">ูุง ุชูุฌุฏ ุฃูุณุงู ุญุงููุงู</div>`;

            c.innerHTML = `
            <!-- ุชู ุชุนุฏูู pt-28 ุฅูู pt-40 ูููุงุชู ูููุน ุงุฎุชูุงุก ุงููุญุชูู ุชุญุช ุงูููุฏุฑ -->
            <div class="pt-40 md:pt-24 pb-20 min-h-screen bg-white">
                <div class="container mx-auto px-4">
                    <!-- Modern Header -->
                    <div class="text-center max-w-2xl mx-auto mb-8 fade-in-up">
                        <h1 class="text-2xl md:text-4xl font-bold text-stone-900 mb-2 tracking-tight">ุชุตูููุงุช ุงููุชุฌุฑ</h1>
                        <p class="text-stone-500 text-xs md:text-lg leading-relaxed">ุงุฎุชุฑ ุงููุณู ุงูููุงุณุจ ูุชุตูุญ ููุชุฌุงุชูุง ุงููููุฒุฉ.</p>
                    </div>

                    <!-- Updated Categories Grid: 4 columns on mobile (smaller icons) for better layout -->
                    <div class="grid grid-cols-4 sm:grid-cols-4 lg:grid-cols-6 gap-2 md:gap-6">
                        ${html}
                    </div>

                    <!-- Call to Action -->
                    <div class="mt-12 text-center fade-in-up border-t border-stone-100 pt-8" style="animation-delay: 0.3s;">
                        <button onclick="viewAllProducts()" class="bg-stone-900 text-white px-6 py-3 rounded-full font-bold hover:bg-stone-800 transition-all shadow-lg hover:shadow-xl hover:-translate-y-0.5 flex items-center gap-2 mx-auto text-xs md:text-sm">
                            <span>ุนุฑุถ ุฌููุน ุงูููุชุฌุงุช</span>
                            <i data-lucide="grid-2x2" size="16"></i>
                        </button>
                    </div>
                </div>
            </div>`;
            lucide.createIcons();
        }

        function renderAdmin(c) {
            if (!user || user.email !== ADMIN_EMAIL) {
                if (user && !user.isAnonymous) {
                     c.innerHTML = `<div class="min-h-screen flex flex-col items-center justify-center text-center px-4"><div class="w-20 h-20 bg-red-100 text-red-600 rounded-full flex items-center justify-center mb-6"><i data-lucide="shield-alert" size="40"></i></div><h1 class="text-2xl font-bold text-stone-900 mb-2">ุบูุฑ ูุตุฑุญ ุจุงูุฏุฎูู</h1><p class="text-stone-500 mb-8">ูุฐู ุงูุตูุญุฉ ูุฎุตุตุฉ ูููุณุคูููู ููุท.</p><button onclick="setView('home')" class="bg-stone-900 text-white px-8 py-3 rounded-xl font-bold">ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ</button></div>`;
                     return;
                }
                setView('login');
                return;
            }
            
            const isEdit = !!currentEditProduct;
            const p = currentEditProduct || {};
            const extraImages = p.images ? p.images.slice(1).join('\n') : '';
            const variantsString = p.variants ? p.variants.map(v => `${v.color}: ${v.image}`).join('\n') : '';
            // Helper to format timestamp to datetime-local string (YYYY-MM-DDTHH:MM)
            const expiryDateStr = p.discountExpiry 
                ? new Date(p.discountExpiry - (new Date().getTimezoneOffset() * 60000)).toISOString().slice(0, 16) 
                : '';

            const features = p.features ? p.features.join('\n') : '';
            const specsString = p.specifications ? p.specifications.map(s => `${s.label}: ${s.value}`).join('\n') : '';
            const defaultServices = [
                "banknote: ุงูุฏูุน ููุฏุงู ุนูุฏ ุงูุงุณุชูุงู",
                "truck: ุชูุตูู ูุฌุงูู",
                "rotate-ccw: 15 ููู ููุฅุฑุฌุงุน",
                "shield-check: ุชุณูู ุขูู",
                "badge-check: ุฌูุฏุฉ ูุถูููุฉ"
            ].join('\n');
            const servicesString = p.services ? p.services.map(s => `${s.icon}: ${s.text}`).join('\n') : defaultServices;

            const pendingReviews = ALL_REVIEWS.filter(r => r.status === 'pending');
            
            // Category Edit Variables
            const editCatObj = currentEditCategoryName ? CATEGORIES.find(c => c.name === currentEditCategoryName) : null;
            const catNameVal = editCatObj ? editCatObj.name : '';
            const catImgVal = editCatObj ? editCatObj.image : '';

            // Helper for active tab style
            const getTabClass = (tabName) => {
                return currentAdminTab === tabName 
                    ? "bg-stone-900 text-white shadow-md" 
                    : "bg-white text-stone-600 hover:bg-stone-100";
            };

            c.innerHTML = `
            <div class="pt-24 pb-20 container mx-auto px-4 min-h-screen bg-white/50">
                <div class="flex flex-col lg:flex-row gap-8 max-w-7xl mx-auto">
                    
                    <!-- Sidebar Navigation -->
                    <aside class="w-full lg:w-64 flex-shrink-0 space-y-2">
                        <div class="bg-white p-4 rounded-2xl shadow-sm border border-stone-200 mb-4">
                            <h2 class="font-bold text-stone-900 flex items-center gap-2 mb-1"><i data-lucide="layout-dashboard" size="18"></i> ููุญุฉ ุงูุชุญูู</h2>
                            <p class="text-xs text-stone-400">ุฃููุงู ุจูุ ุงููุฏูุฑ</p>
                        </div>

                        <button onclick="setAdminView('dashboard')" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl font-bold text-sm transition-all ${getTabClass('dashboard')}">
                            <i data-lucide="activity" size="18"></i> ุงููุฑุงุฌุนุงุช ูุงูููุฎุต
                        </button>
                        
                        <button onclick="setAdminView('orders')" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl font-bold text-sm transition-all ${getTabClass('orders')}">
                            <i data-lucide="shopping-bag" size="18"></i> ุทูุจุงุช ุงูุนููุงุก
                            ${ALL_ORDERS.filter(o => !o.isArchived).length > 0 ? `<span class="bg-red-500 text-white text-[10px] px-2 py-0.5 rounded-full mr-auto">${ALL_ORDERS.filter(o => !o.isArchived).length}</span>` : ''}
                        </button>

                        <button onclick="currentEditProduct=null; setAdminView('products')" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl font-bold text-sm transition-all ${getTabClass('products')}">
                            <i data-lucide="package-plus" size="18"></i> ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช
                        </button>
                        
                        <button onclick="currentEditCategoryName=null; setAdminView('categories')" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl font-bold text-sm transition-all ${getTabClass('categories')}">
                            <i data-lucide="folder-plus" size="18"></i> ุฅุฏุงุฑุฉ ุงูุฃูุณุงู
                        </button>
                        
                        <button onclick="setAdminView('settings')" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl font-bold text-sm transition-all ${getTabClass('settings')}">
                            <i data-lucide="settings" size="18"></i> ุฅุนุฏุงุฏุงุช ุงููุงุฌูุฉ
                        </button>

                         <div class="pt-4 mt-4 border-t border-stone-200">
                             <button onclick="setView('home')" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl font-bold text-sm text-stone-600 hover:bg-red-50 hover:text-red-600 transition-colors">
                                <i data-lucide="log-out" size="18"></i> ุฎุฑูุฌ ูู ุงูููุญุฉ
                            </button>
                        </div>
                    </aside>

                    <!-- Main Content Area -->
                    <div class="flex-1 min-w-0">
                        
                        <!-- 1. DASHBOARD TAB -->
                        ${currentAdminTab === 'dashboard' ? `
                            <div class="space-y-6 fade-in-up">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-stone-100">
                                        <div class="text-stone-400 text-xs font-bold uppercase mb-2">ุฅุฌูุงูู ุงูููุชุฌุงุช</div>
                                        <div class="text-3xl font-bold text-stone-900">${PRODUCTS.length}</div>
                                    </div>
                                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-stone-100">
                                        <div class="text-stone-400 text-xs font-bold uppercase mb-2">ุฅุฌูุงูู ุงูุทูุจุงุช</div>
                                        <div class="text-3xl font-bold text-stone-900">${ALL_ORDERS.length}</div>
                                    </div>
                                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-stone-100">
                                        <div class="text-stone-400 text-xs font-bold uppercase mb-2">ุงููุฑุงุฌุนุงุช ุงููุนููุฉ</div>
                                        <div class="text-3xl font-bold ${pendingReviews.length > 0 ? 'text-orange-500' : 'text-stone-900'}">${pendingReviews.length}</div>
                                    </div>
                                </div>

                                <div class="bg-white rounded-3xl p-8 shadow-sm border border-stone-100">
                                    <h3 class="font-bold text-xl text-stone-900 mb-6 flex items-center gap-2">
                                        <i data-lucide="message-square-warning" class="${pendingReviews.length > 0 ? 'text-orange-500' : 'text-stone-400'}"></i> 
                                        ุงูุชุนูููุงุช ูุงููุฑุงุฌุนุงุช
                                    </h3>
                                    ${pendingReviews.length === 0 ? `<div class="text-center py-12 bg-white rounded-2xl border border-dashed border-stone-200"><p class="text-stone-500 font-medium">ูุง ุชูุฌุฏ ุชุนูููุงุช ูุนููุฉ ุญุงููุงู</p></div>` : 
                                    `<div class="space-y-4">${pendingReviews.map(r => {
                                        const prod = PRODUCTS.find(p => p.id === r.productId);
                                        return `<div class="bg-orange-50 p-6 rounded-2xl border border-orange-100 flex flex-col md:flex-row gap-6 justify-between items-start">
                                            <div>
                                                <div class="flex items-center gap-3 mb-2"><span class="font-bold text-stone-900 text-lg">${r.userName}</span><div class="flex text-yellow-400 text-xs">${Array(r.rating).fill('<i data-lucide="star" class="w-3 h-3 fill-current"></i>').join('')}</div></div>
                                                <p class="text-stone-500 text-xs mb-2">ุนู ููุชุฌ: <span class="font-bold text-stone-800">${prod ? prod.name : 'ููุชุฌ ูุญุฐูู'}</span></p>
                                                <p class="text-stone-700 font-medium bg-white p-3 rounded-xl border border-orange-100">"${r.comment}"</p>
                                            </div>
                                            <div class="flex flex-col gap-3 w-full md:w-auto min-w-[200px]">
                                                <label class="flex items-center gap-2 cursor-pointer bg-white px-3 py-2 rounded-xl border border-orange-200 hover:border-orange-400 transition-colors">
                                                    <input type="checkbox" id="verify-check-${r.id}" class="w-4 h-4 accent-green-600 rounded cursor-pointer">
                                                    <span class="text-xs font-bold text-stone-700 select-none">ุดุฑุงุก ุชู ุงูุชุญูู ููู</span>
                                                </label>
                                                <div class="flex gap-2">
                                                    <button onclick="handleReviewAction('${r.id}', 'approve')" class="flex-1 bg-green-600 text-white px-4 py-2.5 rounded-xl text-sm font-bold hover:bg-green-700 shadow-sm">ููุงููุฉ</button>
                                                    <button onclick="handleReviewAction('${r.id}', 'reject')" class="flex-1 bg-red-600 text-white px-4 py-2.5 rounded-xl text-sm font-bold hover:bg-red-700 shadow-sm">ุฑูุถ</button>
                                                </div>
                                            </div>
                                        </div>`;
                                    }).join('')}</div>`}
                                </div>
                            </div>
                        ` : ''}

                        <!-- 2. ORDERS TAB (Integrated Here) -->
                        ${currentAdminTab === 'orders' ? `
                            <div class="space-y-6 fade-in-up">
                                
                                <!-- ๐ 1. New Stats Dashboard (ุฅุญุตุงุฆูุงุช ุณุฑูุนุฉ) -->
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <div class="bg-white p-4 rounded-2xl border border-stone-100 shadow-sm flex flex-col justify-between">
                                        <div class="text-stone-400 text-[10px] font-bold uppercase tracking-wider mb-2">ุทูุจุงุช ุงูููู</div>
                                        <div class="flex justify-between items-end">
                                            <span class="text-2xl font-bold text-stone-900">${ALL_ORDERS.filter(o => {
                                                if(!o.createdAt) return false;
                                                const d = o.createdAt.toDate ? o.createdAt.toDate() : new Date(o.createdAt);
                                                const now = new Date();
                                                return d.getDate() === now.getDate() && d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();
                                            }).length}</span>
                                            <div class="p-1.5 bg-blue-50 text-blue-600 rounded-lg"><i data-lucide="calendar" size="16"></i></div>
                                        </div>
                                    </div>
                                    <div class="bg-white p-4 rounded-2xl border border-stone-100 shadow-sm flex flex-col justify-between">
                                        <div class="text-stone-400 text-[10px] font-bold uppercase tracking-wider mb-2">ุจุงูุชุธุงุฑ ุงูุฏูุน</div>
                                        <div class="flex justify-between items-end">
                                            <span class="text-2xl font-bold text-orange-600">${ALL_ORDERS.filter(o => o.status === 'pending_payment' && !o.isArchived).length}</span>
                                            <div class="p-1.5 bg-orange-50 text-orange-600 rounded-lg"><i data-lucide="clock" size="16"></i></div>
                                        </div>
                                    </div>
                                    <div class="bg-white p-4 rounded-2xl border border-stone-100 shadow-sm flex flex-col justify-between">
                                        <div class="text-stone-400 text-[10px] font-bold uppercase tracking-wider mb-2">ูุฑุงุฌุนุฉ ุงูุฏูุน</div>
                                        <div class="flex justify-between items-end">
                                            <span class="text-2xl font-bold text-purple-600">${ALL_ORDERS.filter(o => o.status === 'payment_review' && !o.isArchived).length}</span>
                                            <div class="p-1.5 bg-purple-50 text-purple-600 rounded-lg"><i data-lucide="file-search" size="16"></i></div>
                                        </div>
                                    </div>
                                    <div class="bg-white p-4 rounded-2xl border border-stone-100 shadow-sm flex flex-col justify-between">
                                        <div class="text-stone-400 text-[10px] font-bold uppercase tracking-wider mb-2">ุทูุจุงุช ุฌุฏูุฏุฉ</div>
                                        <div class="flex justify-between items-end">
                                            <span class="text-2xl font-bold text-green-600">${ALL_ORDERS.filter(o => o.status === 'new' && !o.isArchived).length}</span>
                                            <div class="p-1.5 bg-green-50 text-green-600 rounded-lg"><i data-lucide="bell" size="16"></i></div>
                                        </div>
                                    </div>
                                </div>

                                <div class="flex flex-col gap-4 bg-white p-5 rounded-3xl shadow-sm border border-stone-100">
                                    <div class="flex flex-wrap items-center justify-between gap-4">
                                        <div>
                                            <h2 class="font-bold text-2xl text-stone-900 flex items-center gap-2">
                                                ุฅุฏุงุฑุฉ ุงูุทูุจุงุช
                                            </h2>
                                            <p class="text-xs text-stone-400 mt-1">ุฅุฏุงุฑุฉ ููุชุงุจุนุฉ ุทูุจุงุช ุงูุนููุงุก ุจููุงุกุฉ</p>
                                        </div>
                                        
                                        <!-- Actions -->
                                        <div class="flex items-center gap-2">
                                            <div class="relative group/export">
                                                <button class="flex items-center gap-2 bg-white text-stone-600 px-4 py-2.5 rounded-xl font-bold hover:bg-stone-50 transition-colors border border-stone-200 shadow-sm text-xs">
                                                    <i data-lucide="download" size="14"></i> ุชุตุฏูุฑ
                                                </button>
                                                <div class="absolute top-full left-0 mt-2 w-40 bg-white rounded-xl shadow-xl border border-stone-100 overflow-hidden hidden group-hover/export:block z-20">
                                                    <button onclick="exportOrdersToCSV('today')" class="w-full text-right px-4 py-2 hover:bg-stone-50 text-xs font-bold text-stone-700">ุทูุจุงุช ุงูููู</button>
                                                    <button onclick="exportOrdersToCSV('all')" class="w-full text-right px-4 py-2 hover:bg-stone-50 text-xs font-bold text-stone-700">ุงููู</button>
                                                </div>
                                            </div>

                                            <div class="flex p-1 bg-stone-100 rounded-xl">
                                                <button onclick="setOrderTab('active')" class="px-4 py-1.5 rounded-lg text-xs font-bold transition-all ${currentOrderTab === 'active' ? 'bg-white text-stone-900 shadow-sm' : 'text-stone-500 hover:text-stone-700'}">ุงูุฌุงุฑูุฉ</button>
                                                <button onclick="setOrderTab('archived')" class="px-4 py-1.5 rounded-lg text-xs font-bold transition-all ${currentOrderTab === 'archived' ? 'bg-white text-stone-900 shadow-sm' : 'text-stone-500 hover:text-stone-700'}">ุงูุฃุฑุดูู</button>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Search -->
                                    <div class="relative w-full group">
                                        <input type="text" oninput="filterOrdersList(this.value)" placeholder="๐ ุงุจุญุซ ุจุฑูู ุงูุทูุจุ ุงุณู ุงูุนูููุ ุฃู ุฑูู ุงููุงุชู..." class="w-full border border-stone-200 bg-stone-50 p-3.5 pl-10 rounded-2xl text-sm focus:ring-2 focus:ring-stone-900 focus:bg-white outline-none transition-all placeholder:text-stone-400 font-medium">
                                        <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 text-stone-400 group-focus-within:text-stone-900 transition-colors" size="18"></i>
                                    </div>

                                    <!-- ๐ 2. Modern Filter Tabs (Requested Filters) -->
                                    <div class="flex gap-2 overflow-x-auto pb-2 scrollbar-hide border-t border-stone-100 pt-4">
                                        <!-- ุงููู -->
                                        <button onclick="setAdminOrderFilter('all')" class="whitespace-nowrap px-4 py-2 rounded-full text-xs font-bold border transition-all flex items-center gap-2 ${adminOrderFilter === 'all' ? 'bg-stone-900 text-white border-stone-900 shadow-md' : 'bg-white text-stone-600 border-stone-200 hover:border-stone-400'}">
                                            ุงููู
                                        </button>
                                        
                                        <!-- ุงูุทูุจุงุช ุงููุคูุฏุฉ (Confirmed) -->
                                        <button onclick="setAdminOrderFilter('confirmed')" class="whitespace-nowrap px-4 py-2 rounded-full text-xs font-bold border transition-all flex items-center gap-2 ${adminOrderFilter === 'confirmed' ? 'bg-green-600 text-white border-green-600 shadow-md' : 'bg-white text-stone-600 border-stone-200 hover:border-green-300 hover:bg-green-50'}">
                                            <span class="w-2 h-2 rounded-full bg-green-400 ${adminOrderFilter === 'confirmed' ? 'bg-white' : ''}"></span>
                                            ุงููุคูุฏุฉ
                                            <span class="bg-green-100 text-green-700 px-1.5 rounded-md text-[10px] min-w-[18px] text-center">${ALL_ORDERS.filter(o => ['confirmed', 'processing', 'shipped', 'delivered'].includes(o.status) && !o.isArchived).length}</span>
                                        </button>

                                        <!-- ุงูุทูุจุงุช ุงููุนููุฉ/ุงูุฌุฏูุฏุฉ (Pending/New) -->
                                        <button onclick="setAdminOrderFilter('new')" class="whitespace-nowrap px-4 py-2 rounded-full text-xs font-bold border transition-all flex items-center gap-2 ${adminOrderFilter === 'new' ? 'bg-blue-600 text-white border-blue-600 shadow-md' : 'bg-white text-stone-600 border-stone-200 hover:border-blue-300 hover:bg-blue-50'}">
                                            <span class="w-2 h-2 rounded-full bg-blue-400 ${adminOrderFilter === 'new' ? 'bg-white' : ''}"></span>
                                            ุงูุฌุฏูุฏุฉ (ุงููุนููุฉ)
                                            <span class="bg-blue-100 text-blue-700 px-1.5 rounded-md text-[10px] min-w-[18px] text-center">${ALL_ORDERS.filter(o => o.status === 'new' && !o.isArchived).length}</span>
                                        </button>

                                        <!-- ูู ูุชู ุงูุฏูุน (Unpaid) -->
                                        <button onclick="setAdminOrderFilter('unpaid')" class="whitespace-nowrap px-4 py-2 rounded-full text-xs font-bold border transition-all flex items-center gap-2 ${adminOrderFilter === 'unpaid' ? 'bg-orange-500 text-white border-orange-500 shadow-md' : 'bg-white text-stone-600 border-stone-200 hover:border-orange-300 hover:bg-orange-50'}">
                                            <i data-lucide="alert-circle" size="12"></i>
                                            ูู ูุชู ุงูุฏูุน
                                            <span class="bg-orange-100 text-orange-700 px-1.5 rounded-md text-[10px] min-w-[18px] text-center">${ALL_ORDERS.filter(o => o.status === 'pending_payment' && !o.isArchived).length}</span>
                                        </button>

                                        <!-- ุฌุงุฑู ุงููุฑุงุฌุนุฉ (Review) -->
                                        <button onclick="setAdminOrderFilter('payment_review')" class="whitespace-nowrap px-4 py-2 rounded-full text-xs font-bold border transition-all flex items-center gap-2 ${adminOrderFilter === 'payment_review' ? 'bg-purple-600 text-white border-purple-600 shadow-md' : 'bg-white text-stone-600 border-stone-200 hover:border-purple-300 hover:bg-purple-50'}">
                                            ูุฑุงุฌุนุฉ ุงูุฏูุน
                                            <span class="bg-purple-100 text-purple-700 px-1.5 rounded-md text-[10px] min-w-[18px] text-center">${ALL_ORDERS.filter(o => o.status === 'payment_review' && !o.isArchived).length}</span>
                                        </button>
                                    </div>
                                </div>

                                ${(() => {
                                    let displayOrders = currentOrderTab === 'active' ? ALL_ORDERS.filter(o => !o.isArchived) : ALL_ORDERS.filter(o => o.isArchived);
                                    
                                    // ๐๏ธ 3. Apply New Filter Logic
                                    if (adminOrderFilter === 'confirmed') {
                                        // ุงููุคูุฏุฉ ุชุดูู: ูุคูุฏุ ุฌุงุฑู ุงูุชุฌููุฒุ ุชู ุงูุดุญูุ ุชู ุงูุชูุตูู
                                        displayOrders = displayOrders.filter(o => ['confirmed', 'processing', 'shipped', 'delivered'].includes(o.status));
                                    } else if (adminOrderFilter === 'new') {
                                        // ุงูุฌุฏูุฏุฉ/ุงููุนููุฉ
                                        displayOrders = displayOrders.filter(o => o.status === 'new');
                                    } else if (adminOrderFilter === 'unpaid') {
                                        // ูู ูุชู ุงูุฏูุน
                                        displayOrders = displayOrders.filter(o => o.status === 'pending_payment');
                                    } else if (adminOrderFilter === 'payment_review') {
                                        // ูุฑุงุฌุนุฉ ุงูุฏูุน
                                        displayOrders = displayOrders.filter(o => o.status === 'payment_review');
                                    } else if (adminOrderFilter === 'vodafone') {
                                        // ููุชุฑ ูุฏูู (ูููู ุฅุจูุงุคู ุฃู ุฏูุฌู)
                                        displayOrders = displayOrders.filter(o => o.paymentMethod === 'vodafone_cash');
                                    } else if (adminOrderFilter === 'today') {
                                        const today = new Date();
                                        displayOrders = displayOrders.filter(o => {
                                            if(!o.createdAt) return false;
                                            const d = o.createdAt.toDate ? o.createdAt.toDate() : new Date(o.createdAt);
                                            return d.getDate() === today.getDate() && 
                                                   d.getMonth() === today.getMonth() && 
                                                   d.getFullYear() === today.getFullYear();
                                        });
                                    }

                                    if (displayOrders.length === 0) return `
                                        <div class="bg-white p-12 rounded-3xl text-center shadow-sm border border-stone-100 flex flex-col items-center animate-in fade-in zoom-in duration-300">
                                            <div class="w-20 h-20 bg-stone-50 rounded-full flex items-center justify-center mb-4 text-stone-300">
                                                <i data-lucide="filter" size="32"></i>
                                            </div>
                                            <h3 class="font-bold text-lg text-stone-900 mb-1">ูุง ุชูุฌุฏ ุทูุจุงุช ูู ูุฐุง ุงูุชุตููู</h3>
                                            <p class="text-stone-500 text-xs mb-4">ุญุงูู ุชุบููุฑ ุงูููุชุฑ ุฃู ุงูุจุญุซ ุนู ุทูุจ ุขุฎุฑ.</p>
                                            <button onclick="setAdminOrderFilter('all')" class="bg-stone-900 text-white px-6 py-2 rounded-xl text-xs font-bold hover:bg-stone-800 transition-colors shadow-sm">ุนุฑุถ ูู ุงูุทูุจุงุช</button>
                                        </div>
                                    `;
                                    
                                    // Status options for dropdown
                                    const statuses = [
                                        { val: 'new', label: '๐ต ุทูุจ ุฌุฏูุฏ' }, 
                                        { val: 'pending_payment', label: '๐ ุจุงูุชุธุงุฑ ุงูุฏูุน' }, 
                                        { val: 'payment_review', label: '๐ฃ ูุฑุงุฌุนุฉ ุงูุฏูุน' }, 
                                        { val: 'confirmed', label: 'โ ุชู ุงูุชุฃููุฏ' }, 
                                        { val: 'processing', label: '๐ฆ ุฌุงุฑู ุงูุชุฌููุฒ' },
                                        { val: 'shipped', label: '๐ ุชู ุงูุดุญู' }, 
                                        { val: 'delivered', label: '๐ ุชู ุงูุชูุตูู' },
                                        { val: 'expired', label: 'โ ููุชููุฉ ุงูุตูุงุญูุฉ' }
                                    ];

                                    // --- Confidence Score (Existing Logic) ---
                                    const calculateConfidence = (order) => {
                                        if (order.paymentMethod !== 'vodafone_cash') return null;
                                        let score = 0; let checks = [];
                                        if (order.paymentDetails?.screenshotBase64) { score += 40; checks.push("๐ธ ุณูุฑูู ูุชููุฑ"); } else { checks.push("โ๏ธ ุจูุง ุณูุฑูู"); }
                                        if (order.paymentDetails?.senderPhone && order.customer?.phone) {
                                            const cleanSender = order.paymentDetails.senderPhone.replace(/\D/g, '').slice(-9);
                                            const cleanCust = order.customer.phone.replace(/\D/g, '').slice(-9);
                                            if (cleanSender === cleanCust) { score += 30; checks.push("๐ฑ ุฑูู ูุทุงุจู"); } else { checks.push(`โ๏ธ ุฑูู ูุฎุชูู`); }
                                        }
                                        const prevOrders = ALL_ORDERS.filter(o => o.customer.phone === order.customer.phone && o.id !== order.id && ['confirmed', 'delivered'].includes(o.status)).length;
                                        if (prevOrders > 0) { score += 30; checks.push(`๐ ุนููู ุณุงุจู`); } else { checks.push("๐ค ุฌุฏูุฏ"); }
                                        
                                        let level = 'ููุฎูุถ'; let color = 'bg-red-50 text-red-700 border-red-100';
                                        if (score >= 80) { level = 'ุนุงูู'; color = 'bg-green-50 text-green-700 border-green-100'; }
                                        else if (score >= 40) { level = 'ูุชูุณุท'; color = 'bg-yellow-50 text-yellow-700 border-yellow-100'; }
                                        return { score, level, color, checks };
                                    };

                                    return displayOrders.map(order => {
                                        // Date Logic
                                        let date = "ุบูุฑ ูุญุฏุฏ";
                                        if (order.createdAt) {
                                            const d = order.createdAt.toDate ? order.createdAt.toDate() : new Date(order.createdAt);
                                            date = d.toLocaleString('ar-EG', { month: 'short', day: 'numeric', hour: 'numeric', minute: 'numeric' });
                                        }
                                        
                                        const trackingUrl = `${window.location.origin}${window.location.pathname}#/track-order`;
                                        const statusMsg = `ุชุญุฏูุซ ุจุฎุตูุต ุทูุจู ุฑูู (#${order.id}):\nุญุงูุฉ ุงูุทูุจ ุงูุขู: *${STATUS_ARABIC_MAP[order.status] || order.status}*\nุชุชุจุน: ${trackingUrl}`;
                                        const notifyLink = `https://wa.me/20${order.customer.phone.replace(/^0+/, '')}?text=${encodeURIComponent(statusMsg)}`;
                                        const confidence = calculateConfidence(order);

                                        // Payment Review Block (Shortened)
                                        let paymentReviewHTML = '';
                                        if (order.paymentMethod === 'vodafone_cash' && order.paymentDetails) {
                                            paymentReviewHTML = `
                                            <div class="col-span-1 lg:col-span-2 bg-purple-50/50 border border-purple-100 rounded-xl p-3 mt-2 text-xs">
                                                <div class="flex justify-between items-center mb-2">
                                                    <h4 class="font-bold text-purple-900 flex items-center gap-1"><i data-lucide="smartphone" size="12"></i> ุจูุงูุงุช ุงูุชุญููู</h4>
                                                    ${confidence ? `<span class="${confidence.color} px-2 py-0.5 rounded text-[10px] font-bold border">ุซูุฉ: ${confidence.level}</span>` : ''}
                                                </div>
                                                <div class="flex gap-4 flex-wrap text-stone-600">
                                                    <span><b>ุงููุญูู:</b> ${order.paymentDetails.senderName}</span>
                                                    <span><b>ุงููุจูุบ:</b> ${order.paymentDetails.amountPaid} ุฌ.ู</span>
                                                    <span><b>ุงููุญูุธุฉ:</b> ${order.paymentDetails.senderPhone}</span>
                                                </div>
                                                ${order.paymentDetails.screenshotBase64 ? `<button onclick="var w=window.open('');w.document.write('<img src=\\'${order.paymentDetails.screenshotBase64}\\' style=\\'width:100%\\'>');" class="mt-2 text-purple-600 underline font-bold flex items-center gap-1"><i data-lucide="image" size="12"></i> ุนุฑุถ ุงูุฅูุตุงู</button>` : ''}
                                                
                                                ${order.status === 'payment_review' ? `
                                                <div class="flex gap-2 mt-3 pt-2 border-t border-purple-100">
                                                    <button onclick="handlePaymentDecision('${order.id}', 'approve')" class="flex-1 bg-purple-600 text-white py-1.5 rounded-lg font-bold hover:bg-purple-700 transition-colors">ูุจูู ูุชุฃููุฏ</button>
                                                    <button onclick="handlePaymentDecision('${order.id}', 'reject')" class="flex-1 bg-white border border-red-200 text-red-600 py-1.5 rounded-lg font-bold hover:bg-red-50 transition-colors">ุฑูุถ</button>
                                                </div>` : ''}
                                            </div>`;
                                        }

                                        // Notes HTML
                                        const notesHTML = (order.internalNotes || []).map(n => `
                                            <div class="bg-yellow-50 border-r-2 border-yellow-400 p-1.5 text-[10px] mb-1 text-stone-600">
                                                ${n.text}
                                            </div>
                                        `).join('');

                                        return `
                                        <div class="bg-white rounded-2xl shadow-sm border border-stone-200 overflow-hidden group mb-4 order-card-item transition-all hover:border-stone-300" data-search="${order.id} ${order.customer.name} ${order.customer.phone}">
                                            
                                            <!-- Card Header -->
                                            <div class="bg-stone-50/50 p-3 border-b border-stone-100 flex flex-wrap justify-between items-center gap-2">
                                                <div class="flex items-center gap-3">
                                                    <!-- UPDATED: Show Full Order ID -->
                                                    <div class="font-mono font-bold text-stone-700 text-xs bg-white px-2 py-1 rounded border border-stone-200 cursor-pointer hover:bg-stone-900 hover:text-white transition-colors select-all" onclick="navigator.clipboard.writeText('${order.id}'); showToast('ุชู ุงููุณุฎ')" title="ูุณุฎ ุงููุนุฑู">#${order.id}</div>
                                                    <span class="text-[10px] text-stone-400 font-medium flex items-center gap-1"><i data-lucide="clock" size="10"></i> ${date}</span>
                                                </div>
                                                
                                                <div class="flex items-center gap-2">
                                                    <!-- Status Select -->
                                                    <div class="relative">
                                                         <select onchange="handleOrderStatusChange('${order.id}', this.value)" class="bg-white border ${order.status==='confirmed'?'border-green-200 text-green-700':(order.status==='new'?'border-blue-200 text-blue-700':'border-stone-200 text-stone-700')} text-[10px] font-bold rounded-lg py-1 px-2 pr-6 appearance-none focus:outline-none cursor-pointer shadow-sm w-fit" ${currentOrderTab === 'archived' ? 'disabled' : ''}>
                                                            ${statuses.map(s => `<option value="${s.val}" ${order.status === s.val ? 'selected' : ''}>${s.label}</option>`).join('')}
                                                        </select>
                                                        <i data-lucide="chevron-down" class="absolute left-1.5 top-1/2 -translate-y-1/2 text-stone-400 pointer-events-none" size="12"></i>
                                                    </div>
                                                    <a href="${notifyLink}" target="_blank" class="w-7 h-7 rounded-lg bg-white border border-stone-200 text-stone-400 hover:text-green-600 hover:border-green-200 flex items-center justify-center transition-colors" title="ูุงุชุณุงุจ"><i data-lucide="message-circle" size="14"></i></a>
                                                </div>
                                            </div>

                                            <!-- Card Body -->
                                            <div class="p-4 grid lg:grid-cols-2 gap-4">
                                                <!-- Customer Info -->
                                                <div>
                                                    <div class="flex items-start gap-3 mb-3">
                                                        <div class="w-8 h-8 rounded-full bg-stone-100 flex items-center justify-center text-stone-500 font-bold text-xs shrink-0">${order.customer.name.charAt(0)}</div>
                                                        <div>
                                                            <p class="font-bold text-stone-900 text-sm">${order.customer.name}</p>
                                                            <div class="flex items-center gap-2 mt-0.5">
                                                                <a href="tel:${order.customer.phone}" class="text-xs text-stone-500 font-mono hover:text-blue-600 underline decoration-dotted">${order.customer.phone}</a>
                                                                <button onclick="navigator.clipboard.writeText('${order.customer.phone}'); showToast('ุชู ูุณุฎ ุงูุฑูู')" class="text-stone-300 hover:text-stone-600"><i data-lucide="copy" size="10"></i></button>
                                                            </div>
                                                            <p class="text-[10px] text-stone-500 mt-1 leading-snug max-w-[250px]"><i data-lucide="map-pin" size="10" class="inline text-orange-500"></i> ${order.customer.address}</p>
                                                        </div>
                                                    </div>
                                                    
                                                    ${order.modificationRequest && order.modificationRequest.status === 'pending' ? `
                                                    <div class="bg-orange-50 p-2 rounded-lg border border-orange-200 text-xs text-orange-800 mb-2">
                                                        <b>ุทูุจ ุชุนุฏูู:</b> "${order.modificationRequest.message}"
                                                        <div class="flex gap-2 mt-2">
                                                            <button onclick="handleModDecision('${order.id}', 'approved')" class="bg-white border border-orange-200 px-2 py-0.5 rounded hover:bg-orange-100">ููุงููุฉ</button>
                                                            <button onclick="handleModDecision('${order.id}', 'rejected')" class="bg-white border border-orange-200 px-2 py-0.5 rounded hover:bg-orange-100">ุฑูุถ</button>
                                                        </div>
                                                    </div>` : ''}

                                                    ${paymentReviewHTML}
                                                </div>

                                                <!-- Order Details -->
                                                <div class="border-t lg:border-t-0 lg:border-r border-stone-100 lg:pr-4 pt-3 lg:pt-0">
                                                    <div class="space-y-2 mb-3 max-h-24 overflow-y-auto custom-scrollbar pr-1">
                                                        ${order.items.map(item => `
                                                            <div class="flex justify-between items-center text-xs">
                                                                <div class="flex items-center gap-2 overflow-hidden">
                                                                    <span class="bg-stone-100 text-stone-600 px-1.5 py-0.5 rounded font-bold text-[10px] shrink-0">${item.quantity}x</span>
                                                                    <span class="truncate text-stone-700">${item.name}</span>
                                                                </div>
                                                                <span class="font-bold text-stone-900 dir-ltr text-[10px] shrink-0">$${item.price * item.quantity}</span>
                                                            </div>
                                                        `).join('')}
                                                    </div>
                                                    
                                                    <div class="flex justify-between items-center border-t border-stone-100 pt-2 mb-2">
                                                        <span class="text-xs font-bold text-stone-500">ุงูุฅุฌูุงูู</span>
                                                        <span class="text-sm font-black text-stone-900 font-serif">$${order.totalAmount}</span>
                                                    </div>
                                                    
                                                    <div class="flex justify-between items-center">
                                                        <span class="text-[10px] text-stone-400">ุงูุฏูุน</span>
                                                        ${order.paymentMethod === 'vodafone_cash' ? 
                                                            `<span class="text-[10px] font-bold text-red-600 bg-red-50 px-2 py-0.5 rounded border border-red-100">ููุฏุงููู ูุงุด</span>` : 
                                                            `<span class="text-[10px] font-bold text-green-600 bg-green-50 px-2 py-0.5 rounded border border-green-100">ุงุณุชูุงู</span>`
                                                        }
                                                    </div>

                                                    <!-- Internal Notes Input -->
                                                    <div class="mt-3 bg-stone-50 p-2 rounded-lg border border-stone-100">
                                                        <div class="max-h-16 overflow-y-auto mb-2">${notesHTML}</div>
                                                        <div class="flex gap-1">
                                                            <input id="note-input-${order.id}" class="flex-1 bg-white border border-stone-200 rounded px-2 py-1 text-[10px] outline-none" placeholder="ููุงุญุธุฉ ุฎุงุตุฉ...">
                                                            <button onclick="addInternalNote('${order.id}')" class="bg-stone-200 hover:bg-stone-300 text-stone-600 px-2 py-1 rounded text-[10px] transition-colors"><i data-lucide="plus" size="10"></i></button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Footer Actions -->
                                            <div class="bg-stone-50 border-t border-stone-100 p-2 flex justify-end gap-2">
                                                 <button onclick="handleOrderAction('${order.id}', 'delete')" class="p-1.5 text-stone-400 hover:text-red-500 hover:bg-red-50 rounded transition-colors" title="ุญุฐู ููุงุฆู"><i data-lucide="trash-2" size="14"></i></button>
                                                 <button onclick="openEditOrderModal('${order.id}')" class="p-1.5 text-stone-400 hover:text-blue-600 hover:bg-blue-50 rounded transition-colors" title="ุชุนุฏูู"><i data-lucide="pen-line" size="14"></i></button>
                                                 ${currentOrderTab === 'active' ? 
                                                    `<button onclick="handleOrderAction('${order.id}', 'archive')" class="text-[10px] font-bold text-stone-500 hover:text-stone-800 bg-white border border-stone-200 px-3 py-1 rounded hover:bg-stone-100 transition-colors">ุฃุฑุดูุฉ</button>` : 
                                                    `<button onclick="handleOrderAction('${order.id}', 'restore')" class="text-[10px] font-bold text-blue-600 bg-blue-50 border border-blue-100 px-3 py-1 rounded hover:bg-blue-100 transition-colors">ุงุณุชุนุงุฏุฉ</button>`
                                                 }
                                            </div>
                                        </div>`;
                                    }).join('');
                                })()}
                            </div>
                        ` : ''}

                        <!-- 3. PRODUCTS TAB -->
                        ${currentAdminTab === 'products' ? `
                            <div class="bg-white rounded-3xl p-8 shadow-sm border border-stone-100 fade-in-up">
                                <div class="flex justify-between items-center mb-8 pb-6 border-b border-stone-100">
                                    <h2 class="font-bold text-2xl flex gap-2 items-center text-stone-900">
                                        <i data-lucide="${isEdit ? 'pen-line' : 'package-plus'}" class="text-blue-600"></i>
                                        ${isEdit ? `<span class="text-blue-600">ุชุนุฏูู ุงูููุชุฌ: ${p.name}</span>` : 'ุฅุถุงูุฉ ููุชุฌ ุฌุฏูุฏ'}
                                    </h2>
                                    ${isEdit ? `<button onclick="cancelEdit()" class="text-stone-400 font-bold text-sm hover:text-stone-600 px-4 py-2 hover:bg-white rounded-lg transition-colors">ุฅูุบุงุก ูุนูุฏุฉ ููุฅุถุงูุฉ</button>` : ''}
                                </div>

                                <form onsubmit="handleSaveProduct(event)" class="space-y-8">
                                    <div class="grid md:grid-cols-2 gap-8">
                                        <div class="space-y-4">
                                            <div class="space-y-2">
                                                <label class="text-xs font-bold text-stone-500 uppercase">ุงุณู ุงูููุชุฌ <span class="text-red-500">*</span></label>
                                                <input name="prodName" value="${p.name || ''}" required class="w-full border border-stone-200 p-3.5 rounded-xl focus:ring-2 focus:ring-stone-900 focus:border-stone-900 outline-none transition-all bg-white focus:bg-white placeholder:text-stone-300" placeholder="ูุซุงู: ููุญ ุจุฏูู ุฎุดุจ">
                                            </div>
                                            <div class="grid grid-cols-2 gap-4">
                                                <div class="space-y-2">
                                                    <label class="text-xs font-bold text-stone-500 uppercase">ุงูุณุนุฑ <span class="text-red-500">*</span></label>
                                                    <div class="relative">
                                                        <input name="prodPrice" type="number" step="0.01" value="${p.price || ''}" required class="w-full border border-stone-200 p-3.5 pl-8 rounded-xl focus:ring-2 focus:ring-stone-900 outline-none bg-white focus:bg-white" placeholder="0.00">
                                                        <span class="absolute left-3 top-3.5 text-stone-400 text-xs font-bold">$</span>
                                                    </div>
                                                </div>
                                                <div class="space-y-2">
                                                    <label class="text-xs font-bold text-stone-500 uppercase">ุงูุฎุตู %</label>
                                                    <input name="prodDiscount" type="number" min="0" max="100" value="${p.discount || 0}" class="w-full border border-stone-200 p-3.5 rounded-xl focus:ring-2 focus:ring-stone-900 outline-none bg-white focus:bg-white" placeholder="0">
                                                </div>
                                            </div>
                                            
                                            <div class="grid grid-cols-1 gap-4">
                                                <!-- Expiry Date Field -->
                                                <div class="space-y-2 bg-orange-50 p-3 rounded-xl border border-orange-100">
                                                    <label class="text-xs font-bold text-orange-800 uppercase flex items-center gap-1"><i data-lucide="timer" size="14"></i> ุชุงุฑูุฎ ุงูุชูุงุก ุงูุฎุตู</label>
                                                    <input name="prodExpiry" type="datetime-local" value="${expiryDateStr}" class="w-full border border-orange-200 p-2 rounded-lg text-sm focus:ring-2 focus:ring-orange-500 outline-none bg-white text-stone-700 dir-ltr">
                                                    <p class="text-[10px] text-orange-600">ุงุชุฑูู ูุงุฑุบุงู ุฅุฐุง ูุงู ุงูุฎุตู ุฏุงุฆู</p>
                                                </div>

                                                <!-- NEW: Featured Product Checkbox -->
                                                <div class="flex items-center gap-3 bg-yellow-50 p-4 rounded-xl border border-yellow-100 cursor-pointer hover:bg-yellow-100 transition-colors" onclick="document.getElementById('prodFeatured').click()">
                                                    <input type="checkbox" name="prodFeatured" id="prodFeatured" class="w-5 h-5 accent-yellow-500 rounded cursor-pointer" onclick="event.stopPropagation()" ${p.isFeatured ? 'checked' : ''}>
                                                    <label for="prodFeatured" class="text-sm font-bold text-yellow-800 cursor-pointer select-none flex items-center gap-2">
                                                        <i data-lucide="star" size="16" class="fill-yellow-500 text-yellow-600"></i> ููุชุฌ ูููุฒ (ูุธูุฑ ูู ูุณู ุฎุงุต)
                                                    </label>
                                                </div>

                                                <!-- NEW: In Stock Checkbox -->
                                                <div class="flex items-center gap-3 bg-green-50 p-4 rounded-xl border border-green-100 cursor-pointer hover:bg-green-100 transition-colors" onclick="document.getElementById('prodInStock').click()">
                                                    <input type="checkbox" name="prodInStock" id="prodInStock" class="w-5 h-5 accent-green-500 rounded cursor-pointer" onclick="event.stopPropagation()" ${p.inStock !== false ? 'checked' : ''}>
                                                    <label for="prodInStock" class="text-sm font-bold text-green-800 cursor-pointer select-none flex items-center gap-2">
                                                        <i data-lucide="package-check" size="16" class="text-green-600"></i> ูุชููุฑ ูู ุงููุฎุฒูู (In Stock)
                                                    </label>
                                                </div>
                                            </div>

                                            <div class="space-y-2">
                                                <label class="text-xs font-bold text-stone-500 uppercase">ุงููุณู <span class="text-red-500">*</span></label>
                                                <select name="prodCat" class="w-full border border-stone-200 p-3.5 rounded-xl focus:ring-2 focus:ring-stone-900 outline-none bg-white focus:bg-white cursor-pointer">
                                                    ${CATEGORIES.map(c => `<option ${p.category === c.name ? 'selected' : ''}>${c.name}</option>`).join('')}
                                                </select>
                                            </div>
                                            <div class="space-y-2">
                                                 <label class="text-xs font-bold text-stone-500 uppercase">ุงูุนูุงูุฉ ุงูุชุฌุงุฑูุฉ</label>
                                                 <input name="prodBrand" value="${p.brand || ''}" class="w-full border border-stone-200 p-3.5 rounded-xl focus:ring-2 focus:ring-stone-900 outline-none bg-white focus:bg-white" placeholder="ุงุณู ุงูุจุฑุงูุฏ (ุงุฎุชูุงุฑู)">
                                            </div>
                                        </div>

                                        <div class="space-y-4">
                                            <div class="space-y-2">
                                                <label class="text-xs font-bold text-stone-500 uppercase">ุฑุงุจุท ุงูุตูุฑุฉ ุงูุฑุฆูุณูุฉ <span class="text-red-500">*</span></label>
                                                <input name="prodImg" value="${p.image || ''}" required class="w-full border border-stone-200 p-3.5 rounded-xl focus:ring-2 focus:ring-stone-900 outline-none bg-white focus:bg-white dir-ltr text-left" placeholder="${HERO_SETTINGS.imageBaseUrl ? 'ุฃุฏุฎู ุงุณู ุงูููู ููุท (ูุซู: image_01)' : 'https://example.com/image.jpg'}">
                                                ${HERO_SETTINGS.imageBaseUrl ? `<p class="text-[10px] text-blue-600 dir-rtl">ุณูุชู ุงูุฏูุฌ ุชููุงุฆูุงู ูุน: ${HERO_SETTINGS.imageBaseUrl} ูุงูุชุฏุงุฏ ${HERO_SETTINGS.imageDefaultExt || '.webp'}</p>` : ''}
                                            </div>
                                            <div class="space-y-2">
                                                <label class="text-xs font-bold text-stone-500 uppercase">ุตูุฑ ุฅุถุงููุฉ (ุฑุงุจุท ูู ูู ุณุทุฑ)</label>
                                                <textarea name="prodImages" rows="3" class="w-full border border-stone-200 p-3.5 rounded-xl focus:ring-2 focus:ring-stone-900 outline-none bg-white focus:bg-white dir-ltr text-left custom-scrollbar" placeholder="https://...&#10;https://...">${extraImages}</textarea>
                                            </div>
                                            <!-- NEW: Variants Field -->
                                            <div class="space-y-2">
                                                <label class="text-xs font-bold text-stone-500 uppercase flex items-center gap-1"><i data-lucide="palette" size="14"></i> ุฃููุงู ุงูููุชุฌ (ุงุณู ุงูููู : ุฑุงุจุท ุงูุตูุฑุฉ)</label>
                                                <textarea name="prodVariants" rows="3" class="w-full border border-stone-200 p-3.5 rounded-xl focus:ring-2 focus:ring-stone-900 outline-none bg-white focus:bg-white dir-ltr text-left custom-scrollbar" placeholder="Red: https://...&#10;Blue: https://...">${variantsString}</textarea>
                                                <p class="text-[10px] text-stone-400">ุฃุฏุฎู ูู ููู ูู ุณุทุฑ ุฌุฏูุฏ. ุณูุชู ุนุฑุถ ูุฐู ุงูุฃููุงู ูุฎูุงุฑุงุช ููุนููู.</p>
                                            </div>
                                             <div class="space-y-2">
                                                <label class="text-xs font-bold text-stone-500 uppercase">ุงููุงุฏุฉ (Material)</label>
                                                <input name="prodMaterial" value="${p.material || ''}" class="w-full border border-stone-200 p-3.5 rounded-xl focus:ring-2 focus:ring-stone-900 outline-none bg-white focus:bg-white" placeholder="ูุซุงู: ุฎุดุจ ุฒุงู">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="grid md:grid-cols-2 gap-8 pt-4 border-t border-stone-100">
                                        <div class="space-y-4">
                                            <div class="space-y-2">
                                                <label class="text-xs font-bold text-stone-500 uppercase">ูุตู ุงูููุชุฌ</label>
                                                <textarea name="prodDesc" rows="4" class="w-full border border-stone-200 p-3.5 rounded-xl focus:ring-2 focus:ring-stone-900 outline-none bg-white focus:bg-white" placeholder="ูุตู ุชูุตููู ููููุชุฌ...">${p.description || ''}</textarea>
                                            </div>
                                            <div class="space-y-2">
                                                <label class="text-xs font-bold text-stone-500 uppercase">ุงููููุฒุงุช (ููุทุฉ ูู ูู ุณุทุฑ)</label>
                                                <textarea name="prodFeatures" rows="4" class="w-full border border-stone-200 p-3.5 rounded-xl focus:ring-2 focus:ring-stone-900 outline-none bg-white focus:bg-white" placeholder="- ููุฒุฉ 1&#10;- ููุฒุฉ 2">${features}</textarea>
                                            </div>
                                        </div>
                                        <div class="space-y-4">
                                            <div class="space-y-2">
                                                <label class="text-xs font-bold text-stone-500 uppercase">ุงูููุงุตูุงุช (ุงูุงุณู: ุงููููุฉ)</label>
                                                <textarea name="prodSpecs" rows="4" class="w-full border border-stone-200 p-3.5 rounded-xl focus:ring-2 focus:ring-stone-900 outline-none bg-white focus:bg-white" placeholder="ุงูุทูู: 120 ุณู&#10;ุงููุฒู: 5 ูุฌู">${specsString}</textarea>
                                            </div>
                                            <div class="space-y-2">
                                                <label class="text-xs font-bold text-stone-500 uppercase">ุงูุฎุฏูุงุช (ุฃููููุฉ: ูุต)</label>
                                                <textarea name="prodServices" rows="4" class="w-full border border-stone-200 p-3.5 rounded-xl focus:ring-2 focus:ring-stone-900 outline-none bg-white focus:bg-white dir-ltr text-right" placeholder="truck: ุชูุตูู ูุฌุงูู">${servicesString}</textarea>
                                            </div>
                                        </div>
                                    </div>

                                    <button class="w-full ${isEdit ? 'bg-blue-600 hover:bg-blue-700' : 'bg-stone-900 hover:bg-stone-800'} text-white py-4 rounded-xl font-bold transition-all text-lg shadow-lg hover:shadow-xl hover:-translate-y-0.5 flex justify-center items-center gap-2">
                                        <i data-lucide="${isEdit ? 'save' : 'plus-circle'}"></i>
                                        ${isEdit ? 'ุญูุธ ุงูุชุนุฏููุงุช' : 'ุฅุถุงูุฉ ุงูููุชุฌ ูููุชุฌุฑ'}
                                    </button>
                                </form>
                            </div>
                        ` : ''}

                        <!-- 4. CATEGORIES TAB -->
                        ${currentAdminTab === 'categories' ? `
                            <div class="bg-white rounded-3xl p-8 shadow-sm border border-stone-100 fade-in-up">
                                <div class="flex justify-between items-center mb-8 pb-6 border-b border-stone-100">
                                    <h2 class="font-bold text-2xl flex gap-2 items-center text-stone-900">
                                        <i data-lucide="${currentEditCategoryName ? 'pen-line' : 'folder-plus'}" class="text-blue-600"></i>
                                        ${currentEditCategoryName ? `ุชุนุฏูู ูุณู: <span class="text-blue-600">${currentEditCategoryName}</span>` : 'ุฅุฏุงุฑุฉ ุงูุฃูุณุงู'}
                                    </h2>
                                    ${currentEditCategoryName ? `<button onclick="cancelEditCategory()" class="text-stone-400 font-bold text-sm hover:text-stone-600 px-4 py-2 hover:bg-white rounded-lg transition-colors">ุฅูุบุงุก ุงูุชุนุฏูู</button>` : ''}
                                </div>

                                <form onsubmit="handleAddCategory(event)" class="max-w-xl space-y-6">
                                    <div>
                                        <label class="text-xs font-bold text-stone-500 uppercase mb-2 block">ุงุณู ุงููุณู <span class="text-red-500">*</span></label>
                                        <input name="catName" value="${catNameVal}" required class="w-full border border-stone-200 p-3.5 rounded-xl focus:ring-2 focus:ring-stone-900 outline-none bg-white focus:bg-white" placeholder="ูุซุงู: ุฏูููุฑุงุช ุญุงุฆุท">
                                    </div>
                                    
                                    <div>
                                        <label class="text-xs font-bold text-stone-500 uppercase mb-2 block">ุตูุฑุฉ ุงููุณู (ุฑุงุจุท) <span class="text-red-500">*</span></label>
                                        <input name="catImg" value="${catImgVal}" required class="w-full border border-stone-200 p-3.5 rounded-xl focus:ring-2 focus:ring-stone-900 outline-none bg-white focus:bg-white dir-ltr text-left" placeholder="https://...">
                                    </div>

                                    <button class="w-full ${currentEditCategoryName ? 'bg-blue-600 hover:bg-blue-700' : 'bg-stone-900 hover:bg-stone-800'} text-white py-3.5 rounded-xl font-bold transition-all shadow-md flex justify-center items-center gap-2">
                                        <i data-lucide="${currentEditCategoryName ? 'save' : 'plus'}"></i>
                                        ${currentEditCategoryName ? 'ุญูุธ ุงูุชุบููุฑุงุช' : 'ุฅุถุงูุฉ ุงููุณู'}
                                    </button>
                                </form>

                                <div class="mt-12">
                                    <h3 class="font-bold text-lg text-stone-900 mb-4 border-b border-stone-100 pb-2">ุงูุฃูุณุงู ุงูุญุงููุฉ</h3>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        ${CATEGORIES.map(c => `
                                            <div class="flex items-center gap-4 bg-white p-3 rounded-xl border border-stone-200 group hover:border-stone-300 transition-colors">
                                                <div class="w-16 h-16 rounded-lg bg-white overflow-hidden border border-stone-100 shrink-0">
                                                    <img src="${c.image}" class="w-full h-full object-cover">
                                                </div>
                                                <div class="flex-1">
                                                    <h4 class="font-bold text-stone-900">${c.name}</h4>
                                                    <p class="text-xs text-stone-400">ูุณู ูุดุท</p>
                                                </div>
                                                <div class="flex gap-2 opacity-100 sm:opacity-0 group-hover:opacity-100 transition-opacity">
                                                    <button onclick="prepareEditCategory('${c.name}')" class="p-2 bg-white text-blue-600 border border-blue-100 hover:bg-blue-50 rounded-lg transition-colors shadow-sm"><i data-lucide="pen-line" size="16"></i></button>
                                                    <button onclick="handleDeleteCategory('${c.name}')" class="p-2 bg-white text-red-600 border border-red-100 hover:bg-red-50 rounded-lg transition-colors shadow-sm"><i data-lucide="trash-2" size="16"></i></button>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        ` : ''}

                        <!-- 5. SETTINGS TAB (RESTORED) -->
                        ${currentAdminTab === 'settings' ? `
                            <div class="bg-white rounded-3xl p-8 shadow-sm border border-stone-100 fade-in-up">
                                <div class="flex justify-between items-center mb-8 pb-6 border-b border-stone-100">
                                    <h2 class="font-bold text-2xl flex gap-2 items-center text-stone-900">
                                        <i data-lucide="layout-template" class="text-stone-900"></i>
                                        ุฅุนุฏุงุฏุงุช ุงููููุน ูุงููุงุฌูุฉ
                                    </h2>
                                </div>

                                <form onsubmit="handleSaveHeroSettings(event)" class="space-y-8 max-w-3xl">
                                    
                                    <!-- NEW: Image Configuration Settings -->
                                    <div class="space-y-4 p-6 bg-blue-50 rounded-2xl border border-blue-200">
                                        <h3 class="font-bold text-blue-800 flex items-center gap-2"><i data-lucide="image-plus"></i> ุชูููู ุฑูุงุจุท ุงูุตูุฑ (ุชููุงุฆู)</h3>
                                        <div class="grid md:grid-cols-3 gap-6">
                                            <div class="md:col-span-2">
                                                <label class="text-xs font-bold text-stone-500 uppercase mb-2 block">ุฑุงุจุท ุงููุงุนุฏุฉ (Base URL)</label>
                                                <input name="imgBaseUrl" value="${HERO_SETTINGS.imageBaseUrl || ''}" class="w-full border border-stone-200 p-3 rounded-xl text-sm focus:ring-2 focus:ring-blue-900 outline-none dir-ltr bg-white" placeholder="https://example.com/images/">
                                                <p class="text-[10px] text-stone-500 mt-1">ุงููุณุงุฑ ุงูุซุงุจุช ุงูุฐู ุชุฑูุน ุนููู ุตูุฑ ููุชุฌุงุชู</p>
                                            </div>
                                            <div>
                                                <label class="text-xs font-bold text-stone-500 uppercase mb-2 block">ุงูุงูุชุฏุงุฏ ุงูุงูุชุฑุงุถู</label>
                                                <input name="imgExt" value="${HERO_SETTINGS.imageDefaultExt || '.webp'}" class="w-full border border-stone-200 p-3 rounded-xl text-sm focus:ring-2 focus:ring-blue-900 outline-none dir-ltr bg-white" placeholder=".webp">
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Logo Settings -->
                                    <div class="space-y-4 p-6 bg-white rounded-2xl border border-stone-200">
                                        <h3 class="font-bold text-blue-600 flex items-center gap-2"><i data-lucide="image-plus"></i> ูููุฉ ุงููููุน (ุงูุดุนุงุฑ)</h3>
                                        <div class="grid md:grid-cols-2 gap-6">
                                            <div>
                                                <label class="text-xs font-bold text-stone-500 uppercase mb-2 block">ุฑุงุจุท ุงูุดุนุงุฑ (Logo URL)</label>
                                                <input name="siteLogo" value="${HERO_SETTINGS.logoUrl || ''}" class="w-full border border-stone-200 p-3 rounded-xl text-sm focus:ring-2 focus:ring-stone-900 outline-none dir-ltr bg-white" placeholder="https://... (ุงุชุฑูู ูุงุฑุบุงู ูููุต)">
                                            </div>
                                            <div>
                                                <label class="text-xs font-bold text-stone-500 uppercase mb-2 block">ุญุฌู ุงูุดุนุงุฑ (ุนุฑุถ ุจุงูุจูุณู)</label>
                                                <div class="relative">
                                                    <input name="logoSize" type="number" value="${HERO_SETTINGS.logoSize || '100'}" class="w-full border border-stone-200 p-3 pl-10 rounded-xl text-sm focus:ring-2 focus:ring-stone-900 outline-none dir-ltr bg-white" placeholder="100">
                                                    <span class="absolute left-3 top-3.5 text-stone-400 text-xs font-bold">px</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- General Visibility Settings (Restored) -->
                                    <div class="space-y-4 p-6 bg-stone-50 rounded-2xl border border-stone-200">
                                        <h3 class="font-bold text-stone-700 flex items-center gap-2"><i data-lucide="eye"></i> ุฅุนุฏุงุฏุงุช ุงูุนุฑุถ ูุงูุธููุฑ</h3>
                                        <div class="flex flex-wrap gap-4">
                                            <label class="flex items-center gap-3 cursor-pointer bg-white px-5 py-3 rounded-xl border border-stone-200 hover:border-stone-900 transition-all shadow-sm group">
                                                <div class="relative flex items-center">
                                                    <input type="checkbox" name="catBarShow" class="peer w-5 h-5 accent-stone-900 rounded cursor-pointer" ${HERO_SETTINGS.showCategoryBar !== false ? 'checked' : ''}>
                                                </div>
                                                <span class="text-sm font-bold text-stone-600 group-hover:text-stone-900 flex items-center gap-2">
                                                    <i data-lucide="circle-dot" size="18" class="text-stone-400 group-hover:text-stone-900"></i> 
                                                    ุดุฑูุท ุชุตูุญ ุงูุฃูุณุงู (ุงูุฏูุงุฆุฑ)
                                                </span>
                                            </label>
                                        </div>
                                    </div>

                                    <!-- Header Banner Settings -->
                                    <div class="space-y-4 p-6 bg-orange-50 rounded-2xl border border-orange-200">
                                        <div class="flex justify-between items-center">
                                            <h3 class="font-bold text-orange-600 flex items-center gap-2"><i data-lucide="monitor"></i> ุจุงูุฑ ุฅุนูุงูู (ุฃุณูู ุงูููุฏุฑ)</h3>
                                            <label class="flex items-center gap-2 cursor-pointer">
                                                <input type="checkbox" name="fbShow" class="w-5 h-5 accent-orange-600 rounded" ${HERO_SETTINGS.showFooterBanner ? 'checked' : ''}>
                                                <span class="text-sm font-bold text-orange-800">ุชูุนูู ุงูุจุงูุฑ</span>
                                            </label>
                                        </div>
                                        
                                        <div class="space-y-6">
                                            <!-- Desktop URLs -->
                                            <div>
                                                <label class="text-xs font-bold text-stone-500 uppercase mb-2 block flex items-center gap-2"><i data-lucide="monitor" size="14"></i> ุตูุฑ ุงูููุจููุชุฑ (ุฑุงุจุท ูู ูู ุณุทุฑ)</label>
                                                <textarea name="fbUrl" rows="3" class="w-full border border-stone-200 p-3 rounded-xl text-sm focus:ring-2 focus:ring-orange-600 outline-none dir-ltr bg-white custom-scrollbar" placeholder="https://desktop-image.jpg">${HERO_SETTINGS.footerBannerUrl || ''}</textarea>
                                            </div>

                                            <!-- Mobile URLs (NEW) -->
                                            <div>
                                                <label class="text-xs font-bold text-stone-500 uppercase mb-2 block flex items-center gap-2"><i data-lucide="smartphone" size="14"></i> ุตูุฑ ุงูููุจุงูู (ุฑุงุจุท ูู ูู ุณุทุฑ)</label>
                                                <textarea name="fbUrlMob" rows="3" class="w-full border border-stone-200 p-3 rounded-xl text-sm focus:ring-2 focus:ring-orange-600 outline-none dir-ltr bg-white custom-scrollbar" placeholder="https://mobile-image.jpg (ุงุฎุชูุงุฑู)">${HERO_SETTINGS.footerBannerUrlMobile || ''}</textarea>
                                                <p class="text-[9px] text-stone-400 mt-1">ุฅุฐุง ุชุฑู ูุงุฑุบุงู ุณูุชู ุงุณุชุฎุฏุงู ุตูุฑ ุงูููุจููุชุฑ</p>
                                            </div>
                                            
                                            <!-- Desktop Settings -->
                                            <div class="bg-white p-4 rounded-xl border border-stone-200">
                                                <h4 class="font-bold text-stone-800 mb-3 flex items-center gap-2"><i data-lucide="monitor" size="14"></i> ุฅุนุฏุงุฏุงุช ุงูููุจููุชุฑ</h4>
                                                <div class="grid grid-cols-3 gap-4">
                                                    <div>
                                                        <label class="text-[10px] font-bold text-stone-500 uppercase block mb-1">ุงูุงุฑุชูุงุน (px)</label>
                                                        <input name="fbHeightDesk" type="number" value="${HERO_SETTINGS.fbHeightDesktop || HERO_SETTINGS.footerBannerHeight || '300'}" class="w-full border border-stone-200 p-2 rounded-lg text-sm text-center">
                                                    </div>
                                                    <div>
                                                        <label class="text-[10px] font-bold text-stone-500 uppercase block mb-1">ุงูุนุฑุถ (%)</label>
                                                        <input name="fbWidthDesk" type="number" value="${HERO_SETTINGS.fbWidthDesktop || HERO_SETTINGS.footerBannerWidth || '90'}" class="w-full border border-stone-200 p-2 rounded-lg text-sm text-center">
                                                    </div>
                                                    <div>
                                                        <label class="text-[10px] font-bold text-stone-500 uppercase block mb-1">ุงูุญูุงู (Radius)</label>
                                                        <input name="fbRadiusDesk" value="${HERO_SETTINGS.fbRadiusDesktop || HERO_SETTINGS.footerBannerRadius || '2rem'}" class="w-full border border-stone-200 p-2 rounded-lg text-sm text-center">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Mobile Settings -->
                                            <div class="bg-white p-4 rounded-xl border border-stone-200">
                                                <h4 class="font-bold text-stone-800 mb-3 flex items-center gap-2"><i data-lucide="smartphone" size="14"></i> ุฅุนุฏุงุฏุงุช ุงูููุจุงูู</h4>
                                                <div class="grid grid-cols-3 gap-4">
                                                    <div>
                                                        <label class="text-[10px] font-bold text-stone-500 uppercase block mb-1">ุงูุงุฑุชูุงุน (px)</label>
                                                        <input name="fbHeightMob" type="number" value="${HERO_SETTINGS.fbHeightMobile || '150'}" class="w-full border border-stone-200 p-2 rounded-lg text-sm text-center">
                                                    </div>
                                                    <div>
                                                        <label class="text-[10px] font-bold text-stone-500 uppercase block mb-1">ุงูุนุฑุถ (%)</label>
                                                        <input name="fbWidthMob" type="number" value="${HERO_SETTINGS.fbWidthMobile || '95'}" class="w-full border border-stone-200 p-2 rounded-lg text-sm text-center">
                                                    </div>
                                                    <div>
                                                        <label class="text-[10px] font-bold text-stone-500 uppercase block mb-1">ุงูุญูุงู (Radius)</label>
                                                        <input name="fbRadiusMob" value="${HERO_SETTINGS.fbRadiusMobile || '1rem'}" class="w-full border border-stone-200 p-2 rounded-lg text-sm text-center">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Category Banner Settings -->
                                    <div class="space-y-4 p-6 bg-green-50 rounded-2xl border border-green-200">
                                        <div class="flex justify-between items-center">
                                            <h3 class="font-bold text-green-600 flex items-center gap-2"><i data-lucide="layout"></i> ุจุงูุฑ ุฅุนูุงูู (ุฃุณูู ุงูุฃูุณุงู)</h3>
                                            <label class="flex items-center gap-2 cursor-pointer">
                                                <input type="checkbox" name="catBanShow" class="w-5 h-5 accent-green-600 rounded" ${HERO_SETTINGS.showCategoryBanner ? 'checked' : ''}>
                                                <span class="text-sm font-bold text-green-800">ุชูุนูู ุงูุจุงูุฑ</span>
                                            </label>
                                        </div>
                                        
                                        <div class="space-y-6">
                                            <div>
                                                <label class="text-xs font-bold text-stone-500 uppercase mb-2 block">ุฑุงุจุท ุตูุฑ ุงูุจุงูุฑ (ูู ุฑุงุจุท ูู ุณุทุฑ)</label>
                                                <textarea name="catBanUrl" rows="3" class="w-full border border-stone-200 p-3 rounded-xl text-sm focus:ring-2 focus:ring-green-600 outline-none dir-ltr bg-white custom-scrollbar" placeholder="https://image1.jpg&#10;https://image2.jpg">${HERO_SETTINGS.categoryBannerUrl || ''}</textarea>
                                            </div>

                                            <!-- Desktop Settings -->
                                            <div class="bg-white p-4 rounded-xl border border-stone-200">
                                                <h4 class="font-bold text-stone-800 mb-3 flex items-center gap-2"><i data-lucide="monitor" size="14"></i> ุฅุนุฏุงุฏุงุช ุงูููุจููุชุฑ</h4>
                                                <div class="grid grid-cols-3 gap-4">
                                                    <div>
                                                        <label class="text-[10px] font-bold text-stone-500 uppercase block mb-1">ุงูุงุฑุชูุงุน (px)</label>
                                                        <input name="catBanHeightDesk" type="number" value="${HERO_SETTINGS.catBanHeightDesktop || HERO_SETTINGS.categoryBannerHeight || '250'}" class="w-full border border-stone-200 p-2 rounded-lg text-sm text-center">
                                                    </div>
                                                    <div>
                                                        <label class="text-[10px] font-bold text-stone-500 uppercase block mb-1">ุงูุนุฑุถ (%)</label>
                                                        <input name="catBanWidthDesk" type="number" value="${HERO_SETTINGS.catBanWidthDesktop || HERO_SETTINGS.categoryBannerWidth || '90'}" class="w-full border border-stone-200 p-2 rounded-lg text-sm text-center">
                                                    </div>
                                                    <div>
                                                        <label class="text-[10px] font-bold text-stone-500 uppercase block mb-1">ุงูุญูุงู (Radius)</label>
                                                        <input name="catBanRadiusDesk" value="${HERO_SETTINGS.catBanRadiusDesktop || HERO_SETTINGS.categoryBannerRadius || '1.5rem'}" class="w-full border border-stone-200 p-2 rounded-lg text-sm text-center">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Mobile Settings -->
                                            <div class="bg-white p-4 rounded-xl border border-stone-200">
                                                <h4 class="font-bold text-stone-800 mb-3 flex items-center gap-2"><i data-lucide="smartphone" size="14"></i> ุฅุนุฏุงุฏุงุช ุงูููุจุงูู</h4>
                                                <div class="grid grid-cols-3 gap-4">
                                                    <div>
                                                        <label class="text-[10px] font-bold text-stone-500 uppercase block mb-1">ุงูุงุฑุชูุงุน (px)</label>
                                                        <input name="catBanHeightMob" type="number" value="${HERO_SETTINGS.catBanHeightMobile || '120'}" class="w-full border border-stone-200 p-2 rounded-lg text-sm text-center">
                                                    </div>
                                                    <div>
                                                        <label class="text-[10px] font-bold text-stone-500 uppercase block mb-1">ุงูุนุฑุถ (%)</label>
                                                        <input name="catBanWidthMob" type="number" value="${HERO_SETTINGS.catBanWidthMobile || '95'}" class="w-full border border-stone-200 p-2 rounded-lg text-sm text-center">
                                                    </div>
                                                    <div>
                                                        <label class="text-[10px] font-bold text-stone-500 uppercase block mb-1">ุงูุญูุงู (Radius)</label>
                                                        <input name="catBanRadiusMob" value="${HERO_SETTINGS.catBanRadiusMobile || '0.8rem'}" class="w-full border border-stone-200 p-2 rounded-lg text-sm text-center">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Best Seller Banner Settings -->
                                    <div class="space-y-4 p-6 bg-purple-50 rounded-2xl border border-purple-200">
                                        <div class="flex justify-between items-center">
                                            <h3 class="font-bold text-purple-600 flex items-center gap-2"><i data-lucide="trending-up"></i> ุจุงูุฑ ุฅุนูุงูู (ุฃุณูู ุงูุฃูุซุฑ ูุจูุนุงู)</h3>
                                            <label class="flex items-center gap-2 cursor-pointer">
                                                <input type="checkbox" name="bsBanShow" class="w-5 h-5 accent-purple-600 rounded" ${HERO_SETTINGS.showBestSellerBanner ? 'checked' : ''}>
                                                <span class="text-sm font-bold text-purple-800">ุชูุนูู ุงูุจุงูุฑ</span>
                                            </label>
                                        </div>
                                        
                                        <div class="space-y-4">
                                            <div>
                                                <label class="text-xs font-bold text-stone-500 uppercase mb-2 block">ุฑุงุจุท ุตูุฑุฉ ุงูุจุงูุฑ</label>
                                                <input name="bsBanUrl" value="${HERO_SETTINGS.bestSellerBannerUrl || ''}" class="w-full border border-stone-200 p-3 rounded-xl text-sm focus:ring-2 focus:ring-purple-600 outline-none dir-ltr bg-white" placeholder="https://...">
                                            </div>
                                            <div class="grid grid-cols-2 gap-6">
                                                <div>
                                                    <label class="text-xs font-bold text-stone-500 uppercase mb-2 block">ุงูุงุฑุชูุงุน (Height px)</label>
                                                    <div class="relative">
                                                        <input name="bsBanHeight" type="number" value="${HERO_SETTINGS.bestSellerBannerHeight || '200'}" class="w-full border border-stone-200 p-3 pl-10 rounded-xl text-sm focus:ring-2 focus:ring-purple-600 outline-none dir-ltr bg-white" placeholder="200">
                                                        <span class="absolute left-3 top-3.5 text-stone-400 text-xs font-bold">px</span>
                                                    </div>
                                                </div>
                                                <div>
                                                    <label class="text-xs font-bold text-stone-500 uppercase mb-2 block">ุงูุนุฑุถ (Width %)</label>
                                                    <div class="relative">
                                                        <input name="bsBanWidth" type="number" value="${HERO_SETTINGS.bestSellerBannerWidth || '100'}" class="w-full border border-stone-200 p-3 pl-10 rounded-xl text-sm focus:ring-2 focus:ring-purple-600 outline-none dir-ltr bg-white" placeholder="100">
                                                        <span class="absolute left-3 top-3.5 text-stone-400 text-xs font-bold">%</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Featured Banner Settings -->
                                    <div class="space-y-4 p-6 bg-yellow-50 rounded-2xl border border-yellow-200">
                                        <div class="flex justify-between items-center">
                                            <h3 class="font-bold text-yellow-600 flex items-center gap-2"><i data-lucide="arrow-up-circle"></i> ุจุงูุฑ ุฅุนูุงูู (ุฃุนูู ุงูููุฏุฑ)</h3>
                                            <label class="flex items-center gap-2 cursor-pointer">
                                                <input type="checkbox" name="ftBanShow" class="w-5 h-5 accent-yellow-600 rounded" ${HERO_SETTINGS.showFeaturedBanner ? 'checked' : ''}>
                                                <span class="text-sm font-bold text-yellow-800">ุชูุนูู ุงูุจุงูุฑ</span>
                                            </label>
                                        </div>
                                        
                                        <div class="space-y-6">
                                            <!-- Desktop Settings Block -->
                                            <div class="bg-white p-3 rounded-xl border border-stone-100">
                                                <h4 class="text-xs font-bold text-stone-800 mb-2 flex items-center gap-1"><i data-lucide="monitor" size="12"></i> ุฅุนุฏุงุฏุงุช ุงูููุจููุชุฑ</h4>
                                                <div class="space-y-3">
                                                    <div>
                                                        <label class="text-[10px] font-bold text-stone-500 uppercase mb-1 block">ุฑุงุจุท ุงูุตูุฑุฉ (Desktop URL)</label>
                                                        <input name="ftBanUrl" value="${HERO_SETTINGS.featuredBannerUrl || ''}" class="w-full border border-stone-200 p-2 rounded-lg text-sm focus:ring-1 focus:ring-yellow-500 outline-none dir-ltr bg-white" placeholder="https://...">
                                                    </div>
                                                    <div class="grid grid-cols-2 gap-4">
                                                        <div>
                                                            <label class="text-[10px] font-bold text-stone-500 uppercase mb-1 block">ุงูุงุฑุชูุงุน (px)</label>
                                                            <div class="relative">
                                                                <input name="ftBanHeightDesk" type="number" value="${HERO_SETTINGS.featuredBannerHeightDesktop || HERO_SETTINGS.featuredBannerHeight || '60'}" class="w-full border border-stone-200 p-2 pl-8 rounded-lg text-sm focus:ring-1 focus:ring-yellow-500 outline-none" placeholder="60">
                                                                <span class="absolute left-2 top-2.5 text-stone-400 text-[10px] font-bold">px</span>
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <label class="text-[10px] font-bold text-stone-500 uppercase mb-1 block">ุงูุนุฑุถ (%)</label>
                                                            <div class="relative">
                                                                <input name="ftBanWidthDesk" type="number" value="${HERO_SETTINGS.featuredBannerWidthDesktop || '100'}" class="w-full border border-stone-200 p-2 pl-8 rounded-lg text-sm focus:ring-1 focus:ring-yellow-500 outline-none" placeholder="100">
                                                                <span class="absolute left-2 top-2.5 text-stone-400 text-[10px] font-bold">%</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Mobile Settings Block -->
                                            <div class="bg-white p-3 rounded-xl border border-stone-100">
                                                <h4 class="text-xs font-bold text-stone-800 mb-2 flex items-center gap-1"><i data-lucide="smartphone" size="12"></i> ุฅุนุฏุงุฏุงุช ุงูููุจุงูู</h4>
                                                <div class="space-y-3">
                                                    <div>
                                                        <label class="text-[10px] font-bold text-stone-500 uppercase mb-1 block">ุฑุงุจุท ุตูุฑุฉ ุงูููุจุงูู (Mobile URL)</label>
                                                        <input name="ftBanUrlMob" value="${HERO_SETTINGS.featuredBannerUrlMobile || ''}" class="w-full border border-stone-200 p-2 rounded-lg text-sm focus:ring-1 focus:ring-yellow-500 outline-none dir-ltr bg-white" placeholder="https://... (ุงุฎุชูุงุฑู)">
                                                        <p class="text-[9px] text-stone-400 mt-0.5">ุฅุฐุง ุชุฑู ูุงุฑุบุงู ุณูุชู ุงุณุชุฎุฏุงู ุตูุฑุฉ ุงูููุจููุชุฑ</p>
                                                    </div>
                                                    <div class="grid grid-cols-2 gap-4">
                                                        <div>
                                                            <label class="text-[10px] font-bold text-stone-500 uppercase mb-1 block">ุงูุงุฑุชูุงุน (px)</label>
                                                            <div class="relative">
                                                                <input name="ftBanHeightMob" type="number" value="${HERO_SETTINGS.featuredBannerHeightMobile || '40'}" class="w-full border border-stone-200 p-2 pl-8 rounded-lg text-sm focus:ring-1 focus:ring-yellow-500 outline-none" placeholder="40">
                                                                <span class="absolute left-2 top-2.5 text-stone-400 text-[10px] font-bold">px</span>
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <label class="text-[10px] font-bold text-stone-500 uppercase mb-1 block">ุงูุนุฑุถ (%)</label>
                                                            <div class="relative">
                                                                <input name="ftBanWidthMob" type="number" value="${HERO_SETTINGS.featuredBannerWidthMobile || '100'}" class="w-full border border-stone-200 p-2 pl-8 rounded-lg text-sm focus:ring-1 focus:ring-yellow-500 outline-none" placeholder="100">
                                                                <span class="absolute left-2 top-2.5 text-stone-400 text-[10px] font-bold">%</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <p class="text-[10px] text-yellow-800 mt-1">ููุงุญุธุฉ: ูุฐุง ุงูุจุงูุฑ ูุธูุฑ ูุซุจุชุงู ุฃุนูู ุงูุตูุญุฉ.</p>
                                        </div>
                                    </div>

                                    <!-- NEW: Payment Banner Settings (Inside Product Page) -->
                                    <div class="space-y-4 p-6 bg-emerald-50 rounded-2xl border border-emerald-200">
                                        <div class="flex justify-between items-center">
                                            <h3 class="font-bold text-emerald-700 flex items-center gap-2"><i data-lucide="credit-card"></i> ุจุงูุฑ ุทุฑู ุงูุฏูุน (ุตูุญุฉ ุงูููุชุฌ)</h3>
                                            <label class="flex items-center gap-2 cursor-pointer">
                                                <input type="checkbox" name="payBanShow" class="w-5 h-5 accent-emerald-600 rounded" ${HERO_SETTINGS.showPaymentBanner ? 'checked' : ''}>
                                                <span class="text-sm font-bold text-emerald-800">ุชูุนูู ุงูุจุงูุฑ</span>
                                            </label>
                                        </div>
                                        
                                        <div class="space-y-4">
                                            <div>
                                                <label class="text-xs font-bold text-stone-500 uppercase mb-2 block">ุฑุงุจุท ุตูุฑุฉ ุทุฑู ุงูุฏูุน</label>
                                                <input name="payBanUrl" value="${HERO_SETTINGS.paymentBannerUrl || ''}" class="w-full border border-stone-200 p-3 rounded-xl text-sm focus:ring-2 focus:ring-emerald-600 outline-none dir-ltr bg-white" placeholder="https://example.com/payments.png">
                                            </div>
                                            
                                            <!-- ุฃุฒุฑุงุฑ ุงูุชุญูู ูู ุงูุญุฌู -->
                                            <div class="grid grid-cols-2 gap-6">
                                                <div>
                                                    <label class="text-xs font-bold text-stone-500 uppercase mb-2 block">ุงูุงุฑุชูุงุน (Height px)</label>
                                                    <div class="relative">
                                                        <input name="payBanHeight" type="number" value="${HERO_SETTINGS.paymentBannerHeight || '60'}" class="w-full border border-stone-200 p-3 pl-10 rounded-xl text-sm focus:ring-2 focus:ring-emerald-600 outline-none dir-ltr bg-white">
                                                        <span class="absolute left-3 top-3.5 text-stone-400 text-xs font-bold">px</span>
                                                    </div>
                                                </div>
                                                <div>
                                                    <label class="text-xs font-bold text-stone-500 uppercase mb-2 block">ุงูุนุฑุถ (Width CSS)</label>
                                                    <input name="payBanWidth" value="${HERO_SETTINGS.paymentBannerWidth || 'auto'}" class="w-full border border-stone-200 p-3 rounded-xl text-sm focus:ring-2 focus:ring-emerald-600 outline-none dir-ltr bg-white" placeholder="auto ุฃู 100%">
                                                </div>
                                            </div>
                                            <p class="text-[10px] text-stone-500 mt-1">ูุธูุฑ ูุฐุง ุงูุจุงูุฑ ุชุญุช ุฒุฑ "ุงูุฅุจูุงุบ ุนู ูุดููุฉ". ููููู ุชูุจูุฑ ุงูุงุฑุชูุงุน ููุง ุชุดุงุก.</p>
                                        </div>
                                    </div>

                                    <!-- ุชู ุฅุฒุงูุฉ ุฅุนุฏุงุฏุงุช Heroุ ุจุทุงูุฉ ุงูุณุนุฑุ ูุฏุงุฆุฑุฉ ุงูุฎุตู -->

                                    <button class="w-full bg-stone-900 text-white hover:bg-stone-800 py-4 rounded-xl font-bold transition-all shadow-lg flex justify-center items-center gap-2">
                                        <i data-lucide="save"></i> ุญูุธ ูุชุญุฏูุซ ุงูุฅุนุฏุงุฏุงุช
                                    </button>
                                </form>
                            </div>
                        ` : ''}

                    </div>
                </div>
            </div>`;
        }

        function renderLogin(c) {
            c.innerHTML = `
                <!-- ุชู ุชุนุฏูู pt-32 ุฅูู pt-28 -->
                <div class="min-h-screen flex items-center justify-center bg-white px-6 pt-28 md:pt-20">
                    <div class="bg-white p-8 md:p-12 rounded-3xl shadow-xl max-w-md w-full text-center space-y-8 fade-in-up">
                        <div class="flex justify-center mb-4"><div class="p-4 bg-stone-100 rounded-full"><i data-lucide="shield-check" size="32" class="text-stone-900"></i></div></div>
                        <div>
                            <h2 class="text-3xl font-serif font-bold text-stone-900 mb-2">ุฏุฎูู ุงููุงูู</h2>
                            <p class="text-stone-500 text-sm leading-relaxed">ูุฐู ุงูููุทูุฉ ูุญุธูุฑุฉ ููุฎุตุตุฉ ููุท ูุฅุฏุงุฑุฉ ุงููุชุฌุฑ ุจูุงุณุทุฉ ุงููุงูู.<br>ุฃู ูุญุงููุฉ ุฏุฎูู ุจุญุณุงุจ ุขุฎุฑ ุณูุชู ุฑูุถูุง.</p>
                        </div>
                        <button onclick="loginWithGoogle()" class="w-full flex items-center justify-center gap-3 bg-stone-900 text-white font-bold py-4 rounded-xl hover:bg-stone-800 transition-all hover:shadow-lg group">
                            <svg class="w-5 h-5 bg-white rounded-full p-0.5" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
                            <span>ุชุณุฌูู ุงูุฏุฎูู (ุงููุงูู ููุท)</span>
                        </button>
                        <button onclick="setView('home')" class="text-sm text-stone-400 hover:text-stone-900 underline underline-offset-4">ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ ูุฒุงุฆุฑ</button>
                    </div>
                </div>
            `;
        }

        function renderContact(c) {
            // ... existing contact code ...
            c.innerHTML = `
            <!-- ุชู ุชุนุฏูู pt-28 ุฅูู pt-40 ูููุงุชู ูููุน ุงุฎุชูุงุก ุงููุญุชูู ุชุญุช ุงูููุฏุฑ -->
            <div class="pt-40 md:pt-24 pb-20 container mx-auto px-6 min-h-screen bg-white/30">
                <!-- ... existing content ... -->
                <div class="grid md:grid-cols-3 gap-6 max-w-6xl mx-auto fade-in-up" style="animation-delay: 0.1s;">
                    <!-- ... cards ... -->
                    <a href="https://wa.me/201014175070" target="_blank" class="bg-white p-8 rounded-3xl shadow-sm border border-stone-100 flex flex-col items-center text-center hover:shadow-xl hover:-translate-y-1 transition-all group relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-1 bg-[#25D366]"></div>
                        <div class="w-16 h-16 bg-[#25D366]/10 text-[#25D366] rounded-2xl flex items-center justify-center mb-6 group-hover:bg-[#25D366] group-hover:text-white transition-colors">
                            <i data-lucide="message-circle" size="32"></i>
                        </div>
                        <h3 class="font-bold text-xl text-stone-900 mb-2">ูุงุชุณุงุจ ุงููุนุฑุถ</h3>
                        <p class="text-stone-500 text-sm mb-4">ุชุญุฏุซ ูุนูุง ูุจุงุดุฑุฉ ูุฎุฏูุฉ ุฃุณุฑุน</p>
                        <span class="font-mono dir-ltr font-bold text-stone-800 text-lg group-hover:text-[#25D366] transition-colors bg-white px-4 py-2 rounded-lg group-hover:bg-[#25D366]/5">01014175070</span>
                    </a>

                    <a href="mailto:gedar.fayoum@gmail.com" class="bg-white p-8 rounded-3xl shadow-sm border border-stone-100 flex flex-col items-center text-center hover:shadow-xl hover:-translate-y-1 transition-all group relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-1 bg-blue-600"></div>
                        <div class="w-16 h-16 bg-blue-50 text-blue-600 rounded-2xl flex items-center justify-center mb-6 group-hover:bg-blue-600 group-hover:text-white transition-colors">
                            <i data-lucide="mail" size="32"></i>
                        </div>
                        <h3 class="font-bold text-xl text-stone-900 mb-2">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</h3>
                        <p class="text-stone-500 text-sm mb-4">ุฑุงุณููุง ูุฃู ุงุณุชูุณุงุฑุงุช ุชุฌุงุฑูุฉ</p>
                        <span class="font-bold text-stone-800 text-sm break-all group-hover:text-blue-600 transition-colors bg-white px-4 py-2 rounded-lg group-hover:bg-blue-50">gedar.fayoum@gmail.com</span>
                    </a>

                    <a href="https://maps.app.goo.gl/UhZig4Crvg52Vq2X6" target="_blank" class="bg-white p-8 rounded-3xl shadow-sm border border-stone-100 flex flex-col items-center text-center hover:shadow-xl hover:-translate-y-1 transition-all group relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-1 bg-orange-600"></div>
                        <div class="w-16 h-16 bg-orange-50 text-orange-600 rounded-2xl flex items-center justify-center mb-6 group-hover:bg-orange-600 group-hover:text-white transition-colors">
                            <i data-lucide="map-pin" size="32"></i>
                        </div>
                        <h3 class="font-bold text-xl text-stone-900 mb-2">ูููุน ุงููุนุฑุถ</h3>
                        <p class="text-stone-500 text-sm mb-4">ุงููููู - ููุงูุฉ ุดุงุฑุน ุงููุณุชุดูู ุงูุนุงู ุฅุชุฌุงู ูุฏูุฑูุฉ ุงูุฃูู<br/>ุจุฌูุงุฑ ุงููุบุณูุฉ ุงูุงูุฑูููู ูุงูุงู ูุทุนู ุงุจู ุตูุงุญ</p>
                        <div class="flex items-center gap-2 text-stone-800 font-bold bg-white px-4 py-2 rounded-lg group-hover:bg-orange-50 group-hover:text-orange-600 transition-colors text-sm">
                            <span>ุนุฑุถ ุนูู ุงูุฎุฑูุทุฉ</span>
                            <i data-lucide="external-link" size="14"></i>
                        </div>
                    </a>
                </div>
                <!-- ... existing map ... -->
                <div class="mt-12 max-w-6xl mx-auto rounded-3xl overflow-hidden shadow-lg border border-stone-200 h-[400px] relative group fade-in-up" style="animation-delay: 0.2s;">
                     <a href="https://maps.app.goo.gl/UhZig4Crvg52Vq2X6" target="_blank" class="block w-full h-full relative group">
                        <div class="absolute inset-0 bg-stone-200 bg-[url('https://upload.wikimedia.org/wikipedia/commons/e/ec/World_map_blank_without_borders.svg')] bg-cover opacity-20 grayscale group-hover:grayscale-0 transition-all duration-700"></div>
                        <div class="absolute inset-0 bg-gradient-to-t from-stone-900/10 to-transparent"></div>
                        <div class="absolute inset-0 flex flex-col items-center justify-center gap-4 z-10">
                            <div class="w-20 h-20 bg-white rounded-full flex items-center justify-center shadow-xl animate-bounce text-red-600">
                                <i data-lucide="map-pin" class="fill-current" size="40"></i>
                            </div>
                            <span class="bg-white/90 backdrop-blur-md px-8 py-4 rounded-full font-bold shadow-lg text-stone-900 group-hover:scale-105 transition-transform border border-white/50 flex items-center gap-2">
                                <i data-lucide="navigation" size="18"></i>
                                ุงุถุบุท ููุง ููุชุญ ุงููููุน ุนูู Google Maps
                            </span>
                        </div>
                     </a>
                </div>
            </div>`;
        }

        // NEW: Render Return Policy Page
        function renderReturnPolicy(c) {
            c.innerHTML = `
            <!-- ุชู ุชุนุฏูู pt-28 ุฅูู pt-40 ูููุงุชู ูููุน ุงุฎุชูุงุก ุงููุญุชูู ุชุญุช ุงูููุฏุฑ -->
            <div class="pt-40 md:pt-24 pb-20 min-h-screen bg-stone-50/50">
                <div class="container mx-auto px-4 md:px-8">
                    
                    <!-- Header -->
                    <div class="text-center mb-12 fade-in-up max-w-3xl mx-auto">
                        <div class="inline-flex items-center justify-center p-3 mb-4 bg-white rounded-2xl shadow-sm border border-stone-100">
                            <i data-lucide="file-shield" class="text-stone-900" size="32"></i>
                        </div>
                        <h1 class="text-3xl md:text-5xl font-black text-stone-900 mb-4 tracking-tight">ุณูุงุณุฉ ุงูุงุณุชุฑุฌุงุน ูุงูุงุณุชุจุฏุงู</h1>
                        <p class="text-stone-500 text-sm md:text-lg leading-relaxed font-medium">ุญุฑุตูุง ููุง ุนูู ุฑุถุง ุนููุงุฆูุง ุงููุฑุงูุ ููุถุญ ููู ูููุง ููู ุณูุงุณุฉ ุงูุงุณุชุฑุฌุงุน ูุงูุงุณุชุจุฏุงู ุงูุฎุงุตุฉ ุจูุงุ ูุถูุงู ุญููู ุฌููุน ุงูุฃุทุฑุงู ูุชูุฏูู ุฃูุถู ูุณุชูู ูู ุงูุฎุฏูุฉ.</p>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 max-w-7xl mx-auto fade-in-up" style="animation-delay: 0.1s;">
                        
                        <!-- Main Content (Right Column) -->
                        <div class="lg:col-span-8 space-y-8">
                            
                            <!-- 1. General Conditions -->
                            <div class="bg-white rounded-3xl p-6 md:p-8 shadow-sm border border-stone-100 relative overflow-hidden">
                                <div class="absolute top-0 right-0 w-1 bg-stone-900 h-full"></div>
                                <h2 class="text-xl font-bold text-stone-900 mb-6 flex items-center gap-3">
                                    <span class="w-8 h-8 rounded-full bg-stone-100 flex items-center justify-center text-sm font-bold">1</span> 
                                    ุฃูููุง: ุงูุดุฑูุท ุงูุนุงูุฉ ูุงูุถูุงู
                                </h2>
                                
                                <div class="space-y-4">
                                    <div class="bg-orange-50 p-4 rounded-xl border border-orange-100 text-sm text-orange-800 flex gap-3 items-start">
                                        <i data-lucide="alert-triangle" size="18" class="shrink-0 mt-0.5"></i>
                                        <p class="font-bold">ุชูุจูู ูุงู: ูู ุญุงูุฉ "ููุงูุฉ ุงูุดุบู"ุ ูุง ุชูุชุฒู ุงูุดุฑูุฉ ุจุชูููุฑ ููุณ ุฏุฑุฌุฉ ุงูููู ูู ุญุงู ุนุฏู ุชูุงูุฑู ููุช ุงูุชูููุฐ.</p>
                                    </div>

                                    <div class="mt-4">
                                        <h3 class="font-bold text-stone-800 mb-3 text-sm flex items-center gap-2"><i data-lucide="ban" size="14" class="text-red-500"></i> ุงูุถูุงู ูุง ูุดูู ุงูุญุงูุงุช ุงูุชุงููุฉ:</h3>
                                        <ul class="grid sm:grid-cols-2 gap-3">
                                            <li class="flex items-center gap-2 text-stone-600 text-xs font-bold bg-stone-50 p-3 rounded-lg border border-stone-100">ุณูุก ุงูุงุณุชุฎุฏุงู ุฃู ุงูุฅููุงู</li>
                                            <li class="flex items-center gap-2 text-stone-600 text-xs font-bold bg-stone-50 p-3 rounded-lg border border-stone-100">ุงุณุชุฎุฏุงู ุงูููุงุฏ ุงูููููุงุฆูุฉ ุฃู ุงูุญุงุฑูุฉ</li>
                                            <li class="flex items-center gap-2 text-stone-600 text-xs font-bold bg-stone-50 p-3 rounded-lg border border-stone-100">ุงูุฎุฏูุด ุงููุงุชุฌุฉ ุนู ุงูุฃุฏูุงุช ุงูุญุงุฏุฉ</li>
                                            <li class="flex items-center gap-2 text-stone-600 text-xs font-bold bg-stone-50 p-3 rounded-lg border border-stone-100">ุงููุณุฑ ุฃู ุงูุชูู ุงููุงุชุฌ ุนู ุงูุงุณุชุฎุฏุงู ุงูุฎุงุทุฆ</li>
                                        </ul>
                                    </div>

                                    <div class="mt-4 border-t border-stone-100 pt-4">
                                        <h3 class="font-bold text-stone-800 mb-2 text-sm flex items-center gap-2"><i data-lucide="wrench" size="16" class="text-blue-600"></i> ุถูุงู ุงูุชุฑููุจ (ุณูุฉ ูุงุญุฏุฉ)</h3>
                                        <ul class="space-y-2 text-xs text-stone-600 list-disc list-inside marker:text-blue-400 font-medium">
                                            <li>ูุดุชุฑุท ุชูุฏูู ุงููุงุชูุฑุฉ ุงูุฃุตููุฉ ููุงุณุชูุงุฏุฉ ูู ุฎุฏูุฉ ุงูุตูุงูุฉ ุงููุฌุงููุฉ.</li>
                                            <li>ูุณูุท ุงูุถูุงู ูู ุญุงู ุชู ุชูููุฐ ุงูุชุฑููุจ ุจูุงุณุทุฉ ุฌูุฉ ุฎุงุฑุฌูุฉ ุบูุฑ ุชุงุจุนุฉ ููุดุฑูุฉ.</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <!-- 2. Return Policy -->
                            <div class="bg-white rounded-3xl p-6 md:p-8 shadow-sm border border-stone-100 relative overflow-hidden">
                                <div class="absolute top-0 right-0 w-1 bg-red-500 h-full"></div>
                                <h2 class="text-xl font-bold text-stone-900 mb-6 flex items-center gap-3">
                                    <span class="w-8 h-8 rounded-full bg-red-50 text-red-600 flex items-center justify-center text-sm font-bold">2</span> 
                                    ุซุงูููุง: ุณูุงุณุฉ ุงูุงุณุชุฑุฌุงุน (7 ุฃูุงู)
                                </h2>
                                
                                <div class="grid md:grid-cols-2 gap-6">
                                    <div>
                                        <h4 class="font-bold text-stone-800 text-sm mb-3">ููููู ุทูุจ ุงูุงุณุชุฑุฌุงุน ูู ุงูุญุงูุงุช ุงูุชุงููุฉ:</h4>
                                        <ul class="space-y-2">
                                            <li class="flex gap-2 text-xs text-stone-600 font-medium"><i data-lucide="check" size="14" class="text-green-500 mt-0.5 shrink-0"></i> ุงุณุชูุงู ููุชุฌ ุบูุฑ ูุทุงุจู ููููุงุตูุงุช ุงููุชูู ุนูููุง.</li>
                                            <li class="flex gap-2 text-xs text-stone-600 font-medium"><i data-lucide="check" size="14" class="text-green-500 mt-0.5 shrink-0"></i> ูุฌูุฏ ุนูุจ ุชุตููุน ุฃู ุชูู ูู ุงูููุชุฌ.</li>
                                            <li class="flex gap-2 text-xs text-stone-600 font-medium"><i data-lucide="check" size="14" class="text-green-500 mt-0.5 shrink-0"></i> ุงุณุชูุงู ููุชุฌ ุบูุฑ ุงูุฐู ุชู ุทูุจู.</li>
                                        </ul>
                                    </div>
                                    <div class="bg-stone-50 rounded-xl p-4 border border-stone-100">
                                        <h4 class="font-bold text-stone-800 text-sm mb-3">ุดุฑูุท ูุจูู ุงูุงุณุชุฑุฌุงุน:</h4>
                                        <ul class="space-y-2">
                                            <li class="flex gap-2 text-xs text-stone-600 font-bold"><span class="w-1.5 h-1.5 bg-stone-400 rounded-full mt-1.5 shrink-0"></span> ุฃู ูููู ุงูููุชุฌ ุจุญุงูุชู ุงูุฃุตููุฉ.</li>
                                            <li class="flex gap-2 text-xs text-stone-600 font-bold"><span class="w-1.5 h-1.5 bg-stone-400 rounded-full mt-1.5 shrink-0"></span> ุบูุฑ ูุณุชุฎุฏู ููุงุฆูุงู.</li>
                                            <li class="flex gap-2 text-xs text-stone-600 font-bold"><span class="w-1.5 h-1.5 bg-stone-400 rounded-full mt-1.5 shrink-0"></span> ุฏุงุฎู ุงูุนุจูุฉ ุงูุฃุตููุฉ ูุจูุงูู ููุญูุงุชู.</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <!-- 3. Exchange Policy -->
                            <div class="bg-white rounded-3xl p-6 md:p-8 shadow-sm border border-stone-100 relative overflow-hidden">
                                <div class="absolute top-0 right-0 w-1 bg-blue-500 h-full"></div>
                                <h2 class="text-xl font-bold text-stone-900 mb-6 flex items-center gap-3">
                                    <span class="w-8 h-8 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center text-sm font-bold">3</span> 
                                    ุซุงูุซูุง: ุณูุงุณุฉ ุงูุงุณุชุจุฏุงู (14 ููู)
                                </h2>
                                
                                <div class="grid sm:grid-cols-2 gap-4">
                                    <div class="flex items-start gap-3 p-4 rounded-xl border border-stone-100 hover:bg-blue-50/30 transition-colors bg-stone-50/50">
                                        <div class="mt-1 bg-white text-blue-600 p-2 rounded-lg border border-stone-100 shadow-sm"><i data-lucide="refresh-ccw" size="16"></i></div>
                                        <div>
                                            <p class="text-sm font-bold text-stone-800">ุชุบููุฑ ุงูููู ุฃู ุงูููุงุณ</p>
                                            <p class="text-xs text-stone-500 mt-1 font-medium">ูุชุงุญ ุญุณุจ ุชููุฑ ุงููุฎุฒูู.</p>
                                        </div>
                                    </div>
                                    <div class="flex items-start gap-3 p-4 rounded-xl border border-stone-100 hover:bg-blue-50/30 transition-colors bg-stone-50/50">
                                        <div class="mt-1 bg-white text-blue-600 p-2 rounded-lg border border-stone-100 shadow-sm"><i data-lucide="arrow-left-right" size="16"></i></div>
                                        <div>
                                            <p class="text-sm font-bold text-stone-800">ุงุณุชุจุฏุงู ุจููุชุฌ ุขุฎุฑ</p>
                                            <p class="text-xs text-stone-500 mt-1 font-medium">ูุน ุชุญููู ูุฑู ุงูุณุนุฑ ุฅู ูุฌุฏ.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 4. Shipping Fees (ุณุงุฏุณูุง ูู ุงููุตุ ุชู ูุถุนู ููุง ููุชุณูุณู ุงูููุทูู ููุนุฑุถ) -->
                            <div class="bg-white rounded-3xl p-6 md:p-8 shadow-sm border border-stone-100 relative overflow-hidden">
                                <div class="absolute top-0 right-0 w-1 bg-green-500 h-full"></div>
                                <h2 class="text-xl font-bold text-stone-900 mb-6 flex items-center gap-3">
                                    <span class="w-8 h-8 rounded-full bg-green-50 text-green-600 flex items-center justify-center text-sm font-bold">4</span> 
                                    ุฑุณูู ุงูุดุญู
                                </h2>
                                
                                <div class="grid md:grid-cols-2 gap-4">
                                    <div class="bg-red-50 p-5 rounded-2xl border border-red-100 text-center hover:shadow-md transition-shadow">
                                        <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center mx-auto mb-3 text-red-600 shadow-sm"><i data-lucide="alert-circle" size="20"></i></div>
                                        <h4 class="font-bold text-red-800 text-sm mb-1">ุฎุทุฃ ูู ุฌุงูุจูุง</h4>
                                        <p class="text-[10px] text-red-700 opacity-80 mb-3">(ููุชุฌ ุชุงูู โ ุบูุฑ ูุทุงุจู โ ุฎุทุฃ ูู ุงูุทูุจ)</p>
                                        <div class="bg-white px-4 py-1.5 rounded-full text-xs font-bold text-red-600 inline-block shadow-sm border border-red-100">ุชุชุญูู ุงูุดุฑูุฉ ูุงูู ุชูููุฉ ุงูุดุญู</div>
                                    </div>
                                    <div class="bg-stone-50 p-5 rounded-2xl border border-stone-200 text-center hover:shadow-md transition-shadow">
                                        <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center mx-auto mb-3 text-stone-600 shadow-sm"><i data-lucide="user" size="20"></i></div>
                                        <h4 class="font-bold text-stone-800 text-sm mb-1">ุฑุบุจุฉ ุงูุนููู</h4>
                                        <p class="text-[10px] text-stone-500 opacity-80 mb-3">(ุจุฏูู ูุฌูุฏ ุฎุทุฃ ูู ุงูููุชุฌ)</p>
                                        <div class="bg-white px-4 py-1.5 rounded-full text-xs font-bold text-stone-600 inline-block shadow-sm border border-stone-200">ูุชู ุฎุตู ูููุฉ ุงูุดุญู ูู ุงููุจูุบ ุงูููุณุชุฑุฏ</div>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <!-- Sidebar (Sticky Info) -->
                        <div class="lg:col-span-4 space-y-6">
                            
                            <!-- Non-Returnable Items (ุฑุงุจุนูุง) -->
                            <div class="bg-stone-900 text-white rounded-3xl p-6 shadow-xl relative overflow-hidden">
                                <div class="absolute top-0 right-0 w-32 h-32 bg-white/5 rounded-full -mr-16 -mt-16 blur-2xl"></div>
                                <h3 class="font-bold text-lg mb-4 flex items-center gap-2 relative z-10"><i data-lucide="ban" class="text-stone-400"></i> ููุชุฌุงุช ุบูุฑ ูุงุจูุฉ ููุงุณุชุฑุฌุงุน</h3>
                                <ul class="space-y-3 relative z-10">
                                    <li class="flex items-start gap-3 text-xs text-stone-300 font-medium leading-relaxed">
                                        <span class="mt-1.5 w-1.5 h-1.5 rounded-full bg-red-500 shrink-0 shadow-[0_0_8px_rgba(239,68,68,0.6)]"></span>
                                        ุงูููุชุฌุงุช ุงูุชู ุชู ูุชุญูุง ุฃู ุงุณุชุฎุฏุงููุง.
                                    </li>
                                    <li class="flex items-start gap-3 text-xs text-stone-300 font-medium leading-relaxed">
                                        <span class="mt-1.5 w-1.5 h-1.5 rounded-full bg-red-500 shrink-0 shadow-[0_0_8px_rgba(239,68,68,0.6)]"></span>
                                        ุงูููุชุฌุงุช ุงูููููุฐุฉ ุฎุตูุตูุง ุญุณุจ ุทูุจ ุงูุนููู.
                                    </li>
                                    <li class="flex items-start gap-3 text-xs text-stone-300 font-medium leading-relaxed">
                                        <span class="mt-1.5 w-1.5 h-1.5 rounded-full bg-red-500 shrink-0 shadow-[0_0_8px_rgba(239,68,68,0.6)]"></span>
                                        ุงูุนุฑูุถ ูุงูุฎุตููุงุช ุงููุนูู ุนููุง ุนูู ุฃููุง ุบูุฑ ูุงุจูุฉ ููุงุณุชุฑุฌุงุน.
                                    </li>
                                </ul>
                            </div>

                            <!-- Steps (ุฎุงูุณูุง) -->
                            <div class="bg-white rounded-3xl p-6 shadow-sm border border-stone-100">
                                <h3 class="font-bold text-stone-900 mb-6 text-sm flex items-center gap-2"><i data-lucide="list-ordered" size="16"></i> ุฎุทูุงุช ุชูุฏูู ุงูุทูุจ</h3>
                                <div class="relative pl-4 border-r-2 border-stone-100 mr-2 space-y-8">
                                    <div class="relative group">
                                        <span class="absolute -right-[9px] top-0 w-4 h-4 bg-white rounded-full border-2 border-green-500 group-hover:scale-110 transition-transform"></span>
                                        <h4 class="font-bold text-stone-800 text-xs">ุงูุชูุงุตู</h4>
                                        <p class="text-[10px] text-stone-500 mt-1 font-medium">ุงูุชูุงุตู ูุน ุฎุฏูุฉ ุงูุนููุงุก ุนุจุฑ ูุงุชุณุงุจ ูุฅุฑุณุงู ุฑูู ุงูุทูุจ.</p>
                                    </div>
                                    <div class="relative group">
                                        <span class="absolute -right-[9px] top-0 w-4 h-4 bg-white rounded-full border-2 border-stone-300 group-hover:border-stone-900 transition-colors"></span>
                                        <h4 class="font-bold text-stone-800 text-xs">ุงูุชูุถูุญ</h4>
                                        <p class="text-[10px] text-stone-500 mt-1 font-medium">ุชูุถูุญ ุณุจุจ ุงูุงุณุชุฑุฌุงุน ุฃู ุงูุงุณุชุจุฏุงู ุจูุถูุญ.</p>
                                    </div>
                                    <div class="relative group">
                                        <span class="absolute -right-[9px] top-0 w-4 h-4 bg-white rounded-full border-2 border-stone-300 group-hover:border-stone-900 transition-colors"></span>
                                        <h4 class="font-bold text-stone-800 text-xs">ุงูุชุณููู</h4>
                                        <p class="text-[10px] text-stone-500 mt-1 font-medium">ุชุฌููุฒ ุงูููุชุฌ ูุชุณูููู ูููุฏูุจ ุงูุดุญู ูู ุงูููุนุฏ ุงููุญุฏุฏ.</p>
                                    </div>
                                    <div class="relative group">
                                        <span class="absolute -right-[9px] top-0 w-4 h-4 bg-white rounded-full border-2 border-stone-300 group-hover:border-stone-900 transition-colors"></span>
                                        <h4 class="font-bold text-stone-800 text-xs">ุงุณุชุฑุฏุงุฏ ุงููุจูุบ</h4>
                                        <p class="text-[10px] text-stone-500 mt-1 font-medium">ูุชู ุฑุฏ ุงููุจูุบ ุฎูุงู 1 ุฅูู 3 ุฃูุงู ุนูู ุญุณุจ ูุณููุฉ ุงูุฏูุน.</p>
                                    </div>
                                </div>
                                <a href="https://wa.me/201014175070" target="_blank" class="block w-full text-center bg-green-600 hover:bg-green-700 text-white font-bold py-3.5 rounded-xl mt-8 transition-all shadow-lg hover:shadow-xl hover:-translate-y-0.5 text-sm flex items-center justify-center gap-2">
                                    <i data-lucide="message-circle" size="16"></i>
                                    ุจุฏุก ุทูุจ ุงุณุชุฑุฌุงุน
                                </a>
                            </div>

                        </div>
                    </div>
                </div>
            </div>`;
            lucide.createIcons();
        }

        // NEW: Render FAQ Page
        function renderFAQ(c) {
            // --- FIX: ุชุนุฑูู ูุงุฆูุฉ ุงูุฃุณุฆูุฉ ุงูุดุงุฆุนุฉ ---
            const faqs = [
                { 
                    q: "ูุง ูู ุฎุงูุงุช ุจุฏูู ุงูุฑุฎุงู ูุจุฏูู ุงูุฎุดุจุ", 
                    a: "ุจุฏูู ุงูุฑุฎุงู ูุตููุน ูู ูุงุฏุฉ PVC ุนุงููุฉ ุงููุซุงูุฉ ูุน ุทุจูุฉ ุญูุงูุฉ UV ุชุนุทู ููุนุงู ุงูุฑุฎุงู ุงูุทุจูุนู ูููุงููุฉ ููุฎุฏุด. ุฃูุง ุจุฏูู ุงูุฎุดุจ ููู ูุตููุน ูู WPC (ุฎููุท ูู ุฃููุงู ุงูุฎุดุจ ูุงูุจูุงุณุชูู) ููุฌูุน ุจูู ูุธูุฑ ุงูุฎุดุจ ุงูุทุจูุนู ูููุงููุฉ ุงููุงุก ูุงูุฑุทูุจุฉ." 
                },
                { 
                    q: "ูู ุงูููุชุฌุงุช ููุงููุฉ ูููุงุก ูุงูุฑุทูุจุฉุ", 
                    a: "ูุนูุ ุฌููุน ููุชุฌุงุชูุง ูู ุจุฏูู ุงูุฑุฎุงู ูุจุฏูู ุงูุฎุดุจ ููุงููุฉ ุชูุงูุงู ูููุงุก ูุงูุฑุทูุจุฉ ุจูุณุจุฉ 100%ุ ููุง ูุฌุนููุง ูุซุงููุฉ ููุงุณุชุฎุฏุงู ูู ุงููุทุงุจุฎ ูุงูุญูุงูุงุช ููุนุงูุฌุฉ ูุดุงูู ุฑุทูุจุฉ ุงูุญูุงุฆุท." 
                },
                { 
                    q: "ูู ุชููุฑูู ุฎุฏูุฉ ุงูุชุฑููุจุ", 
                    a: "ูุนูุ ูุฏููุง ูุฑูู ููู ูุญุชุฑู ูุชุฑููุจ ุฌููุน ุงูุฏูููุฑุงุช (ุจุฏูู ุฑุฎุงูุ ุจุฏูู ุฎุดุจุ ูููุ ูุฑุงูุงุช) ุฏุงุฎู ูุญุงูุธุฉ ุงููููู ูุงูููุงุทู ุงููุฌุงูุฑุฉ. ููููู ุทูุจ ุงููุนุงููุฉ ูุงูุชุฑููุจ ุนุจุฑ ุงูุชูุงุตู ูุนูุง." 
                },
                { 
                    q: "ูู ุชุณุชุบุฑู ุนูููุฉ ุงูุดุญู ูุงูุชูุตููุ", 
                    a: "ูุชู ุชูุตูู ุงูุทูุจุงุช ุนุงุฏุฉ ุฎูุงู 2 ุฅูู 4 ุฃูุงู ุนูู. ุจุงููุณุจุฉ ููููุชุฌุงุช ุงููุจูุฑุฉ (ูุซู ุงูุฃููุงุญ ุงููุงููุฉ)ุ ูุชู ุงูุชูุณูู ูุถูุงู ูุตูููุง ุณูููุฉ." 
                },
                { 
                    q: "ูุงุฐุง ูู ูุตู ุงูููุชุฌ ุชุงููุงู ุฃู ุบูุฑ ูุทุงุจูุ", 
                    a: "ูุถูู ูู ุญู ุงูุงุณุชุฑุฌุงุน ุฃู ุงูุงุณุชุจุฏุงู ููุฑุงู ูุจุฏูู ุฃู ุชูููุฉ ุฅุถุงููุฉ ูู ุญุงู ูุตูู ุงูููุชุฌ ุชุงููุงู ุฃู ุบูุฑ ูุทุงุจู ููููุงุตูุงุช ุงููุทููุจุฉ. ูุฑุฌู ูุฑุงุฌุนุฉ ุงูููุชุฌ ุนูุฏ ุงูุงุณุชูุงู." 
                },
                { 
                    q: "ูู ูููููู ุทูุจ ููุงุณุงุช ุฎุงุตุฉุ", 
                    a: "ูุนุธู ุงูุฃููุงุญ ุชุฃุชู ุจููุงุณุงุช ููุงุณูุฉ (ูุซูุงู ุจุฏูู ุงูุฑุฎุงู 122ร280 ุณู). ูููู ูุตูุง ูุชุดููููุง ุฃุซูุงุก ุงูุชุฑููุจ ูุชูุงุณุจ ูุณุงุญุชู ุชูุงูุงู." 
                }
            ];
            // ----------------------------------------

            c.innerHTML = `
            <!-- ุชู ุชุนุฏูู pt-28 ุฅูู pt-40 ูููุงุชู ูููุน ุงุฎุชูุงุก ุงููุญุชูู ุชุญุช ุงูููุฏุฑ -->
            <div class="pt-40 md:pt-24 pb-20 container mx-auto px-6 min-h-screen bg-white/30">
                <div class="max-w-3xl mx-auto">
                    <div class="text-center mb-12 fade-in-up">
                        <span class="inline-block p-3 rounded-2xl bg-indigo-50 text-indigo-600 mb-4 shadow-sm border border-indigo-100"><i data-lucide="help-circle" size="32"></i></span>
                        <h1 class="text-3xl md:text-4xl font-bold text-stone-900 mb-4">ุงูุฃุณุฆูุฉ ุงูุดุงุฆุนุฉ</h1>
                        <p class="text-stone-500 text-lg">ุฅุฌุงุจุงุช ุนูู ุฃูุซุฑ ุงูุฃุณุฆูุฉ ุชุฏุงููุงู ููุณุงุนุฏุชู ูู ุงุชุฎุงุฐ ุงููุฑุงุฑ.</p>
                    </div>

                    <div class="space-y-4 fade-in-up" style="animation-delay: 0.1s;">
                        ${faqs.map((item, idx) => `
                            <div class="bg-white rounded-2xl border border-stone-200 overflow-hidden group">
                                <button onclick="toggleFAQ(${idx})" class="w-full text-right p-6 flex justify-between items-center hover:bg-white transition-colors">
                                    <h3 class="font-bold text-stone-900 text-lg flex items-center gap-3">
                                        <span class="w-8 h-8 rounded-full bg-stone-100 flex items-center justify-center text-stone-400 text-xs font-mono">${idx + 1}</span>
                                        ${item.q}
                                    </h3>
                                    <div id="faq-icon-${idx}" class="w-8 h-8 rounded-full bg-stone-100 flex items-center justify-center text-stone-500 transition-transform duration-300">
                                        <i data-lucide="chevron-down" size="20"></i>
                                    </div>
                                </button>
                                <div id="faq-content-${idx}" class="hidden px-6 pb-6 text-stone-600 leading-relaxed border-t border-stone-100 pt-4 bg-white/30 mr-14">
                                    ${item.a}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="mt-12 text-center bg-blue-50 rounded-3xl p-8 border border-blue-100 fade-in-up" style="animation-delay: 0.2s;">
                        <h3 class="font-bold text-blue-900 text-lg mb-2">ูู ุชุฌุฏ ุฅุฌุงุจุฉ ูุณุคุงููุ</h3>
                        <p class="text-blue-700/80 mb-6">ูุฑูููุง ุฌุงูุฒ ููุฑุฏ ุนูู ุฌููุน ุงุณุชูุณุงุฑุงุชู ุนุจุฑ ุงููุงุชุณุงุจ.</p>
                        <a href="https://wa.me/201014175070" target="_blank" class="inline-flex items-center gap-2 bg-blue-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-blue-700 transition-all shadow-lg hover:shadow-xl hover:-translate-y-0.5">
                            <i data-lucide="message-circle" size="18"></i> ุชุญุฏุซ ูุนูุง ุงูุขู
                        </a>
                    </div>
                </div>
            </div>`;
        }

        window.toggleFAQ = (idx) => {
            const content = document.getElementById(`faq-content-${idx}`);
            const icon = document.getElementById(`faq-icon-${idx}`);
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                icon.classList.add('rotate-180');
            } else {
                content.classList.add('hidden');
                icon.classList.remove('rotate-180');
            }
        };

        function renderAbout(c) {
            c.innerHTML = `<div class="pt-28 md:pt-24 container mx-auto px-6 text-center"><h1 class="text-4xl font-bold mb-8">ุชุจุณูุท ุงูููุฒู</h1><p class="max-w-2xl mx-auto text-stone-600">ูููุฏุช ุนูุงูุฉ "ุฌุฏุงุฑ" ูู ุงูุฑุบุจุฉ ูู ุฅุนุงุฏุฉ ุงููุฏูุก ุฅูู ุงูููุฒู.</p></div>`;
        }

        function renderProductDetails(c) {
            // NEW: Loading State for Direct Links
            if (!isDataLoaded && PRODUCTS.length === 0) {
                c.innerHTML = `
                <div class="min-h-screen flex flex-col items-center justify-center pt-28 md:pt-20">
                    <div class="animate-spin w-12 h-12 border-4 border-stone-200 border-t-stone-900 rounded-full mb-4"></div>
                    <p class="text-stone-500 font-medium">ุฌุงุฑู ุชุญููู ุงูููุชุฌ...</p>
                </div>`;
                return;
            }

            const p = PRODUCTS.find(x => x.id == currentProductId);
            if(!p) return c.innerHTML = `
                <div class="min-h-screen flex flex-col items-center justify-center text-center px-4 pt-28 md:pt-20">
                    <div class="w-20 h-20 bg-stone-100 rounded-full flex items-center justify-center mb-4 text-stone-400">
                        <i data-lucide="search-x" size="40"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-stone-900 mb-2">ุงูููุชุฌ ุบูุฑ ููุฌูุฏ</h2>
                    <p class="text-stone-500 mb-6">ูุฏ ูููู ุชู ุญุฐู ุงูููุชุฌ ุฃู ุงูุฑุงุจุท ุบูุฑ ุตุญูุญ.</p>
                    <button onclick="setView('shop')" class="bg-stone-900 text-white px-8 py-3 rounded-xl font-bold hover:bg-stone-800 transition-colors">ุชุตูุญ ุงููุชุฌุฑ</button>
                </div>`;
            
            const isFav = favorites.includes(p.id);
            const images = (p.images && p.images.length > 0) ? p.images : [p.image];
            const features = (p.features && p.features.length > 0) ? p.features : [];

            // UPDATE: Use helper
            const hasDiscount = isDiscountActive(p);
            const finalPrice = hasDiscount ? (p.price * (1 - p.discount / 100)).toFixed(2) : p.price;
            
            // Check Stock Status (Default to true if undefined)
            const isInStock = p.inStock !== false;

            // Calculate Reviews Data
            const productReviews = ALL_REVIEWS.filter(r => r.productId === p.id && r.status === 'approved');
            const totalReviews = productReviews.length;
            const averageRating = totalReviews > 0 ? (productReviews.reduce((sum, r) => sum + r.rating, 0) / totalReviews).toFixed(1) : 0;
            const counts = { 5:0, 4:0, 3:0, 2:0, 1:0 };
            productReviews.forEach(r => counts[r.rating]++);

            // --- 1๏ธโฃ Customer Trust: Dynamic Order Counter Logic ---
            const randomMinutes = Math.floor(Math.random() * 40) + 5; // ููุช ุนุดูุงุฆู ุจูู 5 ู 45 ุฏูููุฉ
            const trustCounterHTML = `
            <div class="mt-4 pt-4 border-t border-stone-100">
                <p class="text-xs text-stone-600 flex items-center gap-2 mb-2 font-medium bg-green-50 w-fit px-3 py-1.5 rounded-full border border-green-100">
                    <span class="relative flex h-2 w-2">
                      <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                      <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
                    </span>
                    <span>ุขุฎุฑ ุทูุจ ุชู ุชุฃููุฏู ููุฐ <b>${randomMinutes} ุฏูููุฉ</b></span>
                </p>
                <div class="flex items-center gap-2 text-[10px] text-stone-500">
                    <i data-lucide="shield-check" class="text-green-600" size="14"></i>
                    <span>ุนูููุฉ ุงูุฏูุน ูุคููุฉ 100% ููุชู ูุฑุงุฌุนุชูุง ูุฏููุงู</span>
                </div>
            </div>
            `;
            // -----------------------------------------------------

            // --- Window function to handle color selection ---
            window.selectColor = (colorName, imageUrl) => {
                currentSelectedColor = colorName;
                
                // Update Main Image
                const mainImg = document.getElementById('main-product-image');
                if (mainImg && imageUrl) mainImg.src = imageUrl;
                
                // Update Active State of Buttons
                const allBtns = document.querySelectorAll('.variant-btn');
                allBtns.forEach(btn => {
                    if (btn.dataset.color === colorName) {
                        btn.classList.add('ring-2', 'ring-stone-900', 'ring-offset-2');
                        btn.classList.remove('border-stone-200');
                        btn.classList.add('border-stone-900');
                    } else {
                        btn.classList.remove('ring-2', 'ring-stone-900', 'ring-offset-2');
                        btn.classList.add('border-stone-200');
                        btn.classList.remove('border-stone-900');
                    }
                });
            };

            // --- Dynamic Tags Generation (NEW) ---
            // 1. Get all Category Names
            const catTags = CATEGORIES.map(c => c.name);
            
            // 2. Get Random Product Keywords (First 2-3 words of product names)
            const prodTags = PRODUCTS
                .filter(prod => prod.id !== p.id) // Exclude current product
                .map(prod => prod.name.split(' ').slice(0, 3).join(' ')) // Take first 3 words
                .sort(() => 0.5 - Math.random()) // Shuffle
                .slice(0, 12); // Take 12 items
            
            // 3. Combine & Deduplicate
            const dynamicTags = [...new Set([...catTags, ...prodTags])];

            // --- NEW: Random Sponsored Product Logic ---
            const adProduct = PRODUCTS.filter(x => x.id !== p.id).sort(() => 0.5 - Math.random())[0];
            const adHTML = adProduct ? `
            <div onclick="viewProduct('${adProduct.id}')" class="w-full bg-gradient-to-r from-stone-50 via-white to-stone-50 border border-stone-200 rounded-xl p-3 mb-8 flex items-center gap-4 cursor-pointer hover:shadow-md hover:border-green-200 transition-all group animate-in fade-in slide-in-from-top-4 duration-700">
                <div class="bg-stone-200 text-stone-500 text-[10px] font-bold px-2 py-1 rounded select-none">ุฅุนูุงู</div>
                
                <div class="w-12 h-12 bg-white rounded-lg border border-stone-100 overflow-hidden shrink-0">
                    <img src="${adProduct.image}" class="w-full h-full object-cover group-hover:scale-110 transition-transform">
                </div>
                
                <div class="flex-1 min-w-0 flex flex-col sm:flex-row sm:items-center justify-between gap-1 sm:gap-4">
                    <div class="truncate">
                        <h4 class="font-bold text-stone-900 text-xs sm:text-sm truncate group-hover:text-green-700 transition-colors">${adProduct.name}</h4>
                        <p class="text-[10px] text-stone-500 truncate hidden sm:block">${adProduct.description ? adProduct.description.substring(0, 50) + '...' : 'ุชุตูุญ ูุฐุง ุงูููุชุฌ ุงููููุฒ ุงูุขู'}</p>
                    </div>
                    
                    <div class="flex items-center gap-3 shrink-0">
                        <span class="font-serif font-bold text-stone-900 text-sm sm:text-base">$${adProduct.price}</span>
                        <div class="w-8 h-8 rounded-full bg-stone-100 text-stone-400 flex items-center justify-center group-hover:bg-green-600 group-hover:text-white transition-all">
                            <i data-lucide="arrow-left" size="16"></i>
                        </div>
                    </div>
                </div>
            </div>` : '';

            // --- Prepared Slider Data ---
            
            // 1. Related Products (Same Category)
            const relatedProducts = PRODUCTS.filter(prod => prod.category === p.category && prod.id !== p.id);
            
            // 2. Random Suggestions (NEW LOGIC)
            // Shuffle all products and pick 8 random ones (excluding current)
            const randomSuggestions = PRODUCTS.filter(prod => prod.id !== p.id)
                                              .sort(() => 0.5 - Math.random())
                                              .slice(0, 8);

            // 3. Browsing History
            const historyIds = JSON.parse(localStorage.getItem('gedar_history') || '[]');
            const historyProducts = historyIds.map(hId => PRODUCTS.find(prod => prod.id === hId)).filter(item => item !== undefined);

            // --- Helper: Render Slider HTML (Updated for Small Cards) ---
            const renderSliderHTML = (id, title, items, isSmall = false) => {
                if (items.length === 0) return '';
                
                // Determine width based on isSmall flag
                // UPDATE: ุชู ุชุตุบูุฑ ุงูุนุฑุถ ุงูุงูุชุฑุงุถู ูู 260px ุฅูู 210px
                const cardWidthClass = isSmall ? 'min-w-[140px] w-[140px]' : 'min-w-[210px] w-[210px]';
                
                return `
                <div class="mt-16 border-t border-stone-100 pt-10">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="${isSmall ? 'text-lg' : 'text-xl'} font-bold text-stone-900">${title}</h3>
                        <div class="flex gap-2">
                            <button onclick="scrollSection('${id}', 'prev')" class="w-8 h-8 border border-stone-200 rounded-full hover:bg-stone-900 hover:text-white hover:border-stone-900 transition-all flex items-center justify-center text-stone-600"><i data-lucide="arrow-right" size="16"></i></button>
                            <button onclick="scrollSection('${id}', 'next')" class="w-8 h-8 border border-stone-200 rounded-full hover:bg-stone-900 hover:text-white hover:border-stone-900 transition-all flex items-center justify-center text-stone-600"><i data-lucide="arrow-left" size="16"></i></button>
                        </div>
                    </div>
                    <div id="${id}" class="flex gap-4 overflow-x-auto scrollbar-hide scroll-smooth snap-x pb-4">
                        ${items.map(item => `
                            <div class="${cardWidthClass} snap-start">
                                ${isSmall ? createSmallProductCard(item) : createProductCard(item)}
                            </div>
                        `).join('')}
                    </div>
                </div>`;
            };

            c.innerHTML = `
            <!-- ุชู ุชุนุฏูู pt-28 ุฅูู pt-40 ูููุงุชู ูููุน ุงุฎุชูุงุก ุงูุฅุนูุงู -->
            <div class="bg-white min-h-screen pt-40 md:pt-28 pb-20">
                <div class="container mx-auto px-4 lg:px-6">
                    
                    <!-- Insert The Ad Banner Here -->
                    ${adHTML}

                    <div class="flex items-center gap-2 text-sm text-stone-500 mb-8">
                        <button onclick="setView('shop')" class="hover:text-stone-900">ุงููุชุฌุฑ</button><i data-lucide="chevron-left" size="14"></i>
                        <button onclick="filterCategory('${p.category}'); setView('shop')" class="hover:text-stone-900">${p.category}</button><i data-lucide="chevron-left" size="14"></i>
                        <span class="text-stone-900 font-medium truncate max-w-[200px]">${p.name}</span>
                    </div>
                    
                    <!-- Top Section: Images & Info -->
                    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 lg:gap-12 mb-12">
                        <!-- Product Images -->
                        <div class="lg:col-span-5 flex flex-col-reverse lg:flex-row gap-4">
                            <div class="flex lg:flex-col gap-3 overflow-x-auto lg:overflow-y-auto lg:max-h-[500px] scrollbar-hide py-1 px-1">
                                ${images.map((img, idx) => `<div onmouseover="setActiveImage(${idx})" onclick="setActiveImage(${idx})" class="gallery-thumb cursor-pointer border border-stone-200 rounded-lg p-1 w-16 h-16 lg:w-20 lg:h-20 flex-shrink-0 bg-white ${idx===0?'active':''} hover:border-stone-400 transition-all"><img src="${img}" class="w-full h-full object-cover rounded-md"></div>`).join('')}
                            </div>
                            <!-- Modified Image Container: Square but constrained width/height -->
                            <div class="flex-1 bg-white rounded-2xl border border-stone-200 flex items-center justify-center relative group w-full max-w-[500px] mx-auto aspect-square overflow-hidden shadow-sm">
                                <img id="main-product-image" src="${images[0]}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">
                                <!-- ุชู ุฅุถุงูุฉ ููุงุณ fav-btn-${p.id} ููุง -->
                                <button onclick="toggleFavorite('${p.id}')" class="fav-btn-${p.id} absolute top-4 right-4 p-3 rounded-full bg-white/90 backdrop-blur-sm shadow-md hover:bg-white transition-all z-10 ${isFav?'text-red-500 border-red-100':'text-stone-400 border-stone-100'} border">
                                    <i data-lucide="heart" class="${isFav?'fill-current':''}"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Product Info -->
                        <div class="lg:col-span-4 space-y-6">
                            <div>
                                <div class="flex justify-between items-start gap-4">
                                    <div>
                                        ${p.brand ? `<a href="#" class="text-sm text-blue-600 hover:text-orange-600 hover:underline mb-1 inline-block font-medium">ุฒูุงุฑุฉ ูุชุฌุฑ ${p.brand}</a>` : ''}
                                        <h1 class="text-2xl lg:text-3xl font-bold text-stone-900 leading-tight mb-2">${p.name}</h1>
                                    </div>
                                    <button onclick="shareProduct('${p.id}')" class="w-10 h-10 rounded-full bg-white hover:bg-blue-50 text-stone-500 hover:text-blue-600 flex items-center justify-center transition-all shadow-sm border border-stone-100 shrink-0" title="ูุดุงุฑูุฉ ุงูููุชุฌ">
                                        <i data-lucide="share-2" size="20"></i>
                                    </button>
                                </div>
                                <div class="flex items-center gap-2 mt-2">
                                    <div class="flex text-yellow-400 text-sm">
                                        ${averageRating > 0 
                                            ? Array(Math.round(averageRating)).fill('<i data-lucide="star" class="fill-current w-4 h-4"></i>').join('') 
                                            : '<span class="text-stone-400 text-xs">ูุง ุชูุฌุฏ ุชููููุงุช</span>'}
                                    </div>
                                    <span class="text-stone-500 text-sm">(${totalReviews} ุชูููู)</span>
                                </div>
                            </div>
                            <div class="border-t border-b border-stone-100 py-4">
                                ${hasDiscount ? 
                                `<div class="flex items-end gap-3 mb-1">
                                    <span class="text-4xl font-bold text-red-600 font-serif">$${finalPrice}</span>
                                    <span class="text-xl text-stone-400 line-through mb-1">$${p.price}</span>
                                    <span class="bg-red-100 text-red-600 text-xs font-bold px-2 py-1 rounded mb-2">ุฎุตู ${p.discount}%</span>
                                 </div>
                                 <p class="text-sm text-stone-500">ุดุงูู ุงูุถุฑูุจุฉ</p>` 
                                : 
                                `<div class="flex items-baseline gap-2"><span class="text-3xl font-bold text-stone-900 font-serif">$${p.price}</span><span class="text-stone-500 text-sm">ุดุงูู ุงูุถุฑูุจุฉ</span></div>`
                                }
                            </div>

                            <!-- VARIANTS SECTION (Kept here as it affects image) -->
                            ${p.variants && p.variants.length > 0 ? `
                            <div id="variants-section" class="space-y-3 pb-4 border-b border-stone-100">
                                <h3 class="font-bold text-stone-900 text-sm">ุงูุฃููุงู ุงููุชุงุญุฉ:</h3>
                                <div class="flex flex-wrap gap-3">
                                    ${p.variants.map(v => `
                                        <button 
                                            onclick="selectColor('${v.color}', '${v.image}')" 
                                            data-color="${v.color}"
                                            class="variant-btn group relative w-12 h-12 rounded-full border border-stone-200 overflow-hidden hover:scale-110 transition-all focus:outline-none"
                                            title="${v.color}"
                                        >
                                            <img src="${v.image}" class="w-full h-full object-cover">
                                            <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors"></div>
                                        </button>
                                    `).join('')}
                                </div>
                                <p class="text-[10px] text-stone-400"><i data-lucide="info" size="10" class="inline"></i> ุงุฎุชุฑ ุงูููู ููุดุงูุฏุฉ ุตูุฑุชู ูุฅุถุงูุชู ููุณูุฉ</p>
                            </div>
                            ` : ''}
                            
                            <!-- Dynamic Service Icons Slider -->
                            <div class="mt-2 py-4">
                                <div class="flex gap-4 overflow-x-auto scrollbar-hide px-1 snap-x">
                                    ${(p.services && p.services.length > 0 ? p.services : []).map(s => `
                                    <div class="min-w-[80px] w-[80px] flex flex-col items-center text-center gap-2 snap-start group cursor-default">
                                        <div class="w-10 h-10 rounded-full bg-stone-100 flex items-center justify-center text-stone-600 group-hover:bg-stone-200 transition-colors">
                                            <i data-lucide="${s.icon}" size="20"></i>
                                        </div>
                                        <span class="text-[10px] font-bold text-stone-500 leading-tight">${s.text.replace(/ /g, '<br>')}</span>
                                    </div>
                                    `).join('')}
                                </div>
                            </div>

                            <!-- Report Issue Link (WhatsApp) -->
                            <div class="mt-2">
                                <a href="https://wa.me/201014175070?text=${encodeURIComponent('ูุฑุญุจุงูุ ุฃุฑูุฏ ุงูุฅุจูุงุบ ุนู ูุดููุฉ ุจุฎุตูุต ุงูููุชุฌ: ' + p.name)}" target="_blank" class="flex items-center gap-2 text-stone-400 hover:text-red-600 text-xs font-medium transition-colors w-fit p-2 rounded-lg hover:bg-white">
                                    <i data-lucide="flag" size="14"></i>
                                    <span>ุฃุจูุบ ุนู ูุดููุฉ</span>
                                </a>
                            </div>

                            <!-- NEW: Payment Banner (Dynamic) -->
                            ${HERO_SETTINGS.showPaymentBanner && HERO_SETTINGS.paymentBannerUrl ? `
                            <div class="mt-6 pt-4 border-t border-stone-100 fade-in-up">
                                <p class="text-[10px] text-stone-400 font-bold mb-2 uppercase tracking-wider">ุงูุชูุณูุท:</p>
                                <div class="rounded-xl overflow-hidden border border-stone-100 w-fit max-w-full">
                                    <!-- ุชู ุชุญุฏูุซ ุงูุณุชุงูู ููุง ููุฃุฎุฐ ุงูููู ูู ุงูุฅุนุฏุงุฏุงุช -->
                                    <img src="${HERO_SETTINGS.paymentBannerUrl}" 
                                         style="height: ${HERO_SETTINGS.paymentBannerHeight || 60}px; width: ${HERO_SETTINGS.paymentBannerWidth || 'auto'};" 
                                         class="object-contain bg-white max-w-full" 
                                         alt="Payment Methods">
                                </div>
                            </div>
                            ` : ''}

                        </div>

                        <!-- Action Card -->
                        <div class="lg:col-span-3">
                            <div class="border border-stone-200 rounded-xl p-5 shadow-sm sticky top-24 bg-white">
                                <div class="mb-4">
                                    ${hasDiscount 
                                        ? `<span class="text-2xl font-bold text-red-600">$${finalPrice}</span> <span class="text-sm text-stone-400 line-through">$${p.price}</span>` 
                                        : `<span class="text-2xl font-bold text-stone-900">$${p.price}</span>`
                                    }
                                </div>
                                <div class="text-sm mb-6">
                                    ${isInStock 
                                        ? `<p class="text-green-600 font-medium mb-1 flex items-center gap-2"><i data-lucide="check-circle" size="16"></i> ูุชููุฑ ูู ุงููุฎุฒูู</p>`
                                        : `<p class="text-red-600 font-medium mb-1 flex items-center gap-2"><i data-lucide="x-circle" size="16"></i> ุบูุฑ ูุชููุฑ ุญุงููุงู (Out of Stock)</p>`
                                    }
                                    <p class="text-stone-500">ูุตูู ุฎูุงู: <span class="text-stone-900 font-bold">2-4 ุฃูุงู ุนูู</span></p>
                                </div>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between border border-stone-200 rounded-lg p-2 bg-white ${!isInStock ? 'opacity-50 pointer-events-none' : ''}">
                                        <span class="text-sm font-bold text-stone-600 px-2">ุงููููุฉ:</span>
                                        <div class="flex items-center gap-4">
                                            <button onclick="changeDetailsQuantity(-1)" class="w-8 h-8 flex items-center justify-center bg-white rounded shadow-sm hover:bg-stone-100">-</button>
                                            <span id="details-qty" class="font-bold w-4 text-center">${detailsQuantity}</span>
                                            <button onclick="changeDetailsQuantity(1)" class="w-8 h-8 flex items-center justify-center bg-white rounded shadow-sm hover:bg-stone-100">+</button>
                                        </div>
                                    </div>
                                    
                                    <button onclick="addToCartFromDetails('${p.id}')" ${!isInStock ? 'disabled' : ''} class="w-full ${isInStock ? 'bg-yellow-400 hover:bg-yellow-500 text-stone-900' : 'bg-stone-200 text-stone-400 cursor-not-allowed'} py-3 rounded-full font-bold shadow-sm transition-colors text-sm">
                                        ${isInStock ? 'ุฅุถุงูุฉ ุฅูู ุนุฑุจุฉ ุงูุชุณูู' : 'ุบูุฑ ูุชููุฑ'}
                                    </button>
                                    
                                    <button onclick="addToCartFromDetails('${p.id}'); checkout()" ${!isInStock ? 'disabled' : ''} class="w-full ${isInStock ? 'bg-orange-500 hover:bg-orange-600 text-white' : 'bg-stone-200 text-stone-400 cursor-not-allowed'} py-3 rounded-full font-bold shadow-sm transition-colors text-sm">
                                        ${isInStock ? 'ุดุฑุงุก ุงูุขู' : 'ุบูุฑ ูุชููุฑ'}
                                    </button>
                                </div>

                                <!-- 1๏ธโฃ Trust Signals (Social Proof) -->
                                ${trustCounterHTML}

                                <!-- Sponsored Product Ad -->
                                ${(() => {
                                    // Pick a random product for ad
                                    const adProduct = PRODUCTS.filter(x => x.id !== p.id).sort(() => 0.5 - Math.random())[0];
                                    if (!adProduct) return '';
                                    
                                    return `
                                    <div class="mt-6 pt-4 border-t border-stone-100">
                                        <div class="flex items-center justify-between mb-2">
                                            <span class="text-[10px] font-bold text-stone-400 uppercase tracking-wider">ููุชุฌ ูููู</span>
                                            <i data-lucide="info" size="10" class="text-stone-300"></i>
                                        </div>
                                        <div class="border border-stone-200 rounded-xl p-2 bg-white hover:bg-white hover:border-stone-400 transition-all cursor-pointer group flex gap-3 items-center" onclick="viewProduct('${adProduct.id}')">
                                            <div class="w-14 h-14 bg-white rounded-lg overflow-hidden shrink-0 border border-stone-100">
                                                <img src="${adProduct.image}" class="w-full h-full object-cover group-hover:scale-110 transition-transform">
                                            </div>
                                            <div class="flex-1 min-w-0">
                                                <h4 class="font-bold text-stone-900 text-xs truncate mb-1">${adProduct.name}</h4>
                                                <div class="flex justify-between items-center">
                                                    <span class="font-serif font-bold text-stone-900 text-sm">$${adProduct.price}</span>
                                                    <span class="text-[10px] text-blue-600 font-bold bg-blue-50 px-2 py-0.5 rounded-full">ุนุฑุถ</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    `;
                                })()}

                                <!-- "Customers usually keep this item" Box -->
                                <div class="mt-4 bg-green-50 border border-green-600 rounded-xl p-4 flex items-start justify-between gap-4 shadow-sm">
                                    <div class="flex-1">
                                        <h4 class="font-bold text-stone-900 text-xs mb-1">ุนุงุฏุฉ ูุง ูุญุชูุธ ุงูุนููุงุก ุจูุฐู ุงูุณูุนุฉ</h4>
                                        <p class="text-[10px] text-stone-700 leading-relaxed">ูุชูุชุน ูุฐุง ุงูููุชุฌ ุจูุนุฏูุงุช ุฅุฑุฌุงุน ุฃูู ูู ุงููุชูุณุท.</p>
                                    </div>
                                    <div class="bg-green-600 rounded-full p-1 text-white shrink-0 shadow-sm">
                                        <i data-lucide="check" size="14" stroke-width="3"></i>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>

                    <!-- NEW: Detailed Info Section (Bottom Layout like Amazon) -->
                    <div class="grid md:grid-cols-2 gap-8 mb-16 items-start mt-12 border-t border-stone-100 pt-12">
                        <!-- About Item -->
                        <div class="h-full">
                            <h3 class="font-bold text-xl text-stone-900 mb-6 flex items-center gap-2">
                                <span class="bg-stone-100 p-2 rounded-lg"><i data-lucide="file-text" class="text-stone-600" size="20"></i></span>
                                ุนู ุงูุณูุนุฉ
                            </h3>
                            ${(() => {
                                // Calculate content length (items)
                                const materialLine = p.material ? 1 : 0;
                                const featureLines = features.length;
                                const descLines = 1;
                                const totalLines = materialLine + featureLines + descLines;
                                const isLong = totalLines > 3;

                                return `
                                <div id="about-container-${p.id}" class="relative overflow-hidden transition-all duration-500 ${isLong ? 'max-h-[100px]' : ''}">
                                    <ul class="list-disc list-outside mr-5 space-y-3 text-stone-700 leading-relaxed">
                                        ${p.material ? `<li class="font-bold text-stone-900">ุงููุงุฏุฉ: <span class="font-normal text-stone-700">${p.material}</span></li>` : ''}
                                        ${features.map(f => `<li>${f}</li>`).join('')}
                                        <li>${p.description || p.details}</li>
                                    </ul>
                                    ${isLong ? `<div id="about-fade-${p.id}" class="absolute bottom-0 left-0 w-full h-24 bg-gradient-to-t from-white to-transparent"></div>` : ''}
                                </div>
                                ${isLong ? `
                                <button id="about-btn-${p.id}" onclick="toggleAbout('${p.id}')" class="text-stone-900 font-bold text-sm hover:text-orange-600 underline underline-offset-4 flex items-center gap-1 mt-4 transition-colors">
                                    <i data-lucide="chevron-down" size="16"></i> ูุฑุงุกุฉ ุงููุฒูุฏ
                                </button>` : ''}
                                `;
                            })()}
                        </div>

                        <!-- Specs Section -->
                        <div class="bg-white rounded-3xl p-8 border border-stone-100 h-full">
                            <h3 class="font-bold text-xl text-stone-900 mb-6 flex items-center gap-2">
                                <span class="bg-white p-2 rounded-lg border border-stone-200"><i data-lucide="settings-2" class="text-stone-600" size="20"></i></span>
                                ุงูููุงุตูุงุช ุงููููุฉ
                            </h3>
                            ${p.specifications && p.specifications.length > 0 ? `
                            <div class="space-y-0 divide-y divide-stone-200">
                                ${p.specifications.map(s => `
                                    <div class="flex justify-between items-center py-4 px-2">
                                        <span class="font-bold text-stone-600 text-sm">${s.label}</span>
                                        <span class="text-stone-900 dir-ltr text-sm font-bold">${s.value}</span>
                                    </div>
                                `).join('')}
                            </div>
                            ` : `<p class="text-stone-400 text-sm">ูุง ุชูุฌุฏ ููุงุตูุงุช ุฅุถุงููุฉ.</p>`}
                        </div>
                    </div>

                    <!-- Related Products Slider -->
                    ${renderSliderHTML('related-slider-section', 'ุงูููุชุฌุงุช ุงููุฑุชุจุทุฉ ุจูุฐู ุงูุณูุนุฉ', relatedProducts)}
                    
                    <!-- Random Suggestions Slider (Now Small like History) -->
                    ${renderSliderHTML('suggestions-slider-section', 'ุงูุชุฑุงุญุงุช ูุฏ ุชุนุฌุจู', randomSuggestions, true)}

                    <!-- Reviews Section -->
                    <div class="mt-20 border-t border-stone-100 pt-12">
                        <div class="grid lg:grid-cols-12 gap-12">
                            <!-- Right: Rating Summary (Amazon Style) -->
                            <div class="lg:col-span-4">
                                <h3 class="text-2xl font-bold text-stone-900 mb-2">ูุฑุงุฌุนุงุช ุงููุณุชุฎุฏููู</h3>
                                <div class="flex items-baseline gap-2 mb-4">
                                    <div class="flex text-yellow-400 text-lg">${Array(5).fill(0).map((_,i) => `<i data-lucide="star" class="w-5 h-5 ${i < Math.round(averageRating) ? 'fill-current' : 'text-stone-200'}"></i>`).join('')}</div>
                                    <span class="text-lg font-bold text-stone-900 dir-ltr">${averageRating} ูู 5</span>
                                </div>
                                <p class="text-sm text-stone-500 mb-6">${totalReviews} ูู ุงูุชููููุงุช ุงูุนุงูููุฉ</p>
                                
                                <div class="space-y-3 mb-8">
                                    ${[5,4,3,2,1].map(star => {
                                        const count = counts[star];
                                        const percent = totalReviews > 0 ? Math.round((count / totalReviews) * 100) : 0;
                                        return `
                                        <div class="flex items-center gap-3 text-sm group cursor-default hover:opacity-80 transition-opacity">
                                            <span class="w-12 text-blue-600 font-medium hover:underline text-left dir-ltr">${star} ูุฌูู</span>
                                            <div class="flex-1 h-5 bg-stone-100 rounded-sm overflow-hidden border border-stone-200 box-border">
                                                <div class="h-full bg-yellow-400 border-r border-yellow-500" style="width: ${percent}%"></div>
                                            </div>
                                            <span class="w-8 text-blue-600 font-medium text-right dir-ltr">${percent}%</span>
                                        </div>`;
                                    }).join('')}
                                </div>
                                
                                <div class="border-t border-stone-200 pt-6">
                                    <h4 class="font-bold text-lg mb-2">ุฑุงุฌุน ูุฐุง ุงูููุชุฌ</h4>
                                    <p class="text-sm text-stone-500 mb-4">ุดุงุฑู ุฃููุงุฑู ูุน ุงูุนููุงุก ุงูุขุฎุฑูู</p>
                                    <button onclick="document.getElementById('review-form').classList.toggle('hidden')" class="w-full border border-stone-300 text-stone-900 py-2 rounded-lg text-sm font-bold hover:bg-white transition-colors">ุงูุชุจ ูุฑุงุฌุนุฉ ููุนููู</button>
                                    
                                    <form id="review-form" onsubmit="handleSubmitReview(event)" class="space-y-4 mt-4 hidden bg-white p-4 rounded-xl border border-stone-200">
                                        <div>
                                            <label class="block text-xs font-bold text-stone-600 mb-1">ุงูุชูููู ุงูุนุงู</label>
                                            <div class="flex flex-row-reverse justify-end gap-1 group/rating">
                                                ${[5,4,3,2,1].map(val => `
                                                    <input type="radio" name="reviewerRating" value="${val}" id="star${val}" class="peer hidden" ${val===5?'checked':''}>
                                                    <label for="star${val}" class="cursor-pointer text-stone-300 peer-checked:text-yellow-400 hover:text-yellow-400 peer-hover:text-yellow-400 transition-colors"><i data-lucide="star" class="fill-current w-8 h-8"></i></label>
                                                `).join('')}
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block text-xs font-bold text-stone-600 mb-1">ุงูุงุณู</label>
                                            <input name="reviewerName" required class="w-full border border-stone-300 rounded-lg p-2 text-sm focus:outline-none focus:border-stone-900 focus:ring-1 focus:ring-stone-900" placeholder="ุงุณูู ุงููุฑูู">
                                        </div>
                                        <div>
                                            <label class="block text-xs font-bold text-stone-600 mb-1">ุฃุถู ูุฑุงุฌุนุฉ ููุชูุจุฉ</label>
                                            <textarea name="reviewerComment" required rows="3" class="w-full border border-stone-300 rounded-lg p-2 text-sm focus:outline-none focus:border-stone-900 focus:ring-1 focus:ring-stone-900" placeholder="ูุง ุงูุฐู ุฃุนุฌุจู ุฃู ูู ูุนุฌุจูุ ุจูุงุฐุง ุชูุตุญุ"></textarea>
                                        </div>
                                        <button class="w-full bg-stone-900 text-white py-2 rounded-lg text-sm font-bold hover:bg-stone-800 transition-colors shadow-md">ุฅุฑุณุงู</button>
                                    </form>
                                </div>
                            </div>

                            <!-- Left: Reviews List -->
                            <div class="lg:col-span-8 space-y-6">
                                <h3 class="font-bold text-xl mb-4">ุฃูุถู ุงููุฑุงุฌุนุงุช</h3>
                                ${productReviews.length > 0 ? productReviews.map(r => `
                                    <div class="flex gap-4 mb-6">
                                        <div class="w-10 h-10 rounded-full bg-stone-200 flex items-center justify-center font-bold text-stone-600 text-lg flex-shrink-0">${r.userName.charAt(0)}</div>
                                        <div class="flex-1">
                                            <div class="flex items-center gap-2 mb-1">
                                                <span class="font-bold text-sm text-stone-900">${r.userName}</span>
                                            </div>
                                            <div class="flex items-center gap-2 mb-2">
                                                <div class="flex text-yellow-400 text-xs">
                                                    ${Array(5).fill(0).map((_,i) => `<i data-lucide="star" class="w-4 h-4 ${i < r.rating ? 'fill-current' : 'text-stone-200'}"></i>`).join('')}
                                                </div>
                                                ${r.verified ? `<span class="text-xs font-bold text-orange-600">ุชู ุงูุดุฑุงุก (Verified Purchase)</span>` : ''}
                                            </div>
                                            <p class="text-xs text-stone-400 mb-2">ุชูุช ุงููุฑุงุฌุนุฉ ูู ${new Date(r.createdAt).toLocaleDateString('ar-EG', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                                            <p class="text-stone-700 text-sm leading-relaxed font-medium mb-4">${r.comment}</p>
                                            <div class="flex gap-4 text-xs text-stone-500">
                                                <button class="border border-stone-200 px-4 py-1 rounded-full hover:bg-white transition-colors">ูููุฏ</button>
                                                <button class="text-stone-400 hover:text-stone-600">ุฅุจูุงุบ</button>
                                            </div>
                                        </div>
                                    </div>
                                `).join('') : `
                                    <div class="bg-white rounded-xl p-8 text-center border border-dashed border-stone-200">
                                        <p class="text-stone-500">ูุง ุชูุฌุฏ ูุฑุงุฌุนุงุช ุญุชู ุงูุขู.</p>
                                    </div>
                                `}
                            </div>
                        </div>
                    </div>

                    <!-- NEW: History Slider (Smaller Cards) -->
                    ${renderSliderHTML('history-slider-section', 'ุณุฌู ุงูุชุตูุญ ุงูุฎุงุต ุจู', historyProducts, true)}

                    <!-- NEW: Popular Search Cloud (Dynamic) -->
                    <div class="mt-16 border-t border-stone-100 pt-10 pb-8">
                         <div class="flex justify-between items-end mb-6">
                            <h3 class="text-xl font-bold text-stone-900">ุงูุจุญุซ ุงูุดุงุฆุน</h3>
                         </div>
                         <div class="flex flex-wrap gap-2.5">
                            ${dynamicTags.length > 0 ? dynamicTags.map(tag => `
                                <button onclick="updateShopFilters('search', '${tag}'); setView('shop')" class="bg-stone-100 hover:bg-stone-200 text-stone-600 hover:text-stone-900 px-3 py-1.5 rounded-md text-xs md:text-sm font-medium transition-colors border border-transparent hover:border-stone-300">
                                    ${tag}
                                </button>
                            `).join('') : '<p class="text-sm text-stone-400">ูุง ุชูุฌุฏ ูููุงุช ุจุญุซ ุดุงุฆุนุฉ ุญุงููุงู.</p>'}
                         </div>
                    </div>

                </div>
            </div>`;
        }
        
        // --- Helper Function: Create Small Product Card ---
        function createSmallProductCard(p) {
            // UPDATE: Use helper
            const hasDiscount = isDiscountActive(p);
            const finalPrice = hasDiscount ? (p.price * (1 - p.discount / 100)) : p.price;
            const isAdmin = user && user.email === ADMIN_EMAIL;
            
            return `
            <div class="group flex flex-col gap-2 cursor-pointer h-full" onclick="viewProduct('${p.id}')">
                <div class="relative aspect-square bg-white border border-stone-100 rounded-[1.5rem] overflow-hidden group-hover:shadow-md transition-all duration-300">
                    <!-- Brand Badge -->
                    <div class="absolute top-2 right-2 z-10">
                        <span class="bg-[#00796B] text-white text-[9px] font-bold px-2 py-1 rounded-full shadow-sm">${p.brand || 'ููุชุฌ'}</span>
                    </div>

                    <!-- NEW: Admin Controls -->
                    ${isAdmin ? `
                    <div class="absolute top-2 left-2 z-20 flex flex-col gap-1.5">
                        <button onclick="event.stopPropagation(); handleEditProduct('${p.id}')" class="w-6 h-6 bg-blue-50/90 text-blue-600 rounded-full flex items-center justify-center shadow-sm hover:bg-blue-600 hover:text-white transition-all border border-blue-100" title="ุชุนุฏูู"><i data-lucide="pen-line" size="12"></i></button>
                        <button onclick="event.stopPropagation(); handleDeleteProduct('${p.id}')" class="w-6 h-6 bg-red-50/90 text-red-600 rounded-full flex items-center justify-center shadow-sm hover:bg-red-600 hover:text-white transition-all border border-red-100" title="ุญุฐู"><i data-lucide="trash-2" size="12"></i></button>
                    </div>
                    ` : ''}

                    <!-- Image -->
                    <img src="${p.image}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" loading="lazy">
                    
                    <!-- Add Button -->
                    <div class="absolute bottom-2 left-0 w-full px-2 opacity-0 group-hover:opacity-100 transition-all duration-300">
                        <button onclick="event.stopPropagation(); addToCart('${p.id}')" class="w-full bg-white text-stone-900 text-[10px] font-bold py-2 rounded-full shadow-lg hover:bg-white">
                            ุฃุถู
                        </button>
                    </div>
                </div>
                
                <div class="px-1 text-right">
                    <h3 class="text-stone-800 font-bold text-xs leading-snug line-clamp-1 mb-1">${p.name}</h3>
                    <div class="flex items-center justify-end gap-2 dir-ltr">
                        <span class="text-[#00796B] text-sm font-bold">${Math.floor(finalPrice)} ุฌ.ู</span>
                    </div>
                </div>
            </div>`;
        }

        function createProductCard(p) {
            const isFav = favorites.includes(p.id);
            const isAdmin = user && user.email === ADMIN_EMAIL;
            const hasDiscount = isDiscountActive(p);
            const finalPrice = hasDiscount ? (p.price * (1 - p.discount / 100)) : p.price;
            
            // Check Stock Status
            const isInStock = p.inStock !== false;

            // Format Price
            const priceFormatted = Math.floor(finalPrice).toLocaleString();
            const originalPriceFormatted = Math.floor(p.price).toLocaleString();

            return `
            <div class="group flex flex-col gap-2 cursor-pointer h-full select-none" onclick="viewProduct('${p.id}')">
                <!-- Image Container -->
                <div class="relative aspect-[4/5] bg-white rounded-xl md:rounded-[2rem] overflow-hidden transition-all duration-300 group-hover:shadow-lg border border-stone-100 group-hover:border-stone-200">
                    
                    <!-- OUT OF STOCK OVERLAY (z-40) -->
                    ${!isInStock ? `
                    <div class="absolute inset-0 bg-white/60 z-40 flex items-center justify-center backdrop-blur-[1px]">
                        <div class="bg-red-600 text-white text-xs font-bold px-3 py-1 rounded-full shadow-lg rotate-12 border-2 border-white flex items-center gap-1">
                            <i data-lucide="ban" size="14"></i> ุบูุฑ ูุชููุฑ
                        </div>
                    </div>` : ''}

                    <!-- DISCOUNT BADGE -->
                    ${hasDiscount && isInStock ? `
                    <div class="absolute top-1.5 right-1.5 md:top-3 md:right-3 z-30">
                        <div class="bg-red-600 text-white text-[8px] md:text-xs font-bold px-1.5 py-0.5 md:px-3 md:py-1.5 rounded md:rounded-lg shadow-md border border-white/20 flex items-center gap-1">
                            <span class="dir-ltr">-${p.discount}%</span>
                        </div>
                    </div>` : ''}

                    <!-- Brand Badge -->
                    <div class="absolute bottom-1 right-1 md:bottom-4 md:right-4 z-20 transition-opacity duration-300 group-hover:opacity-0 hidden md:block">
                        <span class="bg-white/80 backdrop-blur-md text-stone-700 text-[10px] font-bold px-2 py-0.5 rounded shadow-sm border border-stone-100/50">${p.brand || 'JEDAR'}</span>
                    </div>

                    <!-- Top Left: Floating Actions (UPDATED Z-INDEX TO 50) -->
                    <div class="absolute top-1.5 left-1.5 md:top-3 md:left-3 z-50 flex flex-col gap-1.5">
                        <!-- Favorite (ุชู ุฅุถุงูุฉ ููุงุณ fav-btn-${p.id}) -->
                        <button onclick="event.stopPropagation(); toggleFavorite('${p.id}')" class="fav-btn-${p.id} w-7 h-7 md:w-9 md:h-9 bg-white/90 backdrop-blur-sm rounded-full flex items-center justify-center shadow-sm hover:scale-110 transition-transform border ${isFav ? 'text-red-500 border-red-100' : 'text-stone-400 border-stone-100'}">
                            <i data-lucide="heart" size="14" class="md:w-[18px] md:h-[18px] ${isFav ? 'fill-current' : ''}"></i>
                        </button>

                        <!-- Admin Controls (ุชูุช ุฅุนุงุฏุชูุง ูุชุตุบูุฑูุง ููููุจุงูู) -->
                        ${isAdmin ? `
                        <button onclick="event.stopPropagation(); handleEditProduct('${p.id}')" class="w-7 h-7 md:w-9 md:h-9 bg-blue-50/90 text-blue-600 rounded-full flex items-center justify-center shadow-sm hover:bg-blue-600 hover:text-white transition-all border border-blue-100" title="ุชุนุฏูู"><i data-lucide="pen-line" size="14" class="md:w-4 md:h-4"></i></button>
                        <button onclick="event.stopPropagation(); handleDeleteProduct('${p.id}')" class="w-7 h-7 md:w-9 md:h-9 bg-red-50/90 text-red-600 rounded-full flex items-center justify-center shadow-sm hover:bg-red-600 hover:text-white transition-all border border-red-100" title="ุญุฐู"><i data-lucide="trash-2" size="14" class="md:w-4 md:h-4"></i></button>
                        ` : ''}
                    </div>

                    <!-- Product Image -->
                    <div class="absolute inset-0">
                        <img src="${p.image}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700 ease-in-out ${!isInStock ? 'grayscale opacity-80' : ''}" loading="lazy" alt="${p.name}">
                    </div>

                    <!-- Add To Cart Button (Floating) -->
                    ${isInStock ? `
                    <div class="hidden md:block absolute bottom-3 left-3 right-3 translate-y-4 opacity-0 group-hover:translate-y-0 group-hover:opacity-100 transition-all duration-300 z-30">
                        <button onclick="event.stopPropagation(); addToCart('${p.id}')" class="w-full bg-stone-900/90 backdrop-blur-sm text-white font-bold py-3 rounded-xl shadow-lg hover:bg-stone-900 transition-colors flex items-center justify-center gap-2 text-sm">
                            ุฃุถู ุฅูู ุงูุนุฑุจุฉ
                        </button>
                    </div>
                    
                    <!-- Mobile Add Button -->
                    <button onclick="event.stopPropagation(); addToCart('${p.id}')" class="md:hidden absolute bottom-1.5 left-1.5 w-7 h-7 bg-stone-900/90 text-white rounded-full flex items-center justify-center shadow-md z-30">
                        <i data-lucide="plus" size="14"></i>
                    </button>
                    ` : ''}
                </div>

                <!-- Info Section -->
                <div class="px-1 md:px-2 text-right flex flex-col gap-0.5 md:gap-1">
                    <!-- Title -->
                    <h3 class="text-stone-800 font-bold text-[10px] md:text-sm leading-tight line-clamp-2 h-7 md:h-auto group-hover:text-[#00796B] transition-colors" title="${p.name}">${p.name}</h3>
                    
                    <!-- Price -->
                    <div class="flex items-center justify-end gap-1 md:gap-2 mt-0.5 dir-ltr flex-wrap">
                        <span class="text-[#00796B] text-xs md:text-lg font-bold">${priceFormatted} <span class="text-[8px] md:text-xs text-[#00796B]">ุฌ.ู</span></span>
                        ${hasDiscount ? `<span class="text-stone-400 text-[9px] md:text-xs line-through decoration-stone-400 decoration-1">${originalPriceFormatted}</span>` : ''}
                    </div>
                </div>
            </div>`;
        }

        // Start
        init();
    </script>
</body>
</html>